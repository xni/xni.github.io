!function(){var e={exports:{}},r=e.exports;r.name="yawikitext",r.uri="https://wiki.yandex-team.ru/types/yawikitextv1",r.create=function(e){if(null!=e&&"string"!=typeof e)throw Error("Initial data must be a string");return e||""};var t=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},o=function(e){if(!t(e))throw Error("Op must be an array of components");for(var r=null,o=0;o<e.length;o++){var n=e[o];switch(typeof n){case"object":if("number"==typeof n.d&&n.d>0)break;if("string"==typeof n.i)break;throw Error('Object components must be {d: +ive} or {i:"str", h:"str"}, not'+n.i+n.d);case"number":if(!(n>0))throw Error("Skip components must be >0");if("number"==typeof r)throw Error("Adjacent skip components should be combined")}r=n}if("number"==typeof r)throw Error("Op has a trailing skip")},n=function(e){return function(r){return console.log("makeAppend in yawikitext: op is",e,"component is",r),e.push(r)}},i=function(e){var r=0,t=0,o=function(o,n){if(r===e.length)return-1===o?null:o;var i,s=e[r];return"number"==typeof s?-1===o||o>=s-t?(i=s-t,++r,t=0,i):(t+=o,o):"string"==typeof s.i?-1===o||"i"===n||s.i.length-t<=o?(i=s.i.slice(t),++r,t=0,{i:i,h:s.h}):(i=s.i.slice(t,t+o),t+=o,{i:i,h:s.html}):-1===o||"d"===n||s.d-t<=o?(i={d:s.d-t},++r,t=0,i):(t+=o,{d:o})},n=function(){return e[r]};return[o,n]},s=function(e){return"number"==typeof e?e:e.length||e.d},f=function(e){return e.length>0&&"number"==typeof e[e.length-1]&&e.pop(),e};r.normalize=function(e){for(var r=[],t=n(r),o=0;o<e.length;o++)t(e[o]);var i=f(r);return i},r.apply=function(e,r){if("string"!=typeof e)throw Error("Snapshot should be a string");o(r);for(var t=[],n=0;n<r.length;n++){var i=r[n];switch(typeof i){case"number":if(i>e.length)throw Error("The op is too long for this document");t.push(e.slice(0,i)),e=e.slice(i);break;case"object":"number"==typeof i.d?e=e.slice(i.d):t.push(i.i)}}return t.join("")+e},r.transform=function(e,r,t){if(console.log('transform: "',e,'" by op "',r,'". Side is ',t),"left"!=t&&"right"!=t)throw Error("side ("+t+") must be 'left' or 'right'");o(e),o(r);for(var a=[],u=n(a),c=i(e),l=c[0],p=c[1],b=0;b<r.length;b++){var h,m,g=r[b];switch(console.log("debug transform, right op component is",g),typeof g){case"number":for(h=g;h>0;)m=l(h,"i"),u(m),console.log("debug transform, took:",m,"length is",h),("object"!=typeof m||"string"!=typeof m.i)&&(h-=s(m)),console.log("debug transform, length is",h);break;case"object":if("number"==typeof g.d)for(h=g.d;h>0;)switch(m=l(h,"i"),console.log("debug transform, took chunk",m),typeof m){case"number":h-=m;break;case"object":if("number"!=typeof m.d){u(m);break}h-=m.d,console.log("new op is currently",a)}else{if("left"===t){var y=p();if(console.log("debug transform insert, peeked",y),"object"==typeof y&&"string"==typeof y.i){{l(-1)}console.log("debug transform insert, peeked",y),u(l(-1))}}u(g.i.length)}}}for(;g=l(-1);)u(g);return console.log("transformed to",a),f(a)},r.compose=!1;var a=function(e,r){for(var t=0,o=0;o<r.length;o++){var n=r[o];if(t>=e)break;switch(typeof n){case"number":if(t+n>=e)return e;t+=n;break;case"object":"number"==typeof n.d?e-=Math.min(n.d,e-t):(t+=n.i.length,e+=n.i.length)}}return e};r.transformSelection=function(e,r,t){var o=0;if(t){for(var n=0;n<r.length;n++){var i=r[n];switch(typeof i){case"number":o+=i;break;case"object":if("string"==typeof i.i){o+=i.i.length;break}}}return o}return"number"==typeof e?a(e,r):[a(e[0],r),a(e[1],r)]},r.transformCursor=r.transformSelection,r.selectionEq=function(e,r){return null!=e[0]&&e[0]===e[1]&&(e=e[0]),null!=r[0]&&r[0]===r[1]&&(r=r[0]),e===r||null!=e[0]&&null!=r[0]&&e[0]===r[0]&&e[1]==r[1]};var u=window.ottypes=window.ottypes||{},c=e.exports;u[c.name]=c,c.uri&&(u[c.uri]=c)}();