var BEMHTML=function(){function t(t){return t._mode=i,t.block=n,t.elem=s,t.elemMods=o,t.mods=r,t}function e(t,e){var a=i;i=e._mode;var l=n;n=e.block;var c=s;s=e.elem;var d=o;o=e.elemMods;var u=r;r=e.mods;var h=t(e);return i=a,n=l,s=c,o=d,r=u,h}var i,n,s,o,r,a,l={},c=function(l){function c(t){var e=i;return"content"===e?d(t):"tag"===e?T(t):"default"===e?O(t):"attrs"===e?H(t):"js"===e?R(t):"mods"===e?"popup"===n?!(r&&"yes"===r.editor)==!1?!!s==!1?t._.extend(t.ctx.mods,{adaptive:"yes"}):Q(t):Q(t):Q(t):"mix"===e?q(t):"service-url"===e?"i-services"===n?W(t):Q(t):""===e?K(t):Q(t)}function d(t){var e=n;if("b-notification"===e)return"content"===s?!(r&&"old-page-maybe"===r.type)==!1?[BEM.I18N("b-notification","notification"),{block:"button",mods:{size:"m",pseudo:"yes"},mix:[{block:"b-old-page",js:{actuality:"actual"}}],content:BEM.I18N("b-notification","not_actual")},{block:"button",mods:{size:"m",pseudo:"yes"},mix:[{block:"b-old-page",js:{actuality:"obsolete"}}],content:BEM.I18N("b-notification","actual")}]:u(t):u(t);if("b-copyright"===e){if("link"===s)return t.ctx.content||BEM.I18N("b-copyright","yandex");if(!!s==!1){var i=(new Date).getFullYear(),o=t.ctx.start?t.ctx.start:i,a="©&#160;"+o;return i===o||(a+="&#8211;"+i),a+="&#160;&#160;",[a,t.ctx.content?t.ctx.content:{block:"i-bem",elem:"i18n",keyset:"b-copyright",key:"link",content:{block:n,elem:"link"}}]}return Q(t)}if("b-form-button"===e)return!(r&&"simple"===r.type)==!1?!!s==!1?[{elem:"simple",content:t.ctx.content},t._click,t._input]:Q(t):Q(t);if("b-form-input"===e)return"input"===s?!(r&&"textarea"===r.type)==!1?t._.xmlEscape(t._value||t.ctx.content||""):Q(t):Q(t);if("b-comment-restore"===e)return!!s==!1?BEM.I18N("b-comment-restore","restore_comment"):Q(t);if("popup"===e)return"content"===s?!(r&&"yes"===r.editor)==!1?[{elem:"data",content:""},{elem:"buttons",mix:[{block:"clearfix"}],content:[{block:"button",mods:{size:"s",action:"add",theme:"action"},content:"Добавить"},{block:"button",mods:{size:"s",action:"cancel"},content:"Отмена"}]}]:Q(t):Q(t);if("b-comment-answer"===e)return!!s==!1?{elem:"head",content:{block:"b-form-button",mix:{block:"b-comment-answer",elem:"button"},mods:{theme:"simple-grey",size:"s",type:"simple"},type:"button",content:t.ctx.content?t.ctx.content:BEM.I18N("b-comment-answer","comment_reply")}}:Q(t);if("m-date"===e)return!(r&&"anchor"===r.type)==!1?!!s==!1?x(t):Q(t):Q(t);if("b-menu"===e)return"item"===s?!(r&&"horiz-simple"===r.layout)==!1?t.isLast()?t.ctx.content:[t.ctx.content,"&nbsp;· "]:E(t):E(t);if("b-foot"===e){var e=s;return"layout-gap"===e?{elem:"layout-gap-i"}:"layout"===e?{bem:!1,elem:"row",content:[{elem:"layout-gap",content:{elem:"layout-gap-i"}},t.ctx.content,{elem:"layout-gap",content:{elem:"layout-gap-i"}}]}:Q(t)}if("m-head"===e)return"action"===s?!(r&&"wiki"===r.type)==!1?[{block:"button",mix:[{block:"b-readonly-item",js:!0}],mods:{size:"m",type:"new-page",pseudo:"yes"},content:t.ctx.action.content}]:{block:"button",mods:{size:"m"},url:t.ctx.action.url||!1,content:t.ctx.action.content||t.ctx.action}:Q(t);if("m-speller"===e){var e=s;return"add-to-dict"===e?"+ "+BEM.I18N("m-speller","add-to-dict"):"corrections-not-found"===e?BEM.I18N("m-speller","corr-not-found"):"text"===e?[{tag:"span",content:t.ctx.before},{elem:"attention",tag:"b",content:t.ctx.word},{tag:"span",content:t.ctx.after}]:!!s==!1?w(t):Q(t)}if("m-orange-actions"===e)return!!s==!1?B(t):Q(t);if("m-editor-popup"===e)return!(r&&"other"===r.type)==!1?!!s==!1?t.ctx.data.map(function(t){return[{block:"m-editor-button",mods:{type:t},caption:!0}]}):_(t):_(t);if("m-orange"===e)return!!s==!1?[{elem:"icon",tag:"span",mix:[{block:"awesome-icon",mods:{icon:"list"}}]},{elem:"counter",tag:"strong"}]:Q(t);if("m-editor"===e)return!!s==!1?{block:"input",value:t.ctx.value?t.ctx.value:!1,name:t.ctx.name?t.ctx.name:null,mods:{type:"textarea",size:"s",editor:"wiki"},content:{elem:"control"}}:Q(t);if("m-head-user"===e)return!!s==!1?I(t):Q(t);if("m-calendar"===e)return!(r&&"input"===r.toggler)==!1?!!s==!1?{elem:"toggler",content:{block:"input",mods:{size:t.ctx.size,clear:"no",toggler:"datepicker",disabled:t.ctx.mods.disabled||""},content:[t.ctx.js.defaultText?{elem:"hint",content:t.ctx.js.defaultText}:"",{elem:"control",attrs:t.extend(t.ctx.attrs||{},{readonly:"yes"})}]}}:Q(t):Q(t);if("m-head-search"===e)return S(t);if("m-uploader"===e)return f(t);if("b-favs-link"===e){if("date"===s){if(!t.ctx.timestamp==!1){var l=BEM.blocks["mi-helpers"].getDateFromHumanString(t.ctx.timestamp),c=function(t){return 10>t?"0"+t:t},d=c(l.getDate()),p=c(l.getMonth()+1),g=l.getFullYear();return[d,p,g].join(".")}return Q(t)}return Q(t)}return"b-page-official-user"===e?!!s==!1?[{block:"m-userpic",url:"http://staff/"+t.ctx.login,size:"30",login:t.ctx.login},{block:"b-user",mix:[{block:"mi-staff-card",js:{user:t.ctx.login}}],mods:{is_dismissed:t.ctx.is_dismissed},url:"http://staff.yandex-team.ru/"+t.ctx.login,content:t.ctx.display}]:Q(t):"b-favs-links"===e?!!s==!1?{block:"scroll",mods:{theme:"normal",tech:"js"},content:[{block:"spinner",mods:{size:"xs",show:"no"}},{block:"b-favs-links",elem:"list",content:[]}]}:Q(t):"b-page-favorites-button"===e?!(r&&"delete"===r.type)==!1?!!s==!1?{block:"awesome-icon",mods:{icon:"bookmark"}}:m(t):m(t):"b-favs-folders"===e?!!s==!1?{block:"scroll",mods:{theme:"normal",tech:"js"},content:[{block:"spinner",mods:{size:"xs",show:"no"}},{block:"b-favs-folders",elem:"list",content:[]}]}:Q(t):"b-widget"===e?h(t):"b-favs-widget"===e?!!s==!1?[{elem:"paranja"},{elem:"content",content:[{block:"b-favs-folders",js:!0},{block:"b-favs-links",js:!0},{block:"button",mods:{size:"m"},mix:[{block:"b-readonly-item",js:!0},{block:"b-favs-options-button",js:!0}],content:BEM.I18N("b-favs-widget","settings")}]}]:Q(t):"b-comment-delete"===e?!!s==!1?BEM.I18N("b-comment-delete","delete_comment"):Q(t):Q(t)}function u(t){return!!s==!1?[{elem:"content",content:[]},{elem:"close",content:{block:"awesome-icon",mods:{icon:"remove"}}}]:Q(t)}function h(t){return"content"===s?p(t):Q(t)}function p(t){return!(r&&"request-access"===r.type)==!1?[{block:"b-request-access",mods:{type:"loading"},js:!0,content:[{elem:"content",content:[{block:"spinner",mods:{size:"xs",progress:"yes"}}]},{elem:"buttons",content:[]}]}]:Q(t)}function m(t){return!(r&&"add"===r.type)==!1?!!s==!1?{block:"awesome-icon",mods:{icon:"bookmark-empty"}}:Q(t):Q(t)}function f(t){if(!(t.__$anflg96!==!0)==!1){if(!(r&&"form"===r.type)==!1){if(!!s==!1){var e,i,n=(e=t.__$anflg96,t.__$anflg96=!0,i=f(t),t.__$anflg96=e,i);return n[0].mix=t._.extend(n[0].mix,{block:"b-readonly-item",js:!0}),n}return Q(t)}return Q(t)}return Q(t)}function _(t){return!(r&&"spell"===r.type)==!1?!!s==!1?{block:"m-speller",js:!0}:g(t):g(t)}function g(t){return!(r&&"code"===r.type)==!1?!!s==!1?b(t):k(t):k(t)}function b(t){return[{elem:"header",tag:"h3",content:BEM.I18N("m-editor-popup","createCode")},{elem:"content",content:[{elem:"select-label",content:BEM.I18N("m-editor-popup","codeStyle")},{block:"select",name:"codeStyle",mods:{size:"s",theme:"normal",width:"150"},js:{rows:6},content:[{block:"button",content:"Plain Text"},{elem:"control",content:[{elem:"option",attrs:{value:""},content:"Plain Text"},{elem:"option",attrs:{value:"1c"},content:"1C"},{elem:"option",attrs:{value:"apache"},content:"Apache"},{elem:"option",attrs:{value:"applescript"},content:"AppleScript"},{elem:"option",attrs:{value:"bash"},content:"Bash"},{elem:"option",attrs:{value:"cs"},content:"C#"},{elem:"option",attrs:{value:"cpp"},content:"C++"},{elem:"option",attrs:{value:"cmake"},content:"CMake"},{elem:"option",attrs:{value:"coffeescript"},content:"CoffeeScript"},{elem:"option",attrs:{value:"css"},content:"CSS"},{elem:"option",attrs:{value:"diff"},content:"Diff"},{elem:"option",attrs:{value:"django"},content:"Django"},{elem:"option",attrs:{value:"dos"},content:"DOS .bat"},{elem:"option",attrs:{value:"erlang"},content:"Erlang"},{elem:"option",attrs:{value:"erlang-repl"},content:"Erlang REPL"},{elem:"option",attrs:{value:"haskell"},content:"Haskell"},{elem:"option",attrs:{value:"xml"},content:"HTML, XML"},{elem:"option",attrs:{value:"http"},content:"HTTP"},{elem:"option",attrs:{value:"ini"},content:"Ini"},{elem:"option",attrs:{value:"java"},content:"Java"},{elem:"option",attrs:{value:"javascript"},content:"JavaScript"},{elem:"option",attrs:{value:"json"},content:"JSON"},{elem:"option",attrs:{value:"lisp"},content:"Lisp"},{elem:"option",attrs:{value:"markdown"},content:"Markdown"},{elem:"option",attrs:{value:"matlab"},content:"Matlab"},{elem:"option",attrs:{value:"nginx"},content:"Nginx"},{elem:"option",attrs:{value:"objectivec"},content:"Objective C"},{elem:"option",attrs:{value:"perl"},content:"Perl"},{elem:"option",attrs:{value:"php"},content:"PHP"},{elem:"option",attrs:{value:"python"},content:"Python"},{elem:"option",attrs:{value:"profile"},content:"Python profile"},{elem:"option",attrs:{value:"r"},content:"R"},{elem:"option",attrs:{value:"ruby"},content:"Ruby"},{elem:"option",attrs:{value:"scala"},content:"Scala"},{elem:"option",attrs:{value:"sql"},content:"SQL"},{elem:"option",attrs:{value:"tex"},content:"TeX"}]}]},{block:"input",mods:{type:"textarea",size:"s"},content:[{elem:"control",attrs:{name:"codeText",placeholder:BEM.I18N("m-editor-popup","codeText"),rows:"10"},content:t.ctx.js.selection&&t.ctx.js.selection.text?t.ctx.js.selection.text:""}]}]}]}function k(t){return!(r&&"picture"===r.type)==!1?!!s==!1?v(t):y(t):y(t)}function v(){return[{elem:"header",tag:"h3",content:BEM.I18N("m-editor-popup","createPicture")},{elem:"content",content:[{block:"input",mods:{size:"s"},content:[{elem:"label",content:BEM.I18N("m-editor-popup","pictureLink")},{elem:"control",attrs:{name:"pictureLink",value:"",placeholder:BEM.I18N("m-editor-popup","pictureLinkPlaceholder")}}]},{block:"size",content:[{block:"input",mods:{size:"s",picture:"width"},content:[{elem:"label",content:BEM.I18N("m-editor-popup","pictureSize")},{elem:"under-label",content:BEM.I18N("m-editor-popup","picturePixels")},{elem:"control",attrs:{name:"pictureWidth",value:"",placeholder:BEM.I18N("m-editor-popup","pictureWidth")}}]},{block:"input",mods:{size:"s",picture:"height"},content:[{elem:"label",content:"x"},{elem:"control",attrs:{name:"pictureHeight",value:"",placeholder:BEM.I18N("m-editor-popup","pictureHeight")}}]}]}]}]}function y(t){return!(r&&"link"===r.type)==!1?!!s==!1?M(t):Q(t):Q(t)}function M(t){return[{elem:"header",tag:"h3",content:BEM.I18N("m-editor-popup","createLink")},{elem:"content",content:[{block:"input",mods:{size:"s"},content:[{elem:"label",content:BEM.I18N("m-editor-popup","pathToLink")},{elem:"control",attrs:{name:"pathToLink",value:"",placeholder:BEM.I18N("m-editor-popup","pathToLink")}}]},{block:"input",mods:{size:"s"},content:[{elem:"label",content:BEM.I18N("m-editor-popup","linkText")},{elem:"control",attrs:{name:"linkText",value:t.ctx.js.selection&&t.ctx.js.selection.text?t.ctx.js.selection.text:"",placeholder:BEM.I18N("m-editor-popup","linkText")}}]}]}]}function w(){return[{elem:"status",content:BEM.I18N("m-speller","not-checked")},{elem:"flex-container",elemMods:{"hide-in-finish":"yes"},content:[{elem:"flex-item",mods:{side:"left",role:"notfound"},content:BEM.I18N("m-speller","notfound")},{elem:"flex-item",mods:{side:"right"},content:{block:"island",mods:{type:"light",role:"input-text"}}}]},{elem:"flex-container",elemMods:{"hide-in-finish":"yes"},content:[{elem:"flex-item",mods:{side:"left"},content:BEM.I18N("m-speller","correction-title")},{elem:"items-wrapper",content:[{elem:"flex-item",mods:{side:"right"},content:{block:"input",mods:{size:"s",type:"error"},mix:[{block:"m-speller",elem:"text-input"}],content:{elem:"control"}}},{elem:"flex-item",mods:{side:"right"},content:{block:"island",mods:{type:"light",role:"correction-options"}}}]}]},{elem:"flex-container",mods:{"hide-in-finish":"yes"},content:[{elem:"flex-item",mods:{side:"left"}},{elem:"flex-item",mods:{side:"right"},content:{block:"button",mods:{size:"s",type:"params"},content:BEM.I18N("m-speller","params")}}]},{elem:"options",mods:{hidden:"yes"},content:[{elem:"flex-container",content:[{elem:"flex-item",mods:{side:"left"},content:BEM.I18N("m-speller","checking-language")},{elem:"flex-item",mods:{side:"right"},content:{block:"select",mods:{size:"s",theme:"normal",type:"lang"},mix:[{block:"m-speller",elem:"speller-select"}],content:[{block:"button",content:BEM.I18N("m-speller","select")},{elem:"control",content:["en","ru","uk"].map(function(t){return{elem:"option",attrs:{value:t},content:BEM.I18N("m-speller",t)}})}]}}]},{elem:"flex-container",mods:{"hide-in-finish":"yes"},content:["ignore-uppercase","ignore-digits","ignore-urls","find-repeat"].map(function(t){return{block:"checkbox",mods:{size:"s",type:t},content:{elem:"label",content:BEM.I18N("m-speller",t)}}}).concat([{block:"button",mods:{size:"s",type:"user-dict"},mix:[{block:"m-speller",elem:"info-block"}],content:BEM.I18N("m-speller","userDict")},{block:"userdict",mods:{hidden:"yes"},mix:[{block:"m-speller",elem:"info-block"}],content:[{block:"input",mods:{type:"textarea",size:"s",role:"dict"},content:{elem:"control"}}]}])}]},{elem:"flex-container",elemMods:{"hide-in-finish":"yes"},content:[{elem:"flex-item",mods:{side:"left"},content:{block:"button",mods:{type:"cancel",size:"s"},type:"button",content:BEM.I18N("m-speller","cancel")}},{elem:"flex-item",mods:{side:"right",align:"right"},content:[{block:"button",mods:{type:"ignore-once",size:"s"},type:"button",content:BEM.I18N("m-speller","ignore-once")},{block:"button",mods:{type:"replace",size:"s"},type:"button",content:BEM.I18N("m-speller","replace")}]}]}]}function x(t){return[{elem:"date",tag:"a",attrs:{href:t.ctx.url?"#"+t.ctx.url:"#"+t["mi-helpers"].getDateFromHumanString(t.ctx.timestamp).getTime()},content:[t.ctx.content?t.ctx.content+"&nbsp;":"",{block:"mi-date",timestamp:t.ctx.timestamp,"short":t.ctx.short?!0:!1,alwaysShowYear:t.ctx.alwaysShowYear?!0:!1,format:t.ctx.format}]},{elem:"anchor",tag:"a",attrs:{name:t.ctx.url?t.ctx.url:t["mi-helpers"].getDateFromHumanString(t.ctx.timestamp).getTime()}}]}function E(t){return!(r&&"horiz-simple"===r.layout)==!1?!!s==!1?[t.ctx.title,t.ctx.content]:Q(t):Q(t)}function B(t){var e;return e=t.ctx.answer&&t.ctx.answer>1?2==t.ctx.answer?[{block:"awesome-icon",mods:{icon:"ok"}},BEM.I18N("m-orange-actions","accepted")]:[{block:"awesome-icon",mods:{icon:"remove"}},BEM.I18N("m-orange-actions","declined")]:[{block:"button",mods:{size:"s",theme:"action",action:"accept"},content:[{block:"awesome-icon",mods:{icon:"ok"}},BEM.I18N("m-orange-actions","accept")]},{block:"button",mods:{size:"s",action:"decline"},content:[{block:"awesome-icon",mods:{icon:"remove"}},BEM.I18N("m-orange-actions","decline")]}],t.ctx.userComment&&e.push({elem:"comment-text",content:BEM.I18N("m-orange-actions","comment")+": "+BEM.I18N("m-orange-actions","laquo")+t.ctx.userComment+BEM.I18N("m-orange-actions","raquo")}),t.ctx.comment&&1==t.ctx.answer&&e.push({block:n,elem:"comment",mix:[{block:"m-orange-item",elem:"comment"}],content:[{block:"input",mods:{type:"textarea"},content:{elem:"control",controlAttrs:{placeholder:BEM.I18N("m-orange-actions","comment_placeholder")}}},{block:n,elem:"comment-submit",content:{block:"button",mods:{size:"s",theme:"action",disabled:"yes"},content:BEM.I18N("m-orange-actions","done")}}]}),e}function I(t){var e,i=t.ctx.customUserLinks,n=i&&i.my||!1,s=i&&i.settings||!1;return e=[{block:"m-userpic",mix:[{block:t.blockName,elem:"icon"}],login:t.ctx.user,size:50},{block:"popup",mods:{theme:"head"},js:{directions:{to:"bottom",axis:"right"}},content:[{elem:"content",content:{block:"m-head-services",mods:{column:"mono",type:"user"},content:{elem:"list",content:[{block:"link",mix:[{block:"awesome-icon",mods:{icon:"user"}}],url:n&&n.url||"//staff.yandex-team.ru/",content:n&&n.text||BEM.I18N("m-head-user","staff")},{block:"link",mix:[{block:"awesome-icon",mods:{icon:"cog"}}],url:s&&s.url||"//staff.yandex-team.ru/settings/",content:s&&s.text||BEM.I18N("m-head-user","options")},{block:"link",mix:[{block:"awesome-icon",mods:{icon:"signout"}}],url:"//passport.yandex-team.ru/passport?mode=logout",content:BEM.I18N("m-head-user","logout")}]}}}]}]}function S(t){if(!(t.__$anflg90!==!0)==!1){if(!(t.ctx.search&&t.ctx.search.supertag&&"/"!=t.ctx.search.pathname)==!1){if(!!s==!1){var e,i,n=(e=t.__$anflg90,t.__$anflg90=!0,i=S(t),t.__$anflg90=e,i),o=[n.content[1].content];return o.unshift({elem:"hidden",attrs:{type:"hidden",name:"from.cluster",value:t.ctx.search.supertag},tag:"input"}),n.content[1].content=o,n}return D(t)}return D(t)}return D(t)}function D(t){return!!s==!1?N(t):Q(t)}function N(t){return{elem:"search",attrs:{action:t.ctx.search&&t.ctx.search.action||"https://search.yandex-team.ru/search",autocomplete:"off"},content:[{elem:"col",content:{block:"m-suggest",mods:{type:"intranet-suggest",size:"s"},inputMods:{size:"m"},hint:t.ctx.search.hint||BEM.I18N("m-head-search","hint"),inHeader:!0,types:["staff"]}},{elem:"col",mix:[{elem:"button"}],content:{block:"button",mods:{size:"m",theme:"normal"},type:"submit",tabindex:2,content:BEM.I18N("m-head-search","find")}}]}}function T(t){var e=n;if("b-user-group"===e)return"remove"===s?"span":!!s==!1?"span":Q(t);if("b-form-button"===e)return"simple"===s?!(r&&"simple"===r.type)==!1?"span":Q(t):Q(t);if("b-form-input"===e)return"input"===s?!(r&&"textarea"===r.type)==!1?"textarea":Q(t):Q(t);if("b-comment"===e)return"text"===s?"span":Q(t);if("b-comment-restore"===e)return!!s==!1?"span":Q(t);if("b-last-changes"===e)return"text"===s?"span":Q(t);if("b-comments"===e){var e=s;return"comment"===e?"li":"list"===e?"ul":Q(t)}if("b-files-data"===e){var e=s;return"clear"===e||"size"===e||"last-changes"===e?"span":"name"===e||"download"===e?"a":Q(t)}if("b-files"===e)return!!t.ctx.count==!1?!!s==!1?"span":C(t):C(t);if("m-date"===e)return!(r&&"anchor"===r.type)==!1?!!s==!1?"span":Q(t):Q(t);if("b-comments-link"===e)return"number"===s?"span":!!s==!1?"a":Q(t);if("b-layout-table"===e)return!("cell"===s||"gap"===s)==!1?"td":"row"===s?"tr":!!s==!1?"table":Q(t);if("b-menu"===e){var e=s;return"item"===e?!(o&&"current"===o.state)==!1?!(r&&"horiz-simple"===r.layout)==!1?"span":Q(t):Q(t):"title"===e?!(r&&"horiz-simple"===r.layout)==!1?"h2":Q(t):Q(t)}if("b-copyright"===e){var e=s;return"link"===e?"span":"text"===e?"":Q(t)}if("b-foot"===e){var e=s;return"layout-column"===e?"td":"layout-gap-i"===e?"i":"layout-gap"===e?"td":"row"===e?"tr":"layout"===e?"table":Q(t)}if("b-tree-action"===e){var e=s;return"link"===e?"a":"list-item"===e?"li":"list"===e?"ul":"text"===e?"span":Q(t)}if("b-page-title"===e)return!!s==!1?"h1":Q(t);if("m-editor-popup"===e)return"select-label"===s?!(r&&"code"===r.type)==!1?"span":Q(t):Q(t);if("m-head-services"===e)return"icon"===s?"i":Q(t);if("m-speller"===e){var e=s;return"add-to-dict"===e?"i":"corrections-not-found"===e||"main-text"===e||"text"===e?"span":Q(t)}if("m-head-search"===e)return"search"===s?"form":Q(t);if("checkbox"===e)return"label"===s?"label":Q(t);if("b-favs-links"===e){var e=s;return"item"===e?"li":"list"===e?"ol":Q(t)}if("select-multiple"===e)return"option"===s?"option":!!s==!1?"select":Q(t);if("b-favs-folder"===e){var e=s;return"count"===e||"name"===e?"span":Q(t)}if("b-page-favorites-button"===e)return!!s==!1?"span":Q(t);if("b-favs-folders"===e){var e=s;return"item"===e?"li":"list"===e?"ol":Q(t)}return"b-comment-delete"===e?!!s==!1?"span":Q(t):Q(t)}function C(t){return!t.ctx.count==!1?!!s==!1?"a":Q(t):Q(t)}function O(t){var e=n;if("b-wiki-grid"===e)return!(t.__$anflg97!==!0&&t.__$anflg98!==!0)==!1?!!s==!1?P(t):Q(t):Q(t);if("popup"===e)return j(t);if("b-menu"===e)return F(t);if("b-foot"===e)return"links"===s?$(t):Q(t);if("i-services"===e){var e=s;return"url"===e?(t._buf.push(t["i-services"].serviceUrl(t.ctx.id,t.ctx.region)),void 0):"name"===e?(t._buf.push(t["i-services"].serviceName(t.ctx.id)),void 0):!s==!1?"":Q(t)}return Q(t)}function P(t){var e,n,s,o,r,a,l,c,d,u;if(t.ctx.js.data.error_code){var h=t.ctx.js.data.message||BEM.I18N("b-wiki-grid","backend_error")+": "+t.ctx.js.data.error_code;return e=t.__$anflg97,t.__$anflg97=!0,s=t.ctx,t.ctx={block:"b-grid-error",content:{elem:"message",content:h}},o=i,i="",r=K(t),t.ctx=s,i=o,n=r,t.__$anflg97=e,n}return a=t.__$anflg98,t.__$anflg98=!0,c=t.ctx,t.ctx={block:"b-grid-table",js:{getTableData:t.ctx.js.data.page,getTableReadOnly:t.ctx.js.data.readonly,getTableSort:t.ctx.js.data.sort,getTableFilter:t.ctx.js.data.filter,getTableWidth:t.ctx.js.data.width,getTableNumbers:t.ctx.js.data.num,getTableColumns:t.ctx.js.data.columns,isAction:!0},mix:[{block:"b-readonly-item",js:!0}]},d=i,i="",u=K(t),t.ctx=c,i=d,l=u,t.__$anflg98=a,l}function j(t){if(!(t.__$anflg95!==!0)==!1){if(!(r&&"yes"===r.wrapped)==!1){if(!!s==!1){t.ctx.content.push({elem:"wrapper",mix:t.ctx.wrapperMix,elemMods:t.ctx.wrapperMods});var e=t.__$anflg95;return t.__$anflg95=!0,j(t),t.__$anflg95=e,void 0}return L(t)}return L(t)}return L(t)}function L(t){return!(t.__$anflg94!==!0)==!1?!(r&&"scrollable"===r.behaviour)==!1?!!s==!1?A(t):Q(t):Q(t):Q(t)}function A(t){t.ctx.mods.wrapped="yes",t.ctx.mods["body-scroll"]="no",t.ctx.wrapperMods={behaviour:"scrollable"};var e=t.__$anflg94;t.__$anflg94=!0;var n=t.ctx;t.ctx=t.ctx;var s=i;i="",K(t),t.ctx=n,i=s,t.__$anflg94=e}function F(t){if("link"===s){if(!(t.__$anflg92!==!0)==!1){if(!t._inFooter==!1){var e=t._.extend(t.ctx,{block:"b-link",elem:void 0,mix:[{block:"b-foot",elem:"link"}]}),n=t.__$anflg92;t.__$anflg92=!0;var o=t.ctx;t.ctx=e;var r=i;return i="",K(t),t.ctx=o,i=r,t.__$anflg92=n,void 0}return Q(t)}return Q(t)}return Q(t)}function $(t){var e=i;i="";var n=t.ctx,s=n.block;n.block="b-menu";var o=t.ctx,r=o.mods;o.mods={layout:"horiz-simple"};var a=t.ctx,l=a.elem;a.elem=void 0;var c=t._inFooter;t._inFooter=!0,K(t),i=e,n.block=s,o.mods=r,a.elem=l,t._inFooter=c}function H(t){var e=n;if("select-multiple"===e)return!!s==!1?{name:t.ctx.name,multiple:"multiple"}:Q(t);if("checkbox"===e){if("label"===s){var i=t.ctx.attrs||{};return i["for"]=t._checkboxAttrs.id,i.id=t._labelId,i["aria-hidden"]=!0,i}return Q(t)}if("b-copyright"===e)return"link"===s?{}:Q(t);if("b-layout-table"===e){if(!("cell"===s||"gap"===s)==!1){for(var o,a=t.ctx,l={},c=["colspan","rowspan"];o=c.shift();)a[o]&&(l[o]=a[o]);return l}return Q(t)}return"b-form-input"===e?"input"===s?!(r&&"textarea"===r.type)==!1?z(t):Q(t):Q(t):"b-files"===e?!t.ctx.count==!1?!!s==!1?{href:"#files"}:Q(t):Q(t):"b-comments-link"===e?!!s==!1?{href:"#comments"}:Q(t):"b-foot"===e?!!s==!1?{role:"contentinfo"}:Q(t):"m-head-services"===e?"icon"===s?{style:"background-image: url(data:image/svg+xml;base64,"+t.ctx.icon+")"}:Q(t):Q(t)}function z(t){if(!!t._baseAttrsApplyed==!1){var e,i,n,s=(e=t._value,t._value=null,i=t._baseAttrsApplyed,t._baseAttrsApplyed=!0,n=z(t),t._value=e,t._baseAttrsApplyed=i,n);return t._.extend(s,{rows:10,cols:10})}return Q(t)}function R(t){var e=n;return"m-editor-popup"===e?!(r&&"other"===r.type)==!1?!!s==!1?{data:t.ctx.data}:Q(t):Q(t):"popup"===e?!(r&&"yes"===r.editor)==!1?!!s==!1?t._.extend(t.ctx.js,{direction:"bottom"}):Q(t):Q(t):"b-files"===e?!t.ctx.count==!1?!!s==!1?!0:Q(t):Q(t):"b-comments-link"===e||"m-head-user"===e?!!s==!1?!0:Q(t):Q(t)}function q(t){return"b-form-button"===n?U(t):Q(t)}function U(t){if(!(t.__$anflg93!==!0)==!1){if(!(r&&"simple"===r.type)==!1){if(!!s==!1){if(!!(t.ctx.mods||{}).theme==!1){var e,i,n=(e=t.__$anflg93,t.__$anflg93=!0,i=U(t),t.__$anflg93=e,i);return n[0].mods.theme="simple-grey",n}return Q(t)}return Q(t)}return Q(t)}return Q(t)}function W(t){return!(t.__$anflg91!==!0)==!1?!!s==!1?V(t):G(t):G(t)}function V(t){var e,i;return t._.extend((e=t.__$anflg91,t.__$anflg91=!0,i=W(t),t.__$anflg91=e,i),{wiki:function(t){return"ru"===t?"http://wiki.yandex-team.ru":"http://wiki.yandex-team.ru"},staff:function(t){return"ru"===t?"http://staff.yandex.ru":"http://staff.yandex.ru"},mail:function(t){return"ru"===t?"https://mail.yandex-team.ru":"https://mail.yandex-team.ru"},tracker:function(t){return"ru"===t?"https://st.yandex-team.ru":"https://st.yandex-team.ru"},jira:function(t){return"ru"===t?"https://jira.yandex-team.ru":"https://jira.yandex-team.ru"},maillists:function(t){return"ru"===t?"http://ml.yandex-team.ru":"http://ml.yandex-team.ru"},statface:function(t){return"ru"===t?"https://stat.yandex-team.ru":"https://stat.yandex-team.ru"},doc:function(t){return"ru"===t?"https://doc.yandex-team.ru":"https://doc.yandex-team.ru"},job:function(t){return"ru"===t?"https://job.yandex-team.ru":"https://job.yandex-team.ru"},otrs:function(t){return"ru"===t?"https://otrs.yandex-team.ru":"https://otrs.yandex-team.ru"},lego:function(t){return"ru"===t?"http://lego.yandex-team.ru":"http://lego.yandex-team.ru"},projects:function(t){return"ru"===t?"http://p.yandex-team.ru":"http://p.yandex-team.ru"},planner:function(t){return"ru"===t?"http://planner.yandex-team.ru":"http://planner.yandex-team.ru"},invite:function(t){return"ru"===t?"http://calendar.yandex-team.ru/invite/":"http://calendar.yandex-team.ru/invite/"},jabber:function(t){return"ru"===t?"https://jabber.yandex-team.ru":"https://jabber.yandex-team.ru"},bond:function(t){return"ru"===t?"http://brak.yandex-team.ru":"http://brak.yandex-team.ru"},diary:function(t){return"ru"===t?"http://my.at.yandex-team.ru":"http://my.at.yandex-team.ru"},jing:function(t){return"ru"===t?"http://jing.yandex-team.ru":"http://jing.yandex-team.ru"},lunapark:function(t){return"ru"===t?"http://lunapark.yandex.ru":"http://lunapark.yandex.ru"},"intranet-passport":function(t){return"ru"===t?"https://passport.yandex-team.ru":"https://passport.yandex-team.ru"},blogmon:function(t){return"ru"===t?"http://blogmon.yandex-team.ru":"http://blogmon.yandex-team.ru"},videoteka:function(t){return"ru"===t?"http://study.yandex-team.ru":"http://study.yandex-team.ru"},study:function(t){return"ru"===t?"http://study.yandex-team.ru":"http://study.yandex-team.ru"},gap:function(t){return"ru"===t?"http://gap.yandex-team.ru":"http://gap.yandex-team.ru"},libra:function(t){return"ru"===t?"http://lib.yandex-team.ru":"http://lib.yandex-team.ru"},admins:function(t){return"ru"===t?"https://golem.yandex-team.ru":"https://golem.yandex-team.ru"},"jams-arm":function(t){return"ru"===t?"http://jams-arm.yandex-team.ru":"http://jams-arm.yandex-team.ru"},center:function(t){return"ru"===t?"https://center.yandex-team.ru":"https://center.yandex-team.ru"},crm:function(t){return"ru"===t?"https://crm.yandex.ru":"https://crm.yandex.ru"},c:function(t){return"ru"===t?"http://c.yandex-team.ru":"http://c.yandex-team.ru"},yahelp:function(t){return"ru"===t?"http://help.yandex-team.ru":"http://help.yandex-team.ru"},calendar:function(t){return"ru"===t?"http://calendar.yandex-team.ru":"http://calendar.yandex-team.ru"},razladki:function(t){return"ru"===t?"http://razladki.yandex-team.ru":"http://razladki.yandex-team.ru"},access:function(t){return"ru"===t?"https://agranat.yandex-team.ru":"https://agranat.yandex-team.ru"},tsystem:function(t){return"ru"===t?"http://tsystem-test.yandex-team.ru":"http://tsystem-test.yandex-team.ru"},newhire:function(t){return"ru"===t?"https://newhire.yandex-team.ru/":"https://newhire.yandex-team.ru/"}})}function G(t){return!!s==!1?J(t):Q(t)}function J(){return{serp:function(t){return"ru"===t?"http://yandex.ru":"ua"===t?"http://yandex.ua":"by"===t?"http://yandex.by":"kz"===t?"http://yandex.kz":"com"===t?"http://www.yandex.com":"tr"===t?"http://www.yandex.com.tr":"http://yandex.ru"},mail:function(t){return"ru"===t?"https://mail.yandex.ru":"ua"===t?"https://mail.yandex.ua":"by"===t?"https://mail.yandex.by":"kz"===t?"https://mail.yandex.kz":"com"===t?"https://mail.yandex.com":"tr"===t?"https://mail.yandex.com.tr":"https://mail.yandex.ru"},pdd:function(t){return"ru"===t?"http://pdd.yandex.ru":"http://pdd.yandex.ru"},zakladki:function(t){return"ru"===t?"http://zakladki.yandex.ru":"http://zakladki.yandex.ru"},fotki:function(t){return"ru"===t?"http://fotki.yandex.ru":"http://fotki.yandex.ru"},moikrug:function(t){return"ru"===t?"http://moikrug.ru":"http://moikrug.ru"},direct:function(t){return"ru"===t?"http://direct.yandex.ru":"ua"===t?"http://direct.yandex.ua":"by"===t?"http://direct.yandex.by":"kz"===t?"http://direct.yandex.kz":"com"===t?"http://direct.yandex.com":"http://direct.yandex.ru"},money:function(t){return"ru"===t?"https://money.yandex.ru":"https://money.yandex.ru"},lenta:function(t){return"ru"===t?"http://lenta.yandex.ru":"http://lenta.yandex.ru"},market:function(t){return"ru"===t?"http://market.yandex.ru":"ua"===t?"http://market.yandex.ua":"by"===t?"http://market.yandex.by":"kz"===t?"http://market.yandex.kz":"http://market.yandex.ru"},"market.advertising":function(t){return"ru"===t?"http://welcome.advertising.yandex.ru/market/":"http://welcome.advertising.yandex.ru/market/"},wow:function(t){return"ru"===t?"http://my.ya.ru":"http://my.ya.ru"},tv:function(t){return"ru"===t?"http://tv.yandex.ru":"ua"===t?"http://tv.yandex.ua":"by"===t?"http://tv.yandex.by":"kz"===t?"http://tv.yandex.kz":"http://tv.yandex.ru"},afisha:function(t){return"ru"===t?"http://afisha.yandex.ru":"ua"===t?"http://afisha.yandex.ua":"by"===t?"http://afisha.yandex.by":"kz"===t?"http://afisha.yandex.kz":"tr"===t?"http://afis.yandex.com.tr":"http://afisha.yandex.ru"},calendar:function(t){return"ru"===t?"http://calendar.yandex.ru":"http://calendar.yandex.ru"},nahodki:function(t){return"ru"===t?"http://nahodki.yandex.ru":"ua"===t?"http://nahodki.yandex.ua":"kz"===t?"http://nahodki.yandex.kz":"http://nahodki.yandex.ru"},weather:function(t){return"ru"===t?"http://pogoda.yandex.ru":"ua"===t?"http://pogoda.yandex.ua":"by"===t?"http://pogoda.yandex.by":"kz"===t?"http://pogoda.yandex.kz":"tr"===t?"http://hava.yandex.com.tr":"http://pogoda.yandex.ru"},kuda:function(t){return"ru"===t?"http://kuda.yandex.ru":"http://kuda.yandex.ru"},video:function(t){return"ru"===t?"http://video.yandex.ru":"ua"===t?"http://video.yandex.ua":"by"===t?"http://video.yandex.by":"kz"===t?"http://video.yandex.kz":"com"===t?"http://video.yandex.com":"tr"===t?"http://video.yandex.com.tr":"http://video.yandex.ru"},"video-com":function(t){return"ru"===t?"http://video.yandex.com":"http://video.yandex.com"},music:function(t){return"ru"===t?"http://music.yandex.ru":"ua"===t?"http://music.yandex.ua":"by"===t?"http://music.yandex.by":"kz"===t?"http://music.yandex.kz":"http://music.yandex.ru"},"music-partner":function(t){return"ru"===t?"http://music-partner.yandex.ru":"http://music-partner.yandex.ru"},www:function(t){return"ru"===t?"http://www.yandex.ru":"ua"===t?"http://www.yandex.ua":"com"===t?"http://www.yandex.com":"by"===t?"http://www.yandex.by":"kz"===t?"http://www.yandex.kz":"tr"===t?"http://www.yandex.com.tr":"http://www.yandex.ru"},search:function(t){return"ru"===t?"http://yandex.ru":"ua"===t?"http://yandex.ua":"com"===t?"http://yandex.com":"by"===t?"http://yandex.by":"kz"===t?"http://yandex.kz":"tr"===t?"http://yandex.com.tr":"http://yandex.ru"},review:function(t){return"ru"===t?"http://yandex.ru":"ua"===t?"http://yandex.ua":"by"===t?"http://yandex.by":"kz"===t?"http://yandex.kz":"com"===t?"http://www.yandex.com":"tr"===t?"http://www.yandex.com.tr":"http://yandex.ru"},fresh:function(t){return"ru"===t?"http://yandex.ru":"ua"===t?"http://yandex.ua":"by"===t?"http://yandex.by":"kz"===t?"http://yandex.kz":"com"===t?"http://www.yandex.com":"tr"===t?"http://www.yandex.com.tr":"http://yandex.ru"},news:function(t){return"ru"===t?"http://news.yandex.ru":"ua"===t?"http://news.yandex.ua":"by"===t?"http://news.yandex.by":"kz"===t?"http://news.yandex.kz":"tr"===t?"http://haber.yandex.com.tr":"http://news.yandex.ru"},"news-com":function(t){return"ru"===t?"http://news.yandex.com":"http://news.yandex.com"},maps:function(t){return"ru"===t?"http://maps.yandex.ru":"ua"===t?"http://maps.yandex.ua":"tr"===t?"http://harita.yandex.com.tr":"http://maps.yandex.ru"},"maps-com":function(t){return"ru"===t?"http://maps.yandex.com":"http://maps.yandex.com"},probki:function(t){return"ru"===t?"http://probki.yandex.ru":"ua"===t?"http://probki.yandex.ua":"http://probki.yandex.ru"},slovari:function(t){return"ru"===t?"http://slovari.yandex.ru":"ua"===t?"http://slovari.yandex.ua":"by"===t?"http://slovari.yandex.by":"kz"===t?"http://slovari.yandex.kz":"http://slovari.yandex.ru"
},images:function(t){return"ru"===t?"http://images.yandex.ru":"ua"===t?"http://images.yandex.ua":"by"===t?"http://images.yandex.by":"kz"===t?"http://images.yandex.kz":"com"===t?"http://images.yandex.com":"tr"===t?"http://gorsel.yandex.com.tr":"http://images.yandex.ru"},"images-com":function(t){return"ru"===t?"http://images.yandex.com":"http://images.yandex.com"},blogs:function(t){return"ru"===t?"http://blogs.yandex.ru":"ua"===t?"http://blogs.yandex.ua":"by"===t?"http://blogs.yandex.by":"kz"===t?"http://blogs.yandex.kz":"http://blogs.yandex.ru"},auto:function(t){return"ua"===t?"http://auto.yandex.ua":"ru"===t?"http://auto.yandex.ru":"http://auto.yandex.ru"},adresa:function(t){return"ru"===t?"http://adresa.yandex.ru":"http://adresa.yandex.ru"},games:function(t){return"ru"===t?"http://games.yandex.ru":"http://games.yandex.ru"},yaca:function(t){return"ru"===t?"http://yaca.yandex.ru":"ua"===t?"http://yaca.yandex.ua":"by"===t?"http://yaca.yandex.by":"http://yaca.yandex.ru"},rasp:function(t){return"ru"===t?"http://rasp.yandex.ru":"ua"===t?"http://rasp.yandex.ua":"by"===t?"http://rasp.yandex.by":"kz"===t?"http://rasp.yandex.kz":"tr"===t?"http://seferler.yandex.com.tr":"http://rasp.yandex.ru"},avia:function(t){return"ru"===t?"http://ticket.yandex.ru":"ua"===t?"http://ticket.yandex.ua":"http://ticket.yandex.ru"},ticket:function(){return"http://ticket.yandex.ru"},pvo:function(t){return"ru"===t?"http://ask.yandex.ru":"http://ask.yandex.ru"},online:function(t){return"ru"===t?"http://online.yandex.ru":"http://online.yandex.ru"},books:function(t){return"ru"===t?"http://books.yandex.ru":"http://books.yandex.ru"},site:function(t){return"ru"===t?"http://site.yandex.ru":"ua"===t?"http://site.yandex.ua":"tr"===t?"http://ozel.yandex.com.tr":"http://site.yandex.ru"},bar:function(t){return"ru"===t?"http://bar.yandex.ru":"ua"===t?"http://bar.yandex.ua":"by"===t?"http://bar.yandex.by":"kz"===t?"http://bar.yandex.kz":"tr"===t?"http://bar.yandex.com.tr":"http://bar.yandex.ru"},widgets:function(t){return"ru"===t?"http://widgets.yandex.ru":"ua"===t?"http://widgets.yandex.ua":"by"===t?"http://widgets.yandex.by":"kz"===t?"http://widgets.yandex.kz":"tr"===t?"http://widgets.yandex.com.tr":"http://widgets.yandex.ru"},wdgt:function(t){return"ru"===t?"http://wdgt.yandex.ru":"ua"===t?"http://wdgt.yandex.ua":"by"===t?"http://wdgt.yandex.by":"kz"===t?"http://wdgt.yandex.kz":"tr"===t?"http://wdgt.yandex.com.tr":"http://wdgt.yandex.ru"},interests:function(t){return"ru"===t?"http://interests.yandex.ru":"http://interests.yandex.ru"},kraski:function(t){return"ru"===t?"http://kraski.yandex.ru":"http://kraski.yandex.ru"},local:function(t){return"ru"===t?"http://local.yandex.ru":"http://local.yandex.ru"},museums:function(t){return"ru"===t?"http://18.yandex.ru":"http://18.yandex.ru"},collection:function(t){return"ru"===t?"http://collection.yandex.ru":"http://collection.yandex.ru"},company:function(t){return"ru"===t?"http://company.yandex.ru":"com"===t?"http://company.yandex.com":"tr"===t?"http://company.yandex.com.tr":"http://company.yandex.ru"},tests:function(t){return"ru"===t?"http://tests.yandex.ru":"http://tests.yandex.ru"},referats:function(t){return"ru"===t?"http://referats.yandex.ru":"http://referats.yandex.ru"},terms:function(t){return"ru"===t?"http://terms.yandex.ru":"http://terms.yandex.ru"},tune:function(t){return"ru"===t?"http://tune.yandex.ru":"ua"===t?"http://tune.yandex.ua":"com"===t?"http://tune.yandex.com":"by"===t?"http://tune.yandex.by":"kz"===t?"http://tune.yandex.kz":"tr"===t?"http://tune.yandex.com.tr":"http://tune.yandex.ru"},api:function(t){return"ru"===t?"http://api.yandex.ru":"com"===t?"http://api.yandex.com":"http://api.yandex.ru"},punto:function(t){return"ru"===t?"http://punto.yandex.ru":"http://punto.yandex.ru"},opinion:function(t){return"ru"===t?"http://opinion.yandex.ru":"http://opinion.yandex.ru"},perevod:function(t){return"ru"===t?"http://perevod.yandex.ru":"http://perevod.yandex.ru"},rabota:function(t){return"ru"===t?"http://rabota.yandex.ru":"ua"===t?"http://rabota.yandex.ua":"by"===t?"http://rabota.yandex.by":"kz"===t?"http://rabota.yandex.kz":"http://rabota.yandex.ru"},sprav:function(t){return"ru"===t?"http://sprav.yandex.ru":"ua"===t?"http://sprav.yandex.ua":"by"===t?"http://sprav.yandex.by":"kz"===t?"http://sprav.yandex.kz":"tr"===t?"http://rehber.yandex.com.tr":"http://sprav.yandex.ru"},realty:function(t){return"ru"===t?"http://realty.yandex.ru":"ua"===t?"http://realty.yandex.ua":"by"===t?"http://realty.yandex.by":"kz"===t?"http://realty.yandex.kz":"http://realty.yandex.ru"},advertising:function(t){return"ru"===t?"http://advertising.yandex.ru":"ua"===t?"http://advertising.yandex.ua":"com"===t?"http://advertising.yandex.com":"by"===t?"http://advertising.yandex.by":"kz"===t?"http://advertising.yandex.kz":"http://advertising.yandex.ru"},expert:function(t){return"ru"===t?"http://expert.yandex.ru":"http://expert.yandex.ru"},"direct.market":function(t){return"ru"===t?"http://partner.market.yandex.ru/yandex.market/":"http://partner.market.yandex.ru/yandex.market/"},ba:function(t){return"ru"===t?"http://ba.yandex.ru":"ua"===t?"http://ba.yandex.ua":"com"===t?"http://ba.yandex.com":"by"===t?"http://ba.yandex.by":"kz"===t?"http://ba.yandex.kz":"http://ba.yandex.ru"},bayan:function(t){return"ru"===t?"http://bayan.yandex.ru":"http://bayan.yandex.ru"},partners:function(t){return"ru"===t?"http://partner.yandex.ru":"ua"===t?"http://partner.yandex.ua":"com"===t?"http://partner.yandex.com":"by"===t?"http://partner.yandex.by":"kz"===t?"http://partner.yandex.kz":"http://partner.yandex.ru"},metrika:function(t){return"ru"===t?"http://metrika.yandex.ru":"ua"===t?"http://metrika.yandex.ua":"com"===t?"http://metrica.yandex.com":"by"===t?"http://metrika.yandex.by":"kz"===t?"http://metrika.yandex.kz":"tr"===t?"http://metrica.yandex.com.tr":"http://metrika.yandex.ru"},balance:function(t){return"ru"===t?"http://balance.yandex.ru":"http://balance.yandex.ru"},wordstat:function(t){return"ru"===t?"http://wordstat.yandex.ru":"http://wordstat.yandex.ru"},webmaster:function(t){return"ru"===t?"http://webmaster.yandex.ru":"ua"===t?"http://webmaster.yandex.ua":"com"===t?"http://webmaster.yandex.com":"tr"===t?"http://webmaster.yandex.com.tr":"http://webmaster.yandex.ru"},server:function(t){return"ru"===t?"http://company.yandex.ru/technology/server/":"http://company.yandex.ru/technology/server/"},stat:function(t){return"ru"===t?"http://stat.yandex.ru":"ua"===t?"http://stat.yandex.ua":"by"===t?"http://stat.yandex.by":"http://stat.yandex.ru"},mobile:function(t){return"ru"===t?"http://mobile.yandex.ru":"ua"===t?"http://mobile.yandex.ua":"tr"===t?"http://mobil.yandex.com.tr":"http://mobile.yandex.ru"},help:function(t){return"ru"===t?"http://help.yandex.ru":"ua"===t?"http://help.yandex.ua":"com"===t?"http://help.yandex.com":"tr"===t?"http://yardim.yandex.com.tr":"http://help.yandex.ru"},feedback:function(t){return"ru"===t?"http://feedback.yandex.ru":"ua"===t?"http://feedback.yandex.ua":"com"===t?"http://feedback.yandex.com":"by"===t?"http://feedback.yandex.by":"kz"===t?"http://feedback.yandex.kz":"tr"===t?"http://contact.yandex.com.tr":"http://feedback.yandex.ru"},feedback2:function(t){return"ru"===t?"http://feedback2.yandex.ru":"ua"===t?"http://feedback2.yandex.ua":"com"===t?"http://feedback2.yandex.com":"by"===t?"http://feedback2.yandex.by":"kz"===t?"http://feedback2.yandex.kz":"tr"===t?"http://contact2.yandex.com.tr":"http://feedback2.yandex.ru"},start:function(t){return"ru"===t?"http://help.yandex.ru/start/":"ua"===t?"http://help.yandex.ua/start/":"com"===t?"http://help.yandex.com/start/":"tr"===t?"http://yardim.yandex.com.tr/start":"http://help.yandex.ru/start/"},cityday:function(t){return"ru"===t?"http://cityday.yandex.ru":"http://cityday.yandex.ru"},openid:function(t){return"ru"===t?"http://openid.yandex.ru":"http://openid.yandex.ru"},oauth:function(t){return"ru"===t?"http://oauth.yandex.ru":"com"===t?"http://oauth.yandex.com":"http://oauth.yandex.ru"},nano:function(t){return"ru"===t?"http://nano.yandex.ru":"http://nano.yandex.ru"},partnersearch:function(t){return"ru"===t?"http://yandex.ru":"http://yandex.ru"},city:function(t){return"ru"===t?"http://city.yandex.ru":"http://city.yandex.ru"},goroda:function(t){return"ru"===t?"http://goroda.yandex.ru":"http://goroda.yandex.ru"},toster:function(t){return"ru"===t?"http://toster.yandex.ru":"http://toster.yandex.ru"},love:function(t){return"ru"===t?"http://love.yandex.ru":"http://love.yandex.ru"},rk:function(t){return"ru"===t?"http://rk.yandex.ru":"http://rk.yandex.ru"},lost:function(t){return"ru"===t?"http://lost.yandex.ru":"http://lost.yandex.ru"},soft:function(t){return"ru"===t?"http://soft.yandex.ru":"ua"===t?"http://soft.yandex.ua":"tr"===t?"http://soft.yandex.com.tr":"http://soft.yandex.ru"},passport:function(t){return"ru"===t?"https://passport.yandex.ru":"com"===t?"https://passport.yandex.com":"tr"===t?"https://passport.yandex.com.tr":"https://passport.yandex.ru"},"maps-wiki":function(t){return"ru"===t?"http://nk.yandex.ru":"http://nk.yandex.ru"},404:function(t){return"ru"===t?"http://404.yandex.ru":"ua"===t?"http://404.yandex.ua":"com"===t?"http://404.yandex.com":"by"===t?"http://404.yandex.by":"kz"===t?"http://404.yandex.kz":"tr"===t?"http://404.yandex.com.tr":"http://404.yandex.ru"},i:function(t){return"ru"===t?"http://i.yandex.ru":"http://i.yandex.ru"},desktop:function(t){return"ru"===t?"http://desktop.yandex.ru":"http://desktop.yandex.ru"},ff:function(t){return"ru"===t?"http://ff.yandex.ru":"http://ff.yandex.ru"},fx:function(t){return"ru"===t?"http://fx.yandex.ru":"ua"===t?"http://fx.yandex.ua":"tr"===t?"http://fx.yandex.com.tr":"http://fx.yandex.ru"},ie:function(t){return"ru"===t?"http://ie.yandex.ru":"ua"===t?"http://ie.yandex.ua":"tr"===t?"http://ie.yandex.com.tr":"http://ie.yandex.ru"},"bar-ie":function(t){return"ru"===t?"http://bar.yandex.ru/ie":"ua"===t?"http://bar.yandex.ua/ie":"com"===t?"http://bar.yandex.com/ie":"by"===t?"http://bar.yandex.by/ie":"kz"===t?"http://bar.yandex.kz/ie":"tr"===t?"http://bar.yandex.com.tr/ie":"http://bar.yandex.ru/ie"},"bar-ie9":function(t){return"ru"===t?"http://bar.yandex.ru/ie":"ua"===t?"http://bar.yandex.ua/ie":"com"===t?"http://bar.yandex.com/ie":"by"===t?"http://bar.yandex.by/ie":"kz"===t?"http://bar.yandex.kz/ie":"tr"===t?"http://bar.yandex.com.tr/ie":"http://bar.yandex.ru/ie"},internet:function(t){return"ru"===t?"http://internet.yandex.ru":"com"===t?"http://internet.yandex.com":"tr"===t?"http://internet.yandex.com.tr":"http://internet.yandex.ru"},keyboard:function(t){return"ru"===t?"http://www.yandex.ru/index_engl_qwerty.html":"http://www.yandex.ru/index_engl_qwerty.html"},metro:function(t){return"ru"===t?"http://metro.yandex.ru":"http://metro.yandex.ru"},pulse:function(t){return"ru"===t?"http://blogs.yandex.ru/pulse":"ua"===t?"http://blogs.yandex.ua/pulse":"by"===t?"http://blogs.yandex.by/pulse":"kz"===t?"http://blogs.yandex.kz/pulse":"http://blogs.yandex.ru/pulse"},school:function(t){return"ru"===t?"http://school.yandex.ru":"http://school.yandex.ru"},so:function(t){return"ru"===t?"http://so.yandex.ru":"http://so.yandex.ru"},time:function(t){return"ru"===t?"http://time.yandex.ru":"ua"===t?"http://time.yandex.ua":"com"===t?"http://time.yandex.com":"by"===t?"http://time.yandex.by":"kz"===t?"http://time.yandex.kz":"tr"===t?"http://saat.yandex.com.tr":"http://time.yandex.ru"},xmlsearch:function(t){return"ru"===t?"http://xml.yandex.ru":"ua"===t?"http://xml.yandex.ua":"com"===t?"http://xml.yandex.com":"by"===t?"http://xml.yandex.by":"kz"===t?"http://xml.yandex.kz":"tr"===t?"http://xml.yandex.com.tr":"http://xml.yandex.ru"},catalogwdgt:function(t){return"ru"===t?"http://www.yandex.ru/catalog":"http://www.yandex.ru/catalog"},opera:function(t){return"ru"===t?"http://opera.yandex.ru":"tr"===t?"http://opera.yandex.com.tr":"http://opera.yandex.ru"},uslugi:function(t){return"ru"===t?"http://uslugi.yandex.ru":"http://uslugi.yandex.ru"},backapv:function(t){return"ru"===t?"http://backapv.yandex.ru":"http://backapv.yandex.ru"},chrome:function(t){return"ru"===t?"http://chrome.yandex.ru":"http://chrome.yandex.ru"},browser:function(t){return"ru"===t?"http://browser.yandex.ru":"ua"===t?"http://browser.yandex.ua":"com"===t?"http://browser.yandex.com":"by"===t?"http://browser.yandex.by":"kz"===t?"http://browser.yandex.kz":"tr"===t?"http://browser.yandex.com.tr":"http://browser.yandex.ru"},aziada:function(t){return"ru"===t?"http://aziada2011.yandex.kz":"http://aziada2011.yandex.kz"},translate:function(t){return"ru"===t?"http://translate.yandex.ru":"ua"===t?"http://translate.yandex.ua":"com"===t?"http://translate.yandex.com":"by"===t?"http://translate.yandex.by":"kz"===t?"http://translate.yandex.kz":"tr"===t?"http://ceviri.yandex.com.tr":"http://translate.yandex.ru"},subs:function(t){return"ru"===t?"http://subs.yandex.ru":"http://subs.yandex.ru"},all:function(t){return"ru"===t?"http://www.yandex.ru/all":"ua"===t?"http://www.yandex.ua/all":"com"===t?"http://www.yandex.com/all":"by"===t?"http://www.yandex.by/all":"kz"===t?"http://www.yandex.kz/all":"tr"===t?"http://www.yandex.com.tr/all":"http://www.yandex.ru/all"},large:function(t){return"ru"===t?"http://large.yandex.ru":"http://large.yandex.ru"},geocontext:function(t){return"ru"===t?"http://geocontext.yandex.ru":"http://geocontext.yandex.ru"},root:function(t){return"ru"===t?"http://root.yandex.ru":"http://root.yandex.ru"},yamb:function(t){return"ru"===t?"https://yamb.yandex.ru":"https://yamb.yandex.ru"},legal:function(t){return"ru"===t?"http://legal.yandex.ru":"ua"===t?"http://legal.yandex.ua":"com"===t?"http://legal.yandex.com":"tr"===t?"http://legal.yandex.com.tr":"http://legal.yandex.ru"},taxi:function(t){return"ru"===t?"https://taxi.yandex.ru":"https://taxi.yandex.ru"},social:function(t){return"ru"===t?"https://social.yandex.ru":"ua"===t?"https://social.yandex.ua":"com"===t?"https://social.yandex.ru":"by"===t?"https://social.yandex.by":"kz"===t?"https://social.yandex.kz":"tr"===t?"https://social.yandex.com.tr":"https://social.yandex.ru"},contest:function(t){return"ru"===t?"http://contest.yandex.ru":"com"===t?"http://contest.yandex.com":"http://contest.yandex.ru"},peoplesearch:function(t){return"ru"===t?"http://people.yandex.ru":"ua"===t?"http://people.yandex.ua":"http://people.yandex.ru"},disk:function(t){return"ru"===t?"http://disk.yandex.ru":"com"===t?"http://disk.yandex.com":"ua"===t?"http://disk.yandex.ua":"kz"===t?"http://disk.yandex.kz":"by"===t?"http://disk.yandex.by":"tr"===t?"http://disk.yandex.com.tr":"http://disk.yandex.ru"},sport:function(t){return"ru"===t?"http://sport.yandex.ru":"by"===t?"http://sport.yandex.by":"ua"===t?"http://sport.yandex.ua":"kz"===t?"http://sport.yandex.kz":"tr"===t?"http://spor.yandex.com.tr":"http://sport.yandex.ru"},literacy:function(t){return"ru"===t?"http://literacy.yandex.ru":"http://literacy.yandex.ru"},appsearch:function(t){return"ru"===t?"//appsearch.yandex.ru":"//appsearch.yandex.ru"},ege:function(t){return"ru"===t?"//ege.yandex.ru":"//ege.yandex.ru"},vno:function(t){return"ru"===t?"//zno.yandex.ua":"//zno.yandex.ua"},notifications:function(t){return"ru"===t?"https://notifications.yandex.ru":"ua"===t?"https://notifications.yandex.ua":"by"===t?"https://notifications.yandex.by":"kz"===t?"https://notifications.yandex.kz":"com"===t?"https://notifications.yandex.com":"tr"===t?"https://notifications.yandex.com.tr":"https://notifications.yandex.ru"}}}function K(t){return!t["i-global"]==!1?!!t["i-services"]==!1?Y(t):Q(t):Q(t)}function Y(t){var e,s,o,r=t["i-services"]={},a=t["i-global"];r._data=(e=n,n="i-services",s=i,i="service-url",o=W(t),n=e,i=s,o),r.serviceName=function(t){return BEM.I18N("i-services",t||a.id)},r.serviceUrl=function(t,e){return t||(t=a.id),r._data[t](e||a["content-region"])},dr(t)}function Q(t){return"m-head-menu"===n?"item"===s?!(t.__$anflg89!==!0)==!1?!(t.ctx.customParams&&t.ctx.customParams.favs)==!1?Z(t):X(t):X(t):X(t):X(t)}function Z(t){var e,n,s,o,r,a={elem:"item",mix:{block:"b-favs",js:!0},content:t.ctx.content[0]||t.ctx.content};return e=t.__$anflg89,t.__$anflg89=!0,s=t.ctx,t.ctx=a,o=i,i="",r=K(t),t.ctx=s,i=o,n=r,t.__$anflg89=e,n}function X(t){var e=i;if("content"===e){var e=n;if("m-head-menu"===e)return"list"===s?te(t):!(r&&"main"===r.type)==!1?!!s==!1?[{elem:"list",menuItems:t.ctx.menuItems},{block:"popup",mods:{theme:"head-menu","head-type":t.ctx.headTypeMod,animate:"no","has-close":"yes"},js:{directions:{to:"bottom",axis:"left",offset:{top:-54,left:-17}}},content:[{elem:"content",content:""}]}]:Xe(t):Xe(t);if("b-event"===e)return"date"===s?oe(t):Xe(t);if("m-uploader"===e)return!(r&&"sidebar"===r.type)==!1?!!s==!1?re(t):ae(t):ae(t);if("b-file-loader"===e)return!!s==!1?[{elem:"name",content:t.ctx.name},{elem:"wrapper"},{elem:"progress"},{elem:"close",content:{block:"awesome-icon",mods:{icon:"remove"}}}]:Xe(t);if("attach"===e)return"holder"===s?[{block:"image",mix:[{block:"attach",elem:"icon-file"}]},{elem:"text",tag:"span",content:t.ctx.content},{block:"image",mix:[{block:"attach",elem:"reset"}]}]:Xe(t);if("b-cluster-tree"===e)return"date"===s?!t.ctx.timestamp==!1?se(t):Xe(t):Xe(t);if("b-file2"===e)return"date"===s?de(t):Xe(t);if("b-spin"===e)return!!s==!1?{block:"b-icon",mix:[{block:"b-spin",elem:"icon"}]}:Xe(t);if("b-menu"===e)return!(r&&"horiz"===r.layout)==!1?!!s==!1?[t.ctx.title,{elem:"layout",content:t.ctx.content}]:ue(t):ue(t);if("mi-date"===e)return!!s==!1?fe(t):Xe(t);if("m-date"===e)return!!s==!1?[t.ctx.content?t.ctx.content+"&nbsp;":"",{block:"mi-date",timestamp:t.ctx.timestamp,"short":t.ctx.short?!0:!1,alwaysShowYear:t.ctx.alwaysShowYear?!0:!1,format:t.ctx.format}]:Xe(t);if("b-grid-table-fields-list"===e)return!!s==!1?ne(t):Xe(t);if("radio-button"===e)return"radio"===s?[{elem:"control"},{elem:"text",tag:"span",content:t.ctx.content}]:Xe(t);if("b-grid-table-sorting-list"===e)return!!s==!1?{block:"radio-button",mods:{size:"m"},name:"sorting_"+Date.now(),value:"asc"===t.ctx.selected?"asc":"desc",content:[{elem:"radio",controlAttrs:{value:"asc"},content:BEM.I18N("b-grid-table-sorting-list","a_z")},{elem:"radio",controlAttrs:{value:"desc"},content:BEM.I18N("b-grid-table-sorting-list","z_a")}]}:Xe(t);if("radiobox"===e)return"radio"===s?[{elem:"box",tag:"span",content:{elem:"control"}},t.ctx.content]:Xe(t);if("b-grid-table-width-controll"===e)return!!s==!1?ie(t):Xe(t);if("b-editor-struct"===e)return!!s==!1?_e(t):Xe(t);if("m-calendar"===e)return!(r&&"button"===r.toggler)==!1?!!s==!1?{elem:"toggler",content:{block:"button",mods:{size:t.ctx.size,disabled:t.ctx.mods.disabled||"",toggler:"datepicker"},type:"button",value:"",content:t.ctx.js.defaultText}}:Xe(t):Xe(t);if("b-widget"===e)return!(t.__$anflg72!==!0)==!1?!(r&&"old-page"===r.type)==!1?!!s==!1?ge(t):Xe(t):Xe(t):Xe(t);if("m-head"===e)return!!s==!1?ee(t):Xe(t);if("input"===e)return"control"===s?!(r&&"textarea"===r.type)==!1?t.xmlEscape(t._value||t.ctx.content||""):Xe(t):Xe(t);if("m-head-arrow"===e)return!!s==!1?[{block:"awesome-icon",mods:{icon:"reorder"}},{elem:"home",tag:"span",mix:[{block:"i-font",mods:{face:"textbook"}}],content:t.ctx.title},{block:"popup",mods:{theme:"head"},js:{directions:{to:"bottom",axis:"left"}},content:[{elem:"content",content:""}]}]:Xe(t);if("m-suggest"===e){if(!!s==!1){var a={block:"input",mods:t.ctx.inputMods,content:{elem:"control",attrs:t._.extend({name:"text",autocomplete:"off"},t.ctx.inputAttrs)},value:t.ctx.value};return t.ctx.hint&&(a.content=[{elem:"hint",content:t.ctx.hint},a.content]),a}return Xe(t)}return"button"===e?ce(t):Xe(t)}if("js"===e){var e=n;return"m-head-menu"===e?!(r&&"main"===r.type)==!1?!!s==!1?!0:Xe(t):Xe(t):"m-datepicker"===e||"select"===e||"b-file-loader"===e||"b-grid-table-checkbox"===e||"b-spin"===e?!!s==!1?!0:Xe(t):"b-menu"===e?!(r&&"yes"===r["is-bem"])==!1?!!s==!1?!0:Xe(t):Xe(t):"mi-date"===e?!!s==!1?t.ctx.params||!0:Xe(t):"radio-button"===e||"radiobox"===e||"m-head"===e?!!s==!1?!0:Xe(t):"m-suggest"===e?!!s==!1?{types:t.ctx.types||["staff"],labels:t.ctx.labels,inHeader:t.ctx.inHeader,inSearchHeader:t.ctx.inSearchHeader,inputMods:t.ctx.inputMods,multiple:t.ctx.multiple}:Xe(t):"attach"===e?!!s==!1?!0:Xe(t):Xe(t)}if("tag"===e){var e=n;if("m-head-menu"===e)return!(r&&"main"===r.type)==!1?!!s==!1?"menu":Xe(t):Xe(t);if("b-diff-string"===e)return"chunk"===s?!(o&&"deleted"===o["diff-type"])==!1?"del":!(o&&"added"===o["diff-type"])==!1?"ins":"span":Xe(t);if("select"===e){var e=s;return"control"===e?"select":"text"===e?"span":"option-group"===e?"optgroup":"option"===e?"option":!!s==!1?"span":Xe(t)}if("b-events-log"===e){var e=s;return"item"===e?"li":"list"===e?"ol":Xe(t)}if("b-diff-grid"===e){var e=s;return"field"===e?"td":"row"===e?"tr":!!s==!1?"table":Xe(t)}if("button"===e)return!t._attachButton==!1?!!s==!1?"span":Xe(t):Xe(t);if("b-file2"===e)return"date"===s?"":Xe(t);if("b-files2"===e){var e=s;return"item"===e?"li":"list"===e?"ol":Xe(t)}if("b-comment2-create"===e)return!!s==!1?"form":Xe(t);if("b-comments2"===e){var e=s;return"item"===e?"li":"list"===e?"ol":Xe(t)}if("b-cluster-tree"===e)return"total-count"===s?"span":Xe(t);if("b-menu"===e){var e=s;return"layout-cell"===e?!(r&&"horiz"===r.layout)==!1?"li":!(r&&"horiz-complex"===r.layout)==!1?"td":Xe(t):"layout"===e?!(r&&"horiz"===r.layout)==!1?"ul":!(r&&"horiz-complex"===r.layout)==!1?"table":Xe(t):"layout-row"===e?!(r&&"horiz-complex"===r.layout)==!1?"tr":Xe(t):Xe(t)}if("b-grid-table-sorting-list"===e)return!!s==!1?"span":Xe(t);if("mi-date"===e)return!!s==!1?"":Xe(t);if("b-grid-table"===e)return"table"===s?"table":Xe(t);if("m-date"===e)return!!s==!1?"span":Xe(t);if("b-grid-table-cell"===e)return!(r&&"th"===r.type)==!1?!!s==!1?"th":be(t):be(t);if("radio-button"===e){if(!!s==!1)return"span";var e=s;return"control"===e?"input":"radio"===e?"label":Xe(t)}if("m-error"===e){var e=s;return"list-item"===e?"li":"list"===e?"ul":"para"===e?"p":"header"===e?"h3":Xe(t)}if("radiobox"===e){var e=s;return"control"===e?"input":"radio"===e?"label":!!s==!1?"span":Xe(t)}if("b-grid-table-checkbox"===e)return!!s==!1?"input":Xe(t);if("input"===e){var e=s;return"control"===e?!(r&&"textarea"===r.type)==!1?"textarea":Xe(t):"label"===e||"hint"===e?"label":Xe(t)}if("m-head"===e)return!!s==!1?"header":Xe(t);if("m-suggest"===e)return"popup-items"===s?"ul":Xe(t);if("attach"===e){var e=s;return"control"===e?"input":"holder"===e?"span":!!s==!1?"span":Xe(t)}return Xe(t)}if("default"===e){var e=n;return"b-grid-table-options"===e?!(t.__$anflg88!==!0)==!1?!!s==!1?ke(t):je(t):je(t):"button"===e?ve(t):"select"===e?we(t):"attach"===e?Ee(t):"b-menu"===e?"item"===s?!(t.__$anflg80!==!0)==!1?!(r&&"horiz"===r.layout)==!1?Ie(t):Se(t):Se(t):Se(t):"b-tabbed-pane"===e?"tabs"===s?Oe(t):!!s==!1?Pe(t):je(t):je(t)}if("attrs"===e){var e=n;if("b-grid-table-checkbox"===e){if(!!s==!1){var l={type:"checkbox"};return t.ctx.mods&&"yes"===t.ctx.mods.checked&&(l.checked=!0),t.ctx.mods&&"yes"===t.ctx.mods.disabled&&(l.disabled=!0),l}return Xe(t)}if("select"===e){var e=s;if("control"===e){for(var c,d=["id","name","tabindex"],u={};c=d.pop();)t._controlAttrs[c]&&(u[c]=t._controlAttrs[c]);return"yes"===r.disabled&&(u.disabled="disabled"),u.tabindex=-1,u["aria-hidden"]=!0,t.ctx.controlAttrs||u}return"item"===e?We(t):Xe(t)}if("button"===e)return Ve(t);if("attach"===e){var e=s;if("control"===e){var h={type:"file",name:t._name};return!!t._disabled&&(h.disabled="disabled"),t._tabindex&&(h.tabindex=t._tabindex),h["aria-labelledby"]=t._textId,h}return"holder"===e?{"aria-hidden":!0}:Xe(t)}if("m-date"===e){if(!!s==!1){var p=t["mi-helpers"].getDateFromHumanString(t.ctx.timestamp),m=p.getMonth()+1;return{title:[p.getDate(),10>m?"0"+m:m,p.getFullYear()].join(".")+" "+[p.getHours(),p.getMinutes()<10?"0"+p.getMinutes():p.getMinutes()].join(":")}}return Xe(t)}if("radio-button"===e){var e=s;if("control"===e){var f=t._controlAttrs;return f.disabled?(f.disabled="disabled",f.tabindex="-1"):delete f.disabled,f.checked?f.checked="checked":delete f.checked,f.type="radio",f.name=t._name,"undefined"==typeof f.value&&delete f.value,f}return"radio"===e?{"for":t._controlAttrs.id}:Xe(t)}if("radiobox"===e){var e=s;if("control"===e){var _=t._controlAttrs;return _.disabled?(_.disabled="disabled",_.tabindex="-1"):delete _.disabled,_.checked?_.checked="checked":delete _.checked,_.type="radio",_.name=t._name,"undefined"==typeof _.value&&delete _.value,_}return"radio"===e?{"for":t._controlAttrs.id}:Xe(t)}if("input"===e){var e=s;return"control"===e?!(r&&"textarea"===r.type)==!1?Ke(t):Xe(t):"label"===e?{id:t._labelId,"for":t._inputId,"aria-hidden":!0}:"hint"===e?{id:t._hintId,"for":t._inputId,"aria-hidden":!0}:Xe(t)}return Xe(t)}if("mix"===e){var e=n;if("button"===e)return!t._formSelect==!1?!!s==!1?[{block:t._formSelect.block,elem:"button"}]:Ye(t):Ye(t);if("attach"===e)return"control"===s?[{block:"button",elem:"control"}]:Xe(t);if("b-spin"===e){if(!!s==!1){var g={},b=t.ctx.mods;return b&&b.size||(g.size="27"),b&&b.theme||(g.theme="grey-27"),[{mods:g}]}return Xe(t)}if("b-menu"===e){var e=s;if("layout-cell"===e){if(!(r&&"horiz-complex"===r.layout)==!1){var k=[];return t.isFirst()&&k.push({elemMods:{position:"first"}}),t.isLast()&&k.push({elemMods:{position:"last"}}),k}return Xe(t)}if("item"===e){if(!t._bTabbedPaneId==!1){if(!t.isbTabbedPaneTabs==!1){var v=[{elem:"item-selector"},{block:"b-tabbed-pane",elem:"tab",elemMods:t.ctx.elemMods}];return t.ctx.mix?v.concat(t.ctx.mix):v}return Xe(t)}return Xe(t)}return Xe(t)}if("b-tabbed-pane"===e)return Qe(t);if("radio-button"===e)return"radio"===s?Ze(t):Xe(t);if("radiobox"===e){if("radio"===s){var y={};return t._modsDisabled&&(y.disabled="yes"),t._valuesMatched&&(y.checked="yes"),[{elemMods:y}]}return Xe(t)}return Xe(t)}return"bem"===e?"b-menu"===n?"layout-row"===s?!(r&&"horiz-complex"===r.layout)==!1?!1:Xe(t):Xe(t):Xe(t):Xe(t)}function te(e){return e.ctx.menuItems.map(function(t){var e;return e=t.more?{elem:"more",content:[{block:"link",mods:{type:"more"},content:"…"},{block:"popup",mix:[{block:"m-head-menu",elem:"more-popup"}],mods:{theme:"head",animate:"yes"},js:{directions:{to:"bottom",axis:"left",offset:{top:-10,left:-11}}},content:[{elem:"tail"},{elem:"content",content:{block:"m-head-menu",mods:{type:"open",mode:"more"},content:[{elem:"item",content:[{elem:"list",menuItems:t.subs}]}]}}]}]}:{elem:"item",elemMods:{},content:[{block:"link",mods:t.mods?t.mods:!1,mix:t.mix||"",url:!t.subs&&t.url,content:t.name}]},t.subs&&!t.more&&(e.elemMods.hassub="yes",e.attrs={"data-content":JSON.stringify({block:"m-head-menu",mods:{type:"open"},content:[{elem:"item",elemMods:{hassub:"yes"},content:[{block:"link",mods:{menu:"title"},content:[t.name,{block:"awesome-icon",mods:{icon:"chevron-down"}}]},{elem:"list",menuItems:t.subs}]}]})},e.content[0].mods={pseudo:"yes"},e.content[0].content=[e.content[0].content,{block:"awesome-icon",mods:{icon:"chevron-down"}}]),t.current&&(e.elemMods.current="yes"),t.customParams&&(e.customParams=t.customParams),e},t(e))}function ee(t){return[{block:"m-head-arrow",mix:[{block:"m-head",elem:"min"}],js:{type:t.ctx.service||"none"},title:t.ctx.title||"Service Name"},{block:t.blockName,elem:"main",content:t.ctx.menuItems&&{block:"m-head-menu",mods:{type:"main"},headTypeMod:t.ctx.mods&&t.ctx.mods.type,menuItems:t.ctx.menuItems}},t.ctx.action&&{elem:"action",mix:[{block:"m-head",elem:"min"}],action:t.ctx.action},t.ctx.search&&{block:"m-head-search",mix:[{block:"m-head",elem:"min"}],search:t.ctx.search},t.ctx.orange!==!1&&{block:t.blockName,elem:"orange",mix:[{block:"m-head",elem:"min"}],content:{block:"m-orange",js:{parentOffset:"m-head",api:t.ctx.orange&&t.ctx.orange.api||!1}}},{block:"m-head-user",user:t.ctx.user,customUserLinks:t.ctx.customUserLinks}]}function ie(t){var e={block:"input",value:t.ctx.width?t.ctx.width:"",mods:{size:t.ctx.size},content:[t.ctx.label&&{elem:"label",content:t.ctx.label},{elem:"control",attrs:{placeholder:BEM.I18N("b-grid-table-width-controll","auto"),autocomplete:"off"}}]},i={block:"select",mods:{size:t.ctx.size,theme:"normal",layout:"fixed"},content:[{block:"button",content:t.ctx.width_units?t.ctx.width_units:"%"},{elem:"control",attrs:{autocomplete:"off"},content:[{elem:"option",attrs:{value:"%"},content:"%"},{elem:"option",attrs:{value:"px"},content:"px"}]}]};return"%"!==i.content[0].content&&(i.content[1].content[1].attrs.selected="selected"),[e,i]}function ne(e){var i,n,s=t(e);return i={block:"select",mods:{size:"m",theme:"normal",layout:"content"},content:[]},n=e.ctx.fields.map(function(t){var e={elem:"option",attrs:{value:t.name},content:t.title};return s.ctx.selected===t.name&&(e.attrs.selected="selected",i.js={defaultValue:t.name},i.content.push({block:"button",content:t.title})),e}),i.content.push({elem:"control",content:n}),i}function se(t){var e=BEM.blocks["mi-helpers"].getDateFromHumanString(t.ctx.timestamp),i=function(t){return 10>t?"0"+t:t},n=[],s=i(e.getDate()),o=i(e.getMonth()+1),r=e.getFullYear(),a=i(e.getHours()),l=i(e.getMinutes());return n.push([s,o,r].join("."),[a,l].join(":")),n.join(", ")}function oe(t){var e=BEM.blocks["mi-helpers"].getDateFromHumanString(t.ctx.timestamp),i=function(t){return 10>t?"0"+t:t},n=[],s=i(e.getDate()),o=i(e.getMonth()+1),r=e.getFullYear(),a=i(e.getHours()),l=i(e.getMinutes());return n.push([s,o,r].join("."),[a,l].join(":")),n.join(", ")}function re(t){return[(!t.ctx.js.choosefile||"yes"===t.ctx.js.choosefile)&&{block:"attach",mods:{size:"s",theme:"action"},content:[{block:"button",mods:{size:"s"},mix:[{block:"attach",elem:"button"}],name:t.ctx.name&&t.ctx.name,controlAttrs:{multiple:"yes"},content:BEM.I18N("m-uploader","choose_file")},t.ctx.js.holder&&{elem:"holder",content:{block:"i-bem",elem:"i18n",keyset:"attach",key:"no-file"}}]},{elem:"text",content:BEM.I18N("m-uploader","drag_file")}]}function ae(t){return!!s==!1?le(t):Xe(t)}function le(t){return[(!t.ctx.js.choosefile||"yes"===t.ctx.js.choosefile)&&{block:"attach",mods:{size:"s"},content:[{block:"button",mods:{size:"s"},mix:[{block:"attach",elem:"button"}],name:t.ctx.name&&t.ctx.name,controlAttrs:{multiple:"yes"},content:"Выбрать файл"},t.ctx.js.holder&&{elem:"holder",content:{block:"i-bem",elem:"i18n",keyset:"attach",key:"no-file"}}]},(!t.ctx.js.dropzone||"yes"===t.ctx.js.dropzone)&&{elem:"drop-zone",content:"Перетащите файлы сюда"}]}function ce(t){if(!(t.__$anflg83!==!0)==!1){if(!t._attachButton==!1){if(!!s==!1){var e,i,n=(e=t.__$anflg83,t.__$anflg83=!0,i=ce(t),t.__$anflg83=e,i),o={block:"attach",elem:"control",attrs:t.ctx.controlAttrs};return[n,o]}return Xe(t)}return Xe(t)}return Xe(t)}function de(t){var e=BEM.blocks["mi-helpers"].getDateFromHumanString(t.ctx.timestamp.replace(" ","T")),i=function(t){return 10>t?"0"+t:t},n=[],s=i(e.getDate()),o=i(e.getMonth()+1),r=e.getFullYear(),a=i(e.getHours()),l=i(e.getMinutes());return n.push([s,o,r].join("."),[a,l].join(":")),n.join(", ")}function ue(t){return"layout"===s?!(r&&"horiz-complex"===r.layout)==!1?{elem:"layout-row",content:t.ctx.content}:he(t):he(t)}function he(t){return!(r&&"horiz-complex"===r.layout)==!1?!!s==!1?[{elem:"layout",content:t.ctx.content}]:pe(t):pe(t)}function pe(t){return"item"===s?!("current"!=o.state)==!1?!(r&&"link"===r.item)==!1?!t.isbTabbedPaneTabs==!1?{block:"b-link",content:t.ctx.content,url:t.ctx.url}:me(t):me(t):me(t):Xe(t)}function me(t){return!t._bTabbedPaneId==!1?!t.isbTabbedPaneTabs==!1?{block:"b-link",mods:{pseudo:"yes"},content:t.ctx.content}:Xe(t):Xe(t)}function fe(e){function i(t){return[t.getHours(),t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes()].join(":")}function n(t){var e="",i=t.getMonth()+1,n=(new Date).getFullYear(),s=BEM.I18N("i-tanker__months",(r.ctx.short?"short":"g")+i).toLowerCase(),o=[t.getDate(),s];return e=r.ctx.alwaysShowYear||n!=t.getFullYear()?o.concat(t.getFullYear()).join(" "):o.join(" ")}function s(t){var e=r["mi-helpers"].getDateFromHumanString(t),s=new Date,o=s-e,a=e.getDate(),l=s.getDate(),c=l-1,d=864e5;if(l==a&&o>0&&d>o){if(6e4>o)return BEM.I18N("mi-date","just-now");var u=Math.floor(o/6e4);if(60>u)return u+" "+BEM.I18N("mi-date","min");var h=Math.floor(o/36e5);return 60>h?h+" "+BEM.I18N("mi-date","h"):BEM.I18N("mi-date","today-at")+" "+i(e)}return c==a&&o>0&&2*d>o?BEM.I18N("mi-date","yesterday-at")+" "+i(e):n(e)
}function o(t){var e=r["mi-helpers"].getDateFromHumanString(t);return n(e)+" "+i(e)}var r=t(e);return e.ctx.timestamp?"full"===e.ctx.format?o(e.ctx.timestamp):"middle"===e.ctx.format?n(r["mi-helpers"].getDateFromHumanString(e.ctx.timestamp)):s(e.ctx.timestamp):[]}function _e(){return[{block:"b-editor-topbar",content:[{block:"m-editor-buttons",mods:{type:"page-editor"},js:{id:"page-editor"}},{block:"b-revision-info",content:[{elem:"text",content:BEM.I18N("b-editor-struct","page_update_warning")}]},{block:"radio-button",js:{id:"edit-action"},mix:{block:"b-editor-actions",js:!0},mods:{size:"m"},name:"edit-action",value:"edit",content:[{elem:"radio",controlAttrs:{value:"edit"},content:BEM.I18N("b-editor-struct","page_edit")},{elem:"radio",controlAttrs:{value:"view"},content:BEM.I18N("b-editor-struct","page_view")}]}]},{block:"m-editor",mods:{type:"edit-page"},js:{buttons:[["h2","h3"],["bold","italic","strikethrough"],["ul","ol"],["indent","outdent"],["quote","link","picture","code","table","math"]]}},{block:"spin",js:!0,mods:{theme:"gray-48",type:"edit-preview"}},{block:"b-editor-bottombar",content:[{block:"button",mix:{block:"b-editor-close-button",js:!0},attrs:{tabindex:1},mods:{size:"m",editor:"cancel"},content:BEM.I18N("b-editor-struct","page_update_reject")},{block:"button",mix:[{block:"b-readonly-item",js:!0},{block:"b-editor-save-button",js:!0}],attrs:{tabindex:0},mods:{size:"m",editor:"save",theme:"action"},content:BEM.I18N("b-editor-struct","page_save")},{block:"spin",js:!0,mods:{editor:"save"}},{block:"checkbox",mods:{size:"m",editor:"changes"},checkboxAttrs:{id:"changes"},content:{elem:"label",content:BEM.I18N("b-editor-struct","page_watcher_notify")}}]}]}function ge(e){var i,n,s=(t(e),i=e.__$anflg72,e.__$anflg72=!0,n=h(e),e.__$anflg72=i,n),o=[];return o.push([{elem:"title",mods:{actuality:"obsolete"},content:BEM.I18N("b-widget","mark_page_as_obsolete")},{elem:"title",mods:{actuality:"actual"},content:BEM.I18N("b-widget","mark_page_as_actual")},{elem:"comment",content:{block:"input",mods:{type:"textarea",size:"s"},name:"test",content:[{elem:"hint",content:BEM.I18N("b-widget","comment")},{elem:"control",attrs:{rows:"3"}}]}},{elem:"links",content:{elem:"link",content:{block:"input",mods:{size:"s"},content:[{elem:"label",content:BEM.I18N("b-widget","add_links_text")},{elem:"hint",content:BEM.I18N("b-widget","link_wiki_page")},{elem:"control"}]}}},{elem:"add-link",content:[{block:"link",content:BEM.I18N("b-widget","add_link")}]},{elem:"buttons",content:[{block:"spinner",mods:{size:"xs",type:"old-page"}},{block:"button",mods:{size:"m",type:"old-page-cancel"},attrs:{tabindex:1},content:BEM.I18N("b-widget","cancel")},{block:"button",mods:{size:"m",type:"old-page",theme:"action"},attrs:{tabindex:0},content:BEM.I18N("b-widget","mark")}]}]),s[1]&&(s[1].content=o),s}function be(t){return!(r&&"td"===r.type)==!1?!!s==!1?"td":Xe(t):Xe(t)}function ke(t){var e,n,s,o,r,a={block:"b-grid-table-options",content:[{block:"dropdown",content:[{elem:"switcher",content:{block:"awesome-icon",mods:{icon:"cog"}}},{elem:"popup",mods:{type:"grid-options"},content:[{block:"b-grid-table-options-item",content:BEM.I18N("b-grid-table-options","copy"),mods:{action:"copy",disabled:!0},js:!0},{block:"b-grid-table-options-item",content:BEM.I18N("b-grid-table-options","move"),mods:{action:"move"},mix:[{block:"b-action-move",js:{type:"grid",isAction:t.ctx.js.isAction||!1,source:"/"+t.ctx.js.gridUrl}}],js:!0},{block:"b-grid-table-options-item",content:BEM.I18N("b-grid-table-options","import"),mods:{action:"import",disabled:!0},js:!0},{block:"b-grid-table-options-item",content:BEM.I18N("b-grid-table-options","export"),mods:{action:"export"},js:!0},{block:"b-grid-table-options-item",content:BEM.I18N("b-grid-table-options","parent_table"),mods:{action:"parent",disabled:!t.ctx.js.isAction},js:!0},!t.ctx.js.isAction&&{block:"b-grid-table-options-item",content:"obsolete"===t.ctx.js.actuality?BEM.I18N("b-grid-table-options","mark_as_actual"):BEM.I18N("b-grid-table-options","mark_as_obsolete"),mods:{action:"old-page"},mix:[{block:"b-old-page",js:{actuality:"obsolete"===t.ctx.js.actuality?"obsolete":"actual"}}],js:!0},{elem:"line"},{block:"b-grid-table-options-item",content:BEM.I18N("b-grid-table-options","delete"),mods:{action:"delete"},mix:[{block:"b-action-delete",js:{type:"grid",isAction:t.ctx.js.isAction||!1,source:"/"+t.ctx.js.gridUrl}}],js:!0}]}]}]};return e=t.__$anflg88,t.__$anflg88=!0,s=t.ctx,t.ctx=a,o=i,i="",r=K(t),t.ctx=s,i=o,n=r,t.__$anflg88=e,n}function ve(t){return!(t.__$anflg87!==!0)==!1?!t._formSelect==!1?!!s==!1?ye(t):Me(t):Me(t):Me(t)}function ye(t){var e=t.ctx,i=t._formSelect.mods,n=t._formSelect.tabindex,s=e.mods||{};s.arrow="down",i.theme&&(s.theme=i.theme),i.size&&(s.size=i.size),"yes"===i.disabled&&(s.disabled="yes"),e.mods=s,n&&(e.tabindex=n);var o=t.__$anflg87;t.__$anflg87=!0;var r=t.ctx,a=r._theme;r._theme=!0,ve(t),r._theme=a,t.__$anflg87=o}function Me(t){if(!(t.__$anflg82!==!0)==!1){if(!t._attachButton==!1){if(!!s==!1){var e=t.__$anflg82;t.__$anflg82=!0;var i=t._name;t._name=t.ctx.name||"attachment";var n=t._tabindex;return t._tabindex=t.ctx.tabindex,ve(t),t._name=i,t._tabindex=n,t.__$anflg82=e,void 0}return je(t)}return je(t)}return je(t)}function we(t){return!(t.__$anflg85!==!0)==!1?!!s==!1?xe(t):je(t):je(t)}function xe(t){var e=t.ctx,i=e.id||t.generateId(),s=t.__$anflg85;t.__$anflg85=!0;var o=t._controlAttrs;t._controlAttrs={id:i,name:e.name||i,tabindex:e.tabindex};var a=t._formSelect;t._formSelect={block:n,mods:r,tabindex:e.tabindex},we(t),t._controlAttrs=o,t._formSelect=a,t.__$anflg85=s}function Ee(t){return!(t.__$anflg81!==!0)==!1?!!s==!1?Be(t):je(t):je(t)}function Be(t){var e=t.ctx.mods||{},i=(t.ctx.controlAttrs||{}).id||t.generateId();e.theme=e.theme||"normal";var n=t.__$anflg81;t.__$anflg81=!0;var s=r;r=e;var o=t._attachButton;t._attachButton=!0;var a=t._disabled;t._disabled=r.disabled;var l=t._textId;t._textId="text"+i,Ee(t),r=s,t._attachButton=o,t._disabled=a,t._textId=l,t.__$anflg81=n}function Ie(t){var e=[{elem:"layout-cell",content:t.ctx}];t._separator&&!t.isFirst()&&e.unshift({elem:"layout-cell",mix:[{elem:"separator"}],content:t._separator});var n=t.__$anflg80;t.__$anflg80=!0;var s=t.ctx;t.ctx=e;var o=i;i="",K(t),t.ctx=s,i=o,t.__$anflg80=n}function Se(t){if(!(t.__$anflg79!==!0)==!1){if(!(r&&"horiz"===r.layout)==!1){if(!!s==!1){var e=t.__$anflg79;t.__$anflg79=!0;var i=t._separator;return t._separator=t.ctx.separator,F(t),t._separator=i,t.__$anflg79=e,void 0}return De(t)}return De(t)}return De(t)}function De(t){if("gap"===s){if(!(r&&"horiz-complex"===r.layout)==!1){var e=i;i="";var n=t.position;t.position=t.position-1;var o=t.ctx;return t.ctx={elem:"layout-gap",tag:"td",content:t.ctx.content},K(t),i=e,t.position=n,t.ctx=o,void 0}return Ne(t)}return Ne(t)}function Ne(t){return!(t.__$anflg78!==!0)==!1?!(r&&"horiz-complex"===r.layout)==!1?!("item"===s||"separator"===s)==!1?Te(t):Ce(t):Ce(t):Ce(t)}function Te(t){var e=t.__$anflg78;t.__$anflg78=!0;var n=i;i="";var s=t.position;t.position=t.position-1;var o=t.ctx;t.ctx={elem:"layout-cell",content:t.ctx},K(t),i=n,t.position=s,t.ctx=o,t.__$anflg78=e}function Ce(t){if("tab"===s){if(!t._bTabbedPaneId==!1){if(!t.isbTabbedPaneTabs==!1){var e=i;i="";var n=t.ctx,o=n.elem;return n.elem="item",K(t),i=e,n.elem=o,void 0}return je(t)}return je(t)}return je(t)}function Oe(t){var e=i;i="";var n=t.isbTabbedPaneTabs;t.isbTabbedPaneTabs=!0;var s=t.ctx;t.ctx={block:"b-menu",js:!0,mods:{"is-bem":"yes",layout:t._mods&&t._mods.layout||"horiz",item:t._mods&&t._mods.item||""},mix:t._mix.concat([{block:"b-tabbed-pane",js:{id:t._bTabbedPaneId},mods:t._mods},{block:"b-tabbed-pane",elem:"tabs"}]),content:t.ctx.content},K(t),i=e,t.isbTabbedPaneTabs=n,t.ctx=s}function Pe(t){var e,n,s=(e=i,i="mix",n=Qe(t),i=e,n),o=i;i="";var r=t._bTabbedPaneId;t._bTabbedPaneId=t.ctx.id||t.generateId();var a=t._mix;t._mix=t.ctx.mix?s=s?s.concat(t.ctx.mix):t.ctx.mix:[];var l=t._mods;t._mods=t.ctx.mods;var c=t.ctx;t.ctx=t.ctx.content,K(t),i=o,t._bTabbedPaneId=r,t._mix=a,t._mods=l,t.ctx=c}function je(t){return!(t.__$anflg77!==!0)==!1?!!t["mi-helpers"]==!1?Le(t):Ae(t):Ae(t)}function Le(t){t["mi-helpers"]={getDateFromHumanString:function(t){var e,i=Math.abs(~t.search(/\./)||~t.search("Z")),n=t;return n=n.replace(/-/g,",").replace("T",",").replace(/:/g,","),n=i?n.substr(0,i-1):n,n=n.split(","),n[1]=n[1]-1,e=new Date(n[0],n[1],n[2]),n[3]&&e.setHours(n[3]),n[4]&&e.setMinutes(n[4]),n[5]&&e.setSeconds(n[5]),e},getHumanStringFromDate:function(t){var e,i=t.date,n=i.getFullYear(),s=(i.getMonth()+1).toString(),o=i.getDate().toString(),r=i.getHours().toString(),a=i.getMinutes().toString(),l=i.getSeconds().toString();return 1===s.length&&(s="0"+s),e=n+"-"+s,t.needDay!==!1&&(1===o.length&&(o="0"+o),e=e+"-"+o,t.needHours&&(1===r.length&&(r="0"+r),e=e+"T"+r,t.needMinutes&&(1===a.length&&(a="0"+a),e=e+":"+a,t.needSeconds&&(1===l.length&&(l="0"+l),e=e+":"+l)))),e}};var e=t.__$anflg77;t.__$anflg77=!0,O(t),t.__$anflg77=e}function Ae(t){var e=n;return"radio-button"===e?!(t.__$anflg76!==!0)==!1?!!s==!1?Fe(t):$e(t):$e(t):"radiobox"===e?"radio"===s?!(t.__$anflg74!==!0)==!1?ze(t):Re(t):Re(t):"input"===e?"hint"===s?!(t.__$anflg71!==!0)==!1?!!t._value==!1?!(0!==t._value)==!1?Ue(t):Xe(t):Xe(t):Xe(t):Xe(t):Xe(t)}function Fe(t){var e=t.ctx.mods||{};e.theme=e.theme||"normal";var i=t.__$anflg76;t.__$anflg76=!0;var n=t.ctx,s=n.mods;n.mods=e;var o=t._modsDisabled;t._modsDisabled=t.ctx.mods&&t.ctx.mods.disabled;var r=t._name;t._name=t.ctx.name;var a=t._value;t._value=t.ctx.value;var l=t._nextForChecked;t._nextForChecked=!1,je(t),n.mods=s,t._modsDisabled=o,t._name=r,t._value=a,t._nextForChecked=l,t.__$anflg76=i}function $e(t){return"radio"===s?!(t.__$anflg75!==!0)==!1?He(t):Xe(t):Xe(t)}function He(t){var e,i,n,s,o,r=t.ctx,a=r.elemMods||{},l=r.controlAttrs||{},c=void 0!=l.value&&l.value==t._value,d=t._.extend(l,{checked:(c||a.checked)&&(t._nextForChecked=!0),disabled:t._modsDisabled||a.disabled});return d.id||(d.id=t.generateId()),e=t.__$anflg75,t.__$anflg75=!0,n=t._controlAttrs,t._controlAttrs=d,s=t._valuesMatched,t._valuesMatched=c,o=je(t),t._controlAttrs=n,t._valuesMatched=s,i=o,t.__$anflg75=e,i}function ze(t){var e,i,n,s,o,r=t.ctx,a=r.elemMods||{},l=r.controlAttrs||{},c=void 0!=l.value&&l.value==t._value,d=t._.extend(l,{checked:c||a.checked,disabled:t._modsDisabled||a.disabled});return d.id||(d.id=t.generateId()),e=t.__$anflg74,t.__$anflg74=!0,n=t._controlAttrs,t._controlAttrs=d,s=t._valuesMatched,t._valuesMatched=c,o=je(t),t._controlAttrs=n,t._valuesMatched=s,i=o,t.__$anflg74=e,i}function Re(t){return!(t.__$anflg73!==!0)==!1?!!s==!1?qe(t):Xe(t):Xe(t)}function qe(t){var e=t.ctx.mods||{};e.theme=e.theme||"normal";var i=t.__$anflg73;t.__$anflg73=!0;var n=t.ctx,s=n.mods;n.mods=e;var o=t._modsDisabled;t._modsDisabled=t.ctx.mods&&t.ctx.mods.disabled;var r=t._name;t._name=t.ctx.name;var a=t._value;t._value=t.ctx.value,je(t),n.mods=s,t._modsDisabled=o,t._name=r,t._value=a,t.__$anflg73=i}function Ue(t){var e,n,s,o,r,a=t.ctx,l=a.elemMods||(a.elemMods={});return l.visibility="visible",e=t.__$anflg71,t.__$anflg71=!0,s=t.ctx,t.ctx=a,o=i,i="",r=K(t),t.ctx=s,i=o,n=r,t.__$anflg71=e,n}function We(t){if(!(t.__$anflg86!==!0)==!1){var e,i,n=(e=t.__$anflg86,t.__$anflg86=!0,i=We(t),t.__$anflg86=e,i||{});return"yes"===(t.ctx.elemMods||{}).label&&(n.id=t._labelId,n["aria-hidden"]=!0),n}return{id:t.generateId()}}function Ve(t){return!t._formSelect==!1?!!s==!1?{role:"listbox",type:"button","aria-haspopup":!0,"aria-expanded":!1}:Ge(t):Ge(t)}function Ge(t){if("text"===s){if(!(t.__$anflg84!==!0)==!1){if(!t._attachButton==!1){var e,i,n=(e=t.__$anflg84,t.__$anflg84=!0,i=Ve(t),t.__$anflg84=e,i||{});return n.id=t._textId,n["aria-hidden"]=!0,n}return Je(t)}return Je(t)}return Je(t)}function Je(t){return!t._attachButton==!1?!!s==!1?{}:Xe(t):Xe(t)}function Ke(t){if(!!t._baseAttrsApplyed==!1){var e,i,n,s=(e=t._value,t._value=null,i=t._baseAttrsApplyed,t._baseAttrsApplyed=!0,n=Ke(t),t._value=e,t._baseAttrsApplyed=i,n);return t._.extend(s,{rows:10,cols:10})}return Xe(t)}function Ye(t){return!t._attachButton==!1?!!s==!1?!t._disabled==!1?[{mods:{disabled:"yes"}}]:Xe(t):Xe(t):Xe(t)}function Qe(t){return"panels"===s?[{block:"b-tabbed-pane",js:{id:t._bTabbedPaneId}},{mods:t._mods}]:Xe(t)}function Ze(t){var e=t._controlAttrs,i={},n=(t.ctx.mods||{}).side;return n||(n=t.isFirst()?t.isLast()?"both":"left":t.isLast()?"right":""),n&&(i.side=n),t._nextForChecked&&!e.checked&&(t._nextForChecked=null,i["next-for-pressed"]="yes"),t._modsDisabled&&(i.disabled="yes"),t._valuesMatched&&(i.checked="yes"),e.checked&&(i.pressed="yes"),[{elemMods:i}]}function Xe(t){if("m-suggest"===n){if(!(t.__$anflg70!==!0)==!1){if(!t.ctx.inHeader==!1){if(!!s==!1){var e=t.ctx;e.inputMods=t._.extend(e.inputMods,{"no-shadow":"yes"});var o=t.__$anflg70;t.__$anflg70=!0;var r=t.ctx;t.ctx=e;var a=i;return i="",K(t),t.ctx=r,i=a,t.__$anflg70=o,void 0}return ti(t)}return ti(t)}return ti(t)}return ni(t)}function ti(t){return!(t.__$anflg69!==!0)==!1?!(!t.ctx.inputMods||!t.ctx.inputMods.size)==!1?!!s==!1?ei(t):ii(t):ii(t):ii(t)}function ei(t){var e=t.ctx;e.inputMods=t._.extend(e.inputMods,{size:e.mods&&e.mods.size||"s"});var n=t.__$anflg69;t.__$anflg69=!0;var s=t.ctx;t.ctx=e;var o=i;i="",K(t),t.ctx=s,i=o,t.__$anflg69=n}function ii(t){if(!(t.__$anflg68!==!0)==!1){if(!!s==!1){if(!!t.ctx.mods.size==!1){var e=t.ctx;e.mods.size="s";var n=t.__$anflg68;t.__$anflg68=!0;var o=t.ctx;t.ctx=e;var r=i;return i="",K(t),t.ctx=o,i=r,t.__$anflg68=n,void 0}return ni(t)}return ni(t)}return ni(t)}function ni(t){var e=i;if("content"===e){var e=n;if("m-suggest-group"===e){if(!!s==!1){var o=t.ctx.content;return t.ctx.groupLabel&&(o=[{elem:"group-label",content:t.ctx.groupLabel&&BEM.I18N("m-suggest-item",t.ctx.groupLabel)},o]),o}return Gn(t)}if("b-form-input"===e)return"clear"===s?!!t.ctx.content==!1?"&nbsp;":Gn(t):Gn(t);if("b-autocomplete-item"===e){if(!(r&&"lingvo"===r.type)==!1){if(!!s==!1){var a=t.ctx.data[1];return[{tag:"span",elem:"text",content:a.text},{tag:"span",elem:"translation",content:[" — ",a.translation]}]}return Mi(t)}return Mi(t)}return"b-old-page-mark"===e?!!s==!1?[{elem:"text",content:BEM.I18N("b-old-page-mark","old_page")},{elem:"popup",content:[{block:"popup",mods:{page:"old-page"},js:{directions:{to:"bottom",offset:{top:11}}},content:[{elem:"content",content:[{block:"b-old-page-mark",elem:"date",content:[BEM.I18N("b-old-page-mark","last_update")+" ",{block:"m-date",format:"full",timestamp:t.ctx.modified_at}]}]}]}]}]:Gn(t):"b-page-date"===e?!!s==!1?[{block:"b-page-info",elem:"label",content:BEM.I18N("b-page-date","updated")},{block:"m-date",format:"full",timestamp:t.ctx.modified_at}]:Gn(t):"b-cluster-autocomplete"===e?!!s==!1?[{block:"input",mods:{size:"s",action:"suggest"},value:"/",content:{elem:"control"}},{block:"spinner",mods:{size:"xs"}},{block:"awesome-icon",mods:{icon:"lock"}},{block:"popup",mods:{adaptive:"yes",type:"suggest"},js:{directions:{to:"bottom",axis:"left"}},content:[{elem:"content",content:[{block:"b-autocomplete-select-item",content:[{elem:"static"},{elem:"sub"}]}]}]}]:Gn(t):"m-replacer"===e?"field"===s?[{block:"input",js:{autoFocus:"yes"},mods:{size:"s",type:"replace"},value:t.ctx.val,content:{elem:"control"}}]:!!s==!1?[{elem:"text",content:t.ctx.content}]:Gn(t):"check-button"===e?!!s==!1?[t._control,{elem:"text",tag:"span",content:t.ctx.content}]:Gn(t):"checkbox"===e?!!s==!1?[{elem:"box",tag:"span",elemMods:"yes"===r.checked?{checked:"yes"}:"",content:[{elem:"control",attrs:t.ctx.checkboxAttrs||{}},{elem:"tick",tag:"i"}]},t.ctx.content]:Gn(t):"m-editor-button"===e?Bi(t):"b-form-button"===e?"text"===s?t.ctx.content:!!s==!1?[{elem:"left"},{elem:"content",tag:"span",content:{elem:"text",content:t.ctx.content}},{elem:"click"},t._input]:Gn(t):"b-widget"===e?"content"===s?!(t.__$anflg61!==!0)==!1?!(r&&"subscribe"===r.type)==!1?mi(t):fi(t):fi(t):fi(t):"wiki-warn"===e?!!s==!1?[t._helper[t.wiki.lang].warn[t.ctx["wiki-attrs"].id]]:Gn(t):"m-suggest-item"===e?si(t):"wiki-tocitem"===e?pn(t):"b-page-more-panel"===e?!!s==!1?Ei(t):Gn(t):Gn(t)}if("attrs"===e){var e=n;if("m-suggest-item"===e)return!(r&&"yes"===r.link)==!1?!!s==!1?{href:t.ctx.data.href}:fn(t):fn(t);if("b-form-input"===e){var e=s;if("hidden-input"===e)return{type:"hidden",name:t.ctx.name,value:t.ctx.value};if("input"===e){var l={id:t._inputId,name:t._name};return t._value&&(l.value=t._value),r.disabled&&(l.disabled="disabled"),l}return Gn(t)}if("check-button"===e){var e=s;return"control"===e?_n(t):"text"===e?{id:t._control.labelledby}:!!s==!1?{"for":t._control.id}:Gn(t)}if("checkbox"===e){if("control"===s){var c=t.ctx.attrs||{};return c.id=t._checkboxAttrs.id,c.type="checkbox",r.disabled&&(c.disabled="disabled"),"yes"==r.checked&&(c.checked="checked"),c["aria-labelledby"]=t._labelId,c}return Gn(t)}if("b-form-button"===e){if("input"===s){for(var d,u={type:t.ctx.type,value:""},h=t.ctx,p=["tabindex","name","value"];d=p.shift();)h[d]&&(u[d]=h[d]);return h.disabled&&(u.disabled="disabled"),"simple"!=h.typeMod&&(u.hidefocus="true"),u}if(!!s==!1){var m={role:"button"},f=t.ctx;return f.url&&(m.href=f.url),f.target&&(m.target=f.target),f.counter&&(m.onmousedown=f.counter),r.disabled&&(m["aria-disabled"]=!0),m}return Gn(t)}return Gn(t)}if("tag"===e){var e=n;if("m-suggest-item"===e)return!(r&&"yes"===r.link)==!1?!!s==!1?"a":bn(t):bn(t);if("b-form-input"===e){var e=s;return"clear"===e?"span":"hidden-input"===e||"input"===e?"input":!!s==!1?"span":Gn(t)}if("b-autocomplete-item"===e)return!!s==!1?"li":Gn(t);if("m-replacer"===e){var e=s;return"field"===e||"text"===e?"span":Gn(t)}if("check-button"===e)return"control"===s?"input":!!s==!1?"label":Gn(t);if("checkbox"===e)return"control"===s?"input":!!s==!1?"span":Gn(t);if("b-form-button"===e){var e=s;return"input"===e?"input":"click"===e?!t.ctx.url==!1?"i":"":"text"===e?"span":"left"===e?"i":!t.ctx.url==!1?!!s==!1?"a":kn(t):kn(t)}return"b-popupa"===e?"tail"===s?"i":Gn(t):Gn(t)}if("js"===e){var e=n;return"m-suggest-item"===e?vn(t):"b-form-input"===e?!(r&&"yes"===r.multicomplete)==!1?!!s==!1?{dataprovider:{name:"b-form-input__multicomplete-dataprovider",multicomplete:t.ctx.multicomplete}}:Bn(t):Bn(t):"b-autocomplete-item"===e?!(r&&"nav"===r.type)==!1?!!s==!1?{val:t._url}:In(t):In(t):"m-replacer"===e||"check-button"===e||"checkbox"===e||"b-form-button"===e||"dropdown"===e?!!s==!1?!0:Gn(t):"wiki-tocitem"===e?!!s==!1?{anchor:t.ctx["wiki-attrs"].anchor}:Gn(t):Gn(t)}if("default"===e){var e=n;if("b-form-input"===e){if(!t.ctx==!1){if(!t.ctx.multicomplete==!1){if(!!s==!1){if(!!r.multicomplete==!1){var _,g,b;return _=r,g=_.multicomplete,_.multicomplete="yes",b=je(t),_.multicomplete=g,b}return Sn(t)}return Sn(t)}return Sn(t)}return Sn(t)}if("b-autocomplete-item"===e)return!(t.__$anflg56!==!0)==!1?!(r&&"nav"===r.type)==!1?!!s==!1?Pn(t):Gn(t):Gn(t):Gn(t);if("check-button"===e){if(!(r&&"yes"===r.pseudo)==!1){if(!!s==!1){if(!!(t.ctx.mods||{}).theme==!1){var _=t.ctx,g=_.mods;return _.mods=t._.extend(t.ctx.mods||{},{theme:"pseudo"}),je(t),_.mods=g,void 0}return jn(t)}return jn(t)}return jn(t)}if("checkbox"===e)return!(t.__$anflg53!==!0)==!1?!!s==!1?An(t):Gn(t):Gn(t);if("b-form-button"===e)return!(t.__$anflg32!==!0)==!1?!!s==!1?Fn(t):Gn(t):Gn(t);if("button"===e){if(!(r&&"yes"===r.pseudo)==!1){if(!!s==!1){if(!!(t.ctx.mods||{}).theme==!1){var _=t.ctx,g=_.mods;return _.mods=t._.extend(t.ctx.mods||{},{theme:"pseudo"}),ve(t),_.mods=g,void 0}return Gn(t)}return Gn(t)}return Gn(t)}if("dropdown"===e)return"popup"===s?!(t.__$anflg31!==!0)==!1?$n(t):Gn(t):Gn(t);if("wiki-wikiword"===e){if(!!s==!1){var _=i;i="";var g=t.ctx;return t.ctx={block:"b-link",url:t.ctx["wiki-attrs"].link,mix:[{block:"wiki-wikiword"}],content:[{block:"wiki-txt","wiki-attrs":{txt:t.ctx["wiki-attrs"].txt}}]},K(t),i=_,t.ctx=g,void 0}return Gn(t)}return"wiki-warnset"===e?!!s==!1?!!t.ctx.content.length==!1?Hn(t):zn(t):zn(t):"wiki-underline"===e?!!s==!1?!!t.wiki.styles.underline==!1?qn(t):Gn(t):Gn(t):Gn(t)}if("value"===e)return"b-form-input"===n?Un(t):Gn(t);if("mix"===e){var e=n;if("b-autocomplete-item"===e)return!(r&&"foot"===r.type)==!1?!!s==!1?[{mods:{enterable:"no"}}]:Vn(t):Vn(t);if("b-form-button"===e){if(!!s==!1){var k={},v=t.ctx.mods;return v&&v.size||(k.size="s"),v&&v.theme||(k.theme="grey-s"),[{mods:k}]}return Gn(t)}return"dropdown"===e?!!s==!1?[{mods:{action:"closed"}}]:Gn(t):"wiki-tocitem"===e?!!s==!1?[{mods:{level:""+t.ctx["wiki-attrs"].level}}]:Gn(t):Gn(t)}return Gn(t)}function si(t){if(!(t.__$anflg67!==!0)==!1){if(!(r&&"yes"===r.labels)==!1){if(!!s==!1){var e,i;return[{elem:"item-label",content:BEM.I18N("m-suggest-item",t.ctx.mods.type)},(e=t.__$anflg67,t.__$anflg67=!0,i=si(t),t.__$anflg67=e,i)]}return oi(t)}return oi(t)}return oi(t)}function oi(t){return!(r&&"equipment"===r.type)==!1?!!s==!1?ri(t):ai(t):ai(t)}function ri(t){var e,i,n=t.ctx.data,s=n.office_name,o=n.name+", "+n.type_display,r=o.indexOf(t.ctx.inputData.text);return parseInt(n.floor_display)>=0&&(s+=", "+n.floor_display.replace("floor",BEM.I18N("m-suggest-item","floor"))),i=-1!==r?[o.substr(0,r),{elem:"selected",content:t.ctx.inputData.text},o.substr(r+t.ctx.inputData.text.length)]:o,e=[{elem:"info-wrapper",content:[{elem:"equipment",content:i},{elem:"office",content:s}]}]}function ai(t){return!(r&&"table"===r.type)==!1?!!s==!1?li(t):ci(t):ci(t)}function li(t){var e,i,n=t.ctx.data,s=n.office_name,o=n.num+", "+n.status_display,r=o.indexOf(t.ctx.inputData.text);return parseInt(n.floor_display)>=0&&(s+=", "+n.floor_display.replace("floor",BEM.I18N("m-suggest-item","floor"))),i=-1!==r?[o.substr(0,r),{elem:"selected",content:t.ctx.inputData.text},o.substr(r+t.ctx.inputData.text.length)]:o,e=[{elem:"info-wrapper",content:[{elem:"table",content:i},{elem:"office",content:s}]}]}function ci(t){return!(r&&"maillist"===r.type)==!1?!!s==!1?di(t):ui(t):ui(t)}function di(t){var e,i,n,s;return t.ctx.data.email===t.ctx.data.name?(i=t.ctx.data.email.replace(/(.*@)/,""),e=t.ctx.data.email.replace(e,"")):(e=t.ctx.data.name+(t.ctx.data.email&&"@"),i=t.ctx.data.email.replace(e,"")),n=(e+i).indexOf(t.ctx.inputData.text),s=-1!==n?[e.substr(0,n),{elem:"selected",content:e.substr(n,n+t.ctx.inputData.text.length)},e.substr(n+t.ctx.inputData.text.length)]:e,{elem:"info-wrapper",content:[{elem:"black",content:s},i]}}function ui(t){if(!(r&&"department"===r.type)==!1){if(!!s==!1){var e,i=t.ctx.data.name,n=i.indexOf(t.ctx.inputData.text);return e=-1!==n?[i.substr(0,n),{elem:"selected",content:t.ctx.inputData.text},i.substr(n+t.ctx.inputData.text.length)]:i,{elem:"info-wrapper",content:e}}return hi(t)}return hi(t)}function hi(t){return!(r&&"staff"===r.type)==!1?!!s==!1?pi(t):Gn(t):Gn(t)}function pi(t){var e,i,n=t.ctx.data,s=n.department__name||n.department,o=n.login.indexOf(t.ctx.inputData.text);return i=-1!==o?[n.login.substr(0,o),{elem:"selected",content:t.ctx.inputData.text},n.login.substr(o+t.ctx.inputData.text.length)]:n.login,e=[{elem:"info-wrapper",content:[{elem:"fullname",content:(n.title||n._text)+", "},{elem:"brief",content:[i,"@"]},{elem:"info",content:s}]},{block:"m-userpic",size:"50",login:n.login}]}function mi(t){var e,i,n=(e=t.__$anflg61,t.__$anflg61=!0,i=p(t),t.__$anflg61=e,i);return t._.isArray(n)||(n=[n]),n.push({elem:"header",tag:"h2",content:BEM.I18N("b-widget","sign_on_page")},{elem:"users-list"},{block:"spinner",mods:{size:"xs",type:"action-load"}},{block:"m-suggest",mods:{type:"multicomplete",size:"m"},multiple:!0,hint:BEM.I18N("b-widget","add_users"),js:{addRequestParams:{staff_fields:"uid"}},types:[{name:"staff",maxCount:10}]},{block:"input",mods:{type:"textarea",subscribe:"comment"},content:{elem:"control",attrs:{placeholder:BEM.I18N("b-widget","comment")}}},{elem:"users-result",content:BEM.I18N("b-widget","success_subscribe")},{elem:"buttons",content:[{block:"button",mods:{size:"m",type:"close"},attrs:{tabindex:0},content:BEM.I18N("b-widget","close")},{block:"button",mods:{size:"m",type:"cancel"},attrs:{tabindex:-1},content:BEM.I18N("b-widget","cancel")},{block:"button",mods:{theme:"action",size:"m",type:"save",disabled:"yes"},attrs:{tabindex:0},content:BEM.I18N("b-widget","subscribe")},{block:"spinner",mods:{size:"s",type:"subscribe-load"}}]}),n}function fi(t){return!(t.__$anflg60!==!0)==!1?!(r&&"page-move"===r.type)==!1?!!s==!1?_i(t):gi(t):gi(t):gi(t)}function _i(e){var i,n,s=(t(e),i=e.__$anflg60,e.__$anflg60=!0,n=h(e),e.__$anflg60=i,n),o=[],r=e.ctx.js.type;return o.push(["grid"==r&&{elem:"additional-text",content:BEM.I18N("b-widget","move_table")},{elem:"current-address-title",content:"grid"==r?BEM.I18N("b-widget","current_address_table")+":":BEM.I18N("b-widget","current_address_of_cluster")+":"},{elem:"current-address-url"},{elem:"current-address-page"},{elem:"current-address-subpages",content:[{block:"checkbox",mods:{size:"s",checked:"yes",type:"clusters"}},{block:"b-cluster-subpages",content:[{elem:"num"},BEM.I18N("b-widget","subpages")]}]}],{elem:"current-page"},{elem:"current-address-title",mods:{type:"subpage"},content:"grid"==r?BEM.I18N("b-widget","set_page_name_to_move_table")+":":BEM.I18N("b-widget","set_page_name_to_move_cluster")+":"},{block:"b-cluster-autocomplete"},{elem:"current-address-title",content:"grid"==r?BEM.I18N("b-widget","table_new_address")+":":BEM.I18N("b-widget","cluster_new_address")+":"},{elem:"new-url"},{elem:"new-url-page"},{elem:"buttons",content:[{block:"spinner",mods:{size:"xs",type:"move-load"}},{block:"button",mods:{size:"m",type:"move-cluster-cancel"},attrs:{tabindex:1},content:BEM.I18N("b-widget","cancel")},{block:"button",mods:{size:"m",type:"move-cluster",theme:"action"},attrs:{tabindex:0},content:"grid"==r?BEM.I18N("b-widget","move_the_table"):BEM.I18N("b-widget","move_the_cluster")}]}),s[1]&&(s[1].content=o),s}function gi(t){return"content"===s?!(t.__$anflg59!==!0)==!1?!(r&&"new-page"===r.type)==!1?bi(t):ki(t):ki(t):yi(t)}function bi(t){var e,i,n=(e=t.__$anflg59,t.__$anflg59=!0,i=p(t),t.__$anflg59=e,i);return t._.isArray(n)||(n=[n]),n.push({block:"radio-button",mods:{size:"m",type:"new-page"},name:"new-page",value:"page",content:[{elem:"radio",controlAttrs:{value:"page"},content:BEM.I18N("b-widget","page")},{elem:"radio",controlAttrs:{value:"grid"},content:BEM.I18N("b-widget","grid")}]},{block:"input",mods:{size:"s",type:"new-page-url"},content:[{elem:"control"},{elem:"under",content:[{elem:"prefix"},{elem:"url"},{elem:"placeholder"}]}]},{block:"input",mods:{size:"m",type:"new-page-title",focused:"yes"},content:{elem:"control",attrs:{placeholder:BEM.I18N("b-widget","name")}}},{elem:"buttons",content:[{block:"button",mods:{size:"m",type:"new-page-cancel"},attrs:{tabindex:1},content:BEM.I18N("b-widget","cancel")},{block:"button",mods:{size:"m",theme:"action",type:"new-page-save"},attrs:{tabindex:0},content:BEM.I18N("b-widget","create")},{block:"spinner",mods:{size:"s",type:"create-load"}}]}),n}function ki(t){return!(t.__$anflg57!==!0)==!1?!(r&&"page-access"===r.type)==!1?vi(t):yi(t):yi(t)}function vi(t){var e,i,n=(e=t.__$anflg57,t.__$anflg57=!0,i=p(t),t.__$anflg57=e,i);return t._.isArray(n)||(n=[n]),n.push({elem:"header",tag:"h2",content:BEM.I18N("b-widget","restricted_access")},{elem:"users-list"},{block:"b-groups-list"},{block:"b-services-list"},{block:"b-wiki-list"},{block:"spinner",mods:{size:"xs",type:"action-load"}},{block:"b-form-input",mods:{size:"l",theme:"grey",type:"pageAccess","has-clear":"yes"},name:"user",multicomplete:{types:"staff|group",limit:5,staff_fields:"login|gender|uid|id",group_fields:"type",staff_id:"login"},content:[{elem:"hint",content:BEM.I18N("b-widget","add_department_or_person")},{elem:"input",clear:{elem:"clear"}}]},{elem:"buttons",content:[{block:"button",mods:{size:"m",type:"cancel"},attrs:{tabindex:1},content:BEM.I18N("b-widget","reject")},{block:"button",mods:{theme:"action",size:"m",type:"save"},attrs:{tabindex:0},content:BEM.I18N("b-widget","save")}]}),n}function yi(t){return!!s==!1?[{block:"spin",js:!0,mods:{theme:"gray-48",type:"load"}},{elem:"content",content:[]}]:Gn(t)}function Mi(e){return!(r&&"foot"===r.type)==!1?!!s==!1?e.ctx.data.slice(1).map(function(t){return this._.isArray(t)?{tag:"span",elem:"foot",content:t[0]}:t},t(e)):wi(e):wi(e)}function wi(t){return!(r&&"nav"===r.type)==!1?!!s==!1?{elem:"link",tag:"a",attrs:{href:t._url,target:"_blank"},content:[{elem:"link-url",tag:"span",content:t._linkUrlContent},{elem:"link-info",tag:"span",content:t._linkInfoConten}]}:xi(t):xi(t)}function xi(t){if(!!s==!1){var e=t.ctx.data,i=BEM.blocks["i-common__string"],n=i.escapeHTML(t._.isArray(e)?e[1]:e);return i.highlight(n,t.ctx.hl)}return Gn(t)}function Ei(t){return[{block:"b-page-more-panel-item",mix:[{block:"b-action-move",js:{type:"page"}}],content:BEM.I18N("b-page-more-panel","move")},{block:"b-page-more-panel-item",mix:[{block:"b-action-subscribe"}],content:BEM.I18N("b-page-more-panel","subscribe_users")},{block:"b-page-more-panel-item",mix:[{block:"b-action-sub"}],content:BEM.I18N("b-page-more-panel","create_page")},{block:"b-page-more-panel-item",mix:[{block:"b-change-owner"}],content:BEM.I18N("b-page-more-panel","change_owner")},{block:"b-page-more-panel-item",mix:[{block:"b-old-page",js:{actuality:"obsolete"===t.ctx.actuality?"obsolete":"actual"}}],mods:{type:"old-page"},content:"obsolete"===t.ctx.actuality?BEM.I18N("b-page-more-panel","mark_as_actual"):BEM.I18N("b-page-more-panel","mark_as_obsolete")},{block:"b-page-more-panel-item",mix:[{block:"b-action-delete",js:{type:"page"}}],content:BEM.I18N("b-page-more-panel","delete")}]}function Bi(t){if(!(t.__$anflg52!==!0)==!1){if(!(r&&"other"===r.type)==!1){if(!!s==!1){var e,i,n=(e=t.__$anflg52,t.__$anflg52=!0,i=Bi(t),t.__$anflg52=e,i);return n.attrs.title=BEM.I18N("m-editor-button","other"),n.js={popup:{title:BEM.I18N("m-editor-popup","other"),type:"other"},notEditor:!0,data:t.ctx.data},n.content="&#133",n}return Ii(t)}return Ii(t)}return Ii(t)}function Ii(t){return!(t.__$anflg51!==!0)==!1?!(r&&"spell"===r.type)==!1?!!s==!1?Si(t):Di(t):Di(t):Di(t)}function Si(t){var e,i,n=(e=t.__$anflg51,t.__$anflg51=!0,i=Bi(t),t.__$anflg51=e,i);return n.attrs.title=BEM.I18N("m-editor-button","spell"),n.js={popup:{title:BEM.I18N("m-editor-popup","spell"),type:"spell"},notEditor:!0},n.content=[{block:"awesome-icon",mods:{icon:"ok"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","spell")}],n}function Di(t){return!(t.__$anflg50!==!0)==!1?!(r&&"math"===r.type)==!1?!!s==!1?Ni(t):Ti(t):Ti(t):Ti(t)}function Ni(t){var e,i,n=(e=t.__$anflg50,t.__$anflg50=!0,i=Bi(t),t.__$anflg50=e,i);return n.attrs.title=BEM.I18N("m-editor-button","math"),n.js={before:"%%(math outline)",after:"%%"},n.content=[{block:"awesome-icon",mods:{icon:"math"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","math")}],n}function Ti(t){return!(t.__$anflg49!==!0)==!1?!(r&&"color"===r.type)==!1?!!s==!1?Ci(t):Oi(t):Oi(t):Oi(t)}function Ci(t){var e,i,n=(e=t.__$anflg49,t.__$anflg49=!0,i=Bi(t),t.__$anflg49=e,i);return n.attrs.title=BEM.I18N("m-editor-button","color"),n.js={placeholder:"Colored text",before:"!!",after:"!!"},n.content=[{block:"awesome-icon",mods:{icon:"font"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","color")}],n}function Oi(t){return!(t.__$anflg48!==!0)==!1?!(r&&"table"===r.type)==!1?!!s==!1?Pi(t):ji(t):ji(t):ji(t)}function Pi(t){var e,i,n=(e=t.__$anflg48,t.__$anflg48=!0,i=Bi(t),t.__$anflg48=e,i);return n.attrs.title=BEM.I18N("m-editor-button","table"),n.js={before:"",after:"\n#|\n|| cell text| cell text||\n|| cell text| cell text||\n|#\n"},n.content=[{block:"awesome-icon",mods:{icon:"table"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","table")}],n}function ji(t){return!(t.__$anflg47!==!0)==!1?!(r&&"code"===r.type)==!1?!!s==!1?Li(t):Ai(t):Ai(t):Ai(t)}function Li(t){var e,i,n=(e=t.__$anflg47,t.__$anflg47=!0,i=Bi(t),t.__$anflg47=e,i);return n.attrs.title=BEM.I18N("m-editor-button","code"),n.js={popup:{title:BEM.I18N("m-editor-button","code"),type:"code"}},n.content=[{block:"awesome-icon",mods:{icon:"code"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","code")}],n
}function Ai(t){return!(t.__$anflg46!==!0)==!1?!(r&&"picture"===r.type)==!1?!!s==!1?Fi(t):$i(t):$i(t):$i(t)}function Fi(t){var e,i,n=(e=t.__$anflg46,t.__$anflg46=!0,i=Bi(t),t.__$anflg46=e,i);return n.attrs.title=BEM.I18N("m-editor-button","picture"),n.js={popup:{title:BEM.I18N("m-editor-popup","createPicture"),type:"picture"}},n.content=[{block:"awesome-icon",mods:{icon:"picture"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","picture")}],n}function $i(t){return!(t.__$anflg45!==!0)==!1?!(r&&"link"===r.type)==!1?!!s==!1?Hi(t):zi(t):zi(t):zi(t)}function Hi(t){var e,i,n=(e=t.__$anflg45,t.__$anflg45=!0,i=Bi(t),t.__$anflg45=e,i);return n.attrs.title=BEM.I18N("m-editor-button","link"),n.js={popup:{title:BEM.I18N("m-editor-popup","createLink"),type:"link"}},n.content=[{block:"awesome-icon",mods:{icon:"link"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","createLink")}],n}function zi(t){return!(t.__$anflg44!==!0)==!1?!(r&&"separator"===r.type)==!1?!!s==!1?Ri(t):qi(t):qi(t):qi(t)}function Ri(t){var e,i,n=(e=t.__$anflg44,t.__$anflg44=!0,i=Bi(t),t.__$anflg44=e,i);return n.attrs.title=BEM.I18N("m-editor-button","separator"),n.js={before:"\n-----------\n",after:""},n.content=["—",{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","separator")}],n}function qi(t){return!(t.__$anflg43!==!0)==!1?!(r&&"quote"===r.type)==!1?!!s==!1?Ui(t):Wi(t):Wi(t):Wi(t)}function Ui(t){var e,i,n=(e=t.__$anflg43,t.__$anflg43=!0,i=Bi(t),t.__$anflg43=e,i);return n.attrs.title=BEM.I18N("m-editor-button","quote"),n.js={placeholder:"quote",before:"<[",after:"]>",selection:!0},n.content=[{block:"awesome-icon",mods:{icon:"quote-right"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","quote")}],n}function Wi(t){return!(t.__$anflg42!==!0)==!1?!(r&&"outdent"===r.type)==!1?!!s==!1?Vi(t):Gi(t):Gi(t):Gi(t)}function Vi(t){var e,i,n=(e=t.__$anflg42,t.__$anflg42=!0,i=Bi(t),t.__$anflg42=e,i);return n.attrs.title=BEM.I18N("m-editor-button","outdent"),n.js={add:"  ",hotkey:"Ctrl+Shift+T, Command+Shift+T"},n.content=[{block:"awesome-icon",mods:{icon:"indent-right"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","outdent")}],n}function Gi(t){return!(t.__$anflg41!==!0)==!1?!(r&&"indent"===r.type)==!1?!!s==!1?Ji(t):Ki(t):Ki(t):Ki(t)}function Ji(t){var e,i,n=(e=t.__$anflg41,t.__$anflg41=!0,i=Bi(t),t.__$anflg41=e,i);return n.attrs.title=BEM.I18N("m-editor-button","indent"),n.js={del:"  "},n.content=[{block:"awesome-icon",mods:{icon:"indent-left"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","indent")}],n}function Ki(t){return!(t.__$anflg40!==!0)==!1?!(r&&"ol"===r.type)==!1?!!s==!1?Yi(t):Qi(t):Qi(t):Qi(t)}function Yi(t){var e,i,n=(e=t.__$anflg40,t.__$anflg40=!0,i=Bi(t),t.__$anflg40=e,i);return n.attrs.title=BEM.I18N("m-editor-button","olist"),n.js={placeholder:"Ordered List",before:"  1. ",toggle:"  * ",wrap:"none",hotkey:"Ctrl+Shift+N, Command+Shift+N"},n.content=[{block:"awesome-icon",mods:{icon:"list-ol"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","olist")}],n}function Qi(t){return!(t.__$anflg39!==!0)==!1?!(r&&"ul"===r.type)==!1?!!s==!1?Zi(t):Xi(t):Xi(t):Xi(t)}function Zi(t){var e,i,n=(e=t.__$anflg39,t.__$anflg39=!0,i=Bi(t),t.__$anflg39=e,i);return n.attrs.title=BEM.I18N("m-editor-button","ulist"),n.js={placeholder:"Unordered List",before:"  * ",multilineInsert:!0,toggle:"  1. ",wrap:"none",hotkey:"Ctrl+Shift+L, Command+Shift+L"},n.content=[{block:"awesome-icon",mods:{icon:"list-ul"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","ulist")}],n}function Xi(t){return!(t.__$anflg38!==!0)==!1?!(r&&"strikethrough"===r.type)==!1?!!s==!1?tn(t):en(t):en(t):en(t)}function tn(t){var e,i,n=(e=t.__$anflg38,t.__$anflg38=!0,i=Bi(t),t.__$anflg38=e,i);return n.attrs.title=BEM.I18N("m-editor-button","strike"),n.js={placeholder:"Strike",before:"--",after:"--",hotkey:"Ctrl+Shift+S, Command+Shift+S"},n.content=[{block:"awesome-icon",mods:{icon:"strikethrough"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","strike")}],n}function en(t){return!(t.__$anflg37!==!0)==!1?!(r&&"underline"===r.type)==!1?!!s==!1?nn(t):sn(t):sn(t):sn(t)}function nn(t){var e,i,n=(e=t.__$anflg37,t.__$anflg37=!0,i=Bi(t),t.__$anflg37=e,i);return n.attrs.title=BEM.I18N("m-editor-button","underline"),n.js={placeholder:"Underline",before:"__",after:"__",hotkey:"Ctrl+U, Command+U"},n.content=[{block:"awesome-icon",mods:{icon:"underline"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","underline")}],n}function sn(t){return!(t.__$anflg36!==!0)==!1?!(r&&"italic"===r.type)==!1?!!s==!1?on(t):rn(t):rn(t):rn(t)}function on(t){var e,i,n=(e=t.__$anflg36,t.__$anflg36=!0,i=Bi(t),t.__$anflg36=e,i);return n.attrs.title=BEM.I18N("m-editor-button","italic"),n.js={placeholder:"Italic",before:"//",after:"//",hotkey:"Ctrl+I, Command+I"},n.content=[{block:"awesome-icon",mods:{icon:"italic"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","italic")}],n}function rn(t){return!(t.__$anflg35!==!0)==!1?!(r&&"bold"===r.type)==!1?!!s==!1?an(t):ln(t):ln(t):ln(t)}function an(t){var e,i,n=(e=t.__$anflg35,t.__$anflg35=!0,i=Bi(t),t.__$anflg35=e,i);return n.attrs.title=BEM.I18N("m-editor-button","bold"),n.js={placeholder:"Bold",before:"**",after:"**",hotkey:"Ctrl+B, Command+B"},n.content=[{block:"awesome-icon",mods:{icon:"bold"}},{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","bold")}],n}function ln(t){return!(t.__$anflg34!==!0)==!1?!(r&&"h3"===r.type)==!1?!!s==!1?cn(t):dn(t):dn(t):dn(t)}function cn(t){var e,i,n=(e=t.__$anflg34,t.__$anflg34=!0,i=Bi(t),t.__$anflg34=e,i);return n.attrs.title=BEM.I18N("m-editor-button","header3"),n.js={placeholder:"Header 3",before:"====",after:"====",type:"block",hotkey:"Ctrl+Shift+3, Command+Shift+3"},n.content=["h3",{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","header3")}],n}function dn(t){return!(t.__$anflg33!==!0)==!1?!(r&&"h2"===r.type)==!1?!!s==!1?un(t):hn(t):hn(t):hn(t)}function un(t){var e,i,n=(e=t.__$anflg33,t.__$anflg33=!0,i=Bi(t),t.__$anflg33=e,i);return n.attrs.title=BEM.I18N("m-editor-button","header2"),n.js={placeholder:"Header 2",before:"===",after:"===",type:"block",hotkey:"Ctrl+Shift+2, Command+Shift+2"},n.content=["h2",{elem:"caption",tag:"span",content:t.ctx.caption&&BEM.I18N("m-editor-button","header2")}],n}function hn(t){return!!s==!1?{block:"button",mods:{size:"m",side:t.ctx.mods.side?t.ctx.mods.side:!1,round:t.ctx.mods.round?t.ctx.mods.round:!1},attrs:{tabindex:-1}}:Gn(t)}function pn(t){if(!(t.__$anflg30!==!0)==!1){if(!!s==!1){var e,i,n=(e=t.__$anflg30,t.__$anflg30=!0,i=pn(t),t.__$anflg30=e,i);return n[0].attrs.href=("/HomePage"===t._toc?"":t._toc)+"#"+t.ctx["wiki-attrs"].anchor,n}return mn(t)}return mn(t)}function mn(t){return!!s==!1?[{elem:"link",tag:"a",attrs:{href:t._toc+"#"+t.ctx["wiki-attrs"].anchor},content:[t.ctx["wiki-attrs"].number&&t.ctx["wiki-attrs"].number+". ",{block:"wiki-txt","wiki-attrs":{txt:t.ctx["wiki-attrs"].txt}}]}]:Gn(t)}function fn(t){return"black"===s?{style:"color: black;"}:Gn(t)}function _n(t){if(!(t.__$anflg55!==!0)==!1){if(!(r&&"yes"===r.pseudo)==!1){var e,i,n=(e=t.__$anflg55,t.__$anflg55=!0,i=_n(t),t.__$anflg55=e,i);return n.value="",n}return gn(t)}return gn(t)}function gn(t){for(var e,i=t.ctx,n={type:"checkbox"},s=["tabindex","name","value","id"];e=s.pop();)i[e]&&(n[e]=i[e]);return i.checked&&(n.checked="checked"),i.disabled&&(n.disabled="disabled"),n["aria-labelledby"]=i.labelledby,n}function bn(t){var e=s;return"black"===e?"span":"selected"===e?"b":Gn(t)}function kn(t){return!!s==!1?"span":Gn(t)}function vn(t){if(!(t.__$anflg66!==!0)==!1){if(!(r&&"equipment"===r.type)==!1){if(!!s==!1){var e,i,n=t.ctx.data;return t._.extend((e=t.__$anflg66,t.__$anflg66=!0,i=vn(t),t.__$anflg66=e,i),{value:n.name})}return yn(t)}return yn(t)}return yn(t)}function yn(t){if(!(t.__$anflg65!==!0)==!1){if(!(r&&"table"===r.type)==!1){if(!!s==!1){var e,i,n=t.ctx.data;return t._.extend((e=t.__$anflg65,t.__$anflg65=!0,i=vn(t),t.__$anflg65=e,i),{value:n.name})}return Mn(t)}return Mn(t)}return Mn(t)}function Mn(t){if(!(t.__$anflg64!==!0)==!1){if(!(r&&"maillist"===r.type)==!1){if(!!s==!1){var e,i,n=t.ctx.data;return t._.extend((e=t.__$anflg64,t.__$anflg64=!0,i=vn(t),t.__$anflg64=e,i),{value:n.email||n.name})}return wn(t)}return wn(t)}return wn(t)}function wn(t){if(!(t.__$anflg63!==!0)==!1){if(!(r&&"department"===r.type)==!1){if(!!s==!1){var e,i,n=t.ctx.data;return t._.extend((e=t.__$anflg63,t.__$anflg63=!0,i=vn(t),t.__$anflg63=e,i),{value:n.name})}return xn(t)}return xn(t)}return xn(t)}function xn(t){if(!(t.__$anflg62!==!0)==!1){if(!(r&&"staff"===r.type)==!1){if(!!s==!1){var e,i,n=t.ctx.data;return t._.extend((e=t.__$anflg62,t.__$anflg62=!0,i=vn(t),t.__$anflg62=e,i),{value:n.title||n._text,href:n.href})}return En(t)}return En(t)}return En(t)}function En(t){return!!s==!1?{inputData:t.ctx.inputData,inSearchHeader:t.ctx.inSearchHeader,fullData:t.ctx.data}:Gn(t)}function Bn(t){return!!s==!1?"gradient"==r.popup?{popupMods:{gradient:"yes"}}:!0:Gn(t)}function In(t){return!!s==!1?!0:!t.ctx.search_cgi==!1?!t._.isArray(t.ctx.search_cgi)==!1?{cgi:t.ctx.search_cgi}:Gn(t):Gn(t)}function Sn(t){return!(r&&"yes"===r.multicomplete)==!1?!t.ctx.name==!1?!!t._hiddenInputs==!1?!!s==!1?Dn(t):Nn(t):Nn(t):Nn(t):Tn(t)}function Dn(t){var e,i,n,s;return e=t.ctx,i=e.content,e.content=t.ctx.content.concat({elem:"hidden-input",name:t.ctx.name+"__value",value:t.ctx.multicomplete.value||""}).concat({elem:"hidden-input",name:t.ctx.name+"__type",value:t.ctx.multicomplete.type||t.ctx.multicomplete.types}),n=t._hiddenInputs,t._hiddenInputs=!0,s=je(t),e.content=i,t._hiddenInputs=n,s}function Nn(t){if(!!r.autocomplete==!1){if(!!s==!1){var e,i,n;return e=r,i=e.autocomplete,e.autocomplete="yes",n=je(t),e.autocomplete=i,n}return Tn(t)}return Tn(t)}function Tn(t){if("input"===s){if(!(t.__$anflg58!==!0)==!1){var e=t.__$anflg58;t.__$anflg58=!0;var n=t.ctx;t.ctx={elem:"box",tag:"span",content:[t.ctx,t.ctx.clear]};var o=i;return i="",K(t),t.ctx=n,i=o,t.__$anflg58=e,void 0}return Cn(t)}return Cn(t)}function Cn(t){return!!t._inputId==!1?!!s==!1?On(t):Gn(t):Gn(t)}function On(t){var e,n,s,o=(e=i,i="value",n=t.ctx,t.ctx=t.ctx.value,s=Un(t),i=e,t.ctx=n,s),r=t._inputId;t._inputId=t.ctx.id||t.generateId();var a=t._name;t._name=t.ctx.name||"";var l=t._value;t._value=o,je(t),t._inputId=r,t._name=a,t._value=l}function Pn(t){var e,i,n,s,o,r,a=t.ctx.data,l=a[4],c=(l.match(/^\w[\w-]*:\/\//g)?"":"http://")+l,d=BEM.blocks["i-common__string"].escapeHTML(a[3]),u="&nbsp;&mdash;&nbsp;"+BEM.blocks["i-common__string"].highlight(a[2],t.ctx.hl);return e=t.__$anflg56,t.__$anflg56=!0,n=t._linkUrlContent,t._linkUrlContent=d,s=t._linkInfoConten,t._linkInfoConten=u,o=t._url,t._url=c,r=je(t),t._linkUrlContent=n,t._linkInfoConten=s,t._url=o,i=r,t.__$anflg56=e,i}function jn(t){return!(t.__$anflg54!==!0)==!1?!!s==!1?Ln(t):Gn(t):Gn(t)}function Ln(t){var e=t.ctx,i=(e.controlAttrs||{}).id||t.generateId(),n=e.mods||{};n.theme=n.theme||"normal";var s=t.__$anflg54;t.__$anflg54=!0;var o=t._control;t._control={elem:"control",attrs:e.controlAttrs,id:i,labelledby:"text"+i,name:e.name,tabindex:e.tabindex,checked:r.checked,disabled:r.disabled,value:e.value||e.content};var a=e.mods;e.mods=n,je(t),t._control=o,e.mods=a,t.__$anflg54=s}function An(t){var e=t.ctx,i=e.checkboxAttrs||{},n=i.id||t.generateId(),s=e.mods||{};s.theme=s.theme||"normal";var o=t.__$anflg53;t.__$anflg53=!0;var r=t._checkboxAttrs;t._checkboxAttrs=i.id?i:{id:"id"+n};var a=t._labelId;t._labelId="label"+n;var l=e.mods;e.mods=s,je(t),t._checkboxAttrs=r,t._labelId=a,e.mods=l,t.__$anflg53=o}function Fn(t){var e=t.ctx.type?{elem:"input",type:t.ctx.type,tabindex:t.ctx.tabindex,disabled:r.disabled,typeMod:r.type,name:t.ctx.name,value:t.ctx.value}:"",i=t.__$anflg32;t.__$anflg32=!0;var n=t._input;t._input=e,je(t),t._input=n,t.__$anflg32=i}function $n(t){var e=t.ctx,n=[{block:"dropdown",elem:"popup"}];e.mix&&(n=n.concat(e.mix));var s=t.__$anflg31;t.__$anflg31=!0;var o=t.ctx;t.ctx={block:"popup",mix:n,mods:e.mods,attrs:e.attrs,js:e.js,content:[{elem:"tail"},{elem:"content",content:e.content}]};var r=i;i="",K(t),t.ctx=o,i=r,t.__$anflg31=s}function Hn(t){var e=i;i="";var n=t.ctx;t.ctx={block:"wiki-warnset",js:t.ctx.ids,mix:t.ctx.c[0]&&t.ctx.c[0].block&&"wiki-err"==t.ctx.c[0].block&&[{mods:{type:"wide"}}],content:[{block:"b-icon",mix:[{mods:{type:"warn"}}]},{block:"b-popupa",mods:{theme:"feffd6",direction:"left",type:"my-popupa"},content:[{elem:"tail"},{elem:"content",content:[{block:"wiki-bold",content:t._helper[t.wiki.lang].txt.attention}]}]}].concat(t.ctx.c)},K(t),i=e,t.ctx=n}function zn(t){return!(t.ctx.content.length&&!t.ctx.js)==!1?!!s==!1?Rn(t):Gn(t):Gn(t)}function Rn(t){var e=t.ctx.ids?t.ctx.ids:[],n=t.ctx.c?t.ctx.c:[];if("wiki-warn"==t.ctx.content[0].block){var s=t.ctx.content.shift();e.push(t._helper[t.wiki.lang].warn[s["wiki-attrs"].id])}else n.push(t.ctx.content.shift());var o=i;i="";var r=t.ctx;t.ctx={block:"wiki-warnset",ids:e,c:n,content:t.ctx.content},K(t),i=o,t.ctx=r}function qn(t){var e,n,s,o,r,a;return e=t.wiki.styles,n=e.underline,e.underline="ins",s=i,i="",o=t.ctx,r=o.tag,o.tag="",a=K(t),e.underline=n,i=s,o.tag=r,a}function Un(t){if(!t._.isSimple(t.ctx)==!1)return t.ctx;if(!t.ctx==!1){if(!!s==!1){var e=[],n=i;i="";var o=t._buf;return t._buf=e,K(t),i=n,t._buf=o,e.join("")}return Wn(t)}return Wn(t)}function Wn(t){return!!s==!1?"":Gn(t)}function Vn(t){return!!s==!1?[{mods:{pers:t.ctx.pers?"yes":""}}]:Gn(t)}function Gn(t){return"wiki-toc"===n?"title"===s?!(r&&"sidebar"===r.type)==!1?!1:Jn(t):Jn(t):Jn(t)}function Jn(t){var e=i;if(""===e)return"wiki-toc"===n?!(t.__$anflg29!==!0)==!1?!(r&&"sidebar"===r.type)==!1?!!s==!1?Kn(t):ps(t):ps(t):ps(t):ps(t);if("tag"===e){var e=n;if("wiki-toc"===e)return"title"===s?"legend":ps(t);if("wiki-table"===e)return!!s==!1?"table":ps(t);if("wiki-row"===e)return!!s==!1?"tr":ps(t);if("wiki-img"===e)return!!s==!1?"img":ps(t);if("wiki-list"===e)return!!s==!1?"outline"==t.ctx["wiki-attrs"].type||"bullet"==t.ctx["wiki-attrs"].type?"ul":"ol":ps(t);if("wiki-li"===e)return!!s==!1?"li":ps(t);if("wiki-jirastub"===e)return!!s==!1?"":ps(t);if("wiki-ticket"===e){var e=s;return"links"===e||"description"===e||"assignee"===e||"summary"===e||"status"===e?"span":!!s==!1?"span":ps(t)}return"wiki-interwiki"===e?!!s==!1?"span":ps(t):"wiki-include"===e?"anchor"===s?"a":ps(t):ps(t)}if("default"===e){var e=n;if("wiki-toc"===e)return!!t.ctx._wrap==!1?!!s==!1?!!t.ctx.elem==!1?Yn(t):ps(t):ps(t):ps(t);if("wiki-staff"===e)return!!s==!1?Zn(t):ps(t);if("wiki-ref"===e)return!!s==!1?Xn(t):ps(t);if("wiki-otrs"===e)return!!s==!1?ts(t):ps(t);if("wiki-lunapark"===e)return!!s==!1?es(t):ps(t);if("wiki-subscript"===e)return!!s==!1?!!t.wiki.styles.subscript==!1?Qn(t):ps(t):ps(t);if("wiki-ticket"===e)return"issue"===s?is(t):!!t.ctx.content==!1?!!s==!1?ns(t):ps(t):ps(t);if("wiki-strike"===e)return!!s==!1?!!t.wiki.styles.strike==!1?ss(t):ps(t):ps(t);if("wiki-jira"===e){if(!!s==!1){t.ctx.block="wiki-ticket",t.ctx["wiki-attrs"].mode="jira",t.ctx["wiki-attrs"].issue=t.ctx["wiki-attrs"].project+"-"+t.ctx["wiki-attrs"].ticket;var o=i;i="";var a=t.ctx;return t.ctx=t.ctx,K(t),i=o,t.ctx=a,void 0}return ps(t)}if("wiki-italic"===e)return!!s==!1?!!t.wiki.styles.italic==!1?os(t):ps(t):ps(t);if("wiki-include"===e){if(!!t._wikiAction==!1){if(!!s==!1){var o=t._wikiAction;t._wikiAction=!0;var a=t.wiki,l=a.page;return a.page=t.ctx["wiki-attrs"].page,je(t),t._wikiAction=o,a.page=l,void 0}return rs(t)}return rs(t)}if("wiki-label"===e){if(!!s==!1){var o=i;i="";var a=t.ctx;return t.ctx=[{block:"wiki-txt","wiki-attrs":{txt:t.ctx["wiki-attrs"].txt}}],K(t),i=o,t.ctx=a,void 0}return ps(t)}return ps(t)}if("mix"===e){var e=n;if("wiki-table"===e){if(!!s==!1){var c={};return t.ctx["wiki-attrs"]&&"wide"==t.ctx["wiki-attrs"].type?c.wide="yes":c.border="yes",[{mods:c}]}return ps(t)}if("wiki-lquot"===e){if(!!s==!1){var d=t.ctx["wiki-attrs"].level,u=d%2?"odd":"even";return[{mods:{parity:u}}]}return ps(t)}return"wiki-list"===e?ls(t):"wiki-li"===e?!!s==!1?us(t):ps(t):"wiki-ticket"===e?!!s==!1?[{mods:{type:t.ctx["wiki-attrs"]&&(!t.ctx["wiki-attrs"].status||"Closed"==t.ctx["wiki-attrs"].status)&&"inactive"}}]:ps(t):ps(t)}if("attrs"===e){var e=n;if("wiki-table"===e){if(!!s==!1){var h=t.ctx["wiki-attrs"]&&t.ctx["wiki-attrs"].type;return"wide"==h?{width:"100%"}:{border:"1"}}return ps(t)}if("wiki-img"===e){if(!!s==!1){var p={src:t.ctx["wiki-attrs"].link,alt:"",border:"0"};return t.ctx["wiki-attrs"].width&&(p.width=t.ctx["wiki-attrs"].width),t.ctx["wiki-attrs"].height&&(p.height=t.ctx["wiki-attrs"].height),p}return ps(t)}return"wiki-li"===e?!!s==!1?t.ctx["wiki-attrs"]&&t.ctx["wiki-attrs"].value&&{value:t.ctx["wiki-attrs"].value}:ps(t):ps(t)}if("bem"===e)return"wiki-row"===n?!!s==!1?!1:ps(t):ps(t);if("content"===e){var e=n;if("wiki-lquot"===e){if(!!s==!1){for(var m="&gt;",f=t.ctx["wiki-attrs"].level,_="",g=0;f>g;g++)_+=m;return[_].concat(t.ctx.content)}return ps(t)}if("wiki-li"===e){if(!!s==!1){var b=t.ctx["wiki-attrs"],k="";return b&&("undefined"!=typeof b.checked&&(k={block:"chBox",tag:"input",attrs:{type:"checkbox",disabled:"disabled"}},b.checked&&(k.attrs.checked="")),b.value&&k.constructor===Object&&(k.attrs.value=b.value)),[k,t.ctx.content]}return ps(t)}return"wiki-jirastub"===e?!!s==!1?{block:"wiki-ticket"}:ps(t):"wiki-ticket"===e?!!s==!1?hs(t):ps(t):"wiki-interwiki"===e?!!s==!1?[{block:"b-link",mix:[{mods:{ico:"ico-l"}}],url:t.ctx["wiki-attrs"].link,target:"_blank",content:[{block:"b-icon",mix:[{mods:{type:"icotype",first:"yes"}}],alt:t._helper[t.wiki.lang].txt.external_link}].concat(t.ctx.content)}]:ps(t):ps(t)}return"js"===e?"wiki-ticket"===n?!!s==!1?!0:ps(t):ps(t):ps(t)}function Kn(t){var e,n,s,o,r;return t.ctx[1].content[0].mods={type:"sidebar"},e=t.__$anflg29,t.__$anflg29=!0,s=t.ctx,t.ctx=t.ctx,o=i,i="",r=K(t),t.ctx=s,i=o,n=r,t.__$anflg29=e,n}function Yn(t){t._toc=t.ctx["wiki-attrs"]&&t.ctx["wiki-attrs"].page?t.ctx["wiki-attrs"].page:"";var e=i;i="";var n=t.ctx;t.ctx=["<!--dynamic action-->",{bem:!1,tag:"div",content:[{block:"wiki-toc",tag:"fieldset",js:!0,_wrap:!0,content:[{elem:"title",content:[t._helper[t.wiki.lang].txt.contents,t.ctx["wiki-attrs"]&&(t.ctx["wiki-attrs"].page||t.ctx["wiki-attrs"].title)&&"&nbsp;",t.ctx["wiki-attrs"]&&(t.ctx["wiki-attrs"].page||t.ctx["wiki-attrs"].title)&&{block:"b-link",url:t.ctx["wiki-attrs"].page||"#",content:t.ctx["wiki-attrs"].title||t.ctx["wiki-attrs"].page}]}].concat(t.ctx.content)}]},"<!--/dynamic action-->"],K(t),i=e,t.ctx=n}function Qn(t){var e,n,s,o,r,a;return e=t.wiki.styles,n=e.subscript,e.subscript="sub",s=i,i="",o=t.ctx,r=o.tag,o.tag="",a=K(t),e.subscript=n,i=s,o.tag=r,a}function Zn(t){var e=t.ctx.content;if(e){var n=i;i="";var s=t.ctx;t.ctx=[{block:"b-link",url:t.ctx["wiki-attrs"].link,cls:"undefined"!=typeof t.ctx["wiki-attrs"].is_active&&t.ctx["wiki-attrs"].is_active===!1?"auto-person-card wiki-user_type_fired":"auto-person-card",attrs:{lang:t.ctx["wiki-attrs"].login},content:e}],K(t),i=n,t.ctx=s}else{var o=i;i="";var r=t.ctx;t.ctx=[{block:"wiki-user",url:t.ctx["wiki-attrs"].link,card:t.ctx["wiki-attrs"].login,mods:"undefined"!=typeof t.ctx["wiki-attrs"].is_active&&t.ctx["wiki-attrs"].is_active===!1?{type:"fired"}:{},content:t.ctx["wiki-attrs"].name||t.ctx["wiki-attrs"].login}],K(t),i=o,t.ctx=r}}function Xn(e){var n=e.ctx["wiki-attrs"],s=n.type,o=n.protocol,r=n.page,a=n.file,l=n.ext,c=n.link,d=n.docviewer,u=n.hidden;if(e.ctx.content&&"wiki-err"==e.ctx.content[0].block){var h=i;i="";var p=e.ctx;e.ctx=e.ctx.content,K(e),i=h,e.ctx=p}else{var m="unc"!=s&&l?"file-alt":m;m="mailto"==o||"xmpp"==o?"envelope":m;var f="wiki"==s?a?r+"/.files/"+a:r:c,_=e.wiki&&e._helper[e.wiki.lang].txt.external_link,g=t(e),b=[{block:"b-link",url:f,attrs:function(){return"wiki"!=s?{title:_}:"wiki"==s&&!l&&g.ctx.content&&g.ctx.content[0]?{"data-title":"1"}:{}}(),target:"wiki"!=s&&"_blank",mix:function(){var t=[];return t.push({block:"wiki-ref"}),"wiki"==s&&t.push({mods:{wiki:"yes"}}),d&&t.push({block:"wiki-ref",mods:{type:"docviewer"},js:{docviewer:d,url:f}}),t}(),content:[e.ctx.content&&"wiki-img"==e.ctx.content[0].block?"":m&&{block:"awesome-icon",mix:[{mods:{icon:m,first:"yes"}}]},e.ctx.content&&e.ctx.content[0]?e.ctx.content:l&&"wiki"==s?"file:"+a:e._.xmlEscape(c)]}];u&&(b={block:"b-hidereferer",tag:"span",cls:"g-js",attrs:{onclick:"return { name: 'b-hidereferer' }"},content:b});var k=i;i="";var v=e.ctx;e.ctx=[b,d&&e.wiki.noDocviewer&&{block:"wiki-docviewer"}],K(e),i=k,e.ctx=v,d&&delete e.wiki.noDocviewer}}function ts(t){var e=i;i="";var n=t.ctx;t.ctx={block:"b-link",mix:[{mods:{ico:"ico-l"}},{block:"wiki-otrs"}],url:t.ctx["wiki-attrs"].link,target:"_blank",content:[{block:"b-icon",alt:t._helper[t.wiki.lang].txt.external_link},t.ctx["wiki-attrs"].ticket]},K(t),i=e,t.ctx=n}function es(t){var e=t.ctx["wiki-attrs"];t.ctx.block="wiki-ticket",t.ctx["wiki-attrs"].ticket_type="lunapark",t.ctx["wiki-attrs"].issue=e.project?e.project+"-"+e.ticket:e.fire;var n=i;i="";var s=t.ctx;t.ctx=t.ctx,K(t),i=n,t.ctx=s}function is(t){var e=t.ctx["wiki-attrs"]&&t.ctx["wiki-attrs"].status,n=i;i="";var s=t.ctx;t.ctx={block:"b-link",url:t.ctx.url||"https://st.yandex-team.ru/"+(t.ctx["wiki-attrs"].issue||t.ctx.js.issue),mix:[{block:"wiki-ticket",elem:"issue"}],content:"Closed"==e?{block:"wiki-strike",content:t.ctx.content}:t.ctx.content},K(t),i=n,t.ctx=s}function ns(e){var n,s,o=(t(e),e.ctx),r=o["wiki-attrs"]?o["wiki-attrs"].link_view:null;r&&(n=-1!==r.indexOf("st.yandex-team")?"startrek":-1!==r.indexOf("jira.yandex-team")?"jira":-1!==r.indexOf("lunapark.yandex-team")?"lunapark":"none"),s=e.ctx["wiki-attrs"]&&e.ctx["wiki-attrs"].project||"NONE";var a=i;i="";var l=e.ctx;e.ctx={block:"wiki-ticket",js:e.wiki.ticket_type?{_id:e.ctx["wiki-attrs"].ticket,type:n,project:s}:!0,mods:{mode:e.ctx["wiki-attrs"]&&e.ctx["wiki-attrs"].ticket_type||"jira"},"wiki-attrs":e.ctx["wiki-attrs"],content:[{elem:"issue",url:e.ctx["wiki-attrs"]&&e.ctx["wiki-attrs"].link_view,content:e.ctx["wiki-attrs"]&&[e.ctx["wiki-attrs"].project?e.ctx["wiki-attrs"].project+"-"+e.ctx["wiki-attrs"].ticket:e.ctx["wiki-attrs"].fire],"wiki-attrs":{issue:s+"-"+(e.ctx["wiki-attrs"]&&e.ctx["wiki-attrs"].ticket),status:e.ctx["wiki-attrs"]&&e.ctx["wiki-attrs"].status}}]},K(e),i=a,e.ctx=l}function ss(t){var e,n,s,o,r,a;return e=t.wiki.styles,n=e.strike,e.strike="del",s=i,i="",o=t.ctx,r=o.tag,o.tag="",a=K(t),e.strike=n,i=s,o.tag=r,a}function os(t){var e,n,s,o,r,a;return e=t.wiki.styles,n=e.italic,e.italic="em",s=i,i="",o=t.ctx,r=o.tag,o.tag="",a=K(t),e.italic=n,i=s,o.tag=r,a}function rs(t){return!!t.ctx._wrap==!1?!!s==!1?!!t.ctx.elem==!1?as(t):ps(t):ps(t):ps(t)}function as(t){var e=t.ctx["wiki-attrs"],n="view"==t.wiki.mode&&e.mark&&e.page+"/.edit?gopage="+t.wiki.path+"&goanchor=p-"+e.id,s="view"==t.wiki.mode&&e.mark&&{elem:"edit",content:[{block:"b-link",url:e.page,content:[e.page]}," :: ",{block:"b-link",url:n,content:["("+t._helper[t.wiki.lang].txt.edit+")"]}]},o=i;i="";var r=t.ctx;t.ctx=["<!--dynamic action-->",{_wrap:!0,block:"wiki-include",content:[e.mark&&{elem:"anchor",attrs:{name:"#p-"+e.id}},s,e.title&&{block:"wiki-head",content:[{block:"wiki-txt","wiki-attrs":{txt:e.title}}],"wiki-attrs":{anchor:e.title,level:1,edit:n,section_local:1}},t.ctx.content,s]},"<!--/dynamic action-->"],K(t),i=o,t.ctx=r}function ls(t){if(!(t.__$anflg28!==!0)==!1){if(!!s==!1){var e,i,n=(e=t.__$anflg28,t.__$anflg28=!0,i=ls(t),t.__$anflg28=e,i);return"bullet"==t.ctx["wiki-attrs"].type&&(n[0].mods["list-type"]="default"),n}return cs(t)}return cs(t)}function cs(t){return!!s==!1?ds(t):ps(t)}function ds(t){var e=!1,i=t.ctx["wiki-attrs"],n={},s=i.type;return"number"==s?e="decimal":"letter_lower"==s?e="lower-alpha":"letter_upper"==s?e="upper-alpha":"rome_lower"==s?e="lower-roman":"rome_upper"==s&&(e="upper-roman"),e&&(n["list-type"]=e),"outline"==i.type&&(n.type="outline"),[{mods:n}]}function us(t){var e=[];return t.ctx["wiki-attrs"]&&t.ctx["wiki-attrs"].enable_inplace&&"yes"==t.ctx["wiki-attrs"].enable_inplace&&"undefined"!=typeof t.ctx["wiki-attrs"].checked&&e.push({block:"wiki-change",mods:{type:"checkbox",id:t.ctx["wiki-attrs"].element_id},js:{element_id:t.ctx["wiki-attrs"].element_id,startPos:t.ctx["wiki-attrs"].element_id.split("x")[0]}}),e}function hs(t){var e=t.ctx["wiki-attrs"];return e?[{elem:"issue",js:e,url:e.link_view,content:{block:"wiki-txt","wiki-attrs":{txt:e.issue||""}},"wiki-attrs":{issue:e.issue||e.project+"-"+e._id,status:e.status||""}},e.status&&" ",e.status&&{elem:"status",content:{block:"wiki-txt","wiki-attrs":{txt:e.status}}},{elem:"summary",mix:!e.summary&&!t.ctx["wiki-attrs"].fire&&[{mods:{type:"waiting"}}],content:[" ",e.summary?{block:"b-link",mods:{pseudo:"yes"},content:{block:"wiki-txt","wiki-attrs":{txt:e.summary}}}:!t.ctx["wiki-attrs"].fire&&{}],"wiki-attrs":{fire:e.fire}},e.assignee_login&&{elem:"assignee",content:[" ",{block:"b-user",card:e.assignee_login,url:e.assignee_link,content:e.assignee_login}]},e.summary&&{elem:"description",content:[e.description?{block:"wiki-txt","wiki-attrs":{txt:e.description}}:"",{elem:"links",content:"startrek"!=t.ctx["wiki-attrs"].ticket_type&&[{block:"b-link",url:e.link_assign,content:t._helper[t.wiki.lang].txt["assign-jira"]}," | ",{block:"b-link",url:e.link_comment,content:t._helper[t.wiki.lang].txt["comment-jira"]}," | ",{block:"b-link",url:e.link_edit,content:t._helper[t.wiki.lang].txt["edit-jira"]}]}]}]:{}}function ps(t){return"wiki-html"===n?!(t.__$anflg27!==!0)==!1?!(t.ctx["wiki-attrs"]&&(t.ctx["wiki-attrs"].style||t.ctx["wiki-attrs"].normalize))==!1?ms(t):fs(t):fs(t):fs(t)}function ms(t){var e,i,n,s,o,r={},a=t.ctx["wiki-attrs"];return a.style&&(r.style=a.style),a.normalize&&(r.normalize=a.normalize),e=t.__$anflg27,t.__$anflg27=!0,n=t.ctx,s=n.mods,n.mods=r,o=c(t),n.mods=s,i=o,t.__$anflg27=e,i}function fs(t){var e=i;if("content"===e){var e=n;if("wiki-html"===e)return!!s==!1?[{block:"wiki-txt",noEscape:!0,"wiki-attrs":{txt:t.ctx["wiki-attrs"].txt}}]:ho(t);if("wiki-definition"===e)return!!s==!1?{block:"wiki-txt","wiki-attrs":{txt:t.ctx["wiki-attrs"].term}}:ho(t);if("wiki-cut"===e)return"chead"===s?[{block:"b-link",mods:{pseudo:"yes"},content:t.ctx.content}]:ho(t);if("wiki-color"===e)return!!s==!1?[{elem:"example",content:"&nbsp;&nbsp;&nbsp;&nbsp;","wiki-attrs":t.ctx["wiki-attrs"]},{elem:"hex",content:{block:"wiki-txt","wiki-attrs":{txt:"#"+t.ctx["wiki-attrs"].rgb}}}]:ho(t);if("wiki-cell"===e)return!!s==!1?t.ctx.content:ho(t);if("wiki-err"===e)return!!s==!1?Ms(t):ho(t);if("wiki-htmlentity"===e)return!!s==!1?[{block:"wiki-txt",noEscape:!0,"wiki-attrs":{txt:t.ctx["wiki-attrs"].txt}}]:ho(t);if("wiki-user"===e){var e=s;if("first-letter"===e)return{block:"wiki-txt","wiki-attrs":{txt:t.ctx.content}};if("link"===e)return t.ctx.content;if(!!s==!1){var o=t.ctx.content;return o=o?[{elem:"first-letter",content:o[0]},{block:"wiki-txt","wiki-attrs":{txt:o.slice(1)}}]:"",{elem:"link",cls:"auto-person-card",attrs:{lang:t.ctx.card},url:t.ctx.url||"http://staff.yandex-team.ru/"+t.ctx.card,counter:t.ctx.counter,content:o}}return ho(t)}if("b-link"===e){if(!(r&&r.pseudo)==!1){if(!!t.ctx._wrap==!1){if(!!s==!1){if(!!r.inner==!1){var a=i;i="";var l=t.ctx;return t.ctx={elem:"inner",content:t.ctx.content,_wrap:!0},K(t),i=a,t.ctx=l,void 0}return ho(t)}return ho(t)}return ho(t)}return ho(t)}if("input"===e){var e=s;return"clear"===e?!!t.ctx.content==!1?"":ho(t):"ahead"===e?[{elem:"ahead-filler"},{elem:"ahead-hint"}]:ho(t)}if("button"===e)return!!s==!1?{elem:"text",tag:"span",content:t.ctx.content}:ho(t);if("wiki-head"===e)return bs(t);if("m-button-action"===e)return!(r&&"phone"===r.type)==!1?!!s==!1?[{block:"button",mods:{size:"s",type:"simple"},mix:[{block:"mi-phone-button",js:{phone:t.ctx.content}}],content:[{block:"mi-phone-button",elem:"phone",tag:"i"},t.ctx.content]}]:ws(t):ws(t);if("wiki-headcut"===e)return _s(t);if("m-username"===e)return"inner"===s?t.ctx.content:!!s==!1?{elem:"inner",url:t.ctx.url,counter:t.ctx.counter,content:t.ctx.content}:ho(t);if("wiki-docviewer"===e)return!!s==!1?[{block:"b-popupa",mods:{theme:"ffffff",direction:"right"},mix:[{block:"wiki-docviewer"}],content:[{elem:"tail"},{elem:"content",content:[{block:"b-menu",mods:{layout:"vert"},content:[{elem:"item",content:{block:"b-link",mods:{type:"download"},url:"",content:"Скачать"}},{elem:"item",content:{block:"b-link",mods:{type:"view"},url:"",content:"Просмотреть"}}]}]}]}]:ho(t);if("m-userpic"===e)return!!s==!1?{elem:"img",tag:"img",login:t.ctx.login,size:t.ctx.size}:ho(t);if("b-popupa"===e)return"wrap"===s?{tag:"tr",content:{elem:"wrap-cell",content:t.ctx.content}}:!(r&&"yes"===r["has-close"])==!1?!!s==!1?(t._.isArray(t.ctx.content)||(t.ctx.content=[t.ctx.content]),t.ctx.content.push({elem:"close"}),t.ctx.content):ho(t):ho(t);if("link"===e){if(!(r&&"yes"===r.pseudo)==!1){if(!!t.ctx._wrap==!1){if(!!s==!1){if(!!r.inner==!1){var a=i;i="";var l=t.ctx;return t.ctx={elem:"inner",content:t.ctx.content,_wrap:!0},K(t),i=a,t.ctx=l,void 0}return ho(t)}return ho(t)}return ho(t)}return ho(t)}return"b-menu"===e?!(r&&"vert"===r.layout)==!1?!!s==!1?[t.ctx.title,{elem:"layout-vert",content:t.ctx.content}]:ho(t):ho(t):"popup"===e?!!s==!1?[{elem:"under",mods:t.ctx.underMods},t.ctx.content]:ho(t):"wiki-anchor"===e?!!s==!1?t.ctx["wiki-attrs"]&&t.ctx["wiki-attrs"].text?t.ctx["wiki-attrs"].text:"":ho(t):ho(t)}if("attrs"===e){var e=n;if("wiki-hr"===e)return!!s==!1?{size:1}:ho(t);if("wiki-color"===e){if("example"===s){var c=t.ctx["wiki-attrs"].rgb,d="background-color: #"+c+";";return d="fff"==c||"ffffff"==c?d+"border: 1px solid #eee;":d,{style:d}}return ho(t)}if("wiki-cell"===e)return!!s==!1?t.ctx["wiki-attrs"]&&{colspan:t.ctx["wiki-attrs"].colspan}:ho(t);if("wiki-anchor"===e)return!!s==!1?t.ctx["wiki-attrs"]&&t.ctx["wiki-attrs"].name&&{name:t.ctx["wiki-attrs"].name}:ho(t);if("wiki-user"===e){if("link"===s){var u={href:t.ctx.url};return t.ctx.counter&&(u.onmousedown=t.ctx.counter),u}return ho(t)}if("wiki-definition"===e)return!!s==!1?{title:t.ctx["wiki-attrs"].txt}:ho(t);if("b-link"===e)return!(r&&r.pseudo)==!1?!!s==!1?!!t.ctx.url==!1?{}:ho(t):ho(t):ho(t);if("input"===e){var e=s;if("clear"===e)return{unselectable:"on"};if("control"===e){var h=t._.extend({id:t._inputId,name:t._name},t.ctx.controlAttrs);return(t._value||0===t._value)&&(h.value=t._value),r.disabled&&(h.disabled="disabled"),h["aria-labelledby"]=t._labelId+" "+t._hintId,h}return ho(t)}if("button"===e){if(!(t.__$anflg16!==!0)==!1){if(!t.ctx.url==!1){if(!!s==!1){var a,l,p=t.ctx,m=(a=t.__$anflg16,t.__$anflg16=!0,l=Ve(t),t.__$anflg16=a,l),f={href:p.url};return p.target&&(f.target=p.target),r.disabled&&(f["aria-disabled"]=!0),t._.extend(m,f)}return Bs(t)}return Bs(t)}return Bs(t)}if("image"===e){if(!!s==!1){var _,g=t.ctx,b={src:"//yastatic.net/lego/_/La6qi18Z8LwgnZdsAr1qy1GwCwo.gif",alt:""},k=["alt","width","height"];for(g.url&&(b.src=g.url);_=k.shift();)g[_]&&(b[_]=g[_]);return b}return ho(t)}if("m-username"===e){if("inner"===s){var v={href:t.ctx.url};return t.ctx.counter&&(v.onmousedown=t.ctx.counter),v}return ho(t)}if("wiki-formatter"===e)return!!s==!1?Es(t):ho(t);if("m-userpic"===e)return"img"===s?!t.ctx.size==!1?{src:"//center.yandex-team.ru/api/v1/user/"+t.ctx.login+"/avatar/"+t.ctx.size+".jpg"}:{src:"//center.yandex-team.ru/api/v1/user/"+t.ctx.login+"/avatar.jpg"}:Ds(t);if("b-popupa"===e)return"wrap"===s?{cellpadding:0,cellspacing:0}:ho(t);if("link"===e)return Ns(t);if("b-icon"===e){if(!!s==!1){var y,M=t.ctx,w={src:"//yastatic.net/lego/_/La6qi18Z8LwgnZdsAr1qy1GwCwo.gif",alt:""},x=["alt","width","height"];for(M.url&&(w.src=M.url);y=x.shift();)M[y]&&(w[y]=M[y]);return w}return ho(t)}return ho(t)}if("tag"===e){var e=n;if("wiki-hr"===e)return!!s==!1?"hr":ho(t);if("wiki-color"===e){var e=s;return"hex"===e||"example"===e?"span":ho(t)}if("wiki-cell"===e)return!!s==!1?"td":ho(t);if("wiki-br"===e)return!!s==!1?"br":ho(t);if("wiki-bquot"===e)return!!s==!1?"blockquote":ho(t);
if("wiki-definition"===e)return!!s==!1?"def":ho(t);if("wiki-htmlentity"===e)return!!s==!1?"":ho(t);if("wiki-user"===e){var e=s;return"first-letter"===e?"b":"link"===e?"a":!!s==!1?"b":ho(t)}if("b-icon"===e)return!!s==!1?"img":ho(t);if("b-link"===e)return"inner"===s?"span":!(r&&r.pseudo)==!1?!!s==!1?t.ctx.url?"a":"span":ho(t):ho(t);if("input"===e){var e=s;return"clear"===e?"span":"control"===e?"input":"ahead-hint"===e||"ahead-filler"===e?"span":!!s==!1?"span":ho(t)}if("wiki-err"===e)return"param"===s?"span":ho(t);if("button"===e)return!t.ctx.url==!1?!!s==!1?"a":js(t):js(t);if("wiki-footnote"===e)return!!s==!1?"sup":ho(t);if("image"===e)return!!s==!1?"img":ho(t);if("wiki-head"===e){var e=s;return"edit"===e?"span":"anchor"===e?"a":!!s==!1?"h"+t.ctx["wiki-attrs"].level:ho(t)}if("m-username"===e)return"inner"===s?t.ctx.url?"a":"span":!!s==!1?"b":ho(t);if("wiki-docviewer"===e)return!!s==!1?"":ho(t);if("m-userpic"===e)return!t.ctx.url==!1?!!s==!1?"a":Ls(t):Ls(t);if("b-popupa"===e){var e=s;return"wrap-cell"===e?"td":"wrap"===e?"table":"shadow"===e?"i":ho(t)}if("link"===e)return"inner"===s?"span":!!s==!1?t.ctx.url?"a":"span":ho(t);if("b-menu"===e){var e=s;return"layout-vert-separator"===e||"layout-vert-cell"===e?!(r&&"vert"===r.layout)==!1?"li":Ps(t):"layout-vert"===e?!(r&&"vert"===r.layout)==!1?"ul":Ps(t):"title"===e?"h2":Ps(t)}if("popup"===e){var e=s;return"close"===e||"tail"===e?"i":ho(t)}return"wiki-anchor"===e?!!s==!1?"a":ho(t):ho(t)}if("default"===e){var e=n;if("b-menu"===e){var e=s;if("separator"===e){if(!(t.__$anflg26!==!0)==!1){if(!(r&&"vert"===r.layout)==!1){if(!!t.ctx._wrap==!1){var a=t.__$anflg26;t.__$anflg26=!0;var l=t.ctx;t.ctx={elem:"layout-vert-separator",content:t.ctx};var E=i;return i="",K(t),t.ctx=l,i=E,t.__$anflg26=a,void 0}return ho(t)}return ho(t)}return ho(t)}if("item"===e){if(!(t.__$anflg25!==!0)==!1){if(!(r&&"vert"===r.layout)==!1){var B=t.ctx.position,a=t.__$anflg25;t.__$anflg25=!0;var l=t.ctx;t.ctx={elem:"layout-vert-cell",elemMods:B?{position:B}:{},content:t.ctx};var E=i;return i="",K(t),t.ctx=l,i=E,t.__$anflg25=a,void 0}return ho(t)}return ho(t)}return ho(t)}if("wiki-helper-label"===e)return!!s==!1?!!t._helper.length==!1?$s(t):ho(t):ho(t);if("wiki-cut"===e)return!!t.ctx._wrap==!1?!!s==!1?!!t.ctx.elem==!1?Hs(t):ho(t):ho(t):ho(t);if("wiki-txt"===e)return!!s==!1?zs(t):ho(t);if("wiki-footnote"===e)return!!t.ctx._wrap==!1?!!s==!1?Fs(t):ho(t):ho(t);if("wiki-action"===e)return!(t.__$anflg20!==!0)==!1?!!t.ctx._wrap==!1?!!s==!1?qs(t):ho(t):ho(t):ho(t);if("wiki-ticket-ajax"===e)return"issue"===s?Us(t):ho(t);if("wiki-small"===e)return!!s==!1?!!t.wiki.styles.small==!1?Ws(t):ho(t):ho(t);if("wiki-monospace"===e)return!!s==!1?!!t.wiki.styles.monospace==!1?Vs(t):ho(t):ho(t);if("input"===e){if("control"===s){if(!(t.__$anflg19!==!0)==!1){if(!(r&&"no"===r.clear)==!1){var a=t.__$anflg19;t.__$anflg19=!0;var l=t.ctx;t.ctx={elem:"box",tag:"span",content:t.ctx};var E=i;return i="",K(t),t.ctx=l,i=E,t.__$anflg19=a,void 0}return Gs(t)}return Gs(t)}return Ks(t)}if("wiki-superscript"===e)return!!s==!1?!!t.wiki.styles.superscript==!1?As(t):ho(t):ho(t);if("button"===e){if(!(t.__$anflg14!==!0)==!1){if(!!s==!1){var I=t.ctx.mods||{};I.theme=I.theme||"normal";var a=t.__$anflg14;t.__$anflg14=!0;var l=t.ctx,E=l.mods;return l.mods=I,ve(t),l.mods=E,t.__$anflg14=a,void 0}return ho(t)}return ho(t)}if("wiki-headcut"===e){if("head"===s){var a=i;i="";var l=t.ctx;return t.ctx={block:"wiki-head","wiki-attrs":t.ctx["wiki-attrs"],content:[{block:"b-link",mods:{pseudo:"yes"},mix:[{block:"wiki-headcut",elem:"head"}],content:t.ctx.content}]},K(t),i=a,t.ctx=l,void 0}return ho(t)}if("spin"===e)return!(t.__$anflg13!==!0)==!1?!!s==!1?Qs(t):ho(t):ho(t);if("b-popupa"===e){if("content"===s){if(!(t.__$anflg24!==!0)==!1){var a=t.__$anflg24;t.__$anflg24=!0;var l=t.ctx;t.ctx=[{elem:"shadow"},{elem:"wrap",content:t.ctx}];var E=i;return i="",K(t),t.ctx=l,i=E,t.__$anflg24=a,void 0}return ho(t)}return ho(t)}if("popup"===e){if(!(t.__$anflg11!==!0)==!1){if(!(r&&"yes"===r["has-close"])==!1){if(!!s==!1){t.ctx.content.push({elem:"close"});var a=t.__$anflg11;return t.__$anflg11=!0,j(t),t.__$anflg11=a,void 0}return Zs(t)}return Zs(t)}return Zs(t)}return"wiki-bold"===e?!!t.wiki.styles.bold==!1?!!s==!1?Rs(t):ho(t):ho(t):ho(t)}if("mix"===e){var e=n;if("b-popupa"===e){if(!!s==!1){var S={},D=t.ctx.mods||{};return D.theme||(S.theme="ffffff"),D.direction||(S.direction="down"),S=[{mods:S}],t._inBDropdowna&&(S.push({block:"b-dropdowna",elem:"popup",elemMods:t._dropdownaColor&&{color:t._dropdownaColor}}),t._dropdownaColor=!1,t._inBDropdowna=!1),S}return ho(t)}if("wiki-formatter"===e)return so(t);if("wiki-block"===e){if(!!s==!1){var N=t.ctx["wiki-attrs"],T={},C=!1;return N&&(N.multiline===!1&&(T.type="inline"),N.mod&&(T.role=N.mod),(T.type||T.role)&&(C=[{mods:T}])),C}return ho(t)}if("wiki-user"===e)return!!s==!1?[{block:"mi-staff-card",js:{user:t.ctx.card}}]:ho(t);if("wiki-remark"===e){if(!!s==!1){var O=t.ctx["wiki-attrs"]&&t.ctx["wiki-attrs"].color;return O&&[{mods:{color:O}}]}return ho(t)}return"input"===e?"ahead"===s?[{block:"input",elem:"input"}]:ho(t):ho(t)}if("js"===e){var e=n;return"b-popupa"===e||"wiki-headcut"===e?!!s==!1?!0:ho(t):"wiki-head"===e?!!s==!1?{anchor:t.ctx["wiki-attrs"].anchor}:ho(t):"wiki-err"===e?!!s==!1?!0:ho(t):"b-link"===e?!(r&&r.pseudo)==!1?!!s==!1?!0:ho(t):ho(t):"input"===e?!!s==!1?"gradient"==r.popup?{live:!1,popupMods:{gradient:"yes"}}:{live:!1}:ho(t):"button"===e?!!s==!1?!0:ho(t):"m-button-action"===e?!(r&&"phone"===r.type)==!1?!!s==!1?!0:ro(t):ro(t):"link"===e?!(r&&"yes"===r.pseudo)==!1?!!s==!1?!0:ao(t):ao(t):ho(t)}return"bem"===e?"wiki-br"===n?!!s==!1?!1:ho(t):ho(t):"value"===e?"input"===n?lo(t):ho(t):ho(t)}function _s(t){if(!(t.__$anflg23!==!0)==!1){if(!!s==!1){var e,i,n=(e=t.__$anflg23,t.__$anflg23=!0,i=_s(t),t.__$anflg23=e,i);return n[0].content=[t.ctx.content[0].content],n}return gs(t)}return gs(t)}function gs(t){return!!s==!1?[{elem:"head","wiki-attrs":t.ctx.content[0]["wiki-attrs"],content:t.ctx.content[0].content},{elem:"cbody",content:t.ctx.content[1].content}]:ho(t)}function bs(t){return!(t.__$anflg22!==!0)==!1?!!s==!1?ks(t):vs(t):vs(t)}function ks(t){var e,i,n,s=(e=t.__$anflg22,t.__$anflg22=!0,i=bs(t),t.__$anflg22=e,i),o=t.ctx["wiki-attrs"],r=t.wiki;return t.wiki.grid?s.splice(4,1):(n=r.page?r.page+"/.edit?section="+o.section_local+"&gopage="+r.path+"&goanchor=h-"+o.section_global:r.path+"/.edit?section="+o.section_local+"&goanchor=h-"+o.section_global,o.edit&&(n=o.edit),"view"==t.wiki.mode&&t.ctx["wiki-attrs"].anchor&&(s.splice(2,1),s.splice(1,0,{elem:"text",tag:"span",content:t.ctx.content})),o.section_local&&s[s.length-1].content&&s[s.length-1].content.push({block:"b-link",url:n||"#",mix:[{block:"wiki-head",elem:"link",elemMods:{type:"edit"}}],content:[t._helper[t.wiki.lang].txt.edit]})),s}function vs(t){return!!s==!1?ys(t):ho(t)}function ys(t){return["view"==t.wiki.mode&&t.ctx["wiki-attrs"].anchor&&{elem:"anchor",attrs:{name:t.ctx["wiki-attrs"].anchor}},"view"==t.wiki.mode&&t.ctx["wiki-attrs"].section_global&&{elem:"anchor",attrs:{name:"h-"+t.ctx["wiki-attrs"].section_global}},t.ctx.content,"view"==t.wiki.mode&&t.ctx["wiki-attrs"].anchor&&{elem:"edit",cls:"no-print",content:[{block:"b-link",url:"#"+t.ctx["wiki-attrs"].anchor,mix:[{block:"wiki-head",elem:"link",elemMods:{type:"anchor"}}],content:["&sect"]}]}]}function Ms(t){var e=t.ctx["wiki-attrs"];for(var i in e)if("id"!=i&&"action_include_page_not_found"!=e.id)var n=e[i];if(t.wiki.action)var s=t.wiki.action;if(t.wiki.formatter)var s=t.wiki.formatter;if(e&&"invocation_error"==e.id){if(e.description)var s=e.description;else var s=!1;e.summary&&(n=e.summary)}return[{block:"b-icon",mix:[{mods:{type:"err"}}]},t._helper[t.wiki.lang].err[t.ctx["wiki-attrs"].id],void 0!=n&&"&nbsp;",void 0!=n&&{elem:"param",content:[n?t._.xmlEscape(n):"<i>"+t._helper[t.wiki.lang].txt.empty+"</i>"]}," ","action_include_page_not_found"==e.id&&{block:"b-link",url:e.page,content:e.page},s&&"&nbsp;",s&&{block:"b-link",mods:{pseudo:"yes"},mix:[{block:"wiki-err",elem:"more"}],content:[{block:"b-icon",mix:[{mods:{type:"arrow"}}]},t._helper[t.wiki.lang].txt.more]},s&&{elem:"description",content:[t._.xmlEscape(s)]}]}function ws(t){return!(r&&"email"===r.type)==!1?!!s==!1?xs(t):ho(t):ho(t)}function xs(t){return[{block:"button",mods:{size:"s",type:"simple"},attrs:{title:"jabber is "+t.ctx.jabberSt},content:[{block:"mi-jabber",mods:{status:t.ctx.jabberSt}},t.ctx.content.replace("yandex-team.ru","")]},{elem:"mailto",content:[{block:"input",mods:{size:"s",clear:"no",type:"simple"},value:t.ctx.content,content:[{elem:"control",attrs:{readonly:"yes"}}]},{elem:"return",content:"&#8634;"},{elem:"links",content:[{block:"link",mods:{type:"simple"},url:"mailto:"+t.ctx.content,content:BEM.I18N("m-button-action","email")},{block:"link",mods:{type:"simple"},url:"xmpp:"+t.ctx.content,content:BEM.I18N("m-button-action","jabber")}]}]}]}function Es(t){if(t.ctx["wiki-attrs"]){var e={style:""},i=t.ctx["wiki-attrs"];return i.txt&&(t.wiki.formatter=i.txt,t.wiki.action=!1),i.border&&(e.style+="0"==i.border?"border: none;":"border: "+i.border+";"),i.width&&(e.style+="width: "+i.width+"px;"),i.height&&(e.style+="height: "+i.height+"px;"),i.align&&"center"!=i.align?e.style+="float: "+i.align+";":("center"==i.align&&(e.style+="float: none;"),i.multiline?e.style+="display: block;":i.width&&(e.style+="word-wrap: break-word; overflow: auto")),i.align&&"text"==i.wrapper&&(e.style+="text-align: "+i.align+";"),e}}function Bs(t){return!(t.__$anflg15!==!0)==!1?!!s==!1?!!t.ctx.url==!1?Is(t):Ss(t):Ss(t):Ss(t)}function Is(t){for(var e,i,n,s=t.ctx,o=(e=t.__$anflg15,t.__$anflg15=!0,i=Ve(t),t.__$anflg15=e,i),a={type:s.type||"button"},l=["name","value"];n=l.shift();)s[n]&&(a[n]=s[n]);return r.disabled&&(a.disabled="disabled"),t._.extend(o,a)}function Ss(t){if(!!s==!1){var e=t.ctx,i={role:"button"};return e.tabindex&&(i.tabindex=e.tabindex),i}return ho(t)}function Ds(t){return!t.ctx.url==!1?!!s==!1?{href:t.ctx.url}:ho(t):ho(t)}function Ns(t){if(!(r&&"yes"===r.pseudo)==!1){if(!!s==!1){if(!!t.ctx.url==!1){var e="yes"===(t.ctx.mods||{}).disabled,i={role:"button",tabindex:0};return e&&(i["aria-disabled"]=!0,delete i.tabindex),i}return Ts(t)}return Ts(t)}return Ts(t)}function Ts(t){if(!(t.__$anflg12!==!0)==!1){if(!(r&&"yes"===r.disabled)==!1){if(!!s==!1){var e,i,n=(e=t.__$anflg12,t.__$anflg12=!0,i=Ns(t),t.__$anflg12=e,i||{});return n.tabindex=-1,n["aria-disabled"]=!0,n}return Cs(t)}return Cs(t)}return Cs(t)}function Cs(t){return!!s==!1?Os(t):ho(t)}function Os(t){var e=t.ctx,n={};if(["title","target","id","tabindex"].forEach(function(t){e.hasOwnProperty(t)&&(n[t]=String(e[t]))}),null!==e.url&&"undefined"!=typeof e.url)if(t.isSimple(e.url))n.href=String(e.url);else{var s=[],o=i;i="";var r=t._buf;t._buf=s;var a=t.ctx;t.ctx=e.url,K(t),i=o,t._buf=r,t.ctx=a,n.href=s.join("")}else n.role="button",n.tabindex||(n.tabindex="0");return n}function Ps(t){return!!s==!1?"div":ho(t)}function js(t){return!!s==!1?"button":ho(t)}function Ls(t){return!!s==!1?"span":ho(t)}function As(t){var e,n,s,o,r,a;return e=t.wiki.styles,n=e.superscript,e.superscript="sup",s=i,i="",o=t.ctx,r=o.tag,o.tag="",a=K(t),e.superscript=n,i=s,o.tag=r,a}function Fs(t){var e,n,s,o,r=t.ctx,a=r["wiki-attrs"].type,l=r["wiki-attrs"].kind,c=r["wiki-attrs"].label?t._.xmlEscape(r["wiki-attrs"].label):"",d=t._.xmlEscape(r["wiki-attrs"].name),u=r["wiki-attrs"].number,h=r.content||c;"asterisk"==a?(e="ref"==l?"#oftn"+u:"#ftn"+u,n="ref"==l?"ftn":"oftn",s=n+u,h||(h=new Array(u+1).join("*"))):"numeric"==a?(e="ref"==l?"#oftnd"+u:"#ftnd"+u,n="ref"==l?"ftnd":"oftnd",s=n+u,h||(h=u)):"named"==a&&(e="ref"==l?"#o"+d:"#"+d,n="ref"==l?"":"o",s=n+d,h||(h=d)),o={name:s};var p=i;i="";var m=t.ctx;t.ctx={block:"wiki-footnote",_wrap:!0,content:[{block:"b-link",url:e,attrs:o,content:h}]},K(t),i=p,t.ctx=m}function $s(t){t._helper={en:{warn:{unclosed_opening_marker:"Unclosed opening marker",unclosed_opening_parenthesis:"Unclosed opening parenthesis",unclosed_opening_marker_till_eol:"Unclosed (within the line) opening marker",unpaired_closing_style_marker:"Unpaired closing style marker",empty_element:"Empty element",invalid_color_name:"Invalid color name",invalid_char_in_table:"Invalid char in the table inter-cell space",li_type_overriden_by_list_type:"Specified listitem type is overriden by list type",li_level_possibly_incorrect:"Listitem level is possibly incorrect",element_is_not_allowed_within_current_element:"Element is not allowed within the current element",element_disabled:"Element is disabled",style_opening_marker_inside_same_style:"Opening style marker inside the same style",invalid_filename:"invalid filename",result_may_be_incorrect_for_preview:"Result may be incorrect in preview",invalid_include_boundaries:"Invalid include boundaries",anchor_not_found:"Anchor not found",invalid_hostname:"Invalid hostname",invalid_parameter:"Invalid parameter",invalid_formatter_name:"Invalid formatter name",invalid_action_name:"Invalid action name",unknown_formatter_name:"Unknown formatter name",unknown_action_name:"Unknown action name",too_long_wiki_link:"Too long wiki page link"},err:{invalid_parameter:"Invalid parameter",invocation_error:"Invocation error",action_include_cycle:"Include action - cycle detected",action_include_error_loading:"Include action - error loading",action_include_no_access:"Content of the included page should be displayed here. But you have no access to the included page.",action_include_page_not_found:"Include action - page not found",action_include_incorrect_syntax_version:"Include action - page to include has incorrect syntax version",file_not_found:"File not found"},txt:{attention:"Attention!",contents:"Contents",more:"Details",empty:"empty","assign-jira":"Assign","comment-jira":"Comment","edit-jira":"Edit",edit:"edit",external_link:"External link (opens in new window)",ticket_soon:"The ticket details will soon be here"}},ru:{warn:{unclosed_opening_marker:"Незакрытый открывающий маркер",unclosed_opening_parenthesis:"Незакрытая открывающая скобка",unclosed_opening_marker_till_eol:"Незакрытый (в той же строке) открывающий маркер",unpaired_closing_style_marker:"Непарный закрывающий маркер стиля",empty_element:"Пустой элемент",invalid_color_name:"Неверное название цвета",invalid_char_in_table:"Недопустимый символ в межстрочном пространстве таблицы",li_type_overriden_by_list_type:"Указанный тип пункта списка перекрыт типом списка",li_level_possibly_incorrect:"Уровень пункта списка возможно неверен",element_is_not_allowed_within_current_element:"Элемент недопустим внутри текущего элемента",element_disabled:"Элемент отключен",style_opening_marker_inside_same_style:"Открывающий маркер стиля внутри такого же стиля",invalid_filename:"Недопустимое имя файла",result_may_be_incorrect_for_preview:"Результат может быть неверным при предварительном просмотре",invalid_include_boundaries:"Неверные границы в действии include",anchor_not_found:"Якорь не найден",invalid_hostname:"Неверное имя хоста",invalid_parameter:"Некорректный параметр",invalid_formatter_name:"Некорректное имя форматера",invalid_action_name:"Некорректное имя действия",unknown_formatter_name:"Неизвестное имя форматера",unknown_action_name:"Неизвестное имя действия",too_long_wiki_link:"Слишком длинная ссылка на вики страницу"},err:{invalid_parameter:"Некорректный параметр",invocation_error:"Ошибка при вызове",action_include_cycle:"Действие include - обнаружен цикл",action_include_error_loading:"На этом месте должен отображаться текст включенной страницы. Но у вас нет прав на включенную страницу.",action_include_no_access:"Действие include - нет доступа",action_include_page_not_found:"Действие include - страница не найдена",action_include_incorrect_syntax_version:"Действие include - неверная версия синтаксиса включаемой страницы",file_not_found:"Файл не найден"},txt:{attention:"Внимание!",contents:"Оглавление документа",more:"Детали",empty:"пусто","assign-jira":"Назначить","comment-jira":"Комментировать","edit-jira":"Редактировать",edit:"правка",external_link:"Внешняя ссылка (откроется в новом окне)",ticket_soon:"Тут скоро будет описание тикета"}}}}function Hs(t){var e=t.ctx.content&&t.ctx.content[0]&&t.ctx.content[0].content,n=t.ctx.content&&t.ctx.content[1]&&t.ctx.content[1].content,s=i;i="";var o=t.ctx;t.ctx={block:"wiki-cut",_wrap:!0,js:!0,content:[{elem:"chead",content:e},{elem:"cbody",content:n}]},K(t),i=s,t.ctx=o}function zs(t){t.ctx.styles=t.ctx.styles||{};var e=t.ctx["wiki-attrs"].txt,n=t.ctx.styles,s=t.wiki?t.wiki.styles:{},o=!1,r={block:"wiki-",tag:"",content:{block:"wiki-txt",keys:t.ctx.keys||[],noEscape:t.ctx.noEscape||!1,styles:n,"wiki-attrs":{txt:e}}};for(var a in s)!s[a]||t._.inArray(r.content.keys,a)||o||(r.tag=s[a],r.block+=a,r.content.keys.push(a),o=!0);r.tag||(r=t.ctx.noEscape?e:t._.xmlEscape(e));var l=i;i="";var c=t.ctx;t.ctx=r,K(t),i=l,t.ctx=c}function Rs(t){var e,n,s,o,r,a;return e=t.wiki.styles,n=e.bold,e.bold="strong",s=i,i="",o=t.ctx,r=o.tag,o.tag="",a=K(t),e.bold=n,i=s,o.tag=r,a}function qs(t){var e,n,s,o,r,a=[],l=t.ctx["wiki-attrs"];return l&&l.txt&&(t.wiki.action=l.txt,t.wiki.formatter=!1),t.ctx.content&&t.ctx.content.forEach(function(t){"wiki-json"===t.block?a.push({block:"b-wiki-"+l.name,js:{data:t["wiki-attrs"].data,attrs:l}}):a.push(t)}),e=t.__$anflg20,t.__$anflg20=!0,s=t.ctx,t.ctx=(i="",t.ctx=[l&&l.dynamic&&"<!--dynamic action-->",{block:"wiki-action",_wrap:!0,attrs:l&&l.name&&l.count&&{id:l.name+l.count},content:a},l&&l.dynamic&&"<!--/dynamic action-->"]),o=i,i="",r=K(t),t.ctx=s,i=o,n=r,t.__$anflg20=e,n}function Us(t){var e=t.ctx["wiki-attrs"]&&t.ctx["wiki-attrs"].status,n=i;i="";var s=t.ctx;t.ctx={block:"b-link",url:t.ctx.url,mix:[{block:"wiki-ticket-ajax",elem:"issue"}],content:"closed"==e.toLowerCase()?{block:"wiki-strike",content:t.ctx.content}:t.ctx.content},K(t),i=n,t.ctx=s}function Ws(t){var e,n,s,o,r,a;return e=t.wiki.styles,n=e.small,e.small="small",s=i,i="",o=t.ctx,r=o.tag,o.tag="",a=K(t),e.small=n,i=s,o.tag=r,a}function Vs(t){var e,n,s,o,r,a;return e=t.wiki.styles,n=e.monospace,e.monospace="tt",s=i,i="",o=t.ctx,r=o.tag,o.tag="",a=K(t),e.monospace=n,i=s,o.tag=r,a}function Gs(t){return!(t.__$anflg18!==!0)==!1?!!r.clear==!1?Js(t):Ks(t):Ks(t)}function Js(t){var e=t.__$anflg18;t.__$anflg18=!0;var n=t.ctx;t.ctx={elem:"box",tag:"span",content:[t.ctx,{elem:"clear",elemMods:t._value||0===t._value?{visibility:"visible"}:void 0}]};var s=i;i="",K(t),t.ctx=n,i=s,t.__$anflg18=e}function Ks(t){return!(t.__$anflg17!==!0)==!1?!!s==!1?Ys(t):ho(t):ho(t)}function Ys(t){var e,n,s,o=(e=i,i="value",n=t.ctx,t.ctx=t.ctx.value,s=lo(t),i=e,t.ctx=n,s),a=t.ctx.id||t.generateId(),l=t.ctx.mods||{};l.theme=l.theme||"normal";var c=t.__$anflg17;t.__$anflg17=!0;var d=t._inputId;t._inputId=a;var u=t._labelId;t._labelId="label"+a;var h=t._hintId;t._hintId="hint"+a;var p=t._name;t._name=t.ctx.name||"";var m=t._value;t._value=o;var f=t._inputLink;t._inputLink=!0;var _=t._disabled;t._disabled=r.disabled;var g=t.ctx,b=g.mods;g.mods=l,je(t),t._inputId=d,t._labelId=u,t._hintId=h,t._name=p,t._value=m,t._inputLink=f,t._disabled=_,g.mods=b,t.__$anflg17=c}function Qs(t){var e,n,s,o,r,a=t.ctx.mods||{};return a.theme||(a.theme="gray-32"),t.ctx.mods=a,t.ctx.content={block:"image",mix:[{block:"spin",elem:"icon"}]},e=t.__$anflg13,t.__$anflg13=!0,s=t.ctx,t.ctx=t.ctx,o=i,i="",r=K(t),t.ctx=s,i=o,n=r,t.__$anflg13=e,n}function Zs(t){return!(t.__$anflg10!==!0)==!1?!(r&&"grid-options"===r.type)==!1?!!s==!1?Xs(t):to(t):to(t):to(t)}function Xs(t){var e,n,s,o,r,a=t.ctx;return a.content=a.content[1]?a.content[1]:"",e=t.__$anflg10,t.__$anflg10=!0,s=t.ctx,t.ctx=a,o=i,i="",r=K(t),t.ctx=s,i=o,n=r,t.__$anflg10=e,n}function to(t){return!(t.__$anflg9!==!0)==!1?!(r&&"panel"===r.related)==!1?!!s==!1?eo(t):io(t):io(t):io(t)}function eo(t){var e,n,s,o,r,a=t.ctx;return a.content=a.content[1]?a.content[1]:"",a.js={directions:[{to:"bottom",axis:"left",offset:{top:11}}]},e=t.__$anflg9,t.__$anflg9=!0,s=t.ctx,t.ctx=a,o=i,i="",r=K(t),t.ctx=s,i=o,n=r,t.__$anflg9=e,n}function io(t){return!!t._popupDefaults==!1?!!s==!1?no(t):ho(t):ho(t)}function no(t){var e=t.ctx;if(e.mods=r=t.extend({theme:"ffffff",autoclosable:"yes",adaptive:"yes",animate:"yes"},r),e.zIndex){var i=e.attrs||(e.attrs={});i.style=(i.style||"")+";z-index:"+e.zIndex+";"}var n=t._popupDefaults;t._popupDefaults=!0,j(t),t._popupDefaults=n}function so(t){if(!(t.__$anflg21!==!0)==!1){if(!!s==!1){var e,i,n=(e=t.__$anflg21,t.__$anflg21=!0,i=so(t),t.__$anflg21=e,i);return"center"!=t.ctx["wiki-attrs"].align&&(n[0].mods.float=t.ctx["wiki-attrs"].align),n}return oo(t)}return oo(t)}function oo(t){if(!!s!=!1)return ho(t);var e=t.ctx["wiki-attrs"];if(e){var i={};return e.hasOwnProperty("wrapper")&&(i.wrapper=e.wrapper),e.hasOwnProperty("multiline")&&!e.multiline&&(i.type="inline"),[{mods:i}]}}function ro(t){return!(r&&"email"===r.type)==!1?!!s==!1?!0:ho(t):ho(t)}function ao(t){return!t.ctx.hasOwnProperty("tabindex")==!1?{origTabindex:String(t.ctx.tabindex)}:ho(t)}function lo(t){return!t.isSimple(t.ctx)==!1?!!s==!1?t.ctx:co(t):co(t)}function co(t){if(!t.ctx==!1){if(!!s==!1){var e=[],n=t._buf;t._buf=e;var o=i;return i="",K(t),t._buf=n,i=o,e.join("")}return uo(t)}return uo(t)}function uo(t){return!!s==!1?"":ho(t)}function ho(t){var e=n;return"popup"===e?!(""===i&&t._popupDefaults)==!1?(delete t._popupDefaults,dr(t),void 0):mo(t):"b-link"===e?!(t.__$anflg8!==!0)==!1?!t.ctx.cls==!1?!!s==!1?po(t):mo(t):mo(t):mo(t):mo(t)}function po(t){var e,n,s,o,r;return t.ctx.attrs&&t.ctx.attrs.lang&&-1!==t.ctx.cls.indexOf("auto-person-card")&&(t.ctx.mix=[{block:"mi-staff-card",js:{user:t.ctx.attrs.lang}}]),e=t.__$anflg8,t.__$anflg8=!0,s=t.ctx,t.ctx=t.ctx,o=i,i="",r=K(t),t.ctx=s,i=o,n=r,t.__$anflg8=e,n}function mo(t){var e=i;if("attrs"===e){var e=n;if("b-link"===e)return!!s==!1?fo(t):_o(t);if("b-user"===e){if("link"===s){var o={href:t.ctx.url};return t.ctx.counter&&(o.onmousedown=t.ctx.counter),o}return _o(t)}if("b-page"===e){var e=s;return"js"===e?!t.ctx.url==!1?{src:t.ctx.url}:_o(t):"css"===e?!t.ctx.url==!1?{rel:"stylesheet",href:t.ctx.url}:_o(t):"favicon"===e?{rel:"shortcut icon",href:t.ctx.url}:"meta"===e?t.ctx.attrs:"icon"===e?{rel:"icon",type:"image/png",href:t.ctx.url,sizes:t.ctx.sizes}:_o(t)}return _o(t)}if(""===e)return!t._==!1?!!t._.cleverSubstring==!1?(t._.cleverSubstring=function(t,e,i){return t.length>e+i?t.substring(0,e-1)+"…":t},dr(t),void 0):Eo(t):Eo(t);if("mix"===e){var e=n;return"wiki-ticket-ajax"===e?!!s==!1?[{mods:{type:t.ctx["wiki-attrs"]&&(!t.ctx["wiki-attrs"].status||"Closed"==t.ctx["wiki-attrs"].status)&&"inactive",mode:t.ctx["wiki-attrs"]&&t.ctx["wiki-attrs"].ticket_type||"jira"}}]:No(t):"b-page"===e?Io(t):No(t)}if("js"===e){var e=n;return"wiki-ticket-ajax"===e?!!s==!1?!0:jo(t):"wiki-doc"===e?To(t):"b-wiki"===e||"scroll"===e?!!s==!1?!0:jo(t):jo(t)}if("default"===e){var e=n;if("wiki-doc"===e){if("yes"===t.ctx["wiki-attrs"].enable_inplace){if(!(t.__$anflg6!==!0)==!1){if(!!s==!1){var a=t.ctx.mix||[];a.push({block:"wiki-change",mods:{type:"doc"},js:!0});var l=t.__$anflg6;t.__$anflg6=!0;var c=t.ctx,d=c.mix;return c.mix=a,je(t),c.mix=d,t.__$anflg6=l,void 0}return Lo(t)}return Lo(t)}return Lo(t)}if("b-page"===e)return"css"===s?!t.ctx.hasOwnProperty("ie")==!1?!!t.ctx._ieCommented==!1?zo(t):Ro(t):Ro(t):Ro(t);if("i-bem"===e)return"i18n"===s?Uo(t):tr(t);if("i-jquery"===e)return"core"===s?!(t.__$anflg3!==!0)==!1?Wo(t):tr(t):tr(t);if("i-global"===e){var e=s;return"lego-static-host"===e?"//yastatic.net/lego/2.10-140":"export-host"===e?"//export.yandex.ru":"social-host"===e?"//social.yandex.ru":"pass-host"===e?"//pass.yandex.ru":"passport-host"===e?"https://passport.yandex.ru":"click-host"===e?"//clck.yandex.ru":"content-region"===e||"tld"===e||"lang"===e?"ru":!s==!1?"":!!s==!1?Vo(t):tr(t)}return tr(t)}if("pre-content"===e)return"b-user"===n?!!s==!1?xo(t):tr(t):tr(t);if("xUACompatible"===e)return"b-page"===n?!!s==!1?Jo(t):tr(t):tr(t);if("cls"===e){if("b-page"===n){var e=s;return"root"===e?"i-ua_js_no i-ua_css_standard":"icon"===e?"":Ko(t)}return Ko(t)}if("doctype"===e)return"b-page"===n?!!s==!1?Yo(t):tr(t):tr(t);if("js-params"===e)return"b-page"===n?!!s==!1?Qo(t):tr(t):tr(t);if("public-params"===e)return"i-global"===n?Zo(t):tr(t);if("content"===e){var e=n;if("b-user"===e){if(!t.ctx.card==!1){if(!!s==!1){var u=t.ctx.content;return u=u?[{elem:"first-letter",content:u[0]},u.slice(1)]:"",{elem:"link",cls:"auto-person-card",attrs:{lang:t.ctx.card},url:t.ctx.url||"http://staff.yandex-team.ru/"+t.ctx.card,counter:t.ctx.counter,content:u}}return bo(t)}return bo(t)}if("wiki-ticket-ajax"===e){if("assignee"===s){var h=t.ctx.content&&t.ctx.content[1];return h?[" ",{block:"b-user",mix:[{block:"mi-staff-card",js:{user:h.card}}],url:h.url,content:h.card}]:[]}return!!s==!1?vo(t):wo(t)}return"b-wiki"===e?"button"===s?"Поехали":!!s==!1?[{elem:"button"},{elem:"data"}]:wo(t):"scroll"===e?!(r&&"js"===r.tech)==!1?!!s==!1?[{elem:"native",content:{elem:"content",content:t.ctx.content}},{elem:"track",mods:{orientation:"vertical"},content:{elem:"thumb",mods:{orientation:"vertical"}}},{elem:"track",mods:{orientation:"horizontal"},content:{elem:"thumb",mods:{orientation:"horizontal"}}}]:wo(t):wo(t):"b-readonly"===e?!!s==!1?[{elem:"wrapper",content:[{elem:"text",content:BEM.I18N("b-readonly","in_readonly")+",<br/>"+BEM.I18N("b-readonly","cant_change")+"."},{elem:"close",content:{block:"awesome-icon",mods:{icon:"remove"}}}]},{elem:"icon"}]:wo(t):"b-page"===e?!!s==!1?{elem:"body",content:t.ctx.content}:wo(t):"i-ua"===e?yo(t):wo(t)}if("env"===e)return"i-global"===n?Xo(t):tr(t);if("tag"===e){var e=n;if("b-link"===e)return!!s==!1?"a":go(t);if("b-user"===e){var e=s;return"first-letter"===e?"b":"link"===e?"a":!!s==!1?"b":go(t)}if("wiki-ticket-ajax"===e){var e=s;return"links"===e||"description"===e||"assignee"===e||"summary"===e||"status"===e?"span":!!s==!1?"span":go(t)}if("b-wiki"===e){var e=s;return"data"===e?"pre":"button"===e?"button":go(t)}if("b-page"===e){var e=s;return"js"===e?"script":"css"===e?!t.ctx.url==!1?"link":"style":"body"===e?"":"favicon"===e?"link":"meta"===e?"meta":"head"===e?"head":"root"===e?"html":!!s==!1?"body":"icon"===s?"link":go(t)}return"awesome-icon"===e?!!s==!1?"span":go(t):"i-ua"===e?!!s==!1?"script":go(t):go(t)}if("jsAttr"===e)return void 0;if("bem"===e){var e=n;if("b-page"===e){var e=s;return"js"===e||"css"===e||"favicon"===e||"meta"===e||"head"===e||"root"===e||"icon"===e?!1:Go(t)}return"i-ua"===e?!!s==!1?!1:Go(t):Go(t)}return tr(t)}function fo(t){for(var e,n,s,o,r=t.ctx,a=["title","target"],l=typeof r.url,c={href:"undefined"===l||"string"===l?r.url:(l=[],e=t._buf,t._buf=l,n=i,i="",s=t.ctx,t.ctx=r.url,o=K(t),t._buf=e,i=n,t.ctx=s,l.join(""))};l=a.pop();)r[l]&&(c[l]=r[l]);return c}function _o(){return void 0}function go(){return void 0}function bo(t){return"link"===s?t.ctx.content:!!s==!1?ko(t):wo(t)}function ko(t){var e,n,s,o=t.ctx,r=parseInt(o.maxLength,10)||1e3,a=parseInt(o.maxLengthRelative,10)||3,l=t._.cleverSubstring(o.content,r,a),c=(e=i,i="pre-content",n=t.ctx,t.ctx=l,s=xo(t),i=e,t.ctx=n,s);return t.ctx.url?{elem:"link",url:t.ctx.url,counter:t.ctx.counter,content:c}:c}function vo(t){var e=t.ctx["wiki-attrs"];return e?[{elem:"issue",url:e.link_view,content:{block:"wiki-txt","wiki-attrs":{txt:e.issue||""}},"wiki-attrs":{status:e.status||""}},e.status&&" ",e.status&&{elem:"status",content:{block:"wiki-txt","wiki-attrs":{txt:e.status}}},{elem:"summary",mix:!e.summary&&!t.ctx["wiki-attrs"].fire&&[{mods:{type:"waiting"}}],content:[" ",e.summary?{block:"b-link",mods:{pseudo:"yes"},content:{block:"wiki-txt","wiki-attrs":{txt:e.summary}}}:!t.ctx["wiki-attrs"].fire&&{}],"wiki-attrs":{fire:e.fire}},e.assignee_login&&{elem:"assignee",content:[" ",{block:"b-user",card:e.assignee_login,url:e.assignee_link,content:e.assignee_login}]},e.summary&&{elem:"description",content:[e.description?{block:"wiki-txt","wiki-attrs":{txt:e.description}}:""]}]:{}}function yo(t){if(!(t.__$anflg2!==!0)==!1){if(!!s==!1){var e,i,n=(e=t.__$anflg2,t.__$anflg2=!0,i=yo(t),t.__$anflg2=e,i);return n+=[";(function(d,e,c,r,n,w,v,f){","e=d.documentElement;",'c="className";','r="replace";','n="createElementNS";','f="firstChild";','w="http://www.w3.org/2000/svg";','e[c]+=" i-ua_svg_"+(!!d[n]&&!!d[n](w,"svg").createSVGRect?"yes":"no");','v=d.createElement("div");','v.innerHTML="<svg/>";','e[c]+=" i-ua_inlinesvg_"+((v[f]&&v[f].namespaceURI)==w?"yes":"no");',"})(document);"].join("")}return Mo(t)}return Mo(t)}function Mo(t){return!!s==!1?[";(function(d,e,c,r){","e=d.documentElement;",'c="className";','r="replace";','e[c]=e[c][r]("i-ua_js_no","i-ua_js_yes");','if(d.compatMode!="CSS1Compat")','e[c]=e[c][r]("i-ua_css_standart","i-ua_css_quirks")',"})(document);"].join(""):wo(t)}function wo(t){return t.ctx.content}function xo(t){var e=t.ctx;return[{elem:"first-letter",content:e.charAt(0)},e.slice(1)]}function Eo(t){if(!!t["i-global"]==!1)return Bo(t);if(!(t.__$anflg1!==!0)==!1){if(!(t.ctx&&t.ctx.hasOwnProperty("_res"))==!1){var e=t.__$anflg1;t.__$anflg1=!0;var n=t.ctx;t.ctx=t.ctx._res;var s=i;return i="",K(t),t.ctx=n,i=s,t.__$anflg1=e,void 0}return tr(t)}return tr(t)}function Bo(t){for(var e,o,r,a,l,c,d,u,h={},p=["lang","tld","content-region","click-host","passport-host","pass-host","social-host","export-host","login","lego-static-host"];u=p.shift();)h[u]=(e=i,i="default",o=n,n="i-global",r=s,s=u,a=je(t),i=e,n=o,s=r,a);t["i-global"]=t._.extend(h,(l=i,i="env",c=n,n="i-global",d=Xo(t),i=l,n=c,d)),dr(t)}function Io(t){return!!t.ctx._iGlobal==!1?!!s==!1?So(t):Do(t):Do(t)}function So(t){var e,n,s,o,r,a=(e=t.ctx,n=e._iGlobal,e._iGlobal=!0,s=Io(t),e._iGlobal=n,s),l=(o=i,i="js-params",r=Qo(t),i=o,r);return a?a.push(l):a=[l],a}function Do(t){return!!s==!1?[{elem:"body"}]:No(t)}function No(){return void 0}function To(t){return!(t.__$anflg7!==!0)==!1?!!s==!1?!!t.ctx.js==!1?Co(t):Oo(t):Oo(t):Oo(t)}function Co(t){var e,i,n=(e=t.__$anflg7,t.__$anflg7=!0,i=To(t),t.__$anflg7=e,i),s=~Object.prototype.toString.call(n).indexOf("Object")?n:{};return t.ctx["wiki-attrs"].document_uid&&(s.hemul_uid=t.ctx["wiki-attrs"].document_uid||"",s.hemul_collection=t.ctx["wiki-attrs"].document_collection||""),s}function Oo(t){return!!s==!1?!!t.ctx.js==!1?Po(t):jo(t):jo(t)}function Po(t){var e;return e=t.ctx["wiki-attrs"].load_tickets_on_client?{trackers_view_urls:t.ctx["wiki-attrs"].trackers_view_urls,trackers_api_urls:t.ctx["wiki-attrs"].trackers_api_urls,wiki:{lang:t.ctx["wiki-attrs"].lang,mode:t.ctx["wiki-attrs"].mode,path:t.ctx["wiki-attrs"].page_path,grid:t.ctx["wiki-attrs"].grid||!1,noDocviewer:!0,styles:{},page:""}}:!0}function jo(){return void 0}function Lo(t){if(!!t._helper==!1){if(!!s==!1){var e=i;i="";var n=t._helper;t._helper=[];var o=t.ctx,r=o.content;return o.content=[{block:"wiki-helper-label"}].concat(t.ctx.content),K(t),i=e,t._helper=n,o.content=r,void 0}return Ao(t)}return Ao(t)}function Ao(t){return!!s==!1?!!t.wiki==!1?Fo(t):$o(t):$o(t)}function Fo(t){var e=t.wiki;t.wiki={ticket_type:t.ctx["wiki-attrs"].load_tickets_on_client?!0:!1,lang:t.ctx["wiki-attrs"].lang,mode:t.ctx["wiki-attrs"].mode,path:t.ctx["wiki-attrs"].page_path,grid:t.ctx["wiki-attrs"].grid||!1,noDocviewer:!0,styles:{},page:""};var i=t._,n=i.inArray;i.inArray=function(t,e){return-1!=t.indexOf(e)},je(t),t.wiki=e,i.inArray=n}function $o(t){if(!!t._buf._streamed==!1){if(!!s==!1){var e=t._buf;return t._buf={_buf:t._buf,push:function(){this._buf.push.apply(this._buf,arguments)},join:function(t){return this._buf.join(t)},_streamed:!0},je(t),t._buf=e,void 0}return Ho(t)}return Ho(t)}function Ho(t){if(!(t.__$anflg5!==!0)==!1){if(!(t.ctx["wiki-attrs"].load_tickets_on_client===!0)==!1){if(!!s==!1){var e=t.__$anflg5;t.__$anflg5=!0;var i=t.ctx,n=i.mods;return i.mods=t._.extend(t.ctx.mods||{},{type:"load-tickets"}),je(t),i.mods=n,t.__$anflg5=e,void 0}return tr(t)}return tr(t)}return tr(t)}function zo(e){var n=e.ctx.ie;if(n===!0){var s=i;i="";var o=e.ctx;e.ctx=[6,7,8,9].map(function(t){return{elem:"css",url:this.ctx.url+".ie"+t+".css",ie:"IE "+t}},t(e)),K(e),i=s,e.ctx=o}else{var r=n?"!IE"===n?[n,"<!-->","<!--"]:[n,"",""]:["gt IE 9","<!-->","<!--"],a=i;
i="";var l=e.ctx,c=l._ieCommented;l._ieCommented=!0;var d=e.ctx;e.ctx=["<!--[if "+r[0]+"]>",r[1],e.ctx,r[2],"<![endif]-->"],K(e),i=a,l._ieCommented=c,e.ctx=d}}function Ro(t){return!(t.__$anflg4!==!0)==!1?!!s==!1?qo(t):tr(t):tr(t)}function qo(t){var e,n,s,o,r=t.ctx,a=(e=i,i="doctype",n=Yo(t),i=e,n),l=(s=i,i="xUACompatible",o=Jo(t),i=s,o),c=[a,{elem:"root",content:[{elem:"head",content:[{tag:"meta",attrs:{charset:"utf-8"}},l,{tag:"title",content:r.title},r.favicon?{elem:"favicon",url:r.favicon}:"",r.meta,{block:"i-ua"},r.head]},r]}],d=t.__$anflg4;t.__$anflg4=!0;var u=t.ctx;t.ctx=c;var h=i;i="",K(t),t.ctx=u,i=h,t.__$anflg4=d}function Uo(t){var e,n,s,o;if(!t.ctx)return"";var r=t.ctx,a=r.keyset,l=r.key,c=r.params||{};if(!a&&!l)return"";if(r.content){var d;c.content=(d=[],e=t._buf,t._buf=d,n=i,i="",s=t.ctx,t.ctx=r.content,o=K(t),t._buf=e,i=n,t.ctx=s,d.join(""))}t._buf.push(BEM.I18N(a,l,c))}function Wo(t){var e,n,s,o,r;return e=t.__$anflg3,t.__$anflg3=!0,s=t.ctx,t.ctx={block:"b-page",elem:"js",url:"//yastatic.net/jquery/1.8.3/jquery.min.js"},o=i,i="",r=K(t),t.ctx=s,i=o,n=r,t.__$anflg3=e,n}function Vo(t){var e,i,n,s=t.ctx.params||{},o=t["i-global"],r=s.tld&&s.tld!==o.tld;r&&(e=s.tld,i="tr"===e?"yandex.com.tr":"yandex."+e,n=-1!=["ua","by","kz"].indexOf(e)?"yandex.ru":i,o["content-region"]=e,o["click-host"]="//clck."+n,o["passport-host"]="https://passport."+n,o["pass-host"]="//pass."+i,o["social-host"]="//social."+i,o["export-host"]="//export."+i);for(var a in s)o[a]=s[a]}function Go(){return void 0}function Jo(){return{tag:"meta",attrs:{"http-equiv":"X-UA-Compatible",content:"IE=EmulateIE7, IE=edge"}}}function Ko(){return void 0}function Yo(t){return t.ctx.doctype||"<!DOCTYPE html>"}function Qo(t){var e,o,r,a,l,c=t["i-global"],d={},u={block:"i-global",js:d};for(l in c)c.hasOwnProperty(l)&&(e=i,i="public-params",o=n,n="i-global",r=s,s=l,a=Zo(t),i=e,n=o,s=r,a)&&(d[l]=c[l]);return u}function Zo(t){return!s==!1?{id:1,lang:1,tld:1,"content-region":1,"user-region":1,login:1,displayName:1,index:1,yandexuid:1,"passport-host":1,"pass-host":1,"passport-msg":1,"static-host":1,"lego-static-host":1,"social-host":1,clck:1,"click-host":1,"export-host":1,"i-host":1,"social-retpath":1,"lego-path":1,sid:1,retpath:1,uid:1}[s]||!1:tr(t)}function Xo(t){return!!s==!1?{}:tr(t)}function tr(t){return!t.ctx==!1?!t.ctx.link==!1?!!t._.isSimple(t.ctx)==!1?er(t):ir(t):ir(t):ir(t)}function er(i){function n(){if("no-follow"===this.ctx.link)return void 0;var t=this._links[this.ctx.link];return __r0=this.ctx,this.ctx=t,__r1=e(dr,this),this.ctx=__r0,__r1}if(!a||!i._cacheLog)return n.call(t(i));var s=i._buf.slice(i._cachePos).join("");i._cachePos=i._buf.length,i._cacheLog.push(s,{log:i._localLog.slice(),link:i.ctx.link});var o=n.call(t(i));return i._cachePos=i._buf.length,o}function ir(t){return!a==!1?!t.ctx==!1?!t.ctx.cache==!1?nr(t):sr(t):sr(t):sr(t)}function nr(e){function i(t,e,i){if(0===e.length)return void 0;if(Array.isArray(i)){for(var n=t,s=0;s<i.length-1;s++)n=n[i[s]];i=n[i[s]]}for(var o,r=t,s=0;s<e.length-1;s++)r=r[e[s]];return o=r[e[s]],r[e[s]]=i,o}var n;if(n=a.get(e.ctx.cache)){var s=e._links;e.ctx.links&&(e._links=e.ctx.links);for(var o=0;o<n.log.length;o++)if("string"!=typeof n.log[o]){var r,l=n.log[o];r=l.log.map(function(t){return{key:t[0],value:i(this,t[0],t[1])}},t(e)).reverse();var d=e.ctx,u=d.cache;d.cache=null;var h=e._cacheLog;e._cacheLog=null;var p=e.ctx,m=p.link;p.link=l.link,c(e),d.cache=u,e._cacheLog=h,p.link=m,r.forEach(function(t){i(this,t.key,t.value)},t(e))}else e._buf.push(n.log[o]);return e._links=s,n.res}var f,_=[],g=e.ctx,b=g.cache;g.cache=null;var k=e._cachePos;e._cachePos=e._buf.length;var v=e._cacheLog;e._cacheLog=_;var y=e._localLog;e._localLog=[],f=c(e);var M=e._buf.slice(e._cachePos).join("");return M&&_.push(M),g.cache=b,e._cachePos=k,e._cacheLog=v,e._localLog=y,a.set(e.ctx.cache,{log:_,res:f}),f}function sr(t){var e=i;if("default"===e)return or(t);if(""===e){if(!t._.isSimple(t.ctx)==!1){t._listLength--;var n=t.ctx;return(n&&n!==!0||0===n)&&t._buf.push(n),void 0}return!!t.ctx==!1?(t._listLength--,void 0):!t._.isArray(t.ctx)==!1?rr(t):ar(t)}return lr(t)}function or(t){function e(t,e){return(t||"")+"__"+(e||"")}var a,l,c,u,h,p,m,f,_,g,b,k,v,y,M,w,x,E,B,I,S,D,N,C=t.BEM,O=t.ctx,P=t._buf;if(l=i,i="tag",k=T(t),i=l,N=k,"undefined"!=typeof N||(N=O.tag),"undefined"!=typeof N||(N="div"),N){var j,L;n&&O.js!==!1&&(c=i,i="js",u=R(t),i=c,L=u,L=L?t._.extend(O.js,L===!0?{}:L):O.js===!0?{}:O.js,L&&((j={})[C.INTERNAL.buildClass(n,O.elem)]=L)),P.push("<",N);var A=(h=i,i="bem",p=Q(t),i=h,p);"undefined"!=typeof A||(A="undefined"!=typeof O.bem?O.bem:O.block||O.elem);var F=(m=i,i="cls",f=Q(t),i=m,f);F||(F=O.cls);var $=O.block&&j&&!O.elem;if(A||F){if(P.push(' class="'),A){C.INTERNAL.buildClasses(n,O.elem,O.elemMods||O.mods,P);var z=(_=i,i="mix",g=q(t),i=_,g);if(O.mix&&(z=z?[].concat(z,O.mix):O.mix),z){var U={};U[e(n,s)]=!0,t._.isArray(z)||(z=[z]);for(var W=0;W<z.length;W++){var V=z[W];if(V){var G=V.block||V.elem,J=V.block||V._block||n,Y=V.elem||V._elem||s,Z=V.mods||r,X=V.elemMods||{};if(G&&P.push(" "),C.INTERNAL[G?"buildClasses":"buildModsClasses"](J,V.elem||V._elem||(V.block?void 0:s),V.elemMods||V.mods,P),V.js&&((j||(j={}))[C.INTERNAL.buildClass(J,V.elem)]=V.js===!0?{}:V.js,$||($=J&&!V.elem)),G&&!U[e(J,Y)]){U[e(J,Y)]=!0;var te=(b=n,n=J,a=s,s=Y,v=r,r=Z,y=o,o=X,M=i,i="mix",w=q(t),n=b,s=a,r=v,o=y,i=M,w);if(te)for(var ee=0;ee<te.length;ee++){var ie=te[ee];(ie.block||ie.elem)&&U[e(ie.block,ie.elem)]||(ie._block=J,ie._elem=Y,z.splice(W+1,0,ie))}}}}}}F&&P.push(A?" ":"",F),$&&P.push(" i-bem"),P.push('"')}if(j){var ne=(x=i,i="jsAttr",E=Q(t),i=x,E);P.push(" ",ne||"data-bem",'="',t._.attrEscape(JSON.stringify(j)),'"')}var se=(B=i,i="attrs",I=H(t),i=B,I);if(se=t._.extend(se,O.attrs)){var oe;for(oe in se)void 0!==se[oe]&&P.push(" ",oe,'="',t._.attrEscape(se[oe]),'"')}}if(t._.isShortTag(N))P.push("/>");else{N&&P.push(">");var re=(S=i,i="content",D=d(t),i=S,D);if(re||0===re){var A=n||s,ae=t._notNewList;t._notNewList=!1;var le=t.position;t.position=A?1:t.position;var ce=t._listLength;t._listLength=A?1:t._listLength;var de=t.ctx;t.ctx=re;var ue=i;i="",K(t),t._notNewList=ae,t.position=le,t._listLength=ce,t.ctx=de,i=ue}N&&P.push("</",N,">")}}function rr(t){var e=t.ctx,i=e.length,n=0,s=t.position,o=t._notNewList;for(o?t._listLength+=i-1:(t.position=0,t._listLength=i),t._notNewList=!0;i>n;){var r=e[n++],a=t.ctx;t.ctx=null==r?"":r,K(t),t.ctx=a}o||(t.position=s)}function ar(t){var e=t.ctx.block,a=t.ctx.elem,l=t._currBlock||n;t.ctx||(t.ctx={});var c=i;i="default";var d=t._links;t._links=t.ctx.links||t._links;var u=n;n=e||(a?l:void 0);var h=t._currBlock;t._currBlock=e||a?void 0:l;var p=s;s=t.ctx.elem;var m=r;r=e?t.ctx.mods||(t.ctx.mods={}):r;var f=o;o=t.ctx.elemMods||{},n||s?t.position=(t.position||0)+1:t._listLength--,O(t),i=c,t._links=d,n=u,t._currBlock=h,s=p,r=m,o=f}function lr(){throw new Error(this)}function cr(t){return dr(t||this)}function dr(t){return c(t)}return!function(){!function(t,e){if(e.I18N)return void 0;t.BEM=e;var i=e.I18N=function(t,e){return e};i.keyset=function(){return i},i.key=function(t){return t},i.lang=function(){return void 0}}(this,"undefined"==typeof BEM?{}:BEM)}(),!function(){function t(t){this.apply=t,this._buf=null,this.ctx=null,this._=this,this._start=!0,this._listLength=0,this._notNewList=!1,this._inside=!1,this.position=0}var e={},i=Object.prototype.toString,n={area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,wbr:1};!function(t,e){function i(t,e,i){i.push(o,t,o,e)}function n(t,e,n,s){s.push(t),n&&i(e,n,s)}function s(t,s,o,a,l){n(t,e,e,l),l.push(r,s),a&&i(o,a,l)}var o="_",r="__",a="[a-zA-Z0-9-]+";t.INTERNAL={NAME_PATTERN:a,MOD_DELIM:o,ELEM_DELIM:r,buildModPostfix:function(t,e,n){var s=n||[];return i(t,e,s),n?s:s.join("")},buildClass:function(t,i,o,r,a){var l=typeof o;if("string"==l?"string"!=typeof r&&(a=r,r=o,o=i,i=e):"undefined"!=l?(a=o,o=e):i&&"string"!=typeof i&&(a=i,i=e),!(i||o||a))return t;var c=a||[];return i?s(t,i,o,r,c):n(t,o,r,c),a?c:c.join("")},buildModsClasses:function(t,e,i,o){var r=o||[];if(i){var a;for(a in i)if(i.hasOwnProperty(a)){var l=i[a];null!=l&&(l=i[a]+"",l&&(r.push(" "),e?s(t,e,a,l,r):n(t,a,l,r)))}}return o?r:r.join("")},buildClasses:function(t,i,o,r){var a=r||[];return i?s(t,i,e,e,a):n(t,e,e,a),this.buildModsClasses(t,i,o,r),r?a:a.join("")}}}(e),t.prototype.reinit=function(t){this.ctx=null===typeof t?"":t,this._buf=[],this._start=!0,this._listLength=0,this._notNewList=!1,this.position=0},t.prototype.isArray=Array.isArray?function(t){return Array.isArray(t)}:function(t){return"[object Array]"===i.call(t)},t.prototype.isSimple=function(t){var e=typeof t;return"string"===e||"number"===e||"boolean"===e},t.prototype.isShortTag=function(t){return n.hasOwnProperty(t)},t.prototype.extend=function(t,e){if(!t||!e)return t||e;var i,n={};for(i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);for(i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);return n},t.prototype.identify=function(){var t=0,i=e.__id=+new Date,n="__"+i,s=function(){return"uniq"+i+ ++t};return function(t,e){return t?e||t[n]?t[n]:t[n]=s():s()}}(),t.prototype.xmlEscape=function(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},t.prototype.attrEscape=function(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},t.prototype.BEM=e,t.prototype.isFirst=function(){return 1===this.position},t.prototype.isLast=function(){return this.position===this._listLength},t.prototype.generateId=function(){return this.identify(this.ctx)},l.apply=t.apply=function(){var e=new t(cr);return e.reinit(this),e.apply(),e._buf.join("")}}(),l}("undefined"==typeof l?{}:l);return function(t){var e=this;return t||(t={}),a=t.cache,function(){return e===this?(e=void 0,i="",n="",s="",o="",r=""):(i="",n="",s="",o="",r=""),c.apply.call([e])}.call(null)}}();"undefined"==typeof exports||(exports.BEMHTML=BEMHTML),function(t){var e=function(t){this._res=t,this._isFulfilled=!!arguments.length,this._isRejected=!1,this._fulfilledCallbacks=[],this._rejectedCallbacks=[],this._progressCallbacks=[]};e.prototype={valueOf:function(){return this._res},isFulfilled:function(){return this._isFulfilled},isRejected:function(){return this._isRejected},isResolved:function(){return this._isFulfilled||this._isRejected},fulfill:function(t){this.isResolved()||(this._isFulfilled=!0,this._res=t,this._callCallbacks(this._fulfilledCallbacks,t),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=i)},reject:function(t){this.isResolved()||(this._isRejected=!0,this._res=t,this._callCallbacks(this._rejectedCallbacks,t),this._fulfilledCallbacks=this._rejectedCallbacks=this._progressCallbacks=i)},notify:function(t){this.isResolved()||this._callCallbacks(this._progressCallbacks,t)},then:function(t,n,s,o){n&&!r(n)?(o=n,n=i):s&&!r(s)&&(o=s,s=i);var a,l=new e;return this._isRejected||(a={promise:l,fn:r(t)?t:i,ctx:o},this._isFulfilled?this._callCallbacks([a],this._res):this._fulfilledCallbacks.push(a)),this._isFulfilled||(a={promise:l,fn:n,ctx:o},this._isRejected?this._callCallbacks([a],this._res):this._rejectedCallbacks.push(a)),this.isResolved()||this._progressCallbacks.push({promise:l,fn:s,ctx:o}),l},fail:function(t,e){return this.then(i,t,e)},always:function(t,e){var i=this,n=function(){return t.call(this,i)};return this.then(n,n,e)},progress:function(t,e){return this.then(i,i,t,e)},spread:function(t,e,i){return this.then(function(e){return t.apply(this,e)},e,i)},done:function(t,e,i,n){this.then(t,e,i,n).fail(o)},delay:function(t){var i,n=this.then(function(n){var s=new e;return i=setTimeout(function(){s.fulfill(n)},t),s});return n.always(function(){clearTimeout(i)}),n},timeout:function(t){var i=new e,n=setTimeout(function(){i.reject(Error("timed out"))},t);return i.sync(this),i.always(function(){clearTimeout(n)}),i},sync:function(t){t.then(this.fulfill,this.reject,this.notify,this)},_callCallbacks:function(t,e){var i=t.length;if(i){var o=this.isResolved(),r=this.isFulfilled();s(function(){for(var s,a,l,c=0;i>c;)if(s=t[c++],a=s.promise,l=s.fn){var d,u=s.ctx;try{d=u?l.call(u,e):l(e)}catch(h){a.reject(h);continue}o?n.isPromise(d)?function(t){d.then(function(e){t.fulfill(e)},function(e){t.reject(e)},function(e){t.notify(e)})}(a):a.fulfill(d):a.notify(d)}else o?r?a.fulfill(e):a.reject(e):a.notify(e)})}}};var i,n={Promise:e,promise:function(t){return arguments.length?n.isPromise(t)?t:new e(t):new e},when:function(t,e,i,s,o){return n.promise(t).then(e,i,s,o)},fail:function(t,e,s){return n.when(t,i,e,s)},always:function(t,e,i){return n.promise(t).always(e,i)},progress:function(t,e,i){return n.promise(t).progress(e,i)},spread:function(t,e,i,s){return n.promise(t).spread(e,i,s)},done:function(t,e,i,s,o){n.promise(t).done(e,i,s,o)},isPromise:function(t){return t&&r(t.then)},valueOf:function(t){return n.isPromise(t)?t.valueOf():t},isFulfilled:function(t){return n.isPromise(t)?t.isFulfilled():!0},isRejected:function(t){return n.isPromise(t)?t.isRejected():!1},isResolved:function(t){return n.isPromise(t)?t.isResolved():!0},fulfill:function(t){return n.when(t,i,function(t){return t})},reject:function(t){return n.when(t,function(t){var i=new e;return i.reject(t),i})},resolve:function(t){return n.isPromise(t)?t:n.when(t)},invoke:function(e){try{return n.promise(e.apply(t,a.call(arguments,1)))}catch(i){return n.reject(i)}},forEach:function(t,e,i,s){for(var o=s?s.length:t.length,r=0;o>r;)n.when(t[s?s[r]:r],e,i),++r},all:function(t){var i=new e,s=c(t),o=s?d(t):u(t),r=o.length,a=s?[]:{};if(!r)return i.fulfill(a),i;var l=r,h=function(){if(!--l){for(var e=0;r>e;)a[o[e]]=n.valueOf(t[o[e++]]);i.fulfill(a)}},p=function(t){i.reject(t)};return n.forEach(t,h,p,o),i},allResolved:function(t){var i=new e,s=c(t),o=s?d(t):u(t),r=o.length,a=s?[]:{};if(!r)return i.fulfill(a),i;var l=function(){--r||i.fulfill(t)};return n.forEach(t,l,l,o),i},allPatiently:function(t){return n.allResolved(t).then(function(){var e,i,s,o,r=c(t),a=r?d(t):u(t),l=a.length,h=0;if(!l)return r?[]:{};for(;l>h;)s=a[h++],o=t[s],n.isRejected(o)?(e||(e=r?[]:{}),r?e.push(o.valueOf()):e[s]=o.valueOf()):e||((i||(i=r?[]:{}))[s]=n.valueOf(o));if(e)throw e;return i})},any:function(t){var i=new e,s=t.length;if(!s)return i.reject(Error()),i;var o,r=0,a=function(t){i.fulfill(t)},l=function(t){r||(o=t),++r===s&&i.reject(o)};return n.forEach(t,a,l),i},delay:function(t,e){return n.promise(t).delay(e)},timeout:function(t,e){return n.promise(t).timeout(e)}},s=function(){var e=[],i=function(t){return 1===e.push(t)},n=function(){var t=e,i=0,n=e.length;for(e=[];n>i;)t[i++]()};if("function"==typeof setImmediate)return function(t){i(t)&&setImmediate(n)};if("object"==typeof process&&process.nextTick)return function(t){i(t)&&process.nextTick(n)};if(t.postMessage){var s=!0;if(t.attachEvent){var o=function(){s=!1};t.attachEvent("onmessage",o),t.postMessage("__checkAsync","*"),t.detachEvent("onmessage",o)}if(s){var r="__promise"+ +new Date,a=function(t){t.data===r&&(t.stopPropagation&&t.stopPropagation(),n())};return t.addEventListener?t.addEventListener("message",a,!0):t.attachEvent("onmessage",a),function(e){i(e)&&t.postMessage(r,"*")}}}var l=t.document;if("onreadystatechange"in l.createElement("script")){var c=function(){var t=l.createElement("script");t.onreadystatechange=function(){t.parentNode.removeChild(t),t=t.onreadystatechange=null,n()},(l.documentElement||l.body).appendChild(t)};return function(t){i(t)&&c()}}return function(t){i(t)&&setTimeout(n,0)}}(),o=function(t){s(function(){throw t})},r=function(t){return"function"==typeof t},a=Array.prototype.slice,l=Object.prototype.toString,c=Array.isArray||function(t){return"[object Array]"===l.call(t)},d=function(t){for(var e=[],i=0,n=t.length;n>i;)e.push(i++);return e},u=Object.keys||function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e},h=!0;"object"==typeof exports&&(module.exports=n,h=!1),"object"==typeof modules&&(modules.define("vow",function(t){t(n)}),h=!1),"function"==typeof define&&(define(function(t,e,i){i.exports=n}),h=!1),h&&(t.Vow=n)}(this),function(t){t.fn.prepareTransition=function(){return this.each(function(){var e=t(this);e.one("TransitionEnd webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd",function(){e.removeClass("is-transitioning")});var i=["transition-duration","-moz-transition-duration","-webkit-transition-duration","-o-transition-duration","-ms-transition-duration"],n=0;t.each(i,function(t,i){n=parseFloat(e.css(i))||n}),0!=n&&(e.addClass("is-transitioning"),e[0].offsetWidth)})}}(jQuery),function(){String.prototype.trim||(String.prototype.trim=function(){for(var t=this.replace(/^\s\s*/,""),e=/\s/,i=t.length;e.test(t.charAt(--i)););return t.slice(0,i+1)})}(),function(){var t=$.browser.msie&&$.browser.version<7,e={_hashBangRegEx:/\#!\//,_filter:[],_safeUnescapeParams:[],_validUrlRegEx:/^(([\w]+:)?\/\/)?(([\d\w]|%[a-fA-f\d]{2,2})+(:([\d\w]|%[a-fA-f\d]{2,2})+)?@)?([\d\w][-\d\w]{0,253}[\d\w]\.)+[\w]{2,4}(:[\d]+)?(\/([-+_~.\d\w]|%[a-fA-f\d]{2,2})*)*(\?(&?([-+_~.\d\w]|%[a-fA-f\d]{2,2})=?)*)?(#([-+_~.\d\w]|%[a-fA-f\d]{2,2})*)?$/,isValid:function(t){return this._validUrlRegEx.test(t)},isAbsolute:function(t){var e=(t||location.href).trim().toLowerCase();return/[a-z:]*\/\//.test(e)},getRoot:function(){return location.protocol+"//"+(location.hostname||location.host)+"/"},getPage:function(t){return t||(t=location.href),t+t.charAt(t.length-1)==="/"?"":"/"},getBasePage:function(t){return t||(t=location.href),this.clearHashSymbol(t).replace(/[^\/]+$/,"").replace(/\/+$/,"")+"/"},getFull:function(t){var i=t,n=t.charAt(0);if(!this.isAbsolute(t))switch(n){case"/":i=e.getRoot()+t.replace(/^\/+/,"");break;case"#":i=e.getPage().replace(/#.*/,"")+t;break;case"?":i=e.getPage().replace(/[\?#].*/,"")+t;break;default:i=e.getBasePage()+t.replace(/^(\.\/)+/,"")}return i.replace(/\#$/,"")},getShort:function(t){if(!t)return"/";if(!this.isAbsolute(t))return t;var i=t,n=(e.getBasePage(),e.getRoot());return i=i.replace(n,"/"),this.isTraditionalAnchor(i)&&(i="/"+i),i=i.replace(/^(\.\/)+/g,"./").replace(/\#$/,"").replace(e._hashBangRegEx,"").replace("//","/")},isTraditionalAnchor:function(t){return!/[\/\?\.]/.test(t)},setSafeUnescapeParams:function(t){t&&(this._safeUnescapeParams=t)},safeUnescape:function(t){t=t||location.href;var e=this.getParams(t,this._safeUnescapeParams);return t=this.unescape(this.delParams(t,this._safeUnescapeParams)),this.setParams(t,e)},unescape:function(t){for(var e,i=t;;){if(e=$.decodeURI(i),e===i)break;i=e}return i},unescapeHash:function(t){return e.unescape(e.normalizeHash(t))},normalizeHash:function(t){return t.replace(/[^#]*#!?/,"").replace(/#.*/,"")},getHash:function(t){return t||(t=location.href),/#/.test(t)||(t=""),e.unescapeHash(t)},setHash:function(t){location.hash=t.replace("#","")},escapeHash:function(i){var n=encodeURI(e.normalizeHash(i));return t||(n=n.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),n},clearHashSymbol:function(t){return(t||location.href).replace(this._hashBangRegEx,"")},parseParams:function(t){t||(t=location.href),t=this.clearHashSymbol(t);var e={};return t.indexOf("?&")>-1&&(t=t.replace(/\?&/g,"?")),(t=t.replace(/[^?]*\??/,""))&&t.replace(/(?:^|&|;)([^&=;]*)=?([^&;]*)/g,function(t,i,n){i&&(e[i]=n.replace(/\+/g," ")),~this._safeUnescapeParams.indexOf(i)||(e[i]=$.decodeURIComponent(e[i]))}.bind(this)),e},normalize:function(t){return(t||location.href).replace(/\+/g,"%20")},mergeFilters:function(t){return $.merge($.url._filter,t)},filter:function(t,e){"undefined"==typeof e&&t instanceof Array&&(e=t,t=location.href);var i=this.parseParams(t);return $.merge($.merge([],this._filter),e||[]).forEach(function(t){i[t]&&delete i[t]}),this.build(this.getPath(t),i)},build:function(t,e){if("undefined"==typeof e&&"object"==typeof t&&(e=t,t=location.href),!e||!Object.keys(e).length)return t;if(e=e instanceof Array?[].concat(e):$.extend({},e),this._safeUnescapeParams.length){var i="";this._safeUnescapeParams.forEach(function(t){e[t]&&(i+="&"+t+"="+e[t],delete e[t])}),e=$.param(e)+i}else e=$.param(e);return this.normalize(t+"?"+e)},getPath:function(t){return this.clearHashSymbol(t).match(/([^\?&]*)/)[0]},setParam:function(t,e,i){"undefined"==typeof e&&(e=t,t=location.href);var n=this.parseParams(t);return"undefined"==typeof i||""===i?delete n[e]:n[e]=i,this.build(this.getPath(t),n)},setParams:function(t,e){"object"==typeof t&&(e=t,t=location.href);var i=$.extend({},this.parseParams(t));return $.each(e,function(t,e){"undefined"==typeof e||""===e?delete i[t]:i[t]=e}),this.build(this.getPath(t),i)},delParam:function(t,e){return this.setParam(t,e)},delParams:function(t,e){"undefined"==typeof e&&"string"!=typeof t&&(e=t,t=location.href);var i={};return e.forEach(function(t){i[t]=""}),this.setParams(t,i)},clearFromParams:function(t){return this.getPath(t)},getParam:function(t,e){return"undefined"==typeof e&&"string"==typeof t&&(e=t,t=location.href),this.parseParams(t)[e]},getParams:function(t,e){"undefined"==typeof withoutDecoding&&"boolean"==typeof e&&t instanceof Array&&(withoutDecoding=e,e=t,t=location.href),e||(e=[]);var i=this.parseParams(t),n={};return e.forEach(function(t){n[t]=i[t]}),n},getAllParams:function(t){return this.parseParams(t)}};$.extend({url:e})}(),function(t){function e(t){return t.replace(/%.{2}/g,function(t){return n[t]||t})}function i(t,i){var n="";try{n=t(i)}catch(s){try{n=t(e(i))}catch(s){n=i}}return n}var n={"%D0":"%D0%A0","%C0":"%D0%90","%C1":"%D0%91","%C2":"%D0%92","%C3":"%D0%93","%C4":"%D0%94","%C5":"%D0%95","%A8":"%D0%81","%C6":"%D0%96","%C7":"%D0%97","%C8":"%D0%98","%C9":"%D0%99","%CA":"%D0%9A","%CB":"%D0%9B","%CC":"%D0%9C","%CD":"%D0%9D","%CE":"%D0%9E","%CF":"%D0%9F","%D1":"%D0%A1","%D2":"%D0%A2","%D3":"%D0%A3","%D4":"%D0%A4","%D5":"%D0%A5","%D6":"%D0%A6","%D7":"%D0%A7","%D8":"%D0%A8","%D9":"%D0%A9","%DA":"%D0%AA","%DB":"%D0%AB","%DC":"%D0%AC","%DD":"%D0%AD","%DE":"%D0%AE","%DF":"%D0%AF","%E0":"%D0%B0","%E1":"%D0%B1","%E2":"%D0%B2","%E3":"%D0%B3","%E4":"%D0%B4","%E5":"%D0%B5","%B8":"%D1%91","%E6":"%D0%B6","%E7":"%D0%B7","%E8":"%D0%B8","%E9":"%D0%B9","%EA":"%D0%BA","%EB":"%D0%BB","%EC":"%D0%BC","%ED":"%D0%BD","%EE":"%D0%BE","%EF":"%D0%BF","%F0":"%D1%80","%F1":"%D1%81","%F2":"%D1%82","%F3":"%D1%83","%F4":"%D1%84","%F5":"%D1%85","%F6":"%D1%86","%F7":"%D1%87","%F8":"%D1%88","%F9":"%D1%89","%FA":"%D1%8A","%FB":"%D1%8B","%FC":"%D1%8C","%FD":"%D1%8D","%FE":"%D1%8E","%FF":"%D1%8F"};t.extend({decodeURI:function(t){return i(decodeURI,t)},decodeURIComponent:function(t){return i(decodeURIComponent,t)}})}(jQuery),function(t,e,i){"$:nomunge";function n(t){return t=t||location.href,"#"+t.replace(/^[^#]*#?(.*)$/,"$1")}var s,o="hashchange",r=document,a=t.event.special,l=r.documentMode,c="on"+o in e&&(l===i||l>7);t.fn[o]=function(t){return t?this.bind(o,t):this.trigger(o)},t.fn[o].delay=50,a[o]=t.extend(a[o],{setup:function(){return c?!1:(t(s.start),void 0)},teardown:function(){return c?!1:(t(s.stop),void 0)}}),s=function(){function s(){var i=n(),r=p(d);i!==d?(h(d=i,r),t(e).trigger(o)):r!==d&&(location.href=location.href.replace(/#.*/,"")+r),a=setTimeout(s,t.fn[o].delay)}var a,l={},d=n(),u=function(t){return t},h=u,p=u;return l.start=function(){a||s()},l.stop=function(){a&&clearTimeout(a),a=i},t.browser.msie&&!c&&function(){var e,i;l.start=function(){e||(i=t.fn[o].src,i=i&&i+n(),e=t('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){i||h(n()),s()}).attr("src",i||"javascript:0").insertAfter("body")[0].contentWindow,r.onpropertychange=function(){try{"title"===event.propertyName&&(e.document.title=r.title)}catch(t){}})},l.stop=u,p=function(){return n(e.location.href)},h=function(i,n){var s=e.document,a=t.fn[o].domain;i!==n&&(s.title=r.title,s.open(),a&&s.write('<script>document.domain="'+a+'"</script>'),s.close(),e.location.hash=i)}}(),l}()}(jQuery,this),function(t,e,i){"use strict";var n=t.console||i,s=t.document,o=s.location,r=t.navigator,a=e(t),l=t.History=t.History||{},c=t.history,d="#!";l.options=l.options||{},l.options.safariPollInterval=l.options.safariPollInterval||500,l.options.doubleCheckInterval=l.options.doubleCheckInterval||500,l.options.busyDelay=l.options.busyDelay||250,l.options.debug=l.options.debug||!1,l.intervalList=[],l.clearAllIntervals=function(){var t,e,i=l.intervalList;for(t=0,e=i.length;e>t;t++)clearInterval(i[t]);l.intervalList=[]},l.debug=function(){l.options.debug&&l.log.apply(l,arguments)},l.log=function(){var t=Array.prototype.slice.call(arguments),e=t.shift();return n.log(e," ",t),!0},l.browserVersion=function(){return e.browser.version},l.isMSIE=function(){return e.browser.msie},l.emulated={pushState:!Boolean(t.history&&t.history.pushState&&t.history.replaceState&&!(/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(r.userAgent)||/AppleWebKit\/5([0-2]|3[0-2])/i.test(r.userAgent)||/Bada\/([\d.]+)/i.test(r.userAgent)||/iPad.*OS\s5_/i.test(r.userAgent))),hashChange:Boolean(!("onhashchange"in t||"onhashchange"in s)||l.isMSIE()&&l.browserVersion()<8)},l.enabled=!l.emulated.pushState,l.bugs={setHash:Boolean(!l.emulated.pushState&&"Apple Computer, Inc."===r.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(r.userAgent)),safariPoll:Boolean(!l.emulated.pushState&&"Apple Computer, Inc."===r.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(r.userAgent)),ieDoubleCheck:Boolean(l.isMSIE()&&l.browserVersion()<8)},l.cloneObject=function(t){return t?e.extend({},t):{}},l.store={},l.idToState=l.idToState||{},l.stateToId=l.stateToId||{},l.urlToId=l.urlToId||{},l.storedStates=l.storedStates||[],l.savedStates=l.savedStates||[],l.normalizeStore=function(){l.store.idToState=l.store.idToState||{},l.store.urlToId=l.store.urlToId||{},l.store.stateToId=l.store.stateToId||{}},l.getState=function(t,e){var i=l.getLastSavedState();return"undefined"==typeof t&&(t=!0),"undefined"==typeof e&&(e=!0),!i&&e&&(i=l.createStateObject()),t&&(i=l.cloneObject(i)),i},l.getIdByState=function(t){var e,i=l.getStateString(t);if("undefined"!=typeof l.stateToId[i])e=l.stateToId[i];else if("undefined"!=typeof l.store.stateToId[i])e=l.store.stateToId[i];else for(;;)if(e=(new Date).getTime()+(""+Math.random()).replace(/\D/g,""),"undefined"==typeof l.idToState[e]&&"undefined"==typeof l.store.idToState[e])break;return e},l.normalizeState=function(t){var i;return t&&"object"==typeof t||(t={}),"undefined"!=typeof t.normalized?t:(t.data&&"object"==typeof t.data||(t.data={}),i={},i.normalized=!0,i.title=t.title||"",i.url=e.url.safeUnescape(e.url.getFull(t.url||o.href)),i.hash=e.url.getShort(i.url),i.data=l.cloneObject(t.data),i.id=l.getIdByState(i),(l.emulated.pushState||l.bugs.safariPoll)&&l.hasUrlDuplicate(i)&&(i.url=e.url.safeUnescape(e.url.getFull(i.hash))),i)},l.createStateObject=function(t,e,i){return l.normalizeState({data:t,title:e,url:i})},l.getStateById=function(t){return l.idToState[t]||l.store.idToState[t]||i},l.getStateString=function(t){return JSON.stringify({data:t.data,title:t.title,url:t.url})},l.getStateId=function(t){return l.getNormalizedData(t,"id")},l.getStateByIndex=function(t){var e=null;return e="undefined"==typeof t?l.savedStates[l.savedStates.length-1]:0>t?l.savedStates[l.savedStates.length+t]:l.savedStates[t]},l.getHashByState=function(t){return l.getNormalizedData(t,"hash")},l.getNormalizedData=function(t,e){return l.normalizeState(t)[e]},l.saveInitialState=function(){var t=l.extractState(e.url.safeUnescape(o.href),!0);l.storeState(t).saveState(t)},l.extractState=function(t,i){var n,s,o;return i=i||!1,o=e.url.getFull(t),s=l.getIdByUrl(o),s&&(n=l.getStateById(s)),n||!i||e.url.isTraditionalAnchor(t)||(n=l.createStateObject(null,null,o)),n},l.extractEventData=function(t,e,n){return e&&e.originalEvent&&e.originalEvent[t]||n&&n[t]||i},l.getIdByUrl=function(t){return l.urlToId[t]||l.store.urlToId[t]||i},l.getLastSavedState=function(){return l.savedStates[l.savedStates.length-1]||i},l.getLastStoredState=function(){return l.storedStates[l.storedStates.length-1]||i},l.hasUrlDuplicate=function(t){var e,i;return i=l.extractState(t.url),e=i&&i.id!==t.id},l.storeState=function(t){var e=l.cloneObject(t);return l.stateToId[l.getStateString(t)]=t.id,l.urlToId[t.url]=t.id,l.idToState[t.id]=e,l.storedStates.push(e),l},l.isLastSavedState=function(t){var e,i,n,s=!1;return l.savedStates.length&&(e=t.id,i=l.getLastSavedState(),n=i.id,s=e===n),s},l.saveState=function(t){return l.isLastSavedState(t)?!1:(l.savedStates.push(l.cloneObject(t)),!0)},l.setHash=function(t,i){var n,s;return i!==!1&&l.busy()?(l._queue("setHash",args,i),!1):(l.debug("History.setHash: called",t),n=e.url.unescapeHash(t),l.busy(!0),s=l.extractState(t,!0),s&&!l.emulated.pushState?(l.debug("History.setHash: Hash is a state so skipping the hash set with a direct pushState call",arguments),l.pushState(s.data,s.title,s.url,!1)):o.hash!==n&&(l.bugs.setHash?l.pushState(null,null,e.url.getPage()+d+n,!1):e.url.setHash(d+n)),l)},l.queues=[],l.busy=function(t){var e=l.options.busyDelay,i=l.queues;if("undefined"!=typeof t?l.debug("History.busy: changing ["+(l.busy.flag||!1)+"] to ["+(t||!1)+"]",i.length):"undefined"==typeof l.busy.flag&&(t=!1),l.busy.flag=t,!l.busy.flag){clearTimeout(l.busy.timeout);var n=function(){var t,s;if(!l.busy.flag)for(t=i.length-1;t>=0;--t)s=i[t],s.length&&(l.fireQueueItem(s.shift()),l.busy.timeout=setTimeout(n,e))};l.busy.timeout=setTimeout(n,e)}return l.busy.flag},l.busy.flag=!1,l.fireQueueItem=function(t){return t.callback.apply(t.scope||l,t.args||[])},l.pushQueue=function(t){var e=t.queue||0;return l.queues[e]||(l.queues[e]=[]),l.queues[e].push(t),l},l.queue=function(t,e){return"function"==typeof t&&(t={callback:t}),"undefined"!=typeof e&&(t.queue=e),l.busy()?l.pushQueue(t):l.fireQueueItem(t),l},l._queue=function(t,e,i){l.debug("History."+t+": we must wait",arguments),l.pushQueue({scope:l,callback:l[t],args:e,queue:i})},l.clearQueue=function(){return l.busy.flag=!1,l.queues=[],l},l.stateChanged=!1,l.doubleChecker=!1,l.doubleCheckComplete=function(){return l.stateChanged=!0,l.doubleCheckClear(),l},l.doubleCheckClear=function(){return l.doubleChecker&&(clearTimeout(l.doubleChecker),l.doubleChecker=!1),l},l.doubleCheck=function(t){return l.stateChanged=!1,l.doubleCheckClear(),l.bugs.ieDoubleCheck&&(l.doubleChecker=setTimeout(function(){return l.doubleCheckClear(),l.stateChanged||(l.debug("History.doubleCheck: State has not yet changed, trying again",arguments),t()),!0},l.options.doubleCheckInterval)),l},l.safariStatePoll=function(){var t=l.extractState(o.href);l.isLastSavedState(t)||(t||(l.debug("History.safariStatePoll: new"),l.createStateObject()),l.debug("History.safariStatePoll: trigger"),a.trigger("popstate"))},l.onPopState=function(t,e){var i,n=!1;return l.doubleCheckComplete(),i=l.extractEventData("state",t,e),n=i?l.getStateById(i):l.expectedStateId?l.getStateById(l.expectedStateId):l.extractState(o.href),n||(n=l.createStateObject(null,null,o.href)),l.expectedStateId=!1,l.isLastSavedState(n)?(l.debug("History.onPopState: no change",n,l.savedStates),l.busy(!1),!1):(l.storeState(n),l.saveState(n),a.trigger("statechange"),l.busy(!1),!0)},l.replaceState=function(t,e,i,n){return l.methodState("replaceState",t,e,i,n)},l.pushState=function(t,e,i,n){return l.methodState("pushState",t,e,i,n)},l.methodState=function(t,i,n,s,o){if(l.debug("History."+t+" : called",arguments),e.url.getHash(s)&&l.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(o!==!1&&l.busy())return l._queue(t,args,o),!1;l.busy(!0);var r=l.createStateObject(i,n,s);return l.isLastSavedState(r)?l.busy(!1):(l.storeState(r),l.expectedStateId=r.id,c[t](r.id,r.title,r.url),a.trigger("popstate")),!0},l.init=function(){l.emulated.pushState?(l.pushState=l.pushState||e.noop,l.replaceState=l.replaceState||e.noop):a.bind("popstate",l.onPopState),l.store={},l.normalizeStore(),a.bind("beforeunload unload",l.clearAllIntervals),l.saveInitialState(),l.emulated.pushState||(l.bugs.safariPoll&&l.intervalList.push(setInterval(l.safariStatePoll,l.options.safariPollInterval)),("Apple Computer, Inc."===r.vendor||"Mozilla"===(r.appCodeName||""))&&(a.bind("hashchange",function(){a.trigger("popstate")
}),e.url.getHash()&&e(function(){a.trigger("hashchange")})))},l.init()}(window,jQuery),function(t){"use strict";var e=t.WikiHistory=t.WikiHistory||{};e._getCorrectPath=function(){var e=t.location.pathname.split("/"),i=e.pop();return/^\./.test(i)?e.join("/"):t.location.pathname},e._pushState=function(e){var i=t.location.pathname,n=i.split("/"),s=n.pop();/^\./.test(s)?(n=n.join("/"),History.pushState(null,null,n+"/"+e)):""===s?History.pushState(null,null,i+e):History.pushState(null,null,i+"/"+e)},e._removeState=function(){{var e=t.location.pathname,i=e.split("/");i.pop()}History.replaceState(null,null,i.join("/"))},e._hasState=function(t){var e=History.storedStates,i=e.length,n=e[i-1].hash,s=/([.]\S+)\?/g.exec(n);return s&&s[1]===t?!0:!1},e._setPreviousState=function(){var e=History.storedStates,i=e.length,n=null,s=null,o=t.location.pathname.split("/").pop();i>2?(n=e[i-4],s=n.hash.split("/").pop(),-1!==s.indexOf(".")&&o!==s?this._pushState(n.hash.split("/").pop()):this._removeState()):this._removeState()},e._parseQueryParams=function(){var e,i=t.location.search;return i?(e=t.location.search.replace("?",'"').replace(/[&]/g,'","').replace(/[=]/g,'":"').replace(/[\w]+S/g,'"')+'"',JSON.parse("{"+e+"}")):null},e._clearUrl=function(){this._pushState("")},e._getRoute=function(i){var n,s,o,r=t.location.pathname,a=r.split("/.");a.length>1?(n=e._parseQueryParams(),s=i._routes["."+a[1]],s&&(o=i.findBlockInside(s)||BEM.blocks[s],o&&o.onURL(n,i))):(i.hasMod("editor","visible")&&i.delMod("editor"),i.setMod("revision",""))}}(window,jQuery),jQuery.cookie=function(t,e,i){if("undefined"==typeof e){var n=null;if(document.cookie&&""!=document.cookie)for(var s=document.cookie.split(";"),o=0;o<s.length;o++){var r=jQuery.trim(s[o]);if(r.substring(0,t.length+1)==t+"="){n=decodeURIComponent(r.substring(t.length+1));break}}return n}i=i||{},null===e&&(e="",i.expires=-1);var a="";if(i.expires&&("number"==typeof i.expires||i.expires.toUTCString)){var l;"number"==typeof i.expires?(l=new Date,l.setTime(l.getTime()+24*i.expires*60*60*1e3)):l=i.expires,a="; expires="+l.toUTCString()}var c=i.path?"; path="+i.path:"",d=i.domain?"; domain="+i.domain:"",u=i.secure?"; secure":"";document.cookie=[t,"=",encodeURIComponent(e),a,c,d,u].join("")},function(t,e){if(!t.jQuery){{var i=function(t,e){return new i.fn.init(t,e)},n=Object.prototype.toString,s=Object.prototype.hasOwnProperty;Array.prototype.push,Array.prototype.slice,Array.prototype.indexOf}i.fn=i.prototype={init:function(){return this}},i.fn.init.prototype=i.fn,i.Event=function(t,e){return this instanceof i.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||t.returnValue===!1||t.getPreventDefault&&t.getPreventDefault()?returnTrue:returnFalse):this.type=t,e&&i.extend(this,e),this.timeStamp=t&&t.timeStamp||i.now(),this[i.expando]=!0,void 0):new i.Event(t,e)},i.extend=i.fn.extend=function(){var t,n,s,o,r=arguments[0]||{},a=1,l=arguments.length,c=!1;for("boolean"==typeof r&&(c=r,r=arguments[1]||{},a=2),"object"==typeof r||i.isFunction(r)||(r={}),l===a&&(r=this,--a);l>a;a++)if(null!=(t=arguments[a]))for(n in t)if(s=r[n],o=t[n],r!==o)if(c&&o&&(i.isPlainObject(o)||i.isArray(o))){var d=s&&(i.isPlainObject(s)||i.isArray(s))?s:i.isArray(o)?[]:{};r[n]=i.extend(c,d,o)}else o!==e&&(r[n]=o);return r},i.extend({isFunction:function(t){return"[object Function]"===n.call(t)},isArray:function(t){return"[object Array]"===n.call(t)},isPlainObject:function(t){if(!t||"[object Object]"!==n.call(t)||t.nodeType||t.setInterval)return!1;if(t.constructor&&!s.call(t,"constructor")&&!s.call(t.constructor.prototype,"isPrototypeOf"))return!1;var i;for(i in t);return i===e||s.call(t,i)},isEmptyObject:function(t){for(var e in t)return!1;return!0},each:function(t,n,s){var o,r=0,a=t.length,l=a===e||i.isFunction(t);if(s)if(l){for(o in t)if(n.apply(t[o],s)===!1)break}else for(;a>r&&n.apply(t[r++],s)!==!1;);else if(l){for(o in t)if(n.call(t[o],o,t[o])===!1)break}else for(var c=t[0];a>r&&n.call(c,r,c)!==!1;c=t[++r]);return t},inArray:function(t,e){if(e.indexOf)return e.indexOf(t);for(var i=0,n=e.length;n>i;i++)if(e[i]===t)return i;return-1},merge:function(t,i){var n=t.length,s=0;if("number"==typeof i.length)for(var o=i.length;o>s;s++)t[n++]=i[s];else for(;i[s]!==e;)t[n++]=i[s++];return t.length=n,t},grep:function(t,e,i){for(var n=[],s=0,o=t.length;o>s;s++)!i!=!e(t[s],s)&&n.push(t[s]);return n},now:function(){return(new Date).getTime()},map:function(t,e,i){for(var n,s=[],o=0,r=t.length;r>o;o++)n=e(t[o],o,i),null!=n&&(s[s.length]=n);return s.concat.apply([],s)},browser:{},event:{special:{}}}),t.jQuery=t.$=i}}(function(){return this}()),function(t){function e(e,n,s){var r=!1;if(o){var a=[];t.each(l,function(){s.hasOwnProperty(this)&&(r=!0)&&a.push({name:this,val:s[this]})}),r&&(t.each(s,function(t){a.push({name:t,val:this})}),s=a)}t.each(s,function(s,o){if(r&&(s=o.name,o=o.val),t.isFunction(o)&&(!i||o.toString().indexOf(".__base")>-1)){var a=e[s]||function(){};n[s]=function(){var t=this.__base;this.__base=a;var e=o.apply(this,arguments);return this.__base=t,e}}else n[s]=o})}var i=function(){"_"}.toString().indexOf("_")>-1,n=function(){},s=Object.create||function(t){var e=function(){};return e.prototype=t,new e},o=!0,r={toString:""};for(var a in r)r.hasOwnProperty(a)&&(o=!1);var l=o?["toString","valueOf"]:null;t.inherit=function(){var i=arguments,o=t.isFunction(i[0]),r=o?i[0]:n,a=i[o?1:0]||{},l=i[o?2:1],c=a.__constructor||o&&r.prototype.__constructor?function(){return this.__constructor.apply(this,arguments)}:function(){};if(!o)return c.prototype=a,c.prototype.__self=c.prototype.constructor=c,t.extend(c,l);t.extend(c,r);var d=r.prototype,u=c.prototype=s(d);return u.__self=u.constructor=c,e(d,u,a),l&&e(r,c,l),c},t.inheritSelf=function(t,i,n){var s=t.prototype;return e(s,s,i),n&&e(t,t,n),t}}(jQuery),function(t){var e=0,i="__"+ +new Date,n=function(){return"uniq"+ ++e};t.identify=function(t,e){if(!t)return n();var s="uniqueID"in t?"uniqueID":i;return e||s in t?t[s]:t[s]=n()}}(jQuery),function(t){t.isEmptyObject||(t.isEmptyObject=function(t){for(var e in t)return!1;return!0})}(jQuery),function(t){t.extend({debounce:function(t,e,i,n){3==arguments.length&&"boolean"!=typeof i&&(n=i,i=!1);var s;return function(){var o=arguments;n=n||this,i&&!s&&t.apply(n,o),clearTimeout(s),s=setTimeout(function(){i||t.apply(n,o),s=null},e)}},throttle:function(t,e,i){var n,s,o;return function(){s=arguments,o=!0,i=i||this,n||function(){o?(t.apply(i,s),o=!1,n=setTimeout(arguments.callee,e)):n=null}()}}})}(jQuery),function(t){var e="__"+ +new Date+"storage",i=function(e,i){return t.identify(e)+(i?t.identify(i):"")},n={buildEventName:function(t){return t},on:function(n,s,o,r,a){if("string"==typeof n){t.isFunction(s)&&(r=o,o=s,s=void 0);for(var l,c=i(o,r),d=this[e]||(this[e]={}),u=n.split(" "),h=0;n=u[h++];)if(n=this.buildEventName(n),l=d[n]||(d[n]={ids:{},list:{}}),!(c in l.ids)){var p=l.list,m={fn:o,data:s,ctx:r,special:a};p.last?(p.last.next=m,m.prev=p.last):p.first=m,l.ids[c]=p.last=m}}else{var f=this;t.each(n,function(t,e){f.on(t,e,s,a)})}return this},onFirst:function(t,e,i,n){return this.on(t,e,i,n,{one:!0})},un:function(n,s,o){if("string"==typeof n||"undefined"==typeof n){var r=this[e];if(r)if(n){for(var a,l=n.split(" "),c=0;n=l[c++];)if(n=this.buildEventName(n),a=r[n])if(s){var d=i(s,o),u=a.ids;if(d in u){var h=a.list,p=u[d],m=p.prev,f=p.next;m?m.next=f:p===h.first&&(h.first=f),f?f.prev=m:p===h.last&&(h.last=m),delete u[d]}}else delete this[e][n]}else delete this[e]}else{var _=this;t.each(n,function(t,e){_.un(t,e,o)})}return this},trigger:function(i,n){var s,o=this,r=o[e];if("string"==typeof i?i=t.Event(o.buildEventName(s=i)):i.type=o.buildEventName(s=i.type),i.target||(i.target=o),r&&(r=r[i.type]))for(var a,l=r.list.first;l;)i.data=l.data,a=l.fn.call(l.ctx||o,i,n),"undefined"!=typeof a&&(i.result=a,a===!1&&(i.preventDefault(),i.stopPropagation())),l.special&&l.special.one&&o.un(s,l.fn,l.ctx),l=l.next;return this}};t.observable=t.inherit(n,n)}(jQuery),function(t,e){function i(t,e,i){return(t?"__elem_"+t:"")+"__mod"+(e?"_"+e:"")+(i?"_"+i:"")}function n(e,n,s){t.isFunction(e)?n[i(s,"*","*")]=e:t.each(e,function(e,o){t.isFunction(o)?n[i(s,e,"*")]=o:t.each(o,function(t,o){n[i(s,e,t)]=o})})}function s(t,e){return e?Array.isArray(e)?function(i){for(var n=0,s=e.length;s>n;)if(i.hasMod(t,e[n++]))return!0;return!1}:function(i){return i.hasMod(t,e)}:function(e){return e.hasMod(t)}}var o=[],r={},a={};this.BEM=t.inherit(t.observable,{__constructor:function(t,e,i){var n=this;n._modCache=t||{},n._processingMods={},n._params=e,n.params=null,i!==!1?n._init():n.afterCurrentEvent(function(){n._init()})},_init:function(){return this._initing||this.hasMod("js","inited")||(this._initing=!0,this.params||(this.params=t.extend(this.getDefaultParams(),this._params),delete this._params),this.setMod("js","inited"),delete this._initing,this.hasMod("js","inited")&&this.trigger("init")),this},changeThis:function(t,e){return t.bind(e||this)},afterCurrentEvent:function(t,e){this.__self.afterCurrentEvent(this.changeThis(t,e))},trigger:function(t,e){return this.__base(t=this.buildEvent(t),e).__self.trigger(t,e),this},buildEvent:function(e){return"string"==typeof e&&(e=t.Event(e)),e.block=this,e},hasMod:function(t,i,n){var s=arguments.length,o=!1;1==s?(n="",i=t,t=e,o=!0):2==s&&("string"==typeof t?(n=i,i=t,t=e):(n="",o=!0));var r=this.getMod(t,i)===n;return o?!r:r},getMod:function(t,e){var i=typeof t;if("string"===i||"undefined"===i){e=t||e;var n=this._modCache;return e in n?n[e]:n[e]=this._extractModVal(e)}return this._getElemMod(e,t)},_getElemMod:function(t,e,i){return this._extractModVal(t,e,i)},getMods:function(t){var i=t&&"string"!=typeof t,n=this,s=[].slice.call(arguments,i?1:0),o=n._extractMods(s,i?t:e);return i||(s.length?s.forEach(function(t){n._modCache[t]=o[t]}):n._modCache=o),o},setMod:function(i,n,s){"undefined"==typeof s&&(s=n,n=i,i=e);var o=this;if(!i||i[0]){var r=(i&&i[0]?t.identify(i[0]):"")+"_"+n;if(this._processingMods[r])return o;var a,l=i?o._getElemMod(n,i,a=o.__self._extractElemNameFrom(i)):o.getMod(n);if(l===s)return o;this._processingMods[r]=!0;var c=!0,d=[n,s,l];i&&d.unshift(i),[["*","*"],[n,"*"],[n,s]].forEach(function(t){c=o._callModFn(a,t[0],t[1],d)!==!1&&c}),!i&&c&&(o._modCache[n]=s),c&&o._afterSetMod(n,s,l,i,a),delete this._processingMods[r]}return o},_afterSetMod:function(){},toggleMod:function(t,i,n,s,o){"string"==typeof t&&(o=s,s=n,n=i,i=t,t=e),"undefined"==typeof s?s="":"boolean"==typeof s&&(o=s,s="");var r=this.getMod(t,i);return(r==n||r==s)&&this.setMod(t,i,"boolean"==typeof o?o?n:s:this.hasMod(t,i,n)?s:n),this},delMod:function(t,i){return i||(i=t,t=e),this.setMod(t,i,"")},_callModFn:function(t,n,s,o){var r=i(t,n,s);return this[r]?this[r].apply(this,o):e},_extractModVal:function(){return""},_extractMods:function(){return{}},channel:function(t,e){return this.__self.channel(t,e)},getDefaultParams:function(){return{}},del:function(t){var e=[].slice.call(arguments);return"string"==typeof t&&e.unshift(this),this.__self.del.apply(this.__self,e),this},destruct:function(){}},{_name:"i-bem",blocks:r,decl:function(i,o,a){if("string"==typeof i?i={block:i}:i.name&&(i.block=i.name),i.baseBlock&&!r[i.baseBlock])throw'baseBlock "'+i.baseBlock+'" for "'+i.block+'" is undefined';o||(o={}),o.onSetMod&&(n(o.onSetMod,o),delete o.onSetMod),o.onElemSetMod&&(t.each(o.onElemSetMod,function(t,e){n(e,o,t)}),delete o.onElemSetMod);var l=r[i.baseBlock||i.block]||this;if(i.modName){var c=s(i.modName,i.modVal);t.each(o,function(i,n){t.isFunction(n)&&(o[i]=function(){var t;if(c(this))t=n;else{var s=l.prototype[i];s&&s!==o[i]&&(t=this.__base)}return t?t.apply(this,arguments):e})})}if(a&&"boolean"==typeof a.live){var d=a.live;a.live=function(){return d}}var u;return i.block==l._name?(u=t.inheritSelf(l,o,a))._processLive(!0):((u=r[i.block]=t.inherit(l,o,a))._name=i.block,delete u._liveInitable),u},_processLive:function(){return!1},create:function(t,e){return"string"==typeof t&&(t={block:t}),new r[t.block](t.mods,e)},getName:function(){return this._name},_extractElemNameFrom:function(){},afterCurrentEvent:function(t,e){1==o.push({fn:t,ctx:e})&&setTimeout(this._runAfterCurrentEventFns,0)},_runAfterCurrentEventFns:function(){var t=o.length;if(t)for(var e,i=o.splice(0,t);e=i.shift();)e.fn.call(e.ctx||this)},changeThis:function(t,e){return t.bind(e||this)},del:function(t){var e="string"==typeof t,i=e?0:1,n=arguments.length;for(e&&(t=this);n>i;)delete t[arguments[i++]];return this},channel:function(i,n){return"boolean"==typeof i&&(n=i,i=e),i||(i="default"),n?(a[i]&&(a[i].un(),delete a[i]),void 0):a[i]||(a[i]=new t.observable)}})}(jQuery),function(){Object.keys||(Object.keys=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e})}(),function(){var t=Array.prototype,e=Object.prototype.toString,i={indexOf:function(t,e){e=+(e||0);var i=this,n=i.length;if(n>0&&n>e)for(e=0>e?Math.ceil(e):Math.floor(e),-n>e&&(e=0),0>e&&(e+=n);n>e;){if(e in i&&i[e]===t)return e;++e}return-1},forEach:function(t,e){for(var i=-1,n=this,s=n.length;++i<s;)i in n&&(e?t.call(e,n[i],i,n):t(n[i],i,n))},map:function(t,e){for(var i=-1,n=this,s=n.length,o=new Array(s);++i<s;)i in n&&(o[i]=e?t.call(e,n[i],i,n):t(n[i],i,n));return o},filter:function(t,e){for(var i=-1,n=this,s=n.length,o=[];++i<s;)i in n&&(e?t.call(e,n[i],i,n):t(n[i],i,n))&&o.push(n[i]);return o},reduce:function(t,e){var i,n=-1,s=this,o=s.length;if(arguments.length<2){for(;++n<o;)if(n in s){i=s[n];break}}else i=e;for(;++n<o;)n in s&&(i=t(i,s[n],n,s));return i},some:function(t,e){for(var i=-1,n=this,s=n.length;++i<s;)if(i in n&&(e?t.call(e,n[i],i,n):t(n[i],i,n)))return!0;return!1},every:function(t,e){for(var i=-1,n=this,s=n.length;++i<s;)if(i in n&&!(e?t.call(e,n[i],i,n):t(n[i],i,n)))return!1;return!0}};for(var n in i)t[n]||(t[n]=i[n]);Array.isArray||(Array.isArray=function(t){return"[object Array]"===e.call(t)})}(),function(){var t=Array.prototype.slice;Function.prototype.bind||(Function.prototype.bind=function(e){var i=this,n=t.call(arguments,1);return function(){return i.apply(e,n.concat(t.call(arguments)))}})}(),function(t,e,i){function n(t,e,i){i.push(r,t,r,e)}function s(t,e,i,s){s.push(t),i&&n(e,i,s)}function o(t,e,o,r,l){s(t,i,i,l),l.push(a,e),r&&n(o,r,l)}var r="_",a="__",l="[a-zA-Z0-9-]+";t.INTERNAL={NAME_PATTERN:l,MOD_DELIM:r,ELEM_DELIM:a,buildModPostfix:function(t,e,i){var s=i||[];return n(t,e,s),i?s:s.join("")},buildClass:function(t,e,n,r,a){var l=typeof n;if("string"==l?"string"!=typeof r&&"number"!=typeof r&&(a=r,r=n,n=e,e=i):"undefined"!=l?(a=n,n=i):e&&"string"!=typeof e&&(a=e,e=i),!(e||n||a))return t;var c=a||[];return e?o(t,e,n,r,c):s(t,n,r,c),a?c:c.join("")},buildClasses:function(t,n,r,a){n&&"string"!=typeof n&&(a=r,r=n,n=i);var l=a||[];return n?o(t,n,i,i,l):s(t,i,i,l),r&&e.each(r,function(e,i){i&&(l.push(" "),n?o(t,n,e,i,l):s(t,e,i,l))}),a?l:l.join("")}}}(BEM,jQuery),function(t){function e(t){return t.replace(/^(?:https?:)?\/\//,"")}t||(t=window.Lego={}),!t.params&&(t.params={}),t.c=function(t,i,n){var s=e(n&&n.host||BEM.blocks["i-global"].param("click-host")||"clck.yandex.ru"),o=function(t,e,i,n){return e=e.replace("'","%27"),e.indexOf("/dtype=")>-1?e:location.protocol+"//"+s+"/"+i+"/dtype="+t+"/rnd="+((new Date).getTime()+Math.round(100*Math.random()))+(n?"/*"+(e.match(/^http/)?e:location.protocol+"//"+location.host+(e.match("^/")?e:"/"+e)):"/*data="+encodeURIComponent("url="+encodeURIComponent(e.match(/^http/)?e:location.protocol+"//"+location.host+(e.match("^/")?e:"/"+e))))},r=function(){var e=document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0],i=document.createElement("script");i.setAttribute("src",o(t,location.href,"jclck")),e.insertBefore(i,e.firstChild)};if(i)if(i.className.match(/b-link_pseudo_yes/)||i.href&&i.href.match(/^mailto:/)||n&&n.noRedirect===!0)r();else if(i.href){var a=i.href;i.href=o(t,a,"redir"),setTimeout(function(){i.href=a},500)}else if(i.form)if(i.type.match(/submit|button|image/)){var a=i.form.action;i.form.action=o(t,a,"redir",!0),setTimeout(function(){i.form.action=a},500)}else r();else{if(!i.action)throw"counter.js: not link and not form!";i.action=o(t,i.action,"redir",!0)}else r()}}(window.Lego),function(t,e){t||(t=window.Lego={}),t.cp=function(i,n,s,o,r,a){"string"==typeof o||(a=r,r=o,o=e),t.c("stred/pid="+i+"/cid="+n+(s?"/path="+s+(o?"/vars="+o:""):""),r,a)}}(window.Lego),function(t){t||(t=window.Lego={}),t.ch=function(e,i,n){BEM.blocks["i-global"].param("show-counters")&&t.cp(0,2219,e,i,n)}}(window.Lego),function(t){t||(t=window.Lego={}),t.getCookie=function(t){var e=document.cookie;if(e.length<1)return!1;var i=e.indexOf(t+"=");if(-1==i)return!1;i+=t.length+1;var n=e.indexOf(";",i);return decodeURIComponent(-1==n?e.substring(i):e.substring(i,n))}}(window.Lego),function(t){t||(t=window.Lego={}),t.isSessionValid=function(){return!!t.getCookie("yandex_login")}}(window.Lego),function(t,e){e||(e=window.Lego={}),e.init||(e.init=function(i){return(i=e.params=t.extend({id:"",login:e.isSessionValid()?e.getCookie("yandex_login")||"":"",yandexuid:e.getCookie("yandexuid"),locale:"ru",retpath:window.location.toString(),"passport-host":"//passport.yandex.ru","pass-host":"//pass.yandex.ru","passport-msg":i.id,"social-host":"//social.yandex.ru","lego-path":"/lego","show-counters-percent":100},i,e.params))["show-counters"]=Math.round(100*Math.random())<=i["show-counters-percent"],BEM.blocks["i-global"]._params||t.extend(BEM.blocks["i-global"]._params={},i),t(function(){i.oframebust&&e.oframebust(i.oframebust)}),i}),e.block||(e.block={}),e.blockInit||(e.blockInit=function(i,n){i=i||document,n=n||".g-js",t(i).find(n).each(function(){var i=t(this),n=this.onclick?this.onclick():{},s=n.name||"",o=e.block[s];o&&!i.data(s)&&(o.call(i,n),i.data(s,!0).addClass(s+"_js_inited"))})}),e.blockInitBinded||(e.blockInitBinded=!!t(document).ready(function(){e.blockInit()}))}(jQuery,window.Lego),function(t,e,i){function n(t,e,i){(t[e]||(t[e]=[])).unshift(i)}function s(t,e){return e.modName?function(i){(i._curBlock.mods||{})[e.modName]===e.modVal&&t(i)}:t}function o(t,i){var n,s=e.isArray(i);return e.isArray(t)?s?n=t.concat(i):(n=t).push(i):s?(n=i).unshift(t):n=[t,i],n}function r(t){return t.replace(m,function(t){return p[t]})}var a=t.INTERNAL,l=a.ELEM_DELIM,c={area:1,base:1,br:1,col:1,command:1,embed:1,hr:1,img:1,input:1,keygen:1,link:1,meta:1,param:1,source:1,wbr:1},d=a.buildClass,u=a.buildClasses,h={},p={'"':"&quot;","&":"&amp;","<":"&lt;",">":"&gt;"},m=/["&<>]/g;t.HTML={decl:function(t,i){"string"==typeof t&&(t={block:t}),t.name&&(t.block=t.name);var o=h[t.block]||(h[t.block]={});i.onBlock&&n(o,"_block",s(i.onBlock,t)),i.onElem&&(e.isFunction(i.onElem)?n(o,"_elem",s(i.onElem,t)):e.each(i.onElem,function(e,i){n(o,"_elem"+("*"===e?"":l+e),s(i,t))}))},build:function(t){var e=new this.Ctx(t);return e._buildAll(),e._flush()},Ctx:e.inherit({__constructor:function(t){this._buffer=[],this._params=t,this._tParams=null,this._tParamsChanges=null,this._curBlock=i},pos:function(){return this._params._pos},isFirst:function(){return 1===this._params._pos},isLast:function(){var t=this._params;return t._pos===t._siblingsCount},params:function(t){var e=this;return"undefined"==typeof t?e._params:(e._params=t,e)},param:function(t,i,n,s){var o=this,r=o._params;return"undefined"==typeof i?r[t]:(!n&&t in r?s&&(r[t]=e.extend(i,r[t])):r[t]=i,o)},attrs:function(t,e){return this.param("attrs",t,e,!0)},attr:function(t,e,i){var n=this;if("undefined"==typeof e)return(n._params.attrs||{})[t];var s=n._params.attrs;return s?(i||!(t in s))&&(s[t]=e):(n._params.attrs={})[t]=e,n},tag:function(t,e){return this.param("tag",t,e)},cls:function(t,e){return this.param("cls",t,e)},mods:function(t,e){return this.param("mods",t,e,!0)},mod:function(t,e,i){var n=this;if("undefined"==typeof e)return(n._params.mods||{})[t];var s=n._params.mods;return s?(i||!(t in s))&&(s[t]=e):(n._params.mods={})[t]=e,n},mix:function(t,e){var i=this,n=i._params;return"undefined"==typeof t?n.mix:(n.mix=!e&&"mix"in n?n.mix.concat(t):t,i)},js:function(t){return this.param("js",t)},content:function(t,e){return this.param("content",t,e)},wrapContent:function(t){var e=this,i=e._params;return t.content=i.content,i.content=t,e},beforeContent:function(t){var e=this,i=e._params;return i.content=o(t,i.content),e},afterContent:function(t){var e=this,i=e._params;return i.content=o(i.content,t),e},wrap:function(t){var e=this,i=e._params;return t.block||(t._curBlock=e._curBlock),t.content=i._wrapper?i._wrapper:i,i._wrapper=t,e},tParam:function(t,e){var i=this,n=i._tParams||(i._tParams={});if("undefined"==typeof e)return n[t];var s=i._tParamsChanges||(i._tParamsChanges={});return t in s||(s[t]=n[t]),n[t]=e,i},generateId:function(){return e.identify()},stop:function(){this._params._isStopped=!0},_buildAll:function(){var t=this,i=t._buffer,n=t._params,s=typeof n;if("string"==s||"number"==s)i.push(n);else if(e.isArray(n))for(var o,r,a=0,l=n.length;l>a;)t._params=o=n[a++],r=typeof o,"string"==r||"number"==r?i.push(o):o&&(o._pos=a,o._siblingsCount=l,t._buildByDecl());else n&&(t._params._pos=t._params._siblingsCount=1,t._buildByDecl())},_build:function(){var t,i=this,n=i._buffer,s=i._params,o=s.tag||"div",a=s.block||s.elem,l=a&&(s.block||i._curBlock.block),h=!1;s.js&&((t={})[d(l,s.elem)]=s.js===!0?{}:s.js,h=!s.elem),n.push("<",o),(a||s.cls)&&(n.push(' class="'),a&&(u(l,s.elem,s.mods,n),s.mix&&e.each(s.mix,function(e,i){i&&(n.push(" "),u(i.block,i.elem,i.mods,n),i.js&&((t||(t={}))[d(i.block,i.elem)]=i.js===!0?{}:i.js,h||(h=!i.elem)))})),s.cls&&n.push(a?" ":"",s.cls),h&&n.push(" i-bem"),n.push('"')),t&&n.push(' data-bem="',r(JSON.stringify(t)),'"'),s.attrs&&e.each(s.attrs,function(t,e){"undefined"!=typeof e&&null!==e&&e!==!1&&n.push(" ",t,'="',e.toString().replace(/"/g,"&quot;"),'"')}),c[o]?n.push("/>"):(n.push(">"),"undefined"!=typeof s.content&&(i._params=s.content,i._buildAll()),n.push("</",o,">"))},_flush:function(){var t=this._buffer.join("");return delete this._buffer,t},_buildByDecl:function(){var t=this,i=t._curBlock,n=t._params;if(n._curBlock&&(t._curBlock=n._curBlock),n.block&&(t._curBlock=n),!n._wrapper){if(n.block||n.elem){var s=h[t._curBlock.block];if(s){var o;if(n.elem?(o=s["_elem"+l+n.elem],s._elem&&(o=o?o.concat(s._elem):s._elem)):o=s._block,o)for(var r,a=0;(r=o[a++])&&(r(t),!n._isStopped););}}if(n._wrapper)return n._curBlock=t._curBlock,t._params=n._wrapper,t._buildAll()}var c=t._tParamsChanges;if(t._tParamsChanges=null,t._build(),t._curBlock=i,c){var d=t._tParams;e.each(c,function(t,e){"undefined"==typeof e?delete d[t]:d[t]=e})}}})}}(BEM,jQuery),function(t){if(!window.JSON){var e,i=Object.prototype.toString,n=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};window.JSON={stringify:e=function(o){if(null===o)return"null";if("undefined"==typeof o)return t;switch(i.call(o)){case"[object String]":return n.lastIndex=0,'"'+(n.test(o)?o.replace(n,function(t){var e=s[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}):o)+'"';case"[object Number]":case"[object Boolean]":return""+o;case"[object Array]":for(var r,a="[",l=0,c=o.length;c>l;)r=e(o[l]),a+=(l++?",":"")+("undefined"==typeof r?"null":r);return a+"]";case"[object Object]":if("[object Function]"===i.call(o.toJSON))return e(o.toJSON());var r,a="{",l=0;for(var d in o)o.hasOwnProperty(d)&&(r=e(o[d]),"undefined"!=typeof r&&(a+=(l++?",":"")+'"'+d+'":'+r));return a+"}";default:return t}},parse:function(t){return Function("return "+t)()}}}}(),function(t,e,i){function n(t,i){var n=t[0];e.each(a(n),function(r,a){o(a,n,r,i);var l=m[a.uniqId];l?l.domElem.index(n)<0&&(l.domElem=l.domElem.add(t),e.extend(l._params,a)):s(r,t,a)})}function s(t,n,s,r,l){"boolean"==typeof s&&(l=r,r=s,s=i);var c=n[0];s=o(s||a(c)[t],c,t);var d=s.uniqId;if(m[d])return m[d]._init();p[d]=p[d]?p[d].add(n):n;var u=c.parentNode;u&&11!==u.nodeType||e.unique(p[d]);var h=b[t]||I.decl(t,{},{live:!0});if(!(h._liveInitable=!!h._processLive())||r||s.live===!1){r&&n.addClass("i-bem");var f=new h(p[d],s,!!r);return delete p[d],l&&l.apply(f,E.call(arguments,4)),f}}function o(t,i,n,s){(t||(t={})).uniqId||(t.uniqId=(t.id?n+"-id-"+t.id:e.identify())+(s||e.identify()));var o=e.identify(i),r=f[o]||(f[o]={});return r[n]||(r[n]=t),t}function r(t,e,i){var n=t.find(e);return i?n:n.add(t.filter(e))}function a(t){var i=e.identify(t);return f[i]||(f[i]=l(t))}function l(t){var i,n,s=t.getAttribute("data-bem");return s?JSON.parse(s):(i=t.onclick||t.ondblclick,i||"body"!=t.tagName.toLowerCase()||(n=e(t),s=n.attr("onclick")||n.attr("ondblclick"),s&&(i=Function(s))),i?i():{})}function c(t){delete f[e.identify(t)]}function d(t,e){1===t.domElem.length?t.destruct(!0):t.domElem=t.domElem.not(e)}var u=e(window),h=e(document),p={},m={},f={},_={},g={},b=t.blocks,k=t.INTERNAL,v=k.NAME_PATTERN,y=k.MOD_DELIM,M=k.ELEM_DELIM,w=k.buildModPostfix,x=k.buildClass,E=Array.prototype.slice,B=Array.prototype.reverse;e.fn.bem=function(t,e){return s(t,this,e,!0)};var I=t.DOM=t.decl("i-bem__dom",{__constructor:function(t,i,n){var s=this;s.domElem=t,s._eventNameCache={},s._elemCache={},m[s._uniqId=i.uniqId||e.identify(s)]=s,s._needSpecialUnbind=!1,s.__base(null,i,n)},findBlocksInside:function(t,e){return this._findBlocks("find",t,e)},findBlockInside:function(t,e){return this._findBlocks("find",t,e,!0)},findBlocksOutside:function(t,e){return this._findBlocks("parents",t,e)},findBlockOutside:function(t,e){return this._findBlocks("closest",t,e)[0]||null},findBlocksOn:function(t,e){return this._findBlocks("",t,e)},findBlockOn:function(t,e){return this._findBlocks("",t,e,!0)},_findBlocks:function(t,n,o,r){if(!this.domElem)return[];o||(o=n,n=i);var a=n?"string"==typeof n?this.findElem(n):n:this.domElem,l="string"==typeof o,c=l?o:o.block||o.blockName,d="."+(l?x(c):x(c,o.modName,o.modVal))+(r?":first":""),u=a.filter(d);if(t&&(u=u.add(a[t](d))),r)return u[0]?s(c,u.eq(0),!0):null;var h=[],p={};return e.each(u,function(t,i){var n=s(c,e(i),!0);p[n._uniqId]||(p[n._uniqId]=!0,h.push(n))}),h},bindToDomElem:function(t,i,n){var s=this;return n?t.bind(s._buildEventName(i),function(t){return(t.data||(t.data={})).domElem=e(this),n.apply(s,arguments)}):e.each(i,function(e,i){s.bindToDomElem(t,e,i)}),s},bindToDoc:function(t,e){return this._needSpecialUnbind=!0,this.bindToDomElem(h,t,e)},bindToWin:function(t,e){var i,n,s=e;return"resize"===t&&(e=function(){var t=u.height(),e=u.width();(i!==t||n!==e)&&(i=t,n=e,s.apply(this,arguments))}),this._needSpecialUnbind=!0,this.bindToDomElem(u,t,e)},bindTo:function(t,i,n){return!i||e.isFunction(i)?(n=i,i=t,t=this.domElem):"string"==typeof t&&(t=this.elem(t)),this.bindToDomElem(t,i,n)},unbindFromDomElem:function(t,e){return t.unbind(this._buildEventName(e)),this},unbindFromDoc:function(t){return this.unbindFromDomElem(h,t)},unbindFromWin:function(t){return this.unbindFromDomElem(u,t)},unbindFrom:function(t,e){return e?"string"==typeof t&&(t=this.elem(t)):(e=t,t=this.domElem),this.unbindFromDomElem(t,e)},_buildEventName:function(t){var e=this;return t.indexOf(" ")>1?t.split(" ").map(function(t){return e._buildOneEventName(t)}).join(" "):e._buildOneEventName(t)},_buildOneEventName:function(t){var e=this,i=e._eventNameCache;if(t in i)return i[t];var n="."+e._uniqId;if(t.indexOf(".")<0)return i[t]=t+n;var s=".bem_"+e.__self._name;return i[t]=t.split(".").map(function(t,e){return 0==e?t+s:s+"_"+t}).join("")+n},trigger:function(t,e){return this.__base(t=this.buildEvent(t),e).domElem&&this._ctxTrigger(t,e),this},_ctxTrigger:function(t,i){var n=this,s=_[n.__self._buildCtxEventName(t.type)],o={};s&&n.domElem.each(function(){for(var r=this,a=s.counter;r&&a;){var l=e.identify(r,!0);if(l){if(o[l])break;var c=s.ctxs[l];c&&(e.each(c,function(e,s){s.fn.call(s.ctx||n,t,i)}),a--),o[l]=!0}r=r.parentNode}})},setMod:function(t,i,n){if(t&&"undefined"!=typeof n&&t.length>1){var s=this;return t.each(function(){var o=e(this);o.__bemElemName=t.__bemElemName,s.setMod(o,i,n)}),s}return this.__base(t,i,n)},_extractModVal:function(t,e,i){var n,s=(e||this.domElem)[0];return s&&(n=s.className.match(this.__self._buildModValRE(t,i||e))),n?n[2]:""},_extractMods:function(t,e){var i={},n=!t.length,s=0;return((e||this.domElem)[0].className.match(this.__self._buildModValRE("("+(n?v:t.join("|"))+")",e,"g"))||[]).forEach(function(t){var e=(t=t.trim()).lastIndexOf(y),n=t.substr(0,e-1).lastIndexOf(y);i[t.substr(n+1,e-n-1)]=t.substr(e+1),++s}),s<t.length&&t.forEach(function(t){t in i||(i[t]="")}),i},_afterSetMod:function(t,i,n,s,o){var r=this.__self,a=r._buildModClassPrefix(t,o),l=r._buildModValRE(t,o),c=""===i;(s||this.domElem).each(function(){var t=this.className;t.indexOf(a)>-1?this.className=t.replace(l,c?"":"$1"+a+i):c||e(this).addClass(a+i)}),o&&this.dropElemCache(o,t,n).dropElemCache(o,t,i)},findElem:function(t,e,i,n){arguments.length%2?(n=i,i=e,e=t,t=this.domElem):"string"==typeof t&&(t=this.findElem(t));var s=this.__self,o="."+e.split(" ").map(function(t){return x(s._name,t,i,n)}).join(",.");return r(t,o)},_elem:function(t,e,i){var n,s=t+w(e,i);return(n=this._elemCache[s])||(n=this._elemCache[s]=this.findElem(t,e,i),n.__bemElemName=t),n},elem:function(t,i,n){if(i&&"string"!=typeof i)return i.__bemElemName=t,i;if(t.indexOf(" ")<0)return this._elem(t,i,n);var s=e([]),o=this;return t.split(" ").forEach(function(t){s=s.add(o._elem(t,i,n))}),s},dropElemCache:function(t,e,i){if(t){var n=this,s=w(e,i);t.indexOf(" ")<0?delete n._elemCache[t+s]:t.split(" ").forEach(function(t){delete n._elemCache[t+s]})}else this._elemCache={};return this},elemParams:function(t){var e;return"string"==typeof t?(e=t,t=this.elem(t)):e=this.__self._extractElemNameFrom(t),l(t[0])[x(this.__self.getName(),e)]||{}},elemify:function(t,i){return(t=e(t)).__bemElemName=i,t},containsDomElem:function(t){var e=!1;return this.domElem.each(function(){return!(e=t.parents().andSelf().index(this)>-1)}),e},buildSelector:function(t,e,i){return this.__self.buildSelector(t,e,i)},destruct:function(t){var i=this,n=i.__self;i._isDestructing||(i._isDestructing=!0,i._needSpecialUnbind&&n.doc.add(n.win).unbind("."+i._uniqId),i.dropElemCache().domElem.each(function(t,i){var n=a(i);e.each(n,function(t,e){var n=m[e.uniqId];n?n._isDestructing||d(n,i):delete p[e.uniqId]}),c(i)}),t||i.domElem.remove(),delete m[i.un()._uniqId],delete i.domElem,delete i._elemCache,i.__base())}},{scope:null,doc:h,win:u,_processLive:function(t){var e=this,i=e._liveInitable;if("live"in e){var n="undefined"==typeof i;if(n^t){i=e.live()!==!1;var s=e.getName(),o=e.live;e.live=function(){return this.getName()===s?i:o.apply(this,arguments)}}}return i},init:function(t,i,s){(!t||e.isFunction(t))&&(s=i,i=t,t=h);var o=e.identify();return r(t,".i-bem").each(function(){n(e(this),o)}),i&&this.afterCurrentEvent(function(){i.call(s||this,t)}),this._runAfterCurrentEventFns(),t},destruct:function(t,n,s){"boolean"!=typeof t&&(s=n,n=t,t=i),B.call(r(n,".i-bem",s)).each(function(t,i){var n=a(this);e.each(n,function(t,e){if(e.uniqId){var n=m[e.uniqId];n?d(n,i):delete p[e.uniqId]}}),c(this)}),t||(s?n.empty():n.remove())},update:function(t,e,i,n){return this.destruct(t,!0),this.init(t.html(e),i,n)},replace:function(t,i){return this.destruct(!0,t),this.init(e(i).replaceAll(t))},append:function(t,i){return this.init(e(i).appendTo(t))},prepend:function(t,i){return this.init(e(i).prependTo(t))},before:function(t,i){return this.init(e(i).insertBefore(t))},after:function(t,i){return this.init(e(i).insertAfter(t))},_buildCtxEventName:function(t){return this._name+":"+t},_liveClassBind:function(t,i,n,s){var o=this;if(i.indexOf(" ")>-1)i.split(" ").forEach(function(e){o._liveClassBind(t,e,n,s)});else{var r=g[i],a=e.identify(n);r||(r=g[i]={},h.bind(i,o.changeThis(o._liveClassTrigger,o))),r=r[t]||(r[t]={uniqIds:{},fns:[]}),a in r.uniqIds||(r.fns.push({uniqId:a,fn:o._buildLiveEventFn(n,s)}),r.uniqIds[a]=r.fns.length-1)}return this},_liveClassUnbind:function(t,i,n){var s=g[i];if(s)if(n){if(s=s[t]){var o=e.identify(n);
if(o in s.uniqIds){var r=s.uniqIds[o],a=s.fns.length-1;for(s.fns.splice(r,1);a>r;)s.uniqIds[s.fns[r++].uniqId]=r-1;delete s.uniqIds[o]}}}else delete s[t];return this},_liveClassTrigger:function(t){var i=g[t.type];if(i){var n=t.target,s=[];for(var o in i)i.hasOwnProperty(o)&&s.push(o);do for(var r=" "+n.className+" ",a=0;o=s[a++];)if(r.indexOf(" "+o+" ")>-1){for(var l,c=0,d=i[o].fns,u=!1;l=d[c++];)l.fn.call(e(n),t)===!1&&(u=!0);if(u&&t.preventDefault(),u||t.isPropagationStopped())return;s.splice(--a,1)}while(s.length&&(n=n.parentNode))}},_buildLiveEventFn:function(t,i){var n=this;return function(o){var r=[n._name,((o.data||(o.data={})).domElem=e(this)).closest(n.buildSelector()),!0],a=s.apply(null,i?r.concat([t,o]):r);return a&&!i&&t?t.apply(a,arguments):void 0}},liveInitOnEvent:function(t,e,i){return this.liveBindTo(t,e,i,!0)},liveBindTo:function(t,n,s,o){(!n||e.isFunction(n))&&(s=n,n=t,t=i),t&&"string"!=typeof t||(t={elem:t}),t.elemName&&(t.elem=t.elemName);var r=this;return t.elem&&t.elem.indexOf(" ")>0?(t.elem.split(" ").forEach(function(e){r._liveClassBind(x(r._name,e,t.modName,t.modVal),n,s,o)}),r):r._liveClassBind(x(r._name,t.elem,t.modName,t.modVal),n,s,o)},liveUnbindFrom:function(t,n,s){(!n||e.isFunction(n))&&(s=n,n=t,t=i);var o=this;return t&&t.indexOf(" ")>1?(t.split(" ").forEach(function(t){o._liveClassUnbind(x(o._name,t),n,s)}),o):o._liveClassUnbind(x(o._name,t),n,s)},_liveInitOnBlockEvent:function(t,e,i,n){var s=this._name;return b[e].on(t,function(t){if(t.block.domElem){var e=arguments,o=t.block[n](s);i&&o.forEach(function(t){i.apply(t,e)})}}),this},liveInitOnBlockEvent:function(t,e,i){return this._liveInitOnBlockEvent(t,e,i,"findBlocksOn")},liveInitOnBlockInsideEvent:function(t,e,i){return this._liveInitOnBlockEvent(t,e,i,"findBlocksOutside")},liveInitOnBlockInit:function(t,e){return this.liveInitOnBlockEvent("init",t,e)},liveInitOnBlockInsideInit:function(t,e){return this.liveInitOnBlockInsideEvent("init",t,e)},on:function(t,e,i,n,s){return t.jquery?this._liveCtxBind(t,e,i,n,s):this.__base(t,e,i,n)},un:function(t,e,i,n){return t.jquery?this._liveCtxUnbind(t,e,i,n):this.__base(t,e,i)},liveCtxBind:function(t,e,i,n,s){return this._liveCtxBind(t,e,i,n,s)},_liveCtxBind:function(t,n,s,o,r){var a=this;if("string"==typeof n)if(e.isFunction(s)&&(r=o,o=s,s=i),n.indexOf(" ")>-1)n.split(" ").forEach(function(e){a._liveCtxBind(t,e,s,o,r)});else{var l=a._buildCtxEventName(n),c=_[l]||(_[l]={counter:0,ctxs:{}});t.each(function(){var t=e.identify(this),i=c.ctxs[t];i||(i=c.ctxs[t]={},++c.counter),i[e.identify(o)+(r?e.identify(r):"")]={fn:o,data:s,ctx:r}})}else e.each(n,function(e,i){a._liveCtxBind(t,e,i,s)});return a},liveCtxUnbind:function(t,e,i,n){return this._liveCtxUnbind(t,e,i,n)},_liveCtxUnbind:function(t,i,n,s){var o=this,r=_[i=o._buildCtxEventName(i)];return r&&(t.each(function(){var t,i=e.identify(this,!0);i&&(t=r.ctxs[i])&&(n&&delete t[e.identify(n)+(s?e.identify(s):"")],(!n||e.isEmptyObject(t))&&(r.counter--,delete r.ctxs[i]))}),r.counter||delete _[i]),o},_extractElemNameFrom:function(t){if(t.__bemElemName)return t.__bemElemName;var e=t[0].className.match(this._buildElemNameRE());return e?e[1]:i},extractParams:l,_buildModClassPrefix:function(t,e){return x(this._name)+(e?M+("string"==typeof e?e:this._extractElemNameFrom(e)):"")+y+t+y},_buildModValRE:function(t,e,i){return new RegExp("(\\s|^)"+this._buildModClassPrefix(t,e)+"("+v+")(?=\\s|$)",i)},_buildElemNameRE:function(){return new RegExp(this._name+M+"("+v+")(?:\\s|$)")},buildSelector:function(t,e,i){return"."+x(this._name,t,e,i)},getBlockByUniqId:function(t){return m[t]},getWindowSize:function(){return{width:u.width(),height:u.height()}}});e(function(){t.DOM.scope=e("body")})}(BEM,jQuery),function(t){var e=1,i=!1;if("deviceXDPI"in screen&&"logicalXDPI"in screen?e=screen.deviceXDPI/screen.logicalXDPI:"devicePixelRatio"in t&&(e=t.devicePixelRatio),"function"==typeof t.matchMedia){var n="only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen and (min-resolution: 1.3dppx), only screen and (min-resolution: 124dpi)";i=t.matchMedia(n).matches}else i=e>=1.3;BEM.DOM.decl("i-ua",{onSetMod:{js:function(){var t=this,e=t.__self;e.hiDpi&&t.setMod("hi-dpi","yes")}}},{dpr:e,hiDpi:i})}(window);var hljs=new function(){function t(t){return t.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;")}function e(t){for(var e=t.firstChild;e;e=e.nextSibling){if("CODE"==e.nodeName)return e;if(3!=e.nodeType||!e.nodeValue.match(/\s+/))break}}function i(t,e){return Array.prototype.map.call(t.childNodes,function(t){return 3==t.nodeType?e?t.nodeValue.replace(/\n/g,""):t.nodeValue:"BR"==t.nodeName?"\n":i(t,e)}).join("")}function n(t){var e=(t.className+" "+t.parentNode.className).split(/\s+/);e=e.map(function(t){return t.replace(/^language-/,"")});for(var i=0;i<e.length;i++)if(p[e[i]]||"no-highlight"==e[i])return e[i]}function s(t){var e=[];return function i(t,n){for(var s=t.firstChild;s;s=s.nextSibling)3==s.nodeType?n+=s.nodeValue.length:"BR"==s.nodeName?n+=1:1==s.nodeType&&(e.push({event:"start",offset:n,node:s}),n=i(s,n),e.push({event:"stop",offset:n,node:s}));return n}(t,0),e}function o(e,i,n){function s(){return e.length&&i.length?e[0].offset!=i[0].offset?e[0].offset<i[0].offset?e:i:"start"==i[0].event?e:i:e.length?e:i}function o(e){function i(e){return" "+e.nodeName+'="'+t(e.value)+'"'}return"<"+e.nodeName+Array.prototype.map.call(e.attributes,i).join("")+">"}for(var r=0,a="",l=[];e.length||i.length;){var c=s().splice(0,1)[0];if(a+=t(n.substr(r,c.offset-r)),r=c.offset,"start"==c.event)a+=o(c.node),l.push(c.node);else if("stop"==c.event){var d,u=l.length;do u--,d=l[u],a+="</"+d.nodeName.toLowerCase()+">";while(d!=c.node);for(l.splice(u,1);u<l.length;)a+=o(l[u]),u++}}return a+t(n.substr(r))}function r(t){function e(e,i){return RegExp(e,"m"+(t.cI?"i":"")+(i?"g":""))}function i(t,n){function s(t,e){e.split(" ").forEach(function(e){var i=e.split("|");r[i[0]]=[t,i[1]?Number(i[1]):1],o.push(i[0])})}if(!t.compiled){t.compiled=!0;var o=[];if(t.k){var r={};if(t.lR=e(t.l||hljs.IR,!0),"string"==typeof t.k)s("keyword",t.k);else for(var a in t.k)t.k.hasOwnProperty(a)&&s(a,t.k[a]);t.k=r}n&&(t.bWK&&(t.b="\\b("+o.join("|")+")\\s"),t.bR=e(t.b?t.b:"\\B|\\b"),t.e||t.eW||(t.e="\\B|\\b"),t.e&&(t.eR=e(t.e)),t.tE=t.e||"",t.eW&&n.tE&&(t.tE+=(t.e?"|":"")+n.tE)),t.i&&(t.iR=e(t.i)),void 0===t.r&&(t.r=1),t.c||(t.c=[]);for(var l=0;l<t.c.length;l++)"self"==t.c[l]&&(t.c[l]=t),i(t.c[l],t);t.starts&&i(t.starts,n);for(var c=[],l=0;l<t.c.length;l++)c.push(t.c[l].b);t.tE&&c.push(t.tE),t.i&&c.push(t.i),t.t=c.length?e(c.join("|"),!0):{exec:function(){return null}}}}i(t)}function a(e,i){function n(t,e){for(var i=0;i<e.c.length;i++){var n=e.c[i].bR.exec(t);if(n&&0==n.index)return e.c[i]}}function s(t,e){return t.e&&t.eR.test(e)?t:t.eW?s(t.parent,e):void 0}function o(t,e){return e.i&&e.iR.test(t)}function c(t,e){var i=_.cI?e[0].toLowerCase():e[0];return t.k.hasOwnProperty(i)&&t.k[i]}function d(){var e=t(b);if(!g.k)return e;var i="",n=0;g.lR.lastIndex=0;for(var s=g.lR.exec(e);s;){i+=e.substr(n,s.index-n);var o=c(g,s);o?(v+=o[1],i+='<span class="'+o[0]+'">'+s[0]+"</span>"):i+=s[0],n=g.lR.lastIndex,s=g.lR.exec(e)}return i+e.substr(n)}function u(){if(g.sL&&!p[g.sL])return t(b);var e=g.sL?a(g.sL,b):l(b);return g.r>0&&(v+=e.keyword_count,k+=e.r),'<span class="'+e.language+'">'+e.value+"</span>"}function h(){return void 0!==g.sL?u():d()}function m(e,i){var n=e.cN?'<span class="'+e.cN+'">':"";e.rB?(y+=n,b=""):e.eB?(y+=t(i)+n,b=""):(y+=n,b=i),g=Object.create(e,{parent:{value:g}}),k+=e.r}function f(e,i){if(b+=e,void 0===i)return y+=h(),0;var r=n(i,g);if(r)return y+=h(),m(r,i),r.rB?0:i.length;var a=s(g,i);if(a){a.rE||a.eE||(b+=i),y+=h();do g.cN&&(y+="</span>"),g=g.parent;while(g!=a.parent);return a.eE&&(y+=t(i)),b="",a.starts&&m(a.starts,""),a.rE?0:i.length}if(o(i,g))throw"Illegal";return b+=i,i.length||1}var _=p[e];r(_);var g=_,b="",k=0,v=0,y="";try{for(var M,w,x=0;;){if(g.t.lastIndex=x,M=g.t.exec(i),!M)break;w=f(i.substr(x,M.index-x),M[0]),x=M.index+w}return f(i.substr(x)),{r:k,keyword_count:v,value:y,language:e}}catch(E){if("Illegal"==E)return{r:0,keyword_count:0,value:t(i)};throw E}}function l(e){var i={keyword_count:0,r:0,value:t(e)},n=i;for(var s in p)if(p.hasOwnProperty(s)){var o=a(s,e);o.language=s,o.keyword_count+o.r>n.keyword_count+n.r&&(n=o),o.keyword_count+o.r>i.keyword_count+i.r&&(n=i,i=o)}return n.language&&(i.second_best=n),i}function c(t,e,i){return e&&(t=t.replace(/^((<[^>]+>|\t)+)/gm,function(t,i){return i.replace(/\t/g,e)})),i&&(t=t.replace(/\n/g,"<br>")),t}function d(t,e,r){var d=i(t,r),u=n(t);if("no-highlight"!=u){var h=u?a(u,d):l(d);u=h.language;var p=s(t);if(p.length){var m=document.createElement("pre");m.innerHTML=h.value,h.value=o(p,s(m),d)}h.value=c(h.value,e,r);var f=t.className;f.match("(\\s|^)(language-)?"+u+"(\\s|$)")||(f=f?f+" "+u:u),t.innerHTML=h.value,t.className=f,t.result={language:u,kw:h.keyword_count,re:h.r},h.second_best&&(t.second_best={language:h.second_best.language,kw:h.second_best.keyword_count,re:h.second_best.r})}}function u(){u.called||(u.called=!0,Array.prototype.map.call(document.getElementsByTagName("pre"),e).filter(Boolean).forEach(function(t){d(t,hljs.tabReplace)}))}function h(){window.addEventListener("DOMContentLoaded",u,!1),window.addEventListener("load",u,!1)}var p={};this.LANGUAGES=p,this.highlight=a,this.highlightAuto=l,this.fixMarkup=c,this.highlightBlock=d,this.initHighlighting=u,this.initHighlightingOnLoad=h,this.IR="[a-zA-Z][a-zA-Z0-9_]*",this.UIR="[a-zA-Z_][a-zA-Z0-9_]*",this.NR="\\b\\d+(\\.\\d+)?",this.CNR="(\\b0[xX][a-fA-F0-9]+|(\\b\\d+(\\.\\d*)?|\\.\\d+)([eE][-+]?\\d+)?)",this.BNR="\\b(0b[01]+)",this.RSR="!|!=|!==|%|%=|&|&&|&=|\\*|\\*=|\\+|\\+=|,|\\.|-|-=|/|/=|:|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|\\?|\\[|\\{|\\(|\\^|\\^=|\\||\\|=|\\|\\||~",this.BE={b:"\\\\[\\s\\S]",r:0},this.ASM={cN:"string",b:"'",e:"'",i:"\\n",c:[this.BE],r:0},this.QSM={cN:"string",b:'"',e:'"',i:"\\n",c:[this.BE],r:0},this.CLCM={cN:"comment",b:"//",e:"$"},this.CBLCLM={cN:"comment",b:"/\\*",e:"\\*/"},this.HCM={cN:"comment",b:"#",e:"$"},this.NM={cN:"number",b:this.NR,r:0},this.CNM={cN:"number",b:this.CNR,r:0},this.BNM={cN:"number",b:this.BNR,r:0},this.inherit=function(t,e){var i={};for(var n in t)i[n]=t[n];if(e)for(var n in e)i[n]=e[n];return i}};hljs.LANGUAGES.bash=function(t){var e="true false",i="if then else elif fi for break continue while in do done echo exit return set declare",n={cN:"variable",b:"\\$[a-zA-Z0-9_#]+"},s={cN:"variable",b:"\\${([^}]|\\\\})+}"},o={cN:"string",b:'"',e:'"',i:"\\n",c:[t.BE,n,s],r:0},r={cN:"string",b:"'",e:"'",c:[{b:"''"}],r:0},a={cN:"test_condition",b:"",e:"",c:[o,r,n,s],k:{literal:e},r:0};return{k:{keyword:i,literal:e},c:[{cN:"shebang",b:"(#!\\/bin\\/bash)|(#!\\/bin\\/sh)",r:10},n,s,t.HCM,o,r,t.inherit(a,{b:"\\[ ",e:" \\]",r:0}),t.inherit(a,{b:"\\[\\[ ",e:" \\]\\]"})]}}(hljs),hljs.LANGUAGES.erlang=function(t){var e="[a-z'][a-zA-Z0-9_']*",i="("+e+":"+e+"|"+e+")",n={keyword:"after and andalso|10 band begin bnot bor bsl bzr bxor case catch cond div end fun let not of orelse|10 query receive rem try when xor",literal:"false true"},s={cN:"comment",b:"%",e:"$",r:0},o={cN:"number",b:"\\b(\\d+#[a-fA-F0-9]+|\\d+(\\.\\d+)?([eE][-+]?\\d+)?)",r:0},r={b:"fun\\s+"+e+"/\\d+"},a={b:i+"\\(",e:"\\)",rB:!0,r:0,c:[{cN:"function_name",b:i,r:0},{b:"\\(",e:"\\)",eW:!0,rE:!0,r:0}]},l={cN:"tuple",b:"{",e:"}",r:0},c={cN:"variable",b:"\\b_([A-Z][A-Za-z0-9_]*)?",r:0},d={cN:"variable",b:"[A-Z][a-zA-Z0-9_]*",r:0},u={b:"#",e:"}",i:".",r:0,rB:!0,c:[{cN:"record_name",b:"#"+t.UIR,r:0},{b:"{",eW:!0,r:0}]},h={k:n,b:"(fun|receive|if|try|case)",e:"end"};h.c=[s,r,t.inherit(t.ASM,{cN:""}),h,a,t.QSM,o,l,c,d,u];var p=[s,r,h,a,t.QSM,o,l,c,d,u];a.c[1].c=p,l.c=p,u.c[1].c=p;var m={cN:"params",b:"\\(",e:"\\)",c:p};return{k:n,i:"(</|\\*=|\\+=|-=|/=|/\\*|\\*/|\\(\\*|\\*\\))",c:[{cN:"function",b:"^"+e+"\\s*\\(",e:"->",rB:!0,i:"\\(|#|//|/\\*|\\\\|:",c:[m,{cN:"title",b:e}],starts:{e:";|\\.",k:n,c:p}},s,{cN:"pp",b:"^-",e:"\\.",r:0,eE:!0,rB:!0,l:"-"+t.IR,k:"-module -record -undef -export -ifdef -ifndef -author -copyright -doc -vsn -import -include -include_lib -compile -define -else -endif -file -behaviour -behavior",c:[m]},o,t.QSM,u,c,d,l]}}(hljs),hljs.LANGUAGES.cs=function(t){return{k:"abstract as base bool break byte case catch char checked class const continue decimal default delegate do double else enum event explicit extern false finally fixed float for foreach goto if implicit in int interface internal is lock long namespace new null object operator out override params private protected public readonly ref return sbyte sealed short sizeof stackalloc static string struct switch this throw true try typeof uint ulong unchecked unsafe ushort using virtual volatile void while ascending descending from get group into join let orderby partial select set value var where yield",c:[{cN:"comment",b:"///",e:"$",rB:!0,c:[{cN:"xmlDocTag",b:"///|<!--|-->"},{cN:"xmlDocTag",b:"</?",e:">"}]},t.CLCM,t.CBLCLM,{cN:"preprocessor",b:"#",e:"$",k:"if else elif endif define undef warning error line region endregion pragma checksum"},{cN:"string",b:'@"',e:'"',c:[{b:'""'}]},t.ASM,t.QSM,t.CNM]}}(hljs),hljs.LANGUAGES.ruby=function(t){var e="[a-zA-Z_][a-zA-Z0-9_]*(\\!|\\?)?",i="[a-zA-Z_]\\w*[!?=]?|[-+~]\\@|<<|>>|=~|===?|<=>|[<>]=?|\\*\\*|[-/+%^&*~`|]|\\[\\]=?",n={keyword:"and false then defined module in return redo if BEGIN retry end for true self when next until do begin unless END rescue nil else break undef not super class case require yield alias while ensure elsif or include"},s={cN:"yardoctag",b:"@[A-Za-z]+"},o=[{cN:"comment",b:"#",e:"$",c:[s]},{cN:"comment",b:"^\\=begin",e:"^\\=end",c:[s],r:10},{cN:"comment",b:"^__END__",e:"\\n$"}],r={cN:"subst",b:"#\\{",e:"}",l:e,k:n},a=[t.BE,r],l=[{cN:"string",b:"'",e:"'",c:a,r:0},{cN:"string",b:'"',e:'"',c:a,r:0},{cN:"string",b:"%[qw]?\\(",e:"\\)",c:a},{cN:"string",b:"%[qw]?\\[",e:"\\]",c:a},{cN:"string",b:"%[qw]?{",e:"}",c:a},{cN:"string",b:"%[qw]?<",e:">",c:a,r:10},{cN:"string",b:"%[qw]?/",e:"/",c:a,r:10},{cN:"string",b:"%[qw]?%",e:"%",c:a,r:10},{cN:"string",b:"%[qw]?-",e:"-",c:a,r:10},{cN:"string",b:"%[qw]?\\|",e:"\\|",c:a,r:10}],c={cN:"function",bWK:!0,e:" |$|;",k:"def",c:[{cN:"title",b:i,l:e,k:n},{cN:"params",b:"\\(",e:"\\)",l:e,k:n}].concat(o)},d=o.concat(l.concat([{cN:"class",bWK:!0,e:"$|;",k:"class module",c:[{cN:"title",b:"[A-Za-z_]\\w*(::\\w+)*(\\?|\\!)?",r:0},{cN:"inheritance",b:"<\\s*",c:[{cN:"parent",b:"("+t.IR+"::)?"+t.IR}]}].concat(o)},c,{cN:"constant",b:"(::)?(\\b[A-Z]\\w*(::)?)+",r:0},{cN:"symbol",b:":",c:l.concat([{b:i}]),r:0},{cN:"symbol",b:e+":",r:0},{cN:"number",b:"(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b",r:0},{cN:"number",b:"\\?\\w"},{cN:"variable",b:"(\\$\\W)|((\\$|\\@\\@?)(\\w+))"},{b:"("+t.RSR+")\\s*",c:o.concat([{cN:"regexp",b:"/",e:"/[a-z]*",i:"\\n",c:[t.BE,r]}]),r:0}]));return r.c=d,c.c[1].c=d,{l:e,k:n,c:d}}(hljs),hljs.LANGUAGES.diff=function(){return{c:[{cN:"chunk",b:"^\\@\\@ +\\-\\d+,\\d+ +\\+\\d+,\\d+ +\\@\\@$",r:10},{cN:"chunk",b:"^\\*\\*\\* +\\d+,\\d+ +\\*\\*\\*\\*$",r:10},{cN:"chunk",b:"^\\-\\-\\- +\\d+,\\d+ +\\-\\-\\-\\-$",r:10},{cN:"header",b:"Index: ",e:"$"},{cN:"header",b:"=====",e:"=====$"},{cN:"header",b:"^\\-\\-\\-",e:"$"},{cN:"header",b:"^\\*{3} ",e:"$"},{cN:"header",b:"^\\+\\+\\+",e:"$"},{cN:"header",b:"\\*{5}",e:"\\*{5}$"},{cN:"addition",b:"^\\+",e:"$"},{cN:"deletion",b:"^\\-",e:"$"},{cN:"change",b:"^\\!",e:"$"}]}}(hljs),hljs.LANGUAGES.javascript=function(t){return{k:{keyword:"in if for while finally var new function do return void else break catch instanceof with throw case default try this switch continue typeof delete let yield const",literal:"true false null undefined NaN Infinity"},c:[t.ASM,t.QSM,t.CLCM,t.CBLCLM,t.CNM,{b:"("+t.RSR+"|\\b(case|return|throw)\\b)\\s*",k:"return throw case",c:[t.CLCM,t.CBLCLM,{cN:"regexp",b:"/",e:"/[gim]*",i:"\\n",c:[{b:"\\\\/"}]},{b:"<",e:">;",sL:"xml"}],r:0},{cN:"function",bWK:!0,e:"{",k:"function",c:[{cN:"title",b:"[A-Za-z$_][0-9A-Za-z$_]*"},{cN:"params",b:"\\(",e:"\\)",c:[t.CLCM,t.CBLCLM],i:"[\"'\\(]"}],i:"\\[|%"}]}}(hljs),hljs.LANGUAGES.xml=function(){var t="[A-Za-z0-9\\._:-]+",e={eW:!0,c:[{cN:"attribute",b:t,r:0},{b:'="',rB:!0,e:'"',c:[{cN:"value",b:'"',eW:!0}]},{b:"='",rB:!0,e:"'",c:[{cN:"value",b:"'",eW:!0}]},{b:"=",c:[{cN:"value",b:"[^\\s/>]+"}]}]};return{cI:!0,c:[{cN:"pi",b:"<\\?",e:"\\?>",r:10},{cN:"doctype",b:"<!DOCTYPE",e:">",r:10,c:[{b:"\\[",e:"\\]"}]},{cN:"comment",b:"<!--",e:"-->",r:10},{cN:"cdata",b:"<\\!\\[CDATA\\[",e:"\\]\\]>",r:10},{cN:"tag",b:"<style(?=\\s|>|$)",e:">",k:{title:"style"},c:[e],starts:{e:"</style>",rE:!0,sL:"css"}},{cN:"tag",b:"<script(?=\\s|>|$)",e:">",k:{title:"script"},c:[e],starts:{e:"</script>",rE:!0,sL:"javascript"}},{b:"<%",e:"%>",sL:"vbscript"},{cN:"tag",b:"</?",e:"/?>",c:[{cN:"title",b:"[^ />]+"},e]}]}}(hljs),hljs.LANGUAGES.markdown=function(){return{c:[{cN:"header",b:"^#{1,3}",e:"$"},{cN:"header",b:"^.+?\\n[=-]{2,}$"},{b:"<",e:">",sL:"xml",r:0},{cN:"bullet",b:"^([*+-]|(\\d+\\.))\\s+"},{cN:"strong",b:"[*_]{2}.+?[*_]{2}"},{cN:"emphasis",b:"\\*.+?\\*"},{cN:"emphasis",b:"_.+?_",r:0},{cN:"blockquote",b:"^>\\s+",e:"$"},{cN:"code",b:"`.+?`"},{cN:"code",b:"^    ",e:"$",r:0},{cN:"horizontal_rule",b:"^-{3,}",e:"$"},{b:"\\[.+?\\]\\(.+?\\)",rB:!0,c:[{cN:"link_label",b:"\\[.+\\]"},{cN:"link_url",b:"\\(",e:"\\)",eB:!0,eE:!0}]}]}}(hljs),hljs.LANGUAGES.css=function(t){var e={cN:"function",b:t.IR+"\\(",e:"\\)",c:[t.NM,t.ASM,t.QSM]};return{cI:!0,i:"[=/|']",c:[t.CBLCLM,{cN:"id",b:"\\#[A-Za-z0-9_-]+"},{cN:"class",b:"\\.[A-Za-z0-9_-]+",r:0},{cN:"attr_selector",b:"\\[",e:"\\]",i:"$"},{cN:"pseudo",b:":(:)?[a-zA-Z0-9\\_\\-\\+\\(\\)\\\"\\']+"},{cN:"at_rule",b:"@(font-face|page)",l:"[a-z-]+",k:"font-face page"},{cN:"at_rule",b:"@",e:"[{;]",eE:!0,k:"import page media charset",c:[e,t.ASM,t.QSM,t.NM]},{cN:"tag",b:t.IR,r:0},{cN:"rules",b:"{",e:"}",i:"[^\\s]",r:0,c:[t.CBLCLM,{cN:"rule",b:"[^\\s]",rB:!0,e:";",eW:!0,c:[{cN:"attribute",b:"[A-Z\\_\\.\\-]+",e:":",eE:!0,i:"[^\\s]",starts:{cN:"value",eW:!0,eE:!0,c:[e,t.NM,t.QSM,t.ASM,t.CBLCLM,{cN:"hexcolor",b:"\\#[0-9A-F]+"},{cN:"important",b:"!important"}]}}]}]}]}}(hljs),hljs.LANGUAGES.lisp=function(t){var e="[a-zA-Z_\\-\\+\\*\\/\\<\\=\\>\\&\\#][a-zA-Z0-9_\\-\\+\\*\\/\\<\\=\\>\\&\\#]*",i="(\\-|\\+)?\\d+(\\.\\d+|\\/\\d+)?((d|e|f|l|s)(\\+|\\-)?\\d+)?",n={cN:"literal",b:"\\b(t{1}|nil)\\b"},s=[{cN:"number",b:i},{cN:"number",b:"#b[0-1]+(/[0-1]+)?"},{cN:"number",b:"#o[0-7]+(/[0-7]+)?"},{cN:"number",b:"#x[0-9a-f]+(/[0-9a-f]+)?"},{cN:"number",b:"#c\\("+i+" +"+i,e:"\\)"}],o={cN:"string",b:'"',e:'"',c:[t.BE],r:0},r={cN:"comment",b:";",e:"$"},a={cN:"variable",b:"\\*",e:"\\*"},l={cN:"keyword",b:"[:&]"+e},c={b:"\\(",e:"\\)",c:["self",n,o].concat(s)},d={cN:"quoted",b:"['`]\\(",e:"\\)",c:s.concat([o,a,l,c])},u={cN:"quoted",b:"\\(quote ",e:"\\)",k:{title:"quote"},c:s.concat([o,a,l,c])},h={cN:"list",b:"\\(",e:"\\)"},p={cN:"body",eW:!0,eE:!0};return h.c=[{cN:"title",b:e},p],p.c=[d,u,h,n].concat(s).concat([o,r,a,l]),{i:"[^\\s]",c:s.concat([n,o,r,d,u,h])}}(hljs),hljs.LANGUAGES.profile=function(t){return{c:[t.CNM,{cN:"builtin",b:"{",e:"}$",eB:!0,eE:!0,c:[t.ASM,t.QSM],r:0},{cN:"filename",b:"[a-zA-Z_][\\da-zA-Z_]+\\.[\\da-zA-Z_]{1,3}",e:":",eE:!0},{cN:"header",b:"(ncalls|tottime|cumtime)",e:"$",k:"ncalls tottime|10 cumtime|10 filename",r:10},{cN:"summary",b:"function calls",e:"$",c:[t.CNM],r:10},t.ASM,t.QSM,{cN:"function",b:"\\(",e:"\\)$",c:[{cN:"title",b:t.UIR,r:0}],r:0}]}}(hljs),hljs.LANGUAGES.http=function(){return{i:"\\S",c:[{cN:"status",b:"^HTTP/[0-9\\.]+",e:"$",c:[{cN:"number",b:"\\b\\d{3}\\b"}]},{cN:"request",b:"^[A-Z]+ (.*?) HTTP/[0-9\\.]+$",rB:!0,e:"$",c:[{cN:"string",b:" ",e:" ",eB:!0,eE:!0}]},{cN:"attribute",b:"^\\w",e:": ",eE:!0,i:"\\n|\\s|=",starts:{cN:"string",e:"$"}},{b:"\\n\\n",starts:{sL:"",eW:!0}}]}}(hljs),hljs.LANGUAGES.java=function(t){return{k:"false synchronized int abstract float private char boolean static null if const for true while long throw strictfp finally protected import native final return void enum else break transient new catch instanceof byte super volatile case assert short package default double public try this switch continue throws",c:[{cN:"javadoc",b:"/\\*\\*",e:"\\*/",c:[{cN:"javadoctag",b:"@[A-Za-z]+"}],r:10},t.CLCM,t.CBLCLM,t.ASM,t.QSM,{cN:"class",bWK:!0,e:"{",k:"class interface",i:":",c:[{bWK:!0,k:"extends implements",r:10},{cN:"title",b:t.UIR}]},t.CNM,{cN:"annotation",b:"@[A-Za-z]+"}]}}(hljs),hljs.LANGUAGES.php=function(t){var e={cN:"variable",b:"\\$+[a-zA-Z_-ÿ][a-zA-Z0-9_-ÿ]*"},i=[t.inherit(t.ASM,{i:null}),t.inherit(t.QSM,{i:null}),{cN:"string",b:'b"',e:'"',c:[t.BE]},{cN:"string",b:"b'",e:"'",c:[t.BE]}],n=[t.BNM,t.CNM],s={cN:"title",b:t.UIR};return{cI:!0,k:"and include_once list abstract global private echo interface as static endswitch array null if endwhile or const for endforeach self var while isset public protected exit foreach throw elseif include __FILE__ empty require_once do xor return implements parent clone use __CLASS__ __LINE__ else break print eval new catch __METHOD__ case exception php_user_filter default die require __FUNCTION__ enddeclare final try this switch continue endfor endif declare unset true false namespace trait goto instanceof insteadof __DIR__ __NAMESPACE__ __halt_compiler",c:[t.CLCM,t.HCM,{cN:"comment",b:"/\\*",e:"\\*/",c:[{cN:"phpdoc",b:"\\s@[A-Za-z]+"}]},{cN:"comment",eB:!0,b:"__halt_compiler.+?;",eW:!0},{cN:"string",b:"<<<['\"]?\\w+['\"]?$",e:"^\\w+;",c:[t.BE]},{cN:"preprocessor",b:"<\\?php",r:10},{cN:"preprocessor",b:"\\?>"},e,{cN:"function",bWK:!0,e:"{",k:"function",i:"\\$|\\[|%",c:[s,{cN:"params",b:"\\(",e:"\\)",c:["self",e,t.CBLCLM].concat(i).concat(n)}]},{cN:"class",bWK:!0,e:"{",k:"class",i:"[:\\(\\$]",c:[{bWK:!0,eW:!0,k:"extends",c:[s]},s]},{b:"=>"}].concat(i).concat(n)}}(hljs),hljs.LANGUAGES.haskell=function(t){var e={cN:"type",b:"\\b[A-Z][\\w']*",r:0},i={cN:"container",b:"\\(",e:"\\)",c:[{cN:"type",b:"\\b[A-Z][\\w]*(\\((\\.\\.|,|\\w+)\\))?"},{cN:"title",b:"[_a-z][\\w']*"}]},n={cN:"container",b:"{",e:"}",c:i.c};return{k:"let in if then else case of where do module import hiding qualified type data newtype deriving class instance not as foreign ccall safe unsafe",c:[{cN:"comment",b:"--",e:"$"},{cN:"preprocessor",b:"{-#",e:"#-}"},{cN:"comment",c:["self"],b:"{-",e:"-}"},{cN:"string",b:"\\s+'",e:"'",c:[t.BE],r:0},t.QSM,{cN:"import",b:"\\bimport",e:"$",k:"import qualified as hiding",c:[i],i:"\\W\\.|;"},{cN:"module",b:"\\bmodule",e:"where",k:"module where",c:[i],i:"\\W\\.|;"},{cN:"class",b:"\\b(class|instance)",e:"where",k:"class where instance",c:[e]},{cN:"typedef",b:"\\b(data|(new)?type)",e:"$",k:"data type newtype deriving",c:[e,i,n]},t.CNM,{cN:"shebang",b:"#!\\/usr\\/bin\\/env runhaskell",e:"$"},e,{cN:"title",b:"^[_a-z][\\w']*"}]}}(hljs),hljs.LANGUAGES["1c"]=function(t){var e="[a-zA-Zа-яА-Я][a-zA-Z0-9_а-яА-Я]*",i="возврат дата для если и или иначе иначеесли исключение конецесли конецпопытки конецпроцедуры конецфункции конеццикла константа не перейти перем перечисление по пока попытка прервать продолжить процедура строка тогда фс функция цикл число экспорт",n="ansitooem oemtoansi ввестивидсубконто ввестидату ввестизначение ввестиперечисление ввестипериод ввестиплансчетов ввестистроку ввестичисло вопрос восстановитьзначение врег выбранныйплансчетов вызватьисключение датагод датамесяц датачисло добавитьмесяц завершитьработусистемы заголовоксистемы записьжурналарегистрации запуститьприложение зафиксироватьтранзакцию значениевстроку значениевстрокувнутр значениевфайл значениеизстроки значениеизстрокивнутр значениеизфайла имякомпьютера имяпользователя каталогвременныхфайлов каталогиб каталогпользователя каталогпрограммы кодсимв командасистемы конгода конецпериодаби конецрассчитанногопериодаби конецстандартногоинтервала конквартала конмесяца коннедели лев лог лог10 макс максимальноеколичествосубконто мин монопольныйрежим названиеинтерфейса названиенабораправ назначитьвид назначитьсчет найти найтипомеченныенаудаление найтиссылки началопериодаби началостандартногоинтервала начатьтранзакцию начгода начквартала начмесяца начнедели номерднягода номерднянедели номернеделигода нрег обработкаожидания окр описаниеошибки основнойжурналрасчетов основнойплансчетов основнойязык открытьформу открытьформумодально отменитьтранзакцию очиститьокносообщений периодстр полноеимяпользователя получитьвремята получитьдатута получитьдокументта получитьзначенияотбора получитьпозициюта получитьпустоезначение получитьта прав праводоступа предупреждение префиксавтонумерации пустаястрока пустоезначение рабочаядаттьпустоезначение рабочаядата разделительстраниц разделительстрок разм разобратьпозициюдокумента рассчитатьрегистрына рассчитатьрегистрыпо сигнал симв символтабуляции создатьобъект сокрл сокрлп сокрп сообщить состояние сохранитьзначение сред статусвозврата стрдлина стрзаменить стрколичествострок стрполучитьстроку  стрчисловхождений сформироватьпозициюдокумента счетпокоду текущаядата текущеевремя типзначения типзначениястр удалитьобъекты установитьтана установитьтапо фиксшаблон формат цел шаблон",s={cN:"dquote",b:'""'},o={cN:"string",b:'"',e:'"|$',c:[s],r:0},r={cN:"string",b:"\\|",e:'"|$',c:[s]};return{cI:!0,l:e,k:{keyword:i,built_in:n},c:[t.CLCM,t.NM,o,r,{cN:"function",b:"(процедура|функция)",e:"$",l:e,k:"процедура функция",c:[{cN:"title",b:e},{cN:"tail",eW:!0,c:[{cN:"params",b:"\\(",e:"\\)",l:e,k:"знач",c:[o,r]},{cN:"export",b:"экспорт",eW:!0,l:e,k:"экспорт",c:[t.CLCM]}]},t.CLCM]},{cN:"preprocessor",b:"#",e:"$"},{cN:"date",b:"'\\d{2}\\.\\d{2}\\.(\\d{2}|\\d{4})'"}]}}(hljs),hljs.LANGUAGES.python=function(t){var e={cN:"prompt",b:"^(>>>|\\.\\.\\.) "},i=[{cN:"string",b:"(u|b)?r?'''",e:"'''",c:[e],r:10},{cN:"string",b:'(u|b)?r?"""',e:'"""',c:[e],r:10},{cN:"string",b:"(u|r|ur)'",e:"'",c:[t.BE],r:10},{cN:"string",b:'(u|r|ur)"',e:'"',c:[t.BE],r:10},{cN:"string",b:"(b|br)'",e:"'",c:[t.BE]},{cN:"string",b:'(b|br)"',e:'"',c:[t.BE]}].concat([t.ASM,t.QSM]),n={cN:"title",b:t.UIR},s={cN:"params",b:"\\(",e:"\\)",c:["self",t.CNM,e].concat(i)},o={bWK:!0,e:":",i:"[${=;\\n]",c:[n,s],r:10};return{k:{keyword:"and elif is global as in if from raise for except finally print import pass return exec else break not with class assert yield try while continue del or def lambda nonlocal|10",built_in:"None True False Ellipsis NotImplemented"},i:"(</|->|\\?)",c:i.concat([e,t.HCM,t.inherit(o,{cN:"function",k:"def"}),t.inherit(o,{cN:"class",k:"class"}),t.CNM,{cN:"decorator",b:"@",e:"$"},{b:"\\b(print|exec)\\("}])}}(hljs),hljs.LANGUAGES.tex=function(){var t={cN:"command",b:"\\\\[a-zA-Zа-яА-я]+[\\*]?"},e={cN:"command",b:"\\\\[^a-zA-Zа-яА-я0-9]"},i={cN:"special",b:"[{}\\[\\]\\&#~]",r:0};return{c:[{b:"\\\\[a-zA-Zа-яА-я]+[\\*]? *= *-?\\d*\\.?\\d+(pt|pc|mm|cm|in|dd|cc|ex|em)?",rB:!0,c:[t,e,{cN:"number",b:" *=",e:"-?\\d*\\.?\\d+(pt|pc|mm|cm|in|dd|cc|ex|em)?",eB:!0}],r:10},t,e,i,{cN:"formula",b:"\\$\\$",e:"\\$\\$",c:[t,e,i],r:0},{cN:"formula",b:"\\$",e:"\\$",c:[t,e,i],r:0},{cN:"comment",b:"%",e:"$",r:0}]}}(hljs),hljs.LANGUAGES.sql=function(t){return{cI:!0,c:[{cN:"operator",b:"(begin|start|commit|rollback|savepoint|lock|alter|create|drop|rename|call|delete|do|handler|insert|load|replace|select|truncate|update|set|show|pragma|grant)\\b(?!:)",e:";",eW:!0,k:{keyword:"all partial global month current_timestamp using go revoke smallint indicator end-exec disconnect zone with character assertion to add current_user usage input local alter match collate real then rollback get read timestamp session_user not integer bit unique day minute desc insert execute like ilike|2 level decimal drop continue isolation found where constraints domain right national some module transaction relative second connect escape close system_user for deferred section cast current sqlstate allocate intersect deallocate numeric public preserve full goto initially asc no key output collation group by union session both last language constraint column of space foreign deferrable prior connection unknown action commit view or first into float year primary cascaded except restrict set references names table outer open select size are rows from prepare distinct leading create only next inner authorization schema corresponding option declare precision immediate else timezone_minute external varying translation true case exception join hour default double scroll value cursor descriptor values dec fetch procedure delete and false int is describe char as at in varchar null trailing any absolute current_time end grant privileges when cross check write current_date pad begin temporary exec time update catalog user sql date on identity timezone_hour natural whenever interval work order cascade diagnostics nchar having left call do handler load replace truncate start lock show pragma exists number",aggregate:"count sum min max avg"},c:[{cN:"string",b:"'",e:"'",c:[t.BE,{b:"''"}],r:0},{cN:"string",b:'"',e:'"',c:[t.BE,{b:'""'}],r:0},{cN:"string",b:"`",e:"`",c:[t.BE]},t.CNM]},t.CBLCLM,{cN:"comment",b:"--",e:"$"}]}}(hljs),hljs.LANGUAGES.ini=function(t){return{cI:!0,i:"[^\\s]",c:[{cN:"comment",b:";",e:"$"},{cN:"title",b:"^\\[",e:"\\]"},{cN:"setting",b:"^[a-z0-9\\[\\]_-]+[ \\t]*=[ \\t]*",e:"$",c:[{cN:"value",eW:!0,k:"on off true false yes no",c:[t.QSM,t.NM]}]}]}}(hljs),hljs.LANGUAGES.perl=function(t){var e="getpwent getservent quotemeta msgrcv scalar kill dbmclose undef lc ma syswrite tr send umask sysopen shmwrite vec qx utime local oct semctl localtime readpipe do return format read sprintf dbmopen pop getpgrp not getpwnam rewinddir qqfileno qw endprotoent wait sethostent bless s|0 opendir continue each sleep endgrent shutdown dump chomp connect getsockname die socketpair close flock exists index shmgetsub for endpwent redo lstat msgctl setpgrp abs exit select print ref gethostbyaddr unshift fcntl syscall goto getnetbyaddr join gmtime symlink semget splice x|0 getpeername recv log setsockopt cos last reverse gethostbyname getgrnam study formline endhostent times chop length gethostent getnetent pack getprotoent getservbyname rand mkdir pos chmod y|0 substr endnetent printf next open msgsnd readdir use unlink getsockopt getpriority rindex wantarray hex system getservbyport endservent int chr untie rmdir prototype tell listen fork shmread ucfirst setprotoent else sysseek link getgrgid shmctl waitpid unpack getnetbyname reset chdir grep split require caller lcfirst until warn while values shift telldir getpwuid my getprotobynumber delete and sort uc defined srand accept package seekdir getprotobyname semop our rename seek if q|0 chroot sysread setpwent no crypt getc chown sqrt write setnetent setpriority foreach tie sin msgget map stat getlogin unless elsif truncate exec keys glob tied closedirioctl socket readlink eval xor readline binmode setservent eof ord bind alarm pipe atan2 getgrent exp time push setgrent gt lt or ne m|0 break given say state when",i={cN:"subst",b:"[$@]\\{",e:"\\}",k:e,r:10},n={cN:"variable",b:"\\$\\d"},s={cN:"variable",b:"[\\$\\%\\@\\*](\\^\\w\\b|#\\w+(\\:\\:\\w+)*|[^\\s\\w{]|{\\w+}|\\w+(\\:\\:\\w*)*)"},o=[t.BE,i,n,s],r={b:"->",c:[{b:t.IR},{b:"{",e:"}"}]},a={cN:"comment",b:"^(__END__|__DATA__)",e:"\\n$",r:5},l=[n,s,t.HCM,a,{cN:"comment",b:"^\\=\\w",e:"\\=cut",eW:!0},r,{cN:"string",b:"q[qwxr]?\\s*\\(",e:"\\)",c:o,r:5},{cN:"string",b:"q[qwxr]?\\s*\\[",e:"\\]",c:o,r:5},{cN:"string",b:"q[qwxr]?\\s*\\{",e:"\\}",c:o,r:5},{cN:"string",b:"q[qwxr]?\\s*\\|",e:"\\|",c:o,r:5},{cN:"string",b:"q[qwxr]?\\s*\\<",e:"\\>",c:o,r:5},{cN:"string",b:"qw\\s+q",e:"q",c:o,r:5},{cN:"string",b:"'",e:"'",c:[t.BE],r:0},{cN:"string",b:'"',e:'"',c:o,r:0},{cN:"string",b:"`",e:"`",c:[t.BE]},{cN:"string",b:"{\\w+}",r:0},{cN:"string",b:"-?\\w+\\s*\\=\\>",r:0},{cN:"number",b:"(\\b0[0-7_]+)|(\\b0x[0-9a-fA-F_]+)|(\\b[1-9][0-9_]*(\\.[0-9_]+)?)|[0_]\\b",r:0},{b:"("+t.RSR+"|\\b(split|return|print|reverse|grep)\\b)\\s*",k:"split return print reverse grep",r:0,c:[t.HCM,a,{cN:"regexp",b:"(s|tr|y)/(\\\\.|[^/])*/(\\\\.|[^/])*/[a-z]*",r:10},{cN:"regexp",b:"(m|qr)?/",e:"/[a-z]*",c:[t.BE],r:0}]},{cN:"sub",bWK:!0,e:"(\\s*\\(.*?\\))?[;{]",k:"sub",r:5},{cN:"operator",b:"-\\w\\b",r:0}];
return i.c=l,r.c[1].c=l,{k:e,c:l}}(hljs),hljs.LANGUAGES.scala=function(t){var e={cN:"annotation",b:"@[A-Za-z]+"},i={cN:"string",b:'u?r?"""',e:'"""',r:10};return{k:"type yield lazy override def with val var false true sealed abstract private trait object null if for while throw finally protected extends import final return else break new catch super class case package default try this match continue throws",c:[{cN:"javadoc",b:"/\\*\\*",e:"\\*/",c:[{cN:"javadoctag",b:"@[A-Za-z]+"}],r:10},t.CLCM,t.CBLCLM,t.ASM,t.QSM,i,{cN:"class",b:"((case )?class |object |trait )",e:"({|$)",i:":",k:"case class trait object",c:[{bWK:!0,k:"extends with",r:10},{cN:"title",b:t.UIR},{cN:"params",b:"\\(",e:"\\)",c:[t.ASM,t.QSM,i,e]}]},t.CNM,e]}}(hljs),hljs.LANGUAGES.cmake=function(t){return{cI:!0,k:"add_custom_command add_custom_target add_definitions add_dependencies add_executable add_library add_subdirectory add_test aux_source_directory break build_command cmake_minimum_required cmake_policy configure_file create_test_sourcelist define_property else elseif enable_language enable_testing endforeach endfunction endif endmacro endwhile execute_process export find_file find_library find_package find_path find_program fltk_wrap_ui foreach function get_cmake_property get_directory_property get_filename_component get_property get_source_file_property get_target_property get_test_property if include include_directories include_external_msproject include_regular_expression install link_directories load_cache load_command macro mark_as_advanced message option output_required_files project qt_wrap_cpp qt_wrap_ui remove_definitions return separate_arguments set set_directory_properties set_property set_source_files_properties set_target_properties set_tests_properties site_name source_group string target_link_libraries try_compile try_run unset variable_watch while build_name exec_program export_library_dependencies install_files install_programs install_targets link_libraries make_directory remove subdir_depends subdirs use_mangled_mesa utility_source variable_requires write_file",c:[{cN:"envvar",b:"\\${",e:"}"},t.HCM,t.QSM,t.NM]}}(hljs),hljs.LANGUAGES.objectivec=function(t){var e={keyword:"int float while private char catch export sizeof typedef const struct for union unsigned long volatile static protected bool mutable if public do return goto void enum else break extern class asm case short default double throw register explicit signed typename try this switch continue wchar_t inline readonly assign property protocol self synchronized end synthesize id optional required implementation nonatomic interface super unichar finally dynamic IBOutlet IBAction selector strong weak readonly",literal:"false true FALSE TRUE nil YES NO NULL",built_in:"NSString NSDictionary CGRect CGPoint UIButton UILabel UITextView UIWebView MKMapView UISegmentedControl NSObject UITableViewDelegate UITableViewDataSource NSThread UIActivityIndicator UITabbar UIToolBar UIBarButtonItem UIImageView NSAutoreleasePool UITableView BOOL NSInteger CGFloat NSException NSLog NSMutableString NSMutableArray NSMutableDictionary NSURL NSIndexPath CGSize UITableViewCell UIView UIViewController UINavigationBar UINavigationController UITabBarController UIPopoverController UIPopoverControllerDelegate UIImage NSNumber UISearchBar NSFetchedResultsController NSFetchedResultsChangeType UIScrollView UIScrollViewDelegate UIEdgeInsets UIColor UIFont UIApplication NSNotFound NSNotificationCenter NSNotification UILocalNotification NSBundle NSFileManager NSTimeInterval NSDate NSCalendar NSUserDefaults UIWindow NSRange NSArray NSError NSURLRequest NSURLConnection class UIInterfaceOrientation MPMoviePlayerController dispatch_once_t dispatch_queue_t dispatch_sync dispatch_async dispatch_once"};return{k:e,i:"</",c:[t.CLCM,t.CBLCLM,t.CNM,t.QSM,{cN:"string",b:"'",e:"[^\\\\]'",i:"[^\\\\][^']"},{cN:"preprocessor",b:"#import",e:"$",c:[{cN:"title",b:'"',e:'"'},{cN:"title",b:"<",e:">"}]},{cN:"preprocessor",b:"#",e:"$"},{cN:"class",bWK:!0,e:"({|$)",k:"interface class protocol implementation",c:[{cN:"id",b:t.UIR}]},{cN:"variable",b:"\\."+t.UIR}]}}(hljs),hljs.LANGUAGES.coffeescript=function(t){var e={keyword:"in if for while finally new do return else break catch instanceof throw try this switch continue typeof delete debugger super then unless until loop of by when and or is isnt not",literal:"true false null undefined yes no on off ",reserved:"case default function var void with const let enum export import native __hasProp __extends __slice __bind __indexOf"},i="[A-Za-z$_][0-9A-Za-z$_]*",n={cN:"title",b:i},s={cN:"subst",b:"#\\{",e:"}",k:e,c:[t.BNM,t.CNM]};return{k:e,c:[t.BNM,t.CNM,t.ASM,{cN:"string",b:'"""',e:'"""',c:[t.BE,s]},{cN:"string",b:'"',e:'"',c:[t.BE,s],r:0},{cN:"comment",b:"###",e:"###"},t.HCM,{cN:"regexp",b:"///",e:"///",c:[t.HCM]},{cN:"regexp",b:"//[gim]*"},{cN:"regexp",b:"/\\S(\\\\.|[^\\n])*/[gim]*"},{b:"`",e:"`",eB:!0,eE:!0,sL:"javascript"},{cN:"function",b:i+"\\s*=\\s*(\\(.+\\))?\\s*[-=]>",rB:!0,c:[n,{cN:"params",b:"\\(",e:"\\)"}]},{cN:"class",bWK:!0,k:"class",e:"$",i:":",c:[{bWK:!0,k:"extends",eW:!0,i:":",c:[n]},n]},{cN:"property",b:"@"+i}]}}(hljs),hljs.LANGUAGES.nginx=function(t){var e=[{cN:"variable",b:"\\$\\d+"},{cN:"variable",b:"\\${",e:"}"},{cN:"variable",b:"[\\$\\@]"+t.UIR}],i={eW:!0,l:"[a-z/_]+",k:{built_in:"on off yes no true false none blocked debug info notice warn error crit select break last permanent redirect kqueue rtsig epoll poll /dev/poll"},r:0,i:"=>",c:[t.HCM,{cN:"string",b:'"',e:'"',c:[t.BE].concat(e),r:0},{cN:"string",b:"'",e:"'",c:[t.BE].concat(e),r:0},{cN:"url",b:"([a-z]+):/",e:"\\s",eW:!0,eE:!0},{cN:"regexp",b:"\\s\\^",e:"\\s|{|;",rE:!0,c:[t.BE].concat(e)},{cN:"regexp",b:"~\\*?\\s+",e:"\\s|{|;",rE:!0,c:[t.BE].concat(e)},{cN:"regexp",b:"\\*(\\.[a-z\\-]+)+",c:[t.BE].concat(e)},{cN:"regexp",b:"([a-z\\-]+\\.)+\\*",c:[t.BE].concat(e)},{cN:"number",b:"\\b\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}(:\\d{1,5})?\\b"},{cN:"number",b:"\\b\\d+[kKmMgGdshdwy]*\\b",r:0}].concat(e)};return{c:[t.HCM,{b:t.UIR+"\\s",e:";|{",rB:!0,c:[{cN:"title",b:t.UIR,starts:i}]}],i:"[^\\s\\}]"}}(hljs),hljs.LANGUAGES["erlang-repl"]=function(t){return{k:{special_functions:"spawn spawn_link self",reserved:"after and andalso|10 band begin bnot bor bsl bsr bxor case catch cond div end fun if let not of or orelse|10 query receive rem try when xor"},c:[{cN:"prompt",b:"^[0-9]+> ",r:10},{cN:"comment",b:"%",e:"$"},{cN:"number",b:"\\b(\\d+#[a-fA-F0-9]+|\\d+(\\.\\d+)?([eE][-+]?\\d+)?)",r:0},t.ASM,t.QSM,{cN:"constant",b:"\\?(::)?([A-Z]\\w*(::)?)+"},{cN:"arrow",b:"->"},{cN:"ok",b:"ok"},{cN:"exclamation_mark",b:"!"},{cN:"function_or_atom",b:"(\\b[a-z'][a-zA-Z0-9_']*:[a-z'][a-zA-Z0-9_']*)|(\\b[a-z'][a-zA-Z0-9_']*)",r:0},{cN:"variable",b:"[A-Z][a-zA-Z0-9_']*",r:0}]}}(hljs),hljs.LANGUAGES.r=function(t){var e="([a-zA-Z]|\\.[a-zA-Z.])[a-zA-Z0-9._]*";return{c:[t.HCM,{b:e,l:e,k:{keyword:"function if in break next repeat else for return switch while try tryCatch|10 stop warning require library attach detach source setMethod setGeneric setGroupGeneric setClass ...|10",literal:"NULL NA TRUE FALSE T F Inf NaN NA_integer_|10 NA_real_|10 NA_character_|10 NA_complex_|10"},r:0},{cN:"number",b:"0[xX][0-9a-fA-F]+[Li]?\\b",r:0},{cN:"number",b:"\\d+(?:[eE][+\\-]?\\d*)?L\\b",r:0},{cN:"number",b:"\\d+\\.(?!\\d)(?:i\\b)?",r:0},{cN:"number",b:"\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d*)?i?\\b",r:0},{cN:"number",b:"\\.\\d+(?:[eE][+\\-]?\\d*)?i?\\b",r:0},{b:"`",e:"`",r:0},{cN:"string",b:'"',e:'"',c:[t.BE],r:0},{cN:"string",b:"'",e:"'",c:[t.BE],r:0}]}}(hljs),hljs.LANGUAGES.json=function(t){var e={literal:"true false null"},i=[t.QSM,t.CNM],n={cN:"value",e:",",eW:!0,eE:!0,c:i,k:e},s={b:"{",e:"}",c:[{cN:"attribute",b:'\\s*"',e:'"\\s*:\\s*',eB:!0,eE:!0,c:[t.BE],i:"\\n",starts:n}],i:"\\S"},o={b:"\\[",e:"\\]",c:[t.inherit(n,{cN:null})],i:"\\S"};return i.splice(i.length,0,s,o),{c:i,k:e,i:"\\S"}}(hljs),hljs.LANGUAGES.django=function(t){function e(t,e){return void 0==e||!t.cN&&"tag"==e.cN||"value"==t.cN}function i(t,n){var o={};for(var r in t){"contains"!=r&&(o[r]=t[r]);for(var a=[],l=0;t.c&&l<t.c.length;l++)a.push(i(t.c[l],t));e(t,n)&&(a=s.concat(a)),a.length&&(o.c=a)}return o}var n={cN:"filter",b:"\\|[A-Za-z]+\\:?",eE:!0,k:"truncatewords removetags linebreaksbr yesno get_digit timesince random striptags filesizeformat escape linebreaks length_is ljust rjust cut urlize fix_ampersands title floatformat capfirst pprint divisibleby add make_list unordered_list urlencode timeuntil urlizetrunc wordcount stringformat linenumbers slice date dictsort dictsortreversed default_if_none pluralize lower join center default truncatewords_html upper length phone2numeric wordwrap time addslashes slugify first escapejs force_escape iriencode last safe safeseq truncatechars localize unlocalize localtime utc timezone",c:[{cN:"argument",b:'"',e:'"'}]},s=[{cN:"template_comment",b:"{%\\s*comment\\s*%}",e:"{%\\s*endcomment\\s*%}"},{cN:"template_comment",b:"{#",e:"#}"},{cN:"template_tag",b:"{%",e:"%}",k:"comment endcomment load templatetag ifchanged endifchanged if endif firstof for endfor in ifnotequal endifnotequal widthratio extends include spaceless endspaceless regroup by as ifequal endifequal ssi now with cycle url filter endfilter debug block endblock else autoescape endautoescape csrf_token empty elif endwith static trans blocktrans endblocktrans get_static_prefix get_media_prefix plural get_current_language language get_available_languages get_current_language_bidi get_language_info get_language_info_list localize endlocalize localtime endlocaltime timezone endtimezone get_current_timezone",c:[n]},{cN:"variable",b:"{{",e:"}}",c:[n]}],o=i(t.LANGUAGES.xml);return o.cI=!0,o}(hljs),hljs.LANGUAGES.dos=function(){return{cI:!0,k:{flow:"if else goto for in do call exit not exist errorlevel defined equ neq lss leq gtr geq",keyword:"shift cd dir echo setlocal endlocal set pause copy",stream:"prn nul lpt3 lpt2 lpt1 con com4 com3 com2 com1 aux",winutils:"ping net ipconfig taskkill xcopy ren del"},c:[{cN:"envvar",b:"%%[^ ]"},{cN:"envvar",b:"%[^ ]+?%"},{cN:"envvar",b:"![^ ]+?!"},{cN:"number",b:"\\b\\d+",r:0},{cN:"comment",b:"@?rem",e:"$"}]}}(hljs),hljs.LANGUAGES.apache=function(t){var e={cN:"number",b:"[\\$%]\\d+"};return{cI:!0,k:{keyword:"acceptfilter acceptmutex acceptpathinfo accessfilename action addalt addaltbyencoding addaltbytype addcharset adddefaultcharset adddescription addencoding addhandler addicon addiconbyencoding addiconbytype addinputfilter addlanguage addmoduleinfo addoutputfilter addoutputfilterbytype addtype alias aliasmatch allow allowconnect allowencodedslashes allowoverride anonymous anonymous_logemail anonymous_mustgiveemail anonymous_nouserid anonymous_verifyemail authbasicauthoritative authbasicprovider authdbduserpwquery authdbduserrealmquery authdbmgroupfile authdbmtype authdbmuserfile authdefaultauthoritative authdigestalgorithm authdigestdomain authdigestnccheck authdigestnonceformat authdigestnoncelifetime authdigestprovider authdigestqop authdigestshmemsize authgroupfile authldapbinddn authldapbindpassword authldapcharsetconfig authldapcomparednonserver authldapdereferencealiases authldapgroupattribute authldapgroupattributeisdn authldapremoteuserattribute authldapremoteuserisdn authldapurl authname authnprovideralias authtype authuserfile authzdbmauthoritative authzdbmtype authzdefaultauthoritative authzgroupfileauthoritative authzldapauthoritative authzownerauthoritative authzuserauthoritative balancermember browsermatch browsermatchnocase bufferedlogs cachedefaultexpire cachedirlength cachedirlevels cachedisable cacheenable cachefile cacheignorecachecontrol cacheignoreheaders cacheignorenolastmod cacheignorequerystring cachelastmodifiedfactor cachemaxexpire cachemaxfilesize cacheminfilesize cachenegotiateddocs cacheroot cachestorenostore cachestoreprivate cgimapextension charsetdefault charsetoptions charsetsourceenc checkcaseonly checkspelling chrootdir contentdigest cookiedomain cookieexpires cookielog cookiename cookiestyle cookietracking coredumpdirectory customlog dav davdepthinfinity davgenericlockdb davlockdb davmintimeout dbdexptime dbdkeep dbdmax dbdmin dbdparams dbdpersist dbdpreparesql dbdriver defaulticon defaultlanguage defaulttype deflatebuffersize deflatecompressionlevel deflatefilternote deflatememlevel deflatewindowsize deny directoryindex directorymatch directoryslash documentroot dumpioinput dumpiologlevel dumpiooutput enableexceptionhook enablemmap enablesendfile errordocument errorlog example expiresactive expiresbytype expiresdefault extendedstatus extfilterdefine extfilteroptions fileetag filterchain filterdeclare filterprotocol filterprovider filtertrace forcelanguagepriority forcetype forensiclog gracefulshutdowntimeout group header headername hostnamelookups identitycheck identitychecktimeout imapbase imapdefault imapmenu include indexheadinsert indexignore indexoptions indexorderdefault indexstylesheet isapiappendlogtoerrors isapiappendlogtoquery isapicachefile isapifakeasync isapilognotsupported isapireadaheadbuffer keepalive keepalivetimeout languagepriority ldapcacheentries ldapcachettl ldapconnectiontimeout ldapopcacheentries ldapopcachettl ldapsharedcachefile ldapsharedcachesize ldaptrustedclientcert ldaptrustedglobalcert ldaptrustedmode ldapverifyservercert limitinternalrecursion limitrequestbody limitrequestfields limitrequestfieldsize limitrequestline limitxmlrequestbody listen listenbacklog loadfile loadmodule lockfile logformat loglevel maxclients maxkeepaliverequests maxmemfree maxrequestsperchild maxrequestsperthread maxspareservers maxsparethreads maxthreads mcachemaxobjectcount mcachemaxobjectsize mcachemaxstreamingbuffer mcacheminobjectsize mcacheremovalalgorithm mcachesize metadir metafiles metasuffix mimemagicfile minspareservers minsparethreads mmapfile mod_gzip_on mod_gzip_add_header_count mod_gzip_keep_workfiles mod_gzip_dechunk mod_gzip_min_http mod_gzip_minimum_file_size mod_gzip_maximum_file_size mod_gzip_maximum_inmem_size mod_gzip_temp_dir mod_gzip_item_include mod_gzip_item_exclude mod_gzip_command_version mod_gzip_can_negotiate mod_gzip_handle_methods mod_gzip_static_suffix mod_gzip_send_vary mod_gzip_update_static modmimeusepathinfo multiviewsmatch namevirtualhost noproxy nwssltrustedcerts nwsslupgradeable options order passenv pidfile protocolecho proxybadheader proxyblock proxydomain proxyerroroverride proxyftpdircharset proxyiobuffersize proxymaxforwards proxypass proxypassinterpolateenv proxypassmatch proxypassreverse proxypassreversecookiedomain proxypassreversecookiepath proxypreservehost proxyreceivebuffersize proxyremote proxyremotematch proxyrequests proxyset proxystatus proxytimeout proxyvia readmename receivebuffersize redirect redirectmatch redirectpermanent redirecttemp removecharset removeencoding removehandler removeinputfilter removelanguage removeoutputfilter removetype requestheader require rewritebase rewritecond rewriteengine rewritelock rewritelog rewriteloglevel rewritemap rewriteoptions rewriterule rlimitcpu rlimitmem rlimitnproc satisfy scoreboardfile script scriptalias scriptaliasmatch scriptinterpretersource scriptlog scriptlogbuffer scriptloglength scriptsock securelisten seerequesttail sendbuffersize serveradmin serveralias serverlimit servername serverpath serverroot serversignature servertokens setenv setenvif setenvifnocase sethandler setinputfilter setoutputfilter ssienableaccess ssiendtag ssierrormsg ssistarttag ssitimeformat ssiundefinedecho sslcacertificatefile sslcacertificatepath sslcadnrequestfile sslcadnrequestpath sslcarevocationfile sslcarevocationpath sslcertificatechainfile sslcertificatefile sslcertificatekeyfile sslciphersuite sslcryptodevice sslengine sslhonorciperorder sslmutex ssloptions sslpassphrasedialog sslprotocol sslproxycacertificatefile sslproxycacertificatepath sslproxycarevocationfile sslproxycarevocationpath sslproxyciphersuite sslproxyengine sslproxymachinecertificatefile sslproxymachinecertificatepath sslproxyprotocol sslproxyverify sslproxyverifydepth sslrandomseed sslrequire sslrequiressl sslsessioncache sslsessioncachetimeout sslusername sslverifyclient sslverifydepth startservers startthreads substitute suexecusergroup threadlimit threadsperchild threadstacksize timeout traceenable transferlog typesconfig unsetenv usecanonicalname usecanonicalphysicalport user userdir virtualdocumentroot virtualdocumentrootip virtualscriptalias virtualscriptaliasip win32disableacceptex xbithack",literal:"on off"},c:[t.HCM,{cN:"sqbracket",b:"\\s\\[",e:"\\]$"},{cN:"cbracket",b:"[\\$%]\\{",e:"\\}",c:["self",e]},e,{cN:"tag",b:"</?",e:">"},t.QSM]}}(hljs),hljs.LANGUAGES.applescript=function(t){var e=t.inherit(t.QSM,{i:""}),i={cN:"title",b:t.UIR},n={cN:"params",b:"\\(",e:"\\)",c:["self",t.CNM,e]},s=[{cN:"comment",b:"--",e:"$"},{cN:"comment",b:"\\(\\*",e:"\\*\\)",c:["self",{b:"--",e:"$"}]},t.HCM];return{k:{keyword:"about above after against and around as at back before beginning behind below beneath beside between but by considering contain contains continue copy div does eighth else end equal equals error every exit fifth first for fourth from front get given global if ignoring in into is it its last local me middle mod my ninth not of on onto or over prop property put ref reference repeat returning script second set seventh since sixth some tell tenth that the then third through thru timeout times to transaction try until where while whose with without",constant:"AppleScript false linefeed return pi quote result space tab true",type:"alias application boolean class constant date file integer list number real record string text",command:"activate beep count delay launch log offset read round run say summarize write",property:"character characters contents day frontmost id item length month name paragraph paragraphs rest reverse running time version weekday word words year"},c:[e,t.CNM,{cN:"type",b:"\\bPOSIX file\\b"},{cN:"command",b:"\\b(clipboard info|the clipboard|info for|list (disks|folder)|mount volume|path to|(close|open for) access|(get|set) eof|current date|do shell script|get volume settings|random number|set volume|system attribute|system info|time to GMT|(load|run|store) script|scripting components|ASCII (character|number)|localized string|choose (application|color|file|file name|folder|from list|remote application|URL)|display (alert|dialog))\\b|^\\s*return\\b"},{cN:"constant",b:"\\b(text item delimiters|current application|missing value)\\b"},{cN:"keyword",b:"\\b(apart from|aside from|instead of|out of|greater than|isn't|(doesn't|does not) (equal|come before|come after|contain)|(greater|less) than( or equal)?|(starts?|ends|begins?) with|contained by|comes (before|after)|a (ref|reference))\\b"},{cN:"property",b:"\\b(POSIX path|(date|time) string|quoted form)\\b"},{cN:"function_start",bWK:!0,k:"on",i:"[${=;\\n]",c:[i,n]}].concat(s)}}(hljs),hljs.LANGUAGES.cpp=function(t){var e={keyword:"false int float while private char catch export virtual operator sizeof dynamic_cast|10 typedef const_cast|10 const struct for static_cast|10 union namespace unsigned long throw volatile static protected bool template mutable if public friend do return goto auto void enum else break new extern using true class asm case typeid short reinterpret_cast|10 default double register explicit signed typename try this switch continue wchar_t inline delete alignof char16_t char32_t constexpr decltype noexcept nullptr static_assert thread_local restrict _Bool complex",built_in:"std string cin cout cerr clog stringstream istringstream ostringstream auto_ptr deque list queue stack vector map set bitset multiset multimap unordered_set unordered_map unordered_multiset unordered_multimap array shared_ptr"};return{k:e,i:"</",c:[t.CLCM,t.CBLCLM,t.QSM,{cN:"string",b:"'\\\\?.",e:"'",i:"."},{cN:"number",b:"\\b(\\d+(\\.\\d*)?|\\.\\d+)(u|U|l|L|ul|UL|f|F)"},t.CNM,{cN:"preprocessor",b:"#",e:"$"},{cN:"stl_container",b:"\\b(deque|list|queue|stack|vector|map|set|bitset|multiset|multimap|unordered_map|unordered_set|unordered_multiset|unordered_multimap|array)\\s*<",e:">",k:e,r:10,c:["self"]}]}}(hljs),hljs.LANGUAGES.matlab=function(t){var e=[t.CNM,{cN:"string",b:"'",e:"'",c:[t.BE,{b:"''"}],r:0}];return{k:{keyword:"break case catch classdef continue else elseif end enumerated events for function global if methods otherwise parfor persistent properties return spmd switch try while",built_in:"sin sind sinh asin asind asinh cos cosd cosh acos acosd acosh tan tand tanh atan atand atan2 atanh sec secd sech asec asecd asech csc cscd csch acsc acscd acsch cot cotd coth acot acotd acoth hypot exp expm1 log log1p log10 log2 pow2 realpow reallog realsqrt sqrt nthroot nextpow2 abs angle complex conj imag real unwrap isreal cplxpair fix floor ceil round mod rem sign airy besselj bessely besselh besseli besselk beta betainc betaln ellipj ellipke erf erfc erfcx erfinv expint gamma gammainc gammaln psi legendre cross dot factor isprime primes gcd lcm rat rats perms nchoosek factorial cart2sph cart2pol pol2cart sph2cart hsv2rgb rgb2hsv zeros ones eye repmat rand randn linspace logspace freqspace meshgrid accumarray size length ndims numel disp isempty isequal isequalwithequalnans cat reshape diag blkdiag tril triu fliplr flipud flipdim rot90 find sub2ind ind2sub bsxfun ndgrid permute ipermute shiftdim circshift squeeze isscalar isvector ans eps realmax realmin pi i inf nan isnan isinf isfinite j why compan gallery hadamard hankel hilb invhilb magic pascal rosser toeplitz vander wilkinson"},i:'(//|"|#|/\\*|\\s+/\\w+)',c:[{cN:"function",bWK:!0,e:"$",k:"function",c:[{cN:"title",b:t.UIR},{cN:"params",b:"\\(",e:"\\)"},{cN:"params",b:"\\[",e:"\\]"}]},{cN:"transposed_variable",b:"[a-zA-Z_][a-zA-Z_0-9]*('+[\\.']*|[\\.']+)",e:""},{cN:"matrix",b:"\\[",e:"\\]'*[\\.']*",c:e},{cN:"cell",b:"\\{",e:"\\}'*[\\.']*",c:e},{cN:"comment",b:"\\%",e:"$"}].concat(e)}}(hljs),!function(t,e){"use strict";function i(t,e){var i,n;e=e||{},t="raven"+t.substr(0,1).toUpperCase()+t.substr(1),document.createEvent?(i=document.createEvent("HTMLEvents"),i.initEvent(t,!0,!0)):(i=document.createEventObject(),i.eventType=t);for(n in e)e.hasOwnProperty(n)&&(i[n]=e[n]);if(document.createEvent)document.dispatchEvent(i);else try{document.fireEvent("on"+i.eventType.toLowerCase(),i)}catch(s){}}function n(t){this.name="RavenConfigError",this.message=t}function s(t){var e=H.exec(t),i={},s=7;try{for(;s--;)i[$[s]]=e[s]||""}catch(o){throw new n("Invalid DSN: "+t)}if(i.pass)throw new n("Do not specify your private key in the DSN!");return i}function o(t){return"undefined"==typeof t}function r(t){return"function"==typeof t}function a(t){return"string"==typeof t}function l(t){for(var e in t)return!1;return!0}function c(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function d(t,e){var i,n;if(o(t.length))for(i in t)t.hasOwnProperty(i)&&e.call(null,i,t[i]);else if(n=t.length)for(i=0;n>i;i++)e.call(null,i,t[i])}function u(){P="?sentry_version=4&sentry_client=raven-js/"+F.VERSION+"&sentry_key="+C}function h(t,e){var n=[];t.stack&&t.stack.length&&d(t.stack,function(t,e){var i=p(e);i&&n.push(i)}),i("handle",{stackInfo:t,options:e}),f(t.name,t.message,t.url,t.lineno,n,e)}function p(t){if(t.url){var e,i={filename:t.url,lineno:t.line,colno:t.column,"function":t.func||"?"},n=m(t);if(n){var s=["pre_context","context_line","post_context"];for(e=3;e--;)i[s[e]]=n[e]}return i.in_app=!(!A.includePaths.test(i.filename)||/(Raven|TraceKit)\./.test(i["function"])||/raven\.(min\.)js$/.test(i.filename)),i}}function m(t){if(t.context&&A.fetchContext){for(var e=t.context,i=~~(e.length/2),n=e.length,s=!1;n--;)if(e[n].length>300){s=!0;break}if(s){if(o(t.column))return;return[[],e[i].substr(t.column,50),[]]}return[e.slice(0,i),e[i],e.slice(i+1)]}}function f(t,e,i,n,s,o){var r,a;e+="",("Error"!==t||e)&&(A.ignoreErrors.test(e)||(s&&s.length?(i=s[0].filename||i,s.reverse(),r={frames:s}):i&&(r={frames:[{filename:i,lineno:n,in_app:!0}]}),e=g(e,100),A.ignoreUrls&&A.ignoreUrls.test(i)||(!A.whitelistUrls||A.whitelistUrls.test(i))&&(a=n?e+" at "+n:e,k(_({exception:{type:t,value:e},stacktrace:r,culprit:i,message:a},o)))))}function _(t,e){return e?(d(e,function(e,i){t[e]=i}),t):t}function g(t,e){return t.length<=e?t:t.substr(0,e)+"…"}function b(){var t={url:document.location.href,headers:{"User-Agent":navigator.userAgent}};return document.referrer&&(t.headers.Referer=document.referrer),t}function k(t){y()&&(t=_({project:O,logger:A.logger,site:A.site,platform:"javascript",request:b()},t),t.tags=_(A.tags,t.tags),t.extra=_(A.extra,t.extra),l(t.tags)&&delete t.tags,l(t.extra)&&delete t.extra,T&&(t.user=T),r(A.dataCallback)&&(t=A.dataCallback(t)),(!r(A.shouldSendCallback)||A.shouldSendCallback(t))&&(D=t.event_id||(t.event_id=w()),v(t)))}function v(t){var e=new Image,n=N+P+"&sentry_data="+encodeURIComponent(JSON.stringify(t));e.onload=function(){i("success",{data:t,src:n})},e.onerror=e.onabort=function(){i("failure",{data:t,src:n})},e.src=n}function y(){return L?N?!0:(t.console&&console.error&&console.error("Error: Raven has not been configured."),!1):!1}function M(t){for(var e,i=[],n=0,s=t.length;s>n;n++)e=t[n],a(e)?i.push(e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")):e&&e.source&&i.push(e.source);return new RegExp(i.join("|"),"i")}function w(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"==t?e:3&e|8;return i.toString(16)})}function x(){var e=t.RavenConfig;e&&F.config(e.dsn,e.config).install()}var E={remoteFetching:!1,collectWindowErrors:!0,linesOfContext:7},B=[].slice,I="?";E.wrap=function(t){function e(){try{return t.apply(this,arguments)}catch(e){throw E.report(e),e}}return e},E.report=function(){function i(t){a(),m.push(t)}function n(t){for(var e=m.length-1;e>=0;--e)m[e]===t&&m.splice(e,1)}function s(){l(),m=[]}function o(t,e){var i=null;if(!e||E.collectWindowErrors){for(var n in m)if(c(m,n))try{m[n].apply(null,[t].concat(B.call(arguments,2)))}catch(s){i=s}if(i)throw i}}function r(t,e,i,n,s){var r=null;if(g)E.computeStackTrace.augmentStackTraceWithInitialElement(g,e,i,t),d();else if(s)r=E.computeStackTrace(s),o(r,!0);else{var a={url:e,line:i,column:n};a.func=E.computeStackTrace.guessFunctionName(a.url,a.line),a.context=E.computeStackTrace.gatherContext(a.url,a.line),r={message:t,url:document.location.href,stack:[a]},o(r,!0)}return h?h.apply(this,arguments):!1}function a(){p||(h=t.onerror,t.onerror=r,p=!0)}function l(){p&&(t.onerror=h,p=!1,h=e)}function d(){var t=g,e=f;f=null,g=null,_=null,o.apply(null,[t,!1].concat(e))}function u(e,i){var n=B.call(arguments,1);if(g){if(_===e)return;d()}var s=E.computeStackTrace(e);if(g=s,_=e,f=n,t.setTimeout(function(){_===e&&d()},s.incomplete?2e3:0),i!==!1)throw e}var h,p,m=[],f=null,_=null,g=null;return u.subscribe=i,u.unsubscribe=n,u.uninstall=s,u}(),E.computeStackTrace=function(){function e(e){if(!E.remoteFetching)return"";try{var i=function(){try{return new t.XMLHttpRequest}catch(e){return new t.ActiveXObject("Microsoft.XMLHTTP")}},n=i();return n.open("GET",e,!1),n.send(""),n.responseText}catch(s){return""}}function i(t){if(!a(t))return[];if(!c(y,t)){var i="";-1!==t.indexOf(document.domain)&&(i=e(t)),y[t]=i?i.split("\n"):[]}return y[t]}function n(t,e){var n,s=/function ([^(]*)\(([^)]*)\)/,r=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,a="",l=10,c=i(t);if(!c.length)return I;for(var d=0;l>d;++d)if(a=c[e-d]+a,!o(a)){if(n=r.exec(a))return n[1];if(n=s.exec(a))return n[1]}return I}function s(t,e){var n=i(t);if(!n.length)return null;var s=[],r=Math.floor(E.linesOfContext/2),a=r+E.linesOfContext%2,l=Math.max(0,e-r-1),c=Math.min(n.length,e+a-1);e-=1;for(var d=l;c>d;++d)o(n[d])||s.push(n[d]);return s.length>0?s:null}function r(t){return t.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,"\\$&")}function l(t){return r(t).replace("<","(?:<|&lt;)").replace(">","(?:>|&gt;)").replace("&","(?:&|&amp;)").replace('"','(?:"|&quot;)').replace(/\s+/g,"\\s+")}function d(t,e){for(var n,s,o=0,r=e.length;r>o;++o)if((n=i(e[o])).length&&(n=n.join("\n"),s=t.exec(n)))return{url:e[o],line:n.substring(0,s.index).split("\n").length,column:s.index-n.lastIndexOf("\n",s.index)-1};return null}function u(t,e,n){var s,o=i(e),a=new RegExp("\\b"+r(t)+"\\b");return n-=1,o&&o.length>n&&(s=a.exec(o[n]))?s.index:null}function h(e){for(var i,n,s,o,a=[t.location.href],c=document.getElementsByTagName("script"),u=""+e,h=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,p=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,m=0;m<c.length;++m){var f=c[m];f.src&&a.push(f.src)}if(s=h.exec(u)){var _=s[1]?"\\s+"+s[1]:"",g=s[2].split(",").join("\\s*,\\s*");i=r(s[3]).replace(/;$/,";?"),n=new RegExp("function"+_+"\\s*\\(\\s*"+g+"\\s*\\)\\s*{\\s*"+i+"\\s*}")}else n=new RegExp(r(u).replace(/\s+/g,"\\s+"));if(o=d(n,a))return o;if(s=p.exec(u)){var b=s[1];if(i=l(s[2]),n=new RegExp("on"+b+"=[\\'\"]\\s*"+i+"\\s*[\\'\"]","i"),o=d(n,a[0]))return o;if(n=new RegExp(i),o=d(n,a))return o}return null}function p(t){if(!t.stack)return null;for(var e,i,r=/^\s*at (?:((?:\[object object\])?\S+(?: \[as \S+\])?) )?\(?((?:file|https?):.*?):(\d+)(?::(\d+))?\)?\s*$/i,a=/^\s*(\S*)(?:\((.*?)\))?@((?:file|https?).*?):(\d+)(?::(\d+))?\s*$/i,l=t.stack.split("\n"),c=[],d=/^(.*) is undefined$/.exec(t.message),h=0,p=l.length;p>h;++h){if(e=a.exec(l[h]))i={url:e[3],func:e[1]||I,args:e[2]?e[2].split(","):"",line:+e[4],column:e[5]?+e[5]:null};else{if(!(e=r.exec(l[h])))continue;i={url:e[2],func:e[1]||I,line:+e[3],column:e[4]?+e[4]:null}}!i.func&&i.line&&(i.func=n(i.url,i.line)),i.line&&(i.context=s(i.url,i.line)),c.push(i)}return c.length?(c[0].line&&!c[0].column&&d?c[0].column=u(d[1],c[0].url,c[0].line):c[0].column||o(t.columnNumber)||(c[0].column=t.columnNumber+1),{name:t.name,message:t.message,url:document.location.href,stack:c}):null}function m(t){for(var e,i=t.stacktrace,o=/ line (\d+), column (\d+) in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\) in (.*):\s*$/i,r=i.split("\n"),a=[],l=0,c=r.length;c>l;l+=2)if(e=o.exec(r[l])){var d={line:+e[1],column:+e[2],func:e[3]||e[4],args:e[5]?e[5].split(","):[],url:e[6]};if(!d.func&&d.line&&(d.func=n(d.url,d.line)),d.line)try{d.context=s(d.url,d.line)}catch(u){}d.context||(d.context=[r[l+1]]),a.push(d)}return a.length?{name:t.name,message:t.message,url:document.location.href,stack:a}:null}function f(e){var o=e.message.split("\n");if(o.length<4)return null;var r,a,u,h,p=/^\s*Line (\d+) of linked script ((?:file|https?)\S+)(?:: in function (\S+))?\s*$/i,m=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|https?)\S+)(?:: in function (\S+))?\s*$/i,f=/^\s*Line (\d+) of function script\s*$/i,_=[],g=document.getElementsByTagName("script"),b=[];for(a in g)c(g,a)&&!g[a].src&&b.push(g[a]);for(a=2,u=o.length;u>a;a+=2){var k=null;if(r=p.exec(o[a]))k={url:r[2],func:r[3],line:+r[1]};else if(r=m.exec(o[a])){k={url:r[3],func:r[4]};var v=+r[1],y=b[r[2]-1];if(y&&(h=i(k.url))){h=h.join("\n");var M=h.indexOf(y.innerText);M>=0&&(k.line=v+h.substring(0,M).split("\n").length)}}else if(r=f.exec(o[a])){var w=t.location.href.replace(/#.*$/,""),x=r[1],E=new RegExp(l(o[a+1]));h=d(E,[w]),k={url:w,line:h?h.line:x,func:""}}if(k){k.func||(k.func=n(k.url,k.line));var B=s(k.url,k.line),I=B?B[Math.floor(B.length/2)]:null;k.context=B&&I.replace(/^\s*/,"")===o[a+1].replace(/^\s*/,"")?B:[o[a+1]],_.push(k)}}return _.length?{name:e.name,message:o[0],url:document.location.href,stack:_}:null}function _(t,e,i,o){var r={url:e,line:i};if(r.url&&r.line){t.incomplete=!1,r.func||(r.func=n(r.url,r.line)),r.context||(r.context=s(r.url,r.line));var a=/ '([^']+)' /.exec(o);if(a&&(r.column=u(a[1],r.url,r.line)),t.stack.length>0&&t.stack[0].url===r.url){if(t.stack[0].line===r.line)return!1;if(!t.stack[0].line&&t.stack[0].func===r.func)return t.stack[0].line=r.line,t.stack[0].context=r.context,!1}return t.stack.unshift(r),t.partial=!0,!0}return t.incomplete=!0,!1}function g(t,e){for(var i,s,o,r=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,a=[],l={},c=!1,d=g.caller;d&&!c;d=d.caller)if(d!==b&&d!==E.report){if(s={url:null,func:I,line:null,column:null},d.name?s.func=d.name:(i=r.exec(d.toString()))&&(s.func=i[1]),o=h(d)){s.url=o.url,s.line=o.line,s.func===I&&(s.func=n(s.url,s.line));
var p=/ '([^']+)' /.exec(t.message||t.description);p&&(s.column=u(p[1],o.url,o.line))}l[""+d]?c=!0:l[""+d]=!0,a.push(s)}e&&a.splice(0,e);var m={name:t.name,message:t.message,url:document.location.href,stack:a};return _(m,t.sourceURL||t.fileName,t.line||t.lineNumber,t.message||t.description),m}function b(t,e){var i=null;e=null==e?0:+e;try{if(i=m(t))return i}catch(n){if(v)throw n}try{if(i=p(t))return i}catch(n){if(v)throw n}try{if(i=f(t))return i}catch(n){if(v)throw n}try{if(i=g(t,e+1))return i}catch(n){if(v)throw n}return{}}function k(t){t=(null==t?0:+t)+1;try{throw new Error}catch(e){return b(e,t+1)}}var v=!1,y={};return b.augmentStackTraceWithInitialElement=_,b.guessFunctionName=n,b.gatherContext=s,b.ofCaller=k,b}();var S,D,N,T,C,O,P,j=t.Raven,L=!(!t.JSON||!t.JSON.stringify),A={logger:"javascript",ignoreErrors:[],ignoreUrls:[],whitelistUrls:[],includePaths:[],collectWindowErrors:!0,tags:{},extra:{}},F={VERSION:"1.1.15",noConflict:function(){return t.Raven=j,F},config:function(t,e){if(!t)return F;var i=s(t),n=i.path.lastIndexOf("/"),o=i.path.substr(1,n);return e&&d(e,function(t,e){A[t]=e}),A.ignoreErrors.push("Script error."),A.ignoreErrors.push("Script error"),A.ignoreErrors=M(A.ignoreErrors),A.ignoreUrls=A.ignoreUrls.length?M(A.ignoreUrls):!1,A.whitelistUrls=A.whitelistUrls.length?M(A.whitelistUrls):!1,A.includePaths=M(A.includePaths),C=i.user,O=i.path.substr(n+1),N="//"+i.host+(i.port?":"+i.port:"")+"/"+o+"api/"+O+"/store/",i.protocol&&(N=i.protocol+":"+N),A.fetchContext&&(E.remoteFetching=!0),A.linesOfContext&&(E.linesOfContext=A.linesOfContext),E.collectWindowErrors=!!A.collectWindowErrors,u(),F},install:function(){return y()&&E.report.subscribe(h),F},context:function(t,i,n){return r(t)&&(n=i||[],i=t,t=e),F.wrap(t,i).apply(this,n)},wrap:function(t,i){function n(){for(var e=[],n=arguments.length,s=!t||t&&t.deep!==!1;n--;)e[n]=s?F.wrap(t,arguments[n]):arguments[n];try{return i.apply(this,e)}catch(o){throw F.captureException(o,t),o}}if(o(i)&&!r(t))return t;if(r(t)&&(i=t,t=e),!r(i))return i;if(i.__raven__)return i;for(var s in i)i.hasOwnProperty(s)&&(n[s]=i[s]);return n.__raven__=!0,n.__inner__=i,n},uninstall:function(){return E.report.uninstall(),F},captureException:function(t,e){if(!(t instanceof Error))return F.captureMessage(t,e);S=t;try{E.report(t,e)}catch(i){if(t!==i)throw i}return F},captureMessage:function(t,e){return k(_({message:t+""},e)),F},setUser:function(t){return T=t,F},lastException:function(){return S},lastEventId:function(){return D}},$="source protocol user pass host port path".split(" "),H=/^(?:(\w+):)?\/\/(\w+)(:\w+)?@([\w\.-]+)(?::(\d+))?(\/.*)/;n.prototype=new Error,n.prototype.constructor=n,x(),t.Raven=F,"function"==typeof define&&define.amd&&define("raven",[],function(){return F})}(this),function(t){t||(t=window.Lego={}),t.messages=t.messages||{},t.message=function(e,i){return"ru"==t.params.locale?i:t.messages[e]||i}}(window.Lego),BEM.DOM.decl("i-global",{onSetMod:{js:function(){this.del(this.__self._params=$.extend({},this.params),"uniqId","name");var t=this.__self._params;t["passport-msg"]||(t["passport-msg"]=t.id),void 0===t["show-counters"]&&(t["show-counters"]=Math.round(100*Math.random())<=t["show-counters-percent"]),t.locale=t.lang,$(function(){t.oframebust&&Lego.oframebust(t.oframebust)})}},getDefaultParams:function(){return{id:"",login:Lego.isSessionValid()?$.cookie("yandex_login")||"":"",yandexuid:$.cookie("yandexuid"),lang:"ru",tld:"ru",retpath:encodeURI($.decodeURI(location.href)),"passport-host":"https://passport.yandex.ru","pass-host":"//pass.yandex.ru","social-host":"//social.yandex.ru","lego-path":"/lego","show-counters-percent":100}}},{param:function(t){return(this._params||{})[t]}}),BEM.decl("i-global",{},{getbPage:function(){return this._bPage=this._bPage||$(".b-page_service_wiki").bem("b-page")}}),$(function(){BEM.afterCurrentEvent(function(){BEM.DOM.init()})}),BEM.blocks["i-explainer"]={uniqueLinks:[],linksTree:{},explainLinks:function(t){var e=this;this.uniqueLinks=[],this.linksTree={},t.findBlocksInside("link").forEach(function(t){e._addLink(t)}),this._sendExplainLinksRequest()},explainAllLinks:function(t){var e=this;this.uniqueLinks=[],this.linksTree={},t.findBlocksInside({block:"b-link",modName:"wiki",modVal:"yes"}).forEach(function(t){t.findBlockOn("wiki-ref").hasMod("type","docviewer")||e._addLink(t)}),t.findBlocksInside("wiki-action").forEach(function(t){t.findBlocksInside("link").forEach(function(t){e._addLink(t)})}),this._sendExplainLinksRequest()},_addLink:function(t){var e=t.domElem.attr("href");e&&($.inArray(e,this.uniqueLinks)<0&&(this.uniqueLinks.push(e),this.linksTree[e]=[]),this.linksTree[e].push(t))},_sendExplainLinksRequest:function(){this.uniqueLinks.length&&BEM.create("api-request",{_:"api-response",apiPath:".explainlinks",method:"POST",data:{links:this.uniqueLinks},urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(this._onExplainLinksSuccess.bind(this),this._onExplainLinksError.bind(this))},_onExplainLinksSuccess:function(t){var e=t.data.links;for(url in e)url in this.linksTree&&this.linksTree[url].forEach(function(t){(-1===e[url]||0===e[url])&&BEM.DOM.prepend(t.domElem,BEMHTML.apply({block:"awesome-icon",mods:{icon:-1===e[url]?"plus-sign":"lock",explainer:"yes"}}))})},_onExplainLinksError:function(t){console.log("==ERROR=="),console.log(t)}},BEM.DOM.decl("b-page",{onSetMod:{js:function(){this._configSentry()}},_configSentry:function(){Raven.config("http://645fe31e3ff4417f9f06d943141c43a1@sentry.test.yandex-team.ru/39").install(),Raven.setUser({email:this.params.login+"@yandex-team.ru",id:this.params.uid})},highLightCode:function(){$("code").each(function(t,e){hljs.highlightBlock(e)})},_routes:{".comments":"b-comments2",".edit":"b-editor-open-button",".files":"b-files2",".requestaccess":"i-access"}}),function(t){t=t||{},t.oframebustMatchDomain=function(t,e){t="[object Array]"===Object.prototype.toString.call(t)?t:function(){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e}();for(var i=0,n=t.length;n>i;i++){var s=t[i];if("string"==typeof s){if(/(\?|\*)/.test(s)){var o=s.replace(/\./g,"\\.").replace(/\*/g,".*").replace(/\?/g,".{1}");if(new RegExp("^"+o+"$").test(e))return!0}else if(e==s)return!0}else try{if(s.test(e))return!0}catch(r){}}}}(window.Lego),function(t){t=t||{},t.oframebust=function(e){if(window.top.location!=window.location){var i=document.referrer.match(/^https?:\/\/([^:\/\s]+)\/?.*/);if(!i)return;!t.oframebustMatchDomain(e,i[1])&&(window.top.location=window.location)}}}(window.Lego),BEM.DOM.decl("b-readonly",{onSetMod:{js:function(){var t=this;this._localStorage=BEM.blocks["mi-storage"],this.READ_ONLY_TIMEOUT=3e4,this.READ_ONLY_TIMEOUT_WAIT=5e3,BEM.channel("readonly").on("enable",function(){t.setMod("visibility","visible")}),BEM.channel("readonly").on("disable",function(){t.delMod("visibility")}),"closed"==this._localStorage.getItem("readonly")&&this.setMod("close","yes"),this._isReadOnlyRequest(),this._checkReadOnlyStatus(this.READ_ONLY_TIMEOUT)}},_checkReadOnlyStatus:function(t){this._timer&&clearInterval(this._timer),this._timer=setInterval(this._isReadOnlyRequest.bind(this),t)},_isReadOnlyRequest:function(){BEM.create("api-request",{_:"api-response",apiPath:".is_readonly",path:""}).run().then(this._onIsReadOnly.bind(this))},_onIsReadOnly:function(t){t.data.service_is_readonly?this._readOnlyStatus||(this._readOnlyStatus=!0,BEM.channel("readonly").trigger("enable"),this._checkReadOnlyStatus(this.READ_ONLY_TIMEOUT_WAIT)):this._readOnlyStatus&&(this._readOnlyStatus=!1,BEM.channel("readonly").trigger("disable"),this._checkReadOnlyStatus(this.READ_ONLY_TIMEOUT))}},{live:function(){return this.liveBindTo("icon","click",function(){this.delMod("close"),this._localStorage.removeItem("readonly")}),this.liveBindTo("close","click",function(){this.setMod("close","yes"),this._localStorage.setItem("readonly","closed")}),!1}}),BEM.DOM.decl("b-readonly-item",{onSetMod:{js:function(){this._isTable||(this._isTable=this.findBlockOn("b-grid-table")),this.__self._isReadOnly&&this.setMod("disabled","yes"),BEM.channel("readonly").on("enable",function(){this._isTable?(this._isTable.readOnly=!0,this._isTable.setMod("readonly",!0),this._isTable.rebuild()):(this.setMod("disabled","yes"),this.__self._isReadOnly=!0)},this),BEM.channel("readonly").on("disable",function(){this._isTable?(this._isTable.readOnly=!1,this._isTable.setMod("readonly",!1),this._isTable.rebuild()):(this.delMod("disabled"),this.__self._isReadOnly=!1)},this)}}},{_isReadOnly:!1}),function(){var t,e=0,i=!1,n=0,s=BEM.channel("sys"),o=50;BEM.decl("i-system",{},{start:function(){$(document).bind("mousemove keydown",function(){n=0,i&&(i=!1,s.trigger("wakeup"))}),this._tick()},_tick:function(){var r=this;s.trigger("tick",{counter:e++}),!i&&(n+=o)>3e3&&(i=!0,s.trigger("idle")),t=setTimeout(function(){r._tick()},o)}}).start()}(),BEM.DOM.decl({block:"scroll",modName:"tech",modVal:"js"},{onSetMod:{js:{inited:function(){this._setAllElems(),this._setSizes(),this._bindToContentChange(),this._bindToScroll(),this._correctSelectedScrollPosition(),this.bindToWin("resize",this._setSizes),this.cursorLossTimerPull={horizontal:[],vertical:[]},this.sizes={content:{}},this._preventSelectContentInIE()}}},getDefaultParams:function(){return{minThumbSize:30,cursorLossTimer:1e3,stick:{step:400,timer:200,delay:200}}},getContentElem:function(){return this.elems.content},cursorLossTimerPull:null,stickScrollMouseup:!1,_setLossTimer:function(t,e){this.cursorLossTimerPull[t].push(e)},_clearAllLossTimers:function(t){this.cursorLossTimerPull[t]=this.cursorLossTimerPull[t].filter(function(t){return clearTimeout(t),!1})},_setSizes:function(){this.dim=this._getDimensions(),this._setCorrectSize(),this._setTracksSize(),this._setThumbsSize(),this._setThumbsPositions()},_setNewSizes:function(){(this._isContentSizeChanged()||this._isThumbsSizeChanged())&&this._setSizes()},_isContentSizeChanged:function(){var t=this.elems.content,e=this.sizes.content,i=t.width(),n=t.height();if(!e.width||!e.height)return e.width=i,e.height=n,!1;var s=e.width!==i||e.height!==n;return s?(e.width=i,e.height=n,!0):!1},_isThumbsSizeChanged:function(){var t=this.dim.content,e=this.elems.nativeElem[0],i=this.dim.scroll.horizontal,n=this.dim.scroll.vertical;return n.thumbHeight!==this._calcThumbSize("vertical",t.visibleHeight,n.height,e.scrollHeight)||i.thumbWidth!==this._calcThumbSize("horizontal",t.visibleWidth,i.width,e.scrollWidth)},_bindToContentChange:function(){var t=this._setNewSizes.bind(this),e=this.channel("sys").on({tick:t,idle:function(){e.un("tick",t)},wakeup:function(){e.on("tick",t)}})},_getDimensions:function(){return{content:{visibleWidth:this.domElem.width(),visibleHeight:this.domElem.height()},scroll:{horizontal:{},vertical:{}}}},_setAllElems:function(){this.elems={nativeElem:this._getElem("native"),content:this._getElem("content"),track:{horizontal:this._getElem("track","orientation","horizontal"),vertical:this._getElem("track","orientation","vertical")},thumb:{horizontal:this._getElem("thumb","orientation","horizontal"),vertical:this._getElem("thumb","orientation","vertical")}}},_getElem:function(t,e,i){var n=this.buildSelector(),s=this.domElem;return this.elem(t,e,i).filter(function(){return s.index($(this).closest(n))>-1})},_setTracksSize:function(){var t=this.dim.scroll,e=this.elems.track;t.horizontal.width=e.horizontal.width(),t.vertical.height=e.vertical.height()},_getCorrect:function(){var t=this.elems.nativeElem;return{right:t.width()-t[0].clientWidth,bottom:t.height()-t[0].clientHeight+parseInt(t.css("padding-bottom"),10)}},_setCorrectSize:function(){var t=this.elems.nativeElem,e=this._getCorrect();t.css({"margin-right":-e.right,"margin-bottom":-e.bottom}),this.getMod("elastic-height","yes")&&"yes"!==this.getMod("page")||t.css("padding-bottom",e.bottom),this.elems.content.css("width","").css("width",t[0].scrollWidth)},_setThumbsSize:function(){var t=this.dim.scroll.horizontal,e=this.dim.scroll.vertical,i=this.dim.content,n=this.elems.nativeElem[0],s={orientation:"horizontal",property:"width",realVisibleSizeName:"realVisibleWidth",thumbSize:t.thumbWidth,visibleSize:i.visibleWidth,scrollSize:t.width,contentSize:n.scrollWidth,realVisibleSize:i.realVisibleWidth},o={orientation:"vertical",property:"height",realVisibleSizeName:"realVisibleHeight",thumbSize:e.thumbHeight,visibleSize:i.visibleHeight,scrollSize:e.height,contentSize:n.scrollHeight,realVisibleSize:i.realVisibleHeight};t.thumbWidth=this._setThumbSize(s,i),e.thumbHeight=this._setThumbSize(o,i),0===e.thumbHeight&&this._setThumbSize(s,i),0!==t.thumbWidth&&0!==e.thumbHeight&&this._delSingleMod()},_setThumbSize:function(t,e){var i=this._calcThumbSize(t.orientation,t.visibleSize,t.scrollSize,t.contentSize);return 0===i&&this._setSingleMod("horizontal"===t.orientation?"vertical":"horizontal"),this.elems.thumb[t.orientation].css(t.property,i),e[t.realVisibleSizeName]=this._calcRealVisibleContentSize(t.contentSize,i,t.scrollSize),i},_calcThumbSize:function(t,e,i,n){var s=e*i/n,o=this.params.minThumbSize;return s>=i?0:(this.dim.scroll[t].realThumbSize=s,s>0&&o>s?o:s)},_calcRealVisibleContentSize:function(t,e,i){return t*e/i},_setSingleMod:function(t){this.setMod("single",t),this._setTracksSize()},_delSingleMod:function(){this.delMod("single"),this._setTracksSize()},_bindToScroll:function(){return this.bindTo("native","scroll",$.throttle(this._setThumbsPositions,30)),this},_correctSelectedScrollPosition:function(){this.bindToDoc("mouseup",function(){var t=this.domElem;(t.scrollTop()>0||t.scrollLeft()>0)&&t.animate({scrollTop:0,scrollLeft:0},50)})},_unbindFromScroll:function(){return this.unbindFrom("native","scroll"),this},_setThumbsPositions:function(){var t=this.elems.nativeElem,e=this.dim.scroll;this.elems.thumb.horizontal.css({left:this._calcThumbPosition(t.scrollLeft(),e.horizontal.width,t[0].scrollWidth,e.horizontal.thumbWidth,e.horizontal.realThumbSize)}),this.elems.thumb.vertical.css({top:this._calcThumbPosition(t.scrollTop(),e.vertical.height,t[0].scrollHeight,e.vertical.thumbHeight,e.vertical.realThumbSize)})},_calcThumbPosition:function(t,e,i,n,s){return this._calcCorrectThumbPosition(t*e/i,e,n,s)},_calcCorrectThumbPosition:function(t,e,i,n){return t*(e-i)/(e-n)},_calcScrollPosition:function(t,e,i,n,s){return this._calcCorrectScrollPosition(t*e/i,t,n,s)},_calcCorrectScrollPosition:function(t,e,i,n){return t*(e-i)/(e-n)},_setThumbPosition:function(t,e){var i=e.scroll,n=e.position,s=e.content,o=this.elems.nativeElem[0],r="horizontal"===t?{scrollSize:i.horizontal.width,thumbSize:i.horizontal.thumbWidth,thumbPos:n.thumb.left,contentSize:o.scrollWidth,visibleSize:s.visibleWidth,realVisibleSize:s.realVisibleWidth,clientPos:e.e.clientX,posStart:n.start.x,thumb:e.thumb,side:"left",scrollMethod:"scrollLeft"}:{scrollSize:i.vertical.height,thumbSize:i.vertical.thumbHeight,thumbPos:n.thumb.top,contentSize:o.scrollHeight,visibleSize:s.visibleHeight,realVisibleSize:s.realVisibleHeight,clientPos:e.e.clientY,posStart:n.start.y,thumb:e.thumb,side:"top",scrollMethod:"scrollTop"},a=Math.min(Math.max(r.thumbPos+r.clientPos-r.posStart,0),r.scrollSize-r.thumbSize);r.thumb.css(r.side,a),this.elems.nativeElem[r.scrollMethod](this._calcScrollPosition(r.contentSize,a,r.scrollSize,r.visibleSize,r.realVisibleSize))},_getTrackOfThumb:function(t,e){return this.elems.track[e||this._getTargetOrientation(t)]},_getTargetOrientation:function(t){return this.getMod($(t.target),"orientation")},_getTargetScrollPosition:function(t,e,i,n){return(t-e)*i/n},_getOneStepScrollPosition:function(t,e){return t+this.params.stick.step*(e>t?1:-1)},_getStickAnimateDuration:function(t,e){return Math.abs(e-t)/this.params.stick.step*this.params.stick.timer},_setStickScrollPosition:function(t,e){"horizontal"===t?this._setScrollPosition({that:e.that,nativeElem:e.nativeElem,property:"scrollLeft",startScrollPosition:e.nativeElem.scrollLeft(),clientPos:e.e.pageX,trackOffset:e.trackOffset.left,contentSize:e.nativeElem[0].scrollWidth,scrollSize:this.dim.scroll.horizontal.width}):this._setScrollPosition({that:e.that,nativeElem:e.nativeElem,property:"scrollTop",startScrollPosition:e.nativeElem.scrollTop(),clientPos:e.e.pageY,trackOffset:e.trackOffset.top,contentSize:e.nativeElem[0].scrollHeight,scrollSize:this.dim.scroll.vertical.height})},_setScrollPosition:function(t){var e=this,i=this._getTargetScrollPosition(t.clientPos,t.trackOffset,t.contentSize,t.scrollSize),n=this.params.stick,s={first:{},full:{}};s.first[t.property]=this._getOneStepScrollPosition(t.startScrollPosition,i),s.full[t.property]=i,t.nativeElem.animate(s.first,n.timer,function(){this.stickScrollMouseup||t.nativeElem.delay(n.delay).animate(s.full,{step:function(){e.stickScrollMouseup&&t.nativeElem.stop()}},t.that._getStickAnimateDuration(t.startScrollPosition,i))})},_onThumbMousedown:function(t){if(1===t.which){var e=$(t.target),i={x:t.clientX,y:t.clientY},n=e.position(),s=this.getMod(e,"orientation"),o=this.dim.scroll,r=this.dim.content,a=!1;this.setMod("dragged","yes")._unbindFromScroll().bindToDoc("mousemove",$.throttle(function(t){this._bindPreventSelectContentInIE(a),a||this._setThumbPosition(s,{e:t,thumb:e,scroll:o,content:r,position:{start:i,thumb:n}})},30)).bindToDoc("mouseup",function(){a=!0,this._unbindPreventSelectContentInIE(),this.delMod("dragged").unbindFromDoc("mousemove")._bindToScroll()}),t.preventDefault(),t.stopPropagation()}},_onTrackMousedown:function(t){if(1===t.which){var e=$(t.target);this.getMod(e,"hovered","yes")&&(this.stickScrollMouseup=!1,this.bindToDoc("mouseup",function(){this.stickScrollMouseup=!0}),this._setStickScrollPosition(this._getTargetOrientation(t),{that:this,nativeElem:this.elems.nativeElem,e:t,trackOffset:e.offset()}),t.preventDefault())}},_preventSelectContentInIE:function(){if($.browser.msie&&!($.browser.version>8)){var t=function(){return!1},e=this.elems.thumb,i=this.elems.track;e.vertical[0].onselectstart=t,e.horizontal[0].onselectstart=t,i.vertical[0].onselectstart=t,i.horizontal[0].onselectstart=t}},_bindPreventSelectContentInIE:function(t){return t?this._unbindPreventSelectContentInIE():(this.elems.content[0].onselectstart=function(){return!1},void 0)},_unbindPreventSelectContentInIE:function(){this.elems.content[0].onselectstart=function(){return!0}}},{live:function(){return this.liveBindTo("thumb","mouseover",function(t){var e=this._getTargetOrientation(t);this._clearAllLossTimers(e),this.setMod(this._getTrackOfThumb(t,e),"hovered","yes")}).liveBindTo("track thumb","mouseout",function(t){var e=this,i=this._getTargetOrientation(t);this._setLossTimer(i,setTimeout(function(){e.delMod(e._getTrackOfThumb(t,i),"hovered")},this.params.cursorLossTimer))}).liveBindTo("track","mouseover",function(t){this._clearAllLossTimers(this._getTargetOrientation(t))}).liveBindTo("thumb","mousedown",function(t){this._onThumbMousedown(t)}).liveBindTo("track","mousedown",function(t){this._onTrackMousedown(t)}),!1}}),BEM.DOM.decl({block:"scroll",modName:"page",modVal:"yes"},{onSetMod:{js:{inited:function(){this._setSingleMod(),this.__base()}}},_setSingleMod:function(){$("html").css("height","100%"),BEM.DOM.scope.css({height:"100%",padding:0,margin:0,overflow:"hidden"})}}),BEM.DOM.decl("b-wiki",{onSetMod:{loading:{yes:function(t){BEM.create("api-request",{_:"api-response",apiPath:".comments",path:window.location.pathname,method:"POST",urlParams:!1,data:{body:"test post api comment"},timeout:2e3}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this)).always(this.delMod.bind(this,null,t))}}},_onGotData:function(t){BEM.DOM.update(this.elem("data"),"Приехало: \n"+JSON.stringify(t,null,2))},_onFailedData:function(t){BEM.DOM.update(this.elem("data"),"Отвалилось: \n"+JSON.stringify(t.message)),console.log(t)},_onClick:function(t){t.preventDefault(),this.hasMod("loading","yes")||this.setMod("loading","yes")}},{live:function(){this.liveBindTo("button","click",function(t){this._onClick(t)})}}),BEM.DOM.decl({block:"wiki-doc",modName:"type",modVal:"load-tickets"},{onSetMod:{js:function(){this.__self.url_type||(this.__self.url_type=~this.__self.SERVICES.indexOf(location.host)?"production":"testing"),this._disableCache=-1!==this.__self.DONT_CACHE.indexOf(location.host)||Boolean(localStorage._disableCache),this._TICKETS_UPDATE_TIME=+this.params.ticketsUpdateTime||3e5,this._ticketsStruct={},this._bemReplace(),clearInterval(this._ticketsUpdateTimer),setTimeout(function(){this._isLoaded||this._getTickets()}.bind(this),0)}},_bemReplace:function(){BEM.DOM.replace||(BEM.DOM.replace=function(t,e){this.destruct(!0,t),this.init($(e).replaceAll(t))},console.error("Обновите версию ромочки."))},_isIndexDB:function(){return window.indexedDB?!0:void 0},_isLocalStorageFull:function(t){try{t()}catch(e){("QuotaExceededError"==e.name||"NS_ERROR_DOM_QUOTA_REACHED"==e.name)&&(localStorage._ajaxTickets="",console.log("LocalStorage переполнен."))}},_getTickets:function(){var t;this._bPage=this.findBlockOutside("b-page"),this._tickets=this._bPage?this._bPage.findBlocksInside("wiki-ticket"):$("body").bem("b-tickets-parent").findBlocksInside("wiki-ticket"),this._tickets.forEach(function(t){t.findBlockOutside("wiki-doc")._isLoaded=!0}),this._createTicketsStruct(),t=this._ticketsCaching(),t&&Date.now()-t.last_update>this._TICKETS_UPDATE_TIME?(this._createTicketsStruct(),this._getTicketsData()):this._ticketsIdsArr.length&&this._getTicketsData(),this._updateTicketsCache()},_ticketsCaching:function(){var t,e=this,i=[];return this._disableCache?(localStorage._ajaxTickets&&this._isLocalStorageFull(function(){localStorage._ajaxTickets=""}),void 0):(localStorage._ajaxTickets?(t=JSON.parse(localStorage._ajaxTickets),Object.keys(t).forEach(function(n){var s=e._ticketsIdsArr.indexOf(t[n].key);~s&&(e._ticketsIdsArr.splice(s,1),i.push(t[n]),t[n].__touch=Date.now())})):this._isLocalStorageFull(function(){localStorage._ajaxTickets=JSON.stringify({last_update:Date.now()})}),i.length&&this._createTickets(i),t)},_updateTicketsCache:function(){var t=this;this._ticketsUpdateTimer=setInterval(function(){t._createTicketsStruct(),t._getTicketsData()},this._TICKETS_UPDATE_TIME)},_cacheTickets:function(t){var e=this,i=localStorage._ajaxTickets&&JSON.parse(localStorage._ajaxTickets);i&&!this._disableCache&&(Object.keys(i).forEach(function(t){"last_update"!==t&&Date.now()-i[t].__touch>e.__self.TICKET_LIVE_TIME&&delete i[t]}),t.constructor!==Array&&(t=[t]),t.forEach(function(t){i[t.key]={key:t.key,summary:t.summary,status:t.status,assignee:t.assignee,ticketType:e._ticketType,__touch:Date.now()}}),i.last_update=Date.now(),this._isLocalStorageFull(function(){localStorage._ajaxTickets=JSON.stringify(i)}))},_createTicketsStruct:function(){this._ticketsIdsArr=[],this._tickets.forEach(function(t){var e=t.params.project,i=t.params._id,n=e+"-"+i;e&&"NONE"!==e&&(~this._ticketsIdsArr.indexOf(n)||this._ticketsIdsArr.push(n),this._ticketsStruct[e]=this._ticketsStruct[e]||{},this._ticketsStruct[e][i]=this._ticketsStruct[e][i]||{tickets:[]},this._ticketsStruct[e][i].tickets.push(t))}.bind(this))},createUrlToStartrek:function(t){return this.__self.URLS[this.__self.url_type].trackers_api_urls[this._ticketType]+"?keys="+(t||this._ticketsIdsArr.join(","))+"&expand=aliases"},createUrlToJira:function(t){return this.__self.URLS[this.__self.url_type].trackers_api_urls[this._ticketType]+"?keys="+(t||this._ticketsIdsArr.join(","))},_getTicketsData:function(){var t,e=this,i=[],n=0,s=Math.ceil(e._ticketsIdsArr.length/e.__self.TICKETS_LOAD_AMOUNT);this._ticketType="startrek",this._ticketsIdsArr.forEach(function(o,r){i.push(o),(r&&r%e.__self.TICKETS_LOAD_AMOUNT===0||r===e._ticketsIdsArr.length-1)&&(e._ticketsRequest(e.createUrlToStartrek(i),function(i){var o,r;++n,i&&(i.ticketType=e._ticketType,e._createTickets(i)),n==s&&(e._ticketType="jira",t=e._ticketsStruct,o=e.params.trackers_api_urls[e._ticketType]+"?keys=",r=[],Object.keys(t).forEach(function(e){Object.keys(t[e]).forEach(function(t){r.push(e+"-"+t)})}),r.length&&r.forEach(function(t,i){o+=t+",",(i&&i%e.__self.TICKETS_LOAD_AMOUNT===0||i===r.length-1)&&(!function(t){t=t.substr(0,t.length-1),e._ticketsRequest(t,function(i,n){var s,o,r,a,l,c,d,u;if(i)i.ticketType=e._ticketType,e._createTickets(i);else{try{s=JSON.parse(n.responseText).errorMessages[0],o=JSON.parse(/({.+})/.exec(s)[1]).errorMessages}catch(h){o=[]}o.forEach(function(i){r=/\'(\w+-\d+)\'/.exec(i)[1],a=r.split("-"),l=a[0],c=a[1],d=t.substr(0,t.indexOf(r)),u=t.substr(t.indexOf(r)+r.length,t.length),/,$/.test(d)&&(d=d.substr(0,d.length-1)),t=d.concat(u),t=t.replace(",)",")").replace("(,","("),delete e._ticketsStruct[l][c]}),e._ticketsRequest(t,function(t){t&&(t.ticketType=e._ticketType,e._createTickets(t))})}})}(o),o=e.params.trackers_api_urls[e._ticketType]+"?keys=")}))}),i=[])})},_ticketsRequest:function(t,e){var i=this,n={type:"GET",url:t,crossDomain:!0,cache:!1,xhrFields:{withCredentials:!0},success:function(t){i._cacheTickets(t),e(t)},error:function(t){e(!1,t)}};$.ajax(n)},_createTickets:function(t){var e,i,n,s=this,o=t.issues||t;o.constructor!==Array&&(o=[o]),o.forEach(function(t){n=t.aliases?t.aliases[0].split("-"):t.key.split("-"),e=s._ticketsStruct[n[0]],i=e[n[1]],i.tickets.forEach(function(e){t.ticketType=s._ticketType||t.ticketType,s._createTicket(t,e)}),delete e[n[1]],Object.keys(e).length||delete s._ticketsStruct[n[0]]})},_createTicket:function(t,e){if(e.domElem){var i=$($(BEMHTML.apply({block:"wiki-doc","wiki-attrs":this.params.wiki,content:{block:"wiki-ticket-ajax",js:{id:t.key,ticket_type:t.ticketType},"wiki-attrs":this._ticketsDataController(t)}})).html());BEM.DOM.replace(e.domElem,i),setTimeout(function(){e.domElem=i},0)}},_ticketsDataController:function(t){var e=t.assignee?t.assignee.login||t.assignee.id:null,i={status:t.status.key||t.status.display,summary:t.summary,assignee_login:e,assignee_link:"https://staff.yandex-team.ru/"+e,lang:t.lang||null};return i.issue=t.key,i.link_view=this.__self.URLS[this.__self.url_type].trackers_view_urls.startrek+t.key,i.ticket_type="startrek",i}},{TICKETS_LOAD_AMOUNT:10,URLS:{testing:{trackers_view_urls:{jira:"https://jira.test.tools.yandex-team.ru/browse/",startrek:"https://st.test.yandex-team.ru/"},trackers_api_urls:{jira:"https://jira.test.tools.yandex-team.ru/rest/wiki/latest/issues/",startrek:"https://st-api.test.yandex-team.ru/v2/issues/"}},production:{trackers_view_urls:{jira:"https://jira.yandex-team.ru/browse/",startrek:"https://st.yandex-team.ru/"},trackers_api_urls:{jira:"https://jira.yandex-team.ru/rest/wiki/latest/issues/",startrek:"https://st-api.yandex-team.ru/v2/issues/"}}},SERVICES:["old.wiki.yandex-team.ru","beta.wiki.yandex-team.ru","wiki.yandex-team.ru","st.yandex-team.ru","jira.yandex-team.ru","planner.yandex-team.ru","staff.yandex-team.ru","search.yandex-team.ru","newhire.yandex-team.ru","fml.yandex-team.ru","aqua.yandex-team.ru","stat.yandex-team.ru"],DONT_CACHE:["st.yandex-team.ru","st.test.yandex-team.ru"],TICKET_LIVE_TIME:864e5}),BEM.DOM.decl("wiki-ticket-ajax",{onSetMod:{js:{inited:function(){this._wikiDoc=this.findBlockOutside("wiki-doc"),this.bindTo(this._getTrigger(),"click",this._toggle)}}},_getTrigger:function(){return this.elem("summary")},_getDescription:function(){return this.elem("description")},_toggle:function(){var t;this.toggleMod(this._getDescription(),"visibility","visible"),this.hasMod("description","yes")||this.hasMod(this._getDescription(),"visibility","visible")&&(this._wikiDoc._ticketType=this.params.ticket_type,t="startrek"===this.params.ticket_type?this._wikiDoc.createUrlToStartrek([this.params.id]):this._wikiDoc.createUrlToJira([this.params.id]),this._getTicketData(t))},_getTicketData:function(t){$.ajax({type:"GET",url:t,crossDomain:!0,cache:!1,xhrFields:{withCredentials:!0},success:this._onGetTicketData.bind(this),error:this._onGetTicketError.bind(this)})},_onGetTicketData:function(t){this.setMod("description","yes"),this.elem("description").html(t[0].description)},_onGetTicketError:function(t){console.log(t)}}),BEM.decl("i-common__string",{},{cleverSubstring:function(){var t="…";return function(e,i,n){return e.length>i+n?e.substring(0,i-1)+t:e}}(),escapeHTML:function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return function(e){return String(e).replace(/&(?!\w+;)|[<>"']/g,function(e){return t[e]||e})}}(),escapeRegExp:function(t){return t.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},highlight:function(t,e){if(!$.isArray(e))return t;var i,n=[],s=0,o=e.sort(function(t,e){return t[0]-e[0]}),r=[],a="?",l=~t.indexOf(a),c=function(){for(var e,i=/\&#\d+;/gi;e=i.exec(t);)r.push(e[0]),t=t.replace(e[0],a)},d=function(t){if(l)return t;for(;~t.indexOf(a)&&r.length;)t=t.replace(a,r[0]),r.shift();return t};return!l&&c(),o.forEach(function(e){i=s>e[0]?s:e[0],n.push({tag:"span",elem:"span",content:d(t.slice(s,i))}),n.push({tag:"em",elem:"em",content:d(t.slice(i,s=e[1]))})},this),n.push({tag:"span",elem:"span",content:d(t.slice(s))}),n}}),function(){BEM.HTML.decl("b-user",{onBlock:function(t){var e=t.param("js").login||"",i=t.param("js").name||"";t.tag("b"),t.attr("data-login",e),t.content({elem:"link",tag:"a",attrs:{href:"//staff.yandex-team.ru/"+e},content:[{elem:"first-letter",tag:"b",content:i.substr(0,1)},i.substr(1)]})}})}(),BEM.HTML.decl("b-link",{onBlock:function(t){t.tag("a").attr("href",t.param("url"));for(var e,i=["title","target"];e=i.pop();)t.param(e)&&t.attr(e,t.param(e))}}),function(t){function e(){}function i(t){r=[t]}function n(t,e,i){return t&&t.apply&&t.apply(e.context||e,i)}function s(t){return/\?/.test(t)?"&":"?"}function o(o){function p(t){K++||(Y(),U&&(B[V]={s:[t]}),H&&(t=H.apply(o,[t])),n(A,o,[t,y,o]),n($,o,[o,y]))}function T(t){K++||(Y(),U&&t!=M&&(B[V]=t),n(F,o,[o,t]),n($,o,[o,t]))}o=t.extend({},S,o);var C,O,P,j,L,A=o.success,F=o.error,$=o.complete,H=o.dataFilter,z=o.callbackParameter,R=o.callback,q=o.cache,U=o.pageCache,W=o.charset,V=o.url,G=o.data,J=o.timeout,K=0,Y=e;return x&&x(function(t){t.done(A).fail(F),A=t.resolve,F=t.reject}).promise(o),o.abort=function(){!K++&&Y()},n(o.beforeSend,o,[o])===!1||K?o:(V=V||c,G=G?"string"==typeof G?G:t.param(G,o.traditional):c,V+=G?s(V)+G:c,z&&(V+=s(V)+encodeURIComponent(z)+"=?"),!q&&!U&&(V+=s(V)+"_"+(new Date).getTime()+"="),V=V.replace(/=\?(&|$)/,"="+R+"$1"),U&&(C=B[V])?C.s?p(C.s[0]):T(C):(w[R]=i,P=t(v)[0],P.id=h+I++,W&&(P[l]=W),D&&D.version()<11.6?(j=t(v)[0]).text="document.getElementById('"+P.id+"')."+f+"()":P[a]=a,N&&(P.htmlFor=P.id,P.event=m),P[_]=P[f]=P[g]=function(t){if(!P[b]||!/i/.test(P[b])){try{P[m]&&P[m]()}catch(e){}t=r,r=0,t?p(t[0]):T(d)}},P.src=V,Y=function(){L&&clearTimeout(L),P[g]=P[_]=P[f]=null,E[k](P),j&&E[k](j)},E[u](P,O=E.firstChild),j&&E[u](j,O),L=J>0&&setTimeout(function(){T(M)},J)),o)}var r,a="async",l="charset",c="",d="error",u="insertBefore",h="_jqjsp",p="on",m=p+"click",f=p+d,_=p+"load",g=p+"readystatechange",b="readyState",k="removeChild",v="<script>",y="success",M="timeout",w=window,x=t.Deferred,E=t("head")[0]||document.documentElement,B={},I=0,S={callback:h,url:location.href},D=w.opera,N=!!t("<div>").html("<!--[if IE]><i><![endif]-->").find("i").length;o.setup=function(e){t.extend(S,e)},t.jsonp=o}(jQuery),BEM.DOM.decl("mi-staff-card",{_prepareData:function(){this.user=this.params.user,this.CLEAR_CACHE_TIME=this.params.clearCacheOn||18e4,this.userInCache&&new Date-this.userInCache.saveDate<=this.CLEAR_CACHE_TIME?(this.popup._isShown=!1,this.popup.setContent(this.userInCache.user)):this._getUserData(this.user)},_onLoadError:function(){this.popup.findBlockInside("m-staff-card").setMod("error","yes")},_buildMStaffCard:function(t){var e=this._buildMStaffCardBEMJSON(t);this.userInCache={user:this.__self._usersChache[this.user]=BEMHTML.apply(e),saveDate:new Date},this.popup._isShown=!1,this.popup.setContent(this.userInCache.user)},_buildMStaffCardBEMJSON:function(t){var e={elem:"location",content:[]},i=[];return t.is_homie?e.content.push("Работает дома"+(t.last_office?"&nbsp;":"")):(e.content.push(t.table&&t.table.url?{block:"link",url:t.table.url,content:t.office?t.office:""}:t.office?t.office:""),t.last_office&&e.content.push("&nbsp;")),e.content.push({elem:"spy",tag:"span",content:t.last_office?"— "+(t.last_office.office?t.last_office.office+", ":" ")+t.last_office.ago:""}),t.gap&&i.push({elem:"gap",attrs:{style:"background-color: rgba("+this.__self._hex2rgb(t.gap.color)+", 0.5);"},content:{block:"link",url:t.gap.url,content:t.gap.name+" "+t.gap.time}}),{block:"m-staff-card",mods:{"no-group":t.group?"":"yes"},js:{user:t.login},content:[{elem:"head",content:[{elem:"department",content:t.dep.name?t.dep.name:" "},{elem:"group",content:t.group?{block:"link",url:t.group.url?t.group.url:"",content:t.group.name?t.group.name:""}:""}]},{elem:"body",content:[{elem:"left",content:[{elem:"userpic",content:{block:"m-userpic",size:100,login:t.login,url:t.staff_url?t.staff_url:""}}]},{elem:"right",content:[{elem:"name",content:{block:"m-username",url:t.staff_url?t.staff_url:"",content:(t.first_name?t.first_name+" ":"")+(t.last_name?t.last_name:"")}},{elem:"position",content:t.position?t.position:""},{elem:"contacts",content:this._getContactsBEMJSON(t)}]},t.is_dismissed?"":e]},{elem:"foot",content:{elem:"availability",content:i}}]}
},_getContactsBEMJSON:function(t){var e=[{elem:"first-line",content:[t.work_email?{block:"m-button-action",mods:{type:"email"},jabberSt:t.jabber_status,content:t.work_email}:""]}];return t.is_dismissed?"":(-1===t.work_email.indexOf("@yandex-team.ru")?e.push({elem:"phones",content:t.phones?this._getPhonesBEMJSON(t.phones):""}):(t.phones&&t.phones.work&&e[0].content.push({elem:"phone",content:{block:"m-button-action",mods:{type:"phone"},content:t.phones.work}}),t.phones&&t.phones.mobile&&!t.phones.work?e[0].content.push({elem:"phone",content:{block:"m-button-action",mods:{type:"phone"},content:t.phones.mobile.replace(/-/g,"-&shy;")}}):t.phones&&t.phones.mobile&&e.push({elem:"phones",content:{elem:"phone",content:{block:"m-button-action",mods:{type:"phone"},content:t.phones.mobile.replace(/-/g,"-&shy;")}}})),e)},_getPhonesBEMJSON:function(t){return[t.work&&{elem:"phone",content:{block:"m-button-action",mods:{type:"phone"},content:t.work}},t.mobile&&{elem:"phone",content:{block:"m-button-action",mods:{type:"phone"},content:t.mobile.replace(/-/g,"-&shy;")}}]},_getUserData:function(t){var e="//center.yandex-team.ru/api/staff_cards/?"+t+(this.__self._messagesCache?"":"&_messages=on")+"&_callback=?";this._requestObject=$.jsonp({url:e,success:this._onData,error:this._onLoadError,context:this})},_onData:function(t){return $.isEmptyObject(t)||!t[this.user]?(this._onLoadError(),!1):(this.__self._messagesCache||(this.__self._messagesCache=t._messages),this._dataReady=t[this.user],this._timerReady&&this._buildMStaffCard(this._dataReady),void 0)}},{live:function(){var t,e,i,n,s=this,o=this.getName(),r=this.buildSelector();this.doc.on({mouseenter:function(i){n=$(i.target).closest(r).bem(o),n.popup||(n.popup=n.__self.getPopup()),n._dataReady=!1,n._timerReady=!1,t=setTimeout(function(){n._prepareData()},n.__self.sendRequestTimer),e=setTimeout(function(){n._timerReady=!0,n.popup.show(n.domElem),n._dataReady&&n._buildMStaffCard(n._dataReady)},n.params.timeout||500)},mouseleave:function(){clearTimeout(t),clearTimeout(e),n._requestObject&&n._requestObject.abort(),clearTimeout(i),i=setTimeout(function(){s._mouseOnPopup||s.hidePopup()},s.hideCardTimer)}},r)},getPopup:function(){function t(){var t,i=$(BEMHTML.apply({block:"popup",mods:{adaptive:"yes",behavior:"staff-card"},js:{directions:[{to:"right",axis:"top",tail:{axis:"middle"},offset:{top:-10}},{to:"left",axis:"top",tail:{axis:"middle"},offset:{top:-10}},{to:"bottom",axis:"left",tail:{axis:"left"},offset:{left:-10}},{to:"bottom",axis:"right",tail:{axis:"right"},offset:{left:-10}},{to:"top",axis:"left",tail:{axis:"left"},offset:{left:-10}},{to:"top",axis:"right",tail:{axis:"right"},offset:{left:-10}}]},content:[{elem:"tail"},{elem:"content"}]}));return i=i.bem("popup"),i.on("outside-click",e._onPopupOutsideClick,e),e._usersChache.defaultUser=BEMHTML.apply(e._getDefaultUserBEMJSON()),i.setContent(e._usersChache.defaultUser),i.domElem.on({mouseenter:function(){e._mouseOnPopup=!0},mouseleave:function(){t&&clearTimeout(t),t=setTimeout(function(){e.hidePopup(),e._mouseOnPopup=!1},e.hideCardTimer)}}),i}var e=this;return this.popup||(this.popup=t())},_onPopupOutsideClick:function(t){this.hidePopup(),t.preventDefault()},hidePopup:function(){this.popup._isShown=!1,this.popup.hide().setContent(this._usersChache.defaultUser)},_hex2rgb:function(t){if("#"==t[0]&&(t=t.substr(1)),3==t.length){var e=t;t="",e=/^([a-f0-9])([a-f0-9])([a-f0-9])$/i.exec(e).slice(1);for(var i=0;3>i;i++)t+=e[i]+e[i]}var n=/^([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})$/i.exec(t).slice(1);return parseInt(n[0],16)+", "+parseInt(n[1],16)+", "+parseInt(n[2],16)},_getDefaultUserBEMJSON:function(){return{block:"m-staff-card",mods:{state:"loading"},content:[{elem:"head"},{elem:"body",content:[{elem:"left",content:{elem:"userpic"}},{elem:"right",content:[{block:"spin",js:!0,mods:{progress:"yes",theme:"gray-24"}},{elem:"error",content:"Ooops"}]}]}]}},sendRequestTimer:200,hideCardTimer:200,_mouseOnPopup:!1,_usersChache:{},_messagesCache:!1}),function(t){var e=t.event.special.leftclick={setup:function(){t(this).bind("click",e.handler)},teardown:function(){t(this).unbind("click",e.handler)},handler:function(e){e.button||(e.type="leftclick",t.event.dispatch.apply(this,arguments),e.type="click")}}}(jQuery),function(t){var e,i=t.browser,n=i.opera&&i.version<13,s=i.opera&&i.version<12.1?"keypress":"keydown",o=Object.prototype.hasOwnProperty,r=BEM.DOM,a=i.msie&&i.version>=9&&i.version<10,l=function(t){try{return t.activeElement}catch(e){}};r.decl("popup",{getDefaultParams:function(){var t={left:15,right:15,top:15,bottom:15};return{directions:[{to:"bottom",axis:"center",tail:{axis:"center"}},{to:"top",axis:"center",tail:{axis:"center"}},{to:"right",axis:"middle",tail:{axis:"middle"}},{to:"left",axis:"middle",tail:{axis:"middle"}}],tail:{width:24.04,height:12.02,offset:t},duration:150}},onSetMod:{js:function(){this._cache={},this._viewport=r.win,this._scope=r.scope,this._channel=BEM.channel("popups"),this._inContainer=!1,this._isParentFixed=!1,this._owner=null,this._userPosition=null,this._parent=null,this._childs=[],this._isShown=!1,this._isHiding=!1,this._positions={},this._currPos={},this._visibilityFactor=null,this._direction=!1,this._directions={};var t=this.getDefaultParams(),e=this.params,i=this._repackDirParams(t.directions),n=e.generateDirections?this._generateDirections:e.directions,s=this._repackDirParams(n);e.tail&&(this.params.tail=this._mergeParams(t.tail,e.tail)),this._order=s.keys.map(function(t){var e=s.directions[t],n=i.directions[t];return n||(n=i.directions[e.to]),this._directions[t]=this._mergeParams(n,e,{tail:this._tailParamsHook}),t},this)},visibility:{visible:function(){this._onShown()},"":function(){this._onHidden()}}},show:function(e){var i;if(e instanceof BEM)i=e.domElem.eq(0);else if(e instanceof t)i=e;else if(!e)return;if(i){this._owner&&i[0]!==this._owner[0]&&this.delMod("visibility"),this._owner=i;var n=this.findBlockOutside(i,"popup");n&&this.setParent(n)}else this._userPosition=e;return this.setMod("visibility","outside").repaint()},hide:function(){if(this._isHiding)return this;if(this._isShown&&(this._isHiding=!0,this._childs.forEach(function(t){t.hide()}),this.hasMod("animate","yes")&&!this.hasMod("fade-out","no"))){var t=this;return this.beforeHide(function(){t.domElem&&t.delMod("visibility")}),this}return this.delMod("visibility")},toggle:function(t){return this._isShown&&!this._isHiding?this.hide():this.show(t||this._owner)},repaint:function(){this._moveToContainer();var t=this._pickDirection();return this.setMod("to",t.to)._show(this._positions[t.key],this._tailPos&&this._tailPos[t.key]),this},repaintShadowIfNeeded:function(){return a&&this._repaintShadow(),this},getCurrPos:function(){return this._currPos},getCurrDirection:function(){return this._direction},setContent:function(t){return r.update(this.elem("content"),t),this._resetDefault(),this._isShown&&this.repaint(),this},isShown:function(){return this._isShown},setParent:function(t){return this._parent=t,this._isParentFixed=t.hasMod("position","fixed"),t.addChild(this),this},addChild:function(t){for(var e=this._childs,i=e.length,n=0;i>n;n++)if(e[n]._uniqId===t._uniqId)return;t.on("hide",function(){this.removeChild(t)},this),e.push(t)},removeChild:function(t){for(var e=this._childs,i=e.length,n=0;i>n;n++)if(e[n]._uniqId===t._uniqId)return e.splice(n,1),void 0},setSize:function(t){return t&&(this._resetDefault(),this.domElem.css(t),this._isShown&&!this._isHiding&&this.repaint()),this},_show:function(t,e){return this._currPos=t,e&&this.elem("tail").removeAttr("style").css(e),this.domElem.css(t),(!this._isShown||this._isHiding)&&this.hasMod("animate","yes")&&!this.hasMod("fade-in","no")&&this.afterShow(),this._isHiding=!1,this.setMod("visibility","visible"),this},_onShown:function(){this.bindToDoc(s,function(t){27===t.which&&0===this._childs.length&&this.hide()}),this._bindFocusEvents(),this._attachUnder(),this._isShown=!0,this.hasMod("autoclosable","yes")&&this.afterCurrentEvent(function(){this._enableAutoclosable()}),this.hasMod("adaptive","yes")&&this._enableAdaptive(),this._channel.on("hide",this.hide,this),this.trigger("show")},_onHidden:function(){this._unbindFocusEvents(),this.unbindFromDoc(s),this._detachUnder(),this.hasMod("autoclosable","yes")&&this._disableAutoclosable(),this.hasMod("adaptive","yes")&&this._disableAdaptive(),this._cache={},this._isShown=!1,this._isHiding=!1,this._channel.un("hide"),this._returnFocus(),this.trigger("hide")},_bindFocusEvents:function(){this._lastFocused=t(l(document)||this._scope);var e=this.__self._getFocusable(this.elem("content"));return this._firstFocusable=e.first(),this._lastFocusable=e.last(),this._skipReturnFocus=!1,0===this._firstFocusable.length?(this._skipReturnFocus=!0,void 0):(this.bindTo(this._lastFocused,"keydown",this._onLastFocusedKeyDown).bindTo(this._firstFocusable,"keydown",this._onFirstFocusableKeyDown).bindTo(this._lastFocusable,"keydown",this._onLastFocusableKeyDown),void 0)},_unbindFocusEvents:function(){this.unbindFrom(this._firstFocusable,"keydown"),this.unbindFrom(this._lastFocusable,"keydown"),this.unbindFrom(this._lastFocused,"keydown")},_onLastFocusedKeyDown:function(t){t.ctrlKey||t.altKey||t.metaKey||9===t.which&&(t.preventDefault(),this[t.shiftKey?"_lastFocusable":"_firstFocusable"].focus())},_onFirstFocusableKeyDown:function(t){t.ctrlKey||t.altKey||t.metaKey||t.shiftKey&&9===t.which&&(t.preventDefault(),this._lastFocused.focus())},_onLastFocusableKeyDown:function(t){t.shiftKey||t.ctrlKey||t.altKey||t.metaKey||9===t.which&&(t.preventDefault(),this._lastFocused.focus())},_returnFocus:function(){var t=(this._parent||{})._skipReturnFocus||this._skipReturnFocus;t||this._lastFocused.focus()},_mergeParams:function(t,e,i){var n={};return i||(i={}),t&&"object"==typeof t&&Object.keys(t).forEach(function(e){n[e]=t[e]}),Object.keys(e).forEach(function(s){var r=o.call(i,s)?i[s].call(this,t[s],e[s]):e[s];n[s]=!r||"object"!=typeof r||Array.isArray(r)?r:t[s]?this._mergeParams(t[s],r,i):r},this),n},_tailParamsHook:function(t,e){return e.offset||(e.offset=this.params.tail.offset),"number"==typeof e.offset?{offset:{left:e.offset,top:e.offset}}:e},_generateDirections:function(){if(e)return e;for(var t=[["bottom","top"],["left","right"]],i=[["center","left","right"],["middle","top","bottom"]],n=i,s=t.length,o=[],r=0;s>r;r++)for(var a=t[r],l=a.length,c=0;l>c;c++)for(var d=i[r],u=d.length,h=0;u>h;h++)for(var p=n[r],m=p.length,f=0;m>f;f++)o.push({direction:a[c],axis:d[h],tail:{axis:p[f]}});return e=o,o},_repackDirParams:function(e){var i={},n=[];return("string"==typeof e||t.isPlainObject(e))&&(e=[e]),n=e.map(function(t){if("string"==typeof t){var e=t.split("-");t={to:e[0],tail:{}},e[1]&&(t.axis=e[1]),e[2]&&(t.tail.axis=e[2])}var n=t.to;return i[n]||(i[n]=t),t.axis&&(n+="-"+t.axis),t.key=n,i[n]=t,n},this),{directions:i,keys:n}},setViewport:function(t){return this._viewport=t,this},_pickDirection:function(){var t,e=this._order,i=this.hasMod("adaptive","yes")?e.length:1;for(this._visibilityFactor=0,t=0;i>t;t++){var n=e[t],s=this._directions[n];this._resetPos(n)._pushPos(n,this._calcPos(s))._pushPos(n,this._calcOffsets(s)),this._hasTail()&&this._resetTailPos(n)._pushTailPos(n,this._calcTailPos(s))._pushTailPos(n,this._calcTailOffset(s))._pushPos(n,this._calcOffsetByTail(s)),this._pushPos(n,this._getParentOffset());var o=this._calcVisibilityFactor(s);if((o>this._visibilityFactor||!this._direction)&&(this._visibilityFactor=o,this._direction=this._directions[n],this.size=this.getPlacingSize(),100===o))break}return this._direction},_getParentOffset:function(){var t=this.domElem.offsetParent().offset();return t.left*=-1,t.top*=-1,t},_calcPos:function(t){this._calcPlacingSize(t);var e=this.getOwnerPos(),i=this.getOwnerSize(),n=this.getPlacingSize(),s=t.axis,r=this.params.position||{},a={};switch(t.to){case"bottom":a={top:o.call(r,"top")?r.top:e.top+i.height,left:o.call(r,"left")?r.left:this._calcLeft(s)};break;case"top":a={top:o.call(r,"top")?r.top:e.top-n.height,left:o.call(r,"left")?r.left:this._calcLeft(s)};break;case"left":a={top:o.call(r,"top")?r.top:this._calcTop(s),left:o.call(r,"left")?r.left:e.left-n.width};break;case"right":a={top:o.call(r,"top")?r.top:this._calcTop(s),left:o.call(r,"left")?r.left:e.left+i.width}}return a},_calcTop:function(t){var e=0,i=this.getPlacingSize(),n=this.getOwnerPos(),s=this.getOwnerSize();return"top"===t?e+=n.top:"middle"===t?e+=n.top+s.height/2-i.height/2:"bottom"===t&&(e+=n.top+s.height-i.height),e},_calcLeft:function(t){var e=0,i=this.getPlacingSize(),n=this.getOwnerPos(),s=this.getOwnerSize();return"left"===t?e+=n.left:"center"===t?e+=n.left+s.width/2-i.width/2:"right"===t&&(e+=n.left+s.width-i.width),e},getPlacingSize:function(){return this.getPopupSize()},_calcOffsets:function(t){var e,i=this._cache.offset||(this._cache.offset={}),n=t.key,s=t.offset;if(i[n])return i[n];if(!s)return!1;if(e={left:0,top:0},"number"==typeof s)switch(n){case"left":e.left+=s;break;case"right":e.left-=s;break;case"top":e.top+=s;break;case"bottom":e.top-=s}else s.left&&(e.left+=s.left),s.right&&(e.left-=s.right),s.top&&(e.top+=s.top),s.bottom&&(e.top-=s.bottom);return i[n]=e,e},_hasTail:function(){return 0!==this.elem("tail").length},_moveToContainer:function(t){if(t)this._inContainer=!1;else{if(this._isShown)return;t=this._parent?this._parent.domElem:this._scope}this.domElem.appendTo(t),this._inContainer=!0},_resetPos:function(t){return t?this._positions[t]=null:this._positions={},this},_pushPosTo:function(t,e,i){i!==!1&&("string"==typeof e?this._sum(t[e]||(t[e]={}),i):(i=e,Object.keys(t).forEach(function(e){this._sum(t[e],i)},this)))},_pushPos:function(t,e){return this._pushPosTo(this._positions,t,e),this},_sum:function(t,e){Object.keys(e).forEach(function(i){t[i]=(t[i]||0)+e[i]})},_getSizeOf:function(t){return{height:t.outerHeight(),width:t.outerWidth()}},getOwnerSize:function(){return this._owner?this._cache.ownerSize||(this._cache.ownerSize=this._getSizeOf(this._owner)):{height:0,width:0}},getPopupSize:function(){return this._getSizeOf(this.domElem)},_getPosOf:function(t){return t.offset()||{left:0,top:0}},getOwnerPos:function(){var t;return this._owner&&(t=this._getPosOf(this._owner),"pageYOffset"in window&&(t.top-=window.pageYOffset-(document.documentElement.scrollTop||document.body.scrollTop),t.left-=window.pageXOffset-(document.documentElement.scrollLeft||document.body.scrollLeft))),t||this._userPosition},_calcVisibilityFactor:function(t){var e,i,n=this._viewport,s=this._getSizeOf(n),o=this.getPopupSize(),r=this._positions[t.key],a=this._parent?this._parent.domElem.offset():{top:0,left:0},l=r.top+(this._isParentFixed?a.top:-n.scrollTop()),c=r.left+(this._isParentFixed?a.left:-n.scrollLeft()),d=c+o.width-s.width,u=l+o.height-s.height,h={height:o.height,width:o.width},p=100;return u>0&&(h.height-=u),0>l&&(h.height+=l),0>c&&(h.width+=c),d>0&&(h.width-=d),h.height<0||h.width<0?p=0:(i=Math.abs(h.height*h.width),e=o.height*o.width,e!==i&&(p=i/e*100)),p},_repaintShadow:function(){"undefined"==typeof this._repaintShadowCounter&&(this._repaintShadowCounter=0),this.domElem.css("zoom",1&++this._repaintShadowCounter)},destruct:function(){var t=arguments;return this._channel.un("hide"),this._childs.forEach(function(e){e.destruct.apply(e,t)}),this.__base.apply(this,t)},_resetDefault:function(){},_calcPlacingSize:function(){}},{live:function(){this.liveBindTo("close","leftclick tap",function(){this.hide()})},_getFocusable:function(e){var i=t.data(e,"popup-getFocusable-id");i||(i=t.identify(),t.data(e,"popup-getFocusable-id",i)),i='*[data-popup-getFocusable-id="'+i+'"]';var s=n?"":"a[href], link, ";return e.find(s+'*[tabindex], button, input:not([type="hidden"]), textarea, select, menuitem').filter(function(){var e=t(this),n=!0;return parseInt(e.prop("tabindex"),10)<0||"hidden"===e.css("visibility")?!1:(t(this).parentsUntil(i).each(function(){var e=t(this);return"none"===e.css("display")?n=!1:void 0}),n)})}})}(jQuery),BEM.DOM.decl("popup",{onSetMod:{autoclosable:{yes:function(){this._enableAutoclosable()},"":function(){this._disableAutoclosable()}}},_enableAutoclosable:function(){var t=this._under;this.hasMod(t,"type","paranja")&&(t.is("iframe")&&(t=$([t[0].contentWindow,t[0].contentWindow.document])),this.bindTo(t,"leftclick tap",function(t){t.stopPropagation(),this.hide()}),this.bindTo(t,"mousedown",function(){this._skipReturnFocus=!0})),this.bindToDoc("leftclick tap",function(t){if(!this._isRelatedNode($(t.target))){var e=$.Event("outside-click");this.trigger(e,t),e.isDefaultPrevented()||this.hide()}}),this.bindToDoc("mousedown",function(){this._skipReturnFocus=!0})},_disableAutoclosable:function(){this.hasMod(this._under,"type","paranja")&&this.unbindFrom(this._under,"leftclick tap mousedown"),this.unbindFromDoc("leftclick tap mousedown")},_isRelatedNode:function(t){var e=this.containsDomElem(t);if(e||(e=Boolean(this._owner)&&this.containsDomElem.call({domElem:this._owner},t)),e)return!0;var i,n=this._childs.length;for(i=0;n>i;i++)if(this.containsDomElem.call({domElem:this._childs[i].domElem},t))return!0;return!1}}),BEM.DOM.decl({block:"popup",modName:"adaptive",modVal:"yes"},{onSetMod:{adaptive:{yes:function(){this._enableAdaptive()},no:function(){this._disableAdaptive()}},"watch-scroll":{yes:function(){this._watchScroll()},no:function(){this._unwatchScroll()}}},_enableAdaptive:function(){this.bindToWin("resize",$.throttle(this.onResize,500,this))._watchScroll()},_disableAdaptive:function(){this.unbindFromWin("resize")._unwatchScroll()},getScrollEvents:function(){return["scroll"]},_watchScroll:function(){this._owner&&!this.hasMod("watch-scroll","no")&&this.bindTo(this._owner.parents().add(this._viewport),this.getScrollEvents().join(" "),$.throttle(this.onScroll,500,this),this)},_unwatchScroll:function(){this._owner&&this.unbindFromDomElem(this._owner.parents().add(this._viewport),this.getScrollEvents().join(" "))},onResize:function(){this._cache={},this._isShown&&!this._isHiding&&this.repaint()},onScroll:function(){this._cache={},this._isShown&&!this._isHiding&&this.repaint()},destruct:function(){this._disableAdaptive(),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"popup",modName:"animate",modVal:"yes"},{afterShow:function(){var t=this.getCurrDirection();if(t){var e=t.to,i=this.getCurrPos(),n={opacity:1,top:i.top,left:i.left},s={opacity:0,top:i.top,left:i.left};"bottom"===e?s.top+=10:"top"===e?s.top-=10:"left"===e?s.left-=10:"right"===e&&(s.left+=10),this.domElem.stop(!0).css(s).animate(n,this.params.duration)}},beforeHide:function(t){var e=this.getCurrDirection();if(!e)return t();var i=e.to,n=this.getCurrPos(),s=this.domElem,o={top:n.top,left:n.left,opacity:0};return"bottom"===i?o.top+=10:"top"===i?o.top-=10:"left"===i?o.left-=10:"right"===i&&(o.left+=10),s.stop(!0,!0).animate(o,this.params.duration,function(){t(),s.css("opacity","")})}}),function(){var t=[];BEM.DOM.decl("popup",{onSetMod:{js:function(){this.__base.call(this);var t=this.findElem("under").first();this._underClassAttr=t.attr("class"),this.isDivEnough()?this._under=t:(t.remove(),this._under=null),this._underInPool=!1}},isDivEnough:function(){return!1},_createUnder:function(){return $('<iframe frameBorder="0" tabindex="-1" src="about:blank"/>')},_getUnder:function(){if(this._under)return this._under;var e=t.pop();return e&&(this._underInPool=!1),this._under=e||this._createUnder()},_attachUnder:function(){var t=this._under=this._getUnder();t.attr("class",this._underClassAttr),this.hasMod(t,"type","paranja")?t.detach().insertBefore(this.domElem):t.prependTo(this.domElem)},_detachUnder:function(){var e=this._under;t.push(e.detach()),this._under=null,this._underInPool=!0},destruct:function(){return this._underInPool&&t.pop(),this.__base.apply(this,arguments)}})}(),BEM.DOM.decl("popup",{onSetMod:{js:function(){this.__base(),this._tailPos={}}},_calcTailPos:function(t){var e=t.to,i=this._positions[t.key],n=t.tail.axis,s={};return"top"===e||"bottom"===e?s.left=this._calcTailLeft(n,i):("left"===e||"right"===e)&&(s.top=this._calcTailTop(n,i)),s},_calcTailTop:function(t,e){var i=0,n=this.getOwnerSize(),s=this.getOwnerPos(),o=this.params.tail.width,r=this.getPopupSize(),a=r.height,l=s.top-e.top,c=e.top+r.height-(s.top+n.height);return l>0&&(i+=l,a-=l),c>0&&(a-=c),"middle"===t?(a-=o,i+=a/2):"bottom"===t&&(a-=o,i+=a),0>i&&(i=0),i},_calcTailLeft:function(t,e){var i=0,n=this.getOwnerSize(),s=this.getOwnerPos(),o=this.params.tail.width,r=this.getPopupSize(),a=s.left-e.left,l=r.width,c=e.left+r.width-(s.left+n.width);return a>0&&(i+=a,l-=a),c>0&&(l-=c),"center"===t?(l-=o,i+=l/2):"right"===t&&(l-=o,i+=l),i},_calcOffsetByTail:function(t){var e=this.params.tail,i=e.height,n={};switch(t.to){case"top":n={top:-i};break;case"bottom":n={top:i};break;case"right":n={left:i};break;case"left":n={left:-i}}return n},_calcTailOffset:function(t){var e={},i=t.to,n=t.tail,s=n.offset,o=n.axis;return s?("top"===i||"bottom"===i?(e.left=0,"left"===o?e.left+=s.left:"center"===o?(s.left&&(e.left+=s.left),s.right&&(e.left-=s.right)):"right"===o&&(e.left-=s.right)):("left"===i||"right"===i)&&(e.top=0,"top"===o?e.top+=s.top:"middle"===o?(s.top&&(e.top+=s.top),s.bottom&&(e.top-=s.bottom)):"bottom"===o&&(e.top-=s.bottom)),e):!1},_resetTailPos:function(t){return t?this._tailPos[t]=null:this._tailPos={},this},_pushTailPos:function(t,e){return this._pushPosTo(this._tailPos,t,e),this}}),BEM.DOM.decl({block:"popup",modName:"more",modVal:"yes"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.bindTo("click",this._onItemClick.bind(this))}},_onItemClick:function(){this.hide()}}),BEM.DOM.decl({block:"popup",modName:"type",modVal:"modal"},{getDefaultParams:function(){var t=this.__base();return t.top="50%",t.left="50%",t},_isPercentVal:function(t){return"string"==typeof t&&t.indexOf("%")>0},show:function(t){return this._moveToContainer(),this.setMod("visibility","outside").setMod("adaptive","no"),this.repaint(t),this},repaint:function(t){this._moveToContainer(),t||(t={left:this.params.left,top:this.params.top});var e=this.getPopupSize();return this._isPercentVal(t.left)&&!t.marginLeft&&(t.marginLeft=e.width/(-100/parseInt(t.left,10))),this._isPercentVal(t.top)&&!t.marginTop&&(t.marginTop=e.height/(-100/parseInt(t.top,10))),this._show(t),this}}),BEM.DOM.decl({block:"popup",modName:"position",modVal:"fixed"},{addChild:function(t){this.__base.apply(this,arguments),t.setMod("watch-scroll","no")},_onFirstFocusableKeyDown:function(t){t.ctrlKey||t.altKey||t.metaKey||t.shiftKey&&9===t.which&&(t.preventDefault(),this._lastFocusable.focus())},_onLastFocusableKeyDown:function(t){t.shiftKey||t.ctrlKey||t.altKey||t.metaKey||9===t.which&&(t.preventDefault(),this._firstFocusable.focus())}}),BEM.DOM.decl({block:"popup",modName:"position",modVal:"fixed"},{getOwnerPos:function(){var t=this.__base.apply(this,arguments);if(this._owner){var e=this._viewport;t.top-=e.scrollTop(),t.left-=e.scrollLeft()}return t}}),BEM.DOM.decl({block:"popup",modName:"behavior",modVal:"staff-card"},{_moveToContainer:function(t){t=this._scope,this._inContainer?t.children(":last")[0]===this.domElem[0]||this.domElem.appendTo(t):this._inContainer=!!this.domElem.appendTo(t)},setParent:function(){return this._isParentFixed=!1,this}}),BEM.DOM.decl("link",{getDefaultParams:function(){return{origTabindex:"0"}},onSetMod:{disabled:function(t,e){var i="yes"===e;this.domElem.attr({"aria-disabled":i,tabindex:i?-1:this.params.origTabindex})}}}),BEM.DOM.decl({name:"link",modName:"pseudo",modVal:"yes"},{_onClick:function(t){t.preventDefault(),this.hasMod("disabled","yes")||this.afterCurrentEvent(function(){this.trigger("click")})},_onKeyUp:function(t){t.shiftKey||t.ctrlKey||t.altKey||(13===t.which||32===t.which)&&(this.hasMod("disabled","yes")||this.afterCurrentEvent(function(){this.trigger("click")}))}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo({modName:"pseudo",modVal:"yes"},"leftclick tap",function(t){this._onClick(t)}).liveBindTo({modName:"pseudo",modVal:"yes"},"keyup",function(t){this._onKeyUp(t)})}}),BEM.DOM.decl("mi-phone-button",{onSetMod:{js:function(){this._setDefaultState()}},_setDefaultState:function(){var t=this;clearTimeout(this._timeout),this.delMod("calling"),this.delMod("error"),this.domElem.off("click.cancel-call"),this.domElem.on("click.call",function(){t._onCallClick()})},setPhone:function(t){this.params.phone=t},_onData:function(t){return t&&t.response&&"ok"==t.response?this._successFinish():(this._onError(),void 0)},_onError:function(){this.setMod("error","yes")},_successFinish:function(){var t=this;this._timeout=setTimeout(function(){t._setDefaultState()},5e3)},_onCallClick:function(){var t=this;this.domElem.off("click.call"),this.domElem.on("click.cancel-call",function(){t._setDefaultState()}),this.setMod("calling","yes"),$.ajax({url:"//staff.yandex-team.ru/api/call/"+this.params.phone,dataType:"jsonp",success:this._onData,error:this._onError,context:this})},destruct:function(){this.domElem.off(),this.__base.apply(this,arguments)}}),function(){var t="background-position",e="0 -",i=!1,n="animation",s="islands-spin",o="transform",r="sprite";!function(){var s=document.createElement("img");void 0!==s.style["background-position-y"]&&(t="background-position-y",e="-");var o="Webkit Moz O ms Khtml".split(" ");if(void 0!==s.style.animationName)i=!0;else for(var r=0;r<o.length;r++){var a=o[r];if(void 0!==s.style[a+"AnimationName"]){n="-"+a.toLowerCase()+"-animation",i=!0;break}}}(),BEM.DOM.decl("spin",{getDefaultParams:function(){return{animation:o,startDelay:0,frameAngle:10,frameTime:27,frames:36}},onSetMod:{js:function(){i||(this.params.animation=r),this.params.animation===r&&(this._size=parseInt(this.getMod("size")||/[\d]+/.exec(this.getMod("theme"))[0],10),this._height=this._size*this.params.frames,this._curFrame=0,this.setMod("support-transforms","no")),this.hasMod("progress","yes")&&this._startSpin()},progress:{yes:function(){this._startSpin()},"":function(){this._stopSpin()}}},_startSpin:function(){var t=function(){if(this.hasMod("progress","yes")&&!this._interval)switch(this.params.animation){case o:var t=s+" "+Math.floor(360*this.params.frameTime/this.params.frameAngle)+"ms infinite linear";this.elem("icon").css(n,t);break;case r:this._interval=setInterval(this._switchFrame.bind(this),this.params.frameTime)}}.bind(this);this._delayTimeout=setTimeout(t,this.params.startDelay)},_stopSpin:function(){this._delayTimeout&&(clearTimeout(this._delayTimeout),delete this._delayTimeout),this._interval&&(clearInterval(this._interval),delete this._interval)},_switchFrame:function(){var i=++this._curFrame,n=i*this._size;n>=this._height&&(this._curFrame=n=0),this.elem("icon").css(t,e+n+"px")},destruct:function(){this._stopSpin(),this.__base.apply(this,arguments)}})}(),BEM.DOM.decl({name:"m-button-action",modName:"type",modVal:"email"},{onSetMod:{js:function(){var t=this.findBlockInside("button");t.on("click",this._changeView,this)}},_changeView:function(){var t=this,e=this.domElem.css("width"),i=this.findBlockInside("input").elem("control"),n=this.elem("return");this.domElem.css("width",e),this.setMod("email","copy"),i.select(),n.on("click",function(){t.delMod("email")})}},{live:function(){this.liveInitOnBlockInsideInit("button")}}),BEM.DOM.decl("button",{onSetMod:{js:function(){var t=this.isDisabled(),e=this.domElem;(this._href=e.attr("href"))&&t&&e.removeAttr("href")},disabled:function(t,e){var i="yes"===e,n=this.domElem;this._href&&(i?n.removeAttr("href"):n.attr("href",this._href)),this.afterCurrentEvent(function(){n.attr("disabled",i)})},pressed:function(t,e){return this.isDisabled()?!1:(this.trigger("yes"===e?"press":"release"),void 0)}},isDisabled:function(){return this.hasMod("disabled","yes")},url:function(t){return"undefined"==typeof t?this._href:(this._href=t,this.isDisabled()||this.domElem.attr("href",t),this)},_onClick:function(t){this.isDisabled()?t.preventDefault():this.afterCurrentEvent(function(){this.trigger("click")})}},{live:function(){this.liveBindTo("leftclick tap",function(t){this._onClick(t)})}}),BEM.DOM.decl("button",{onSetMod:{js:function(){this.__base.apply(this,arguments)},focused:{yes:function(){return this.isDisabled()?!1:(this.bindToWin("unload",function(){this.delMod("focused")}).bindTo("keydown",this._onKeyDown),this._isControlFocused()||this._getControl().focus(),this.afterCurrentEvent(function(){this.trigger("focus")}),void 0)},"":function(){this.unbindFromWin("unload").unbindFrom("keydown"),this._isControlFocused()&&this._getControl().blur(),this.afterCurrentEvent(function(){this.trigger("blur")})}},disabled:function(t,e){this.__base.apply(this,arguments),"yes"===e&&this.domElem.keyup()},hovered:function(t,e){return this.isDisabled()?!1:(""===e&&this.delMod("pressed"),void 0)},pressed:function(){return this.isDisabled()||this.setMod("focused","yes"),this.__base.apply(this,arguments)}},_getControl:function(){return this.elem("control").length&&this.elem("control")||this.domElem},_isControlFocused:function(){try{return this.containsDomElem($(this.__self.doc[0].activeElement))}catch(t){return!1}},_onKeyDown:function(t){var e=t.keyCode;13!==e&&32!==e||this._keyDowned||(this._keyDowned=!0,this.setMod("pressed","yes").bindTo("keyup",function(){this.delMod("pressed").unbindFrom("keyup"),delete this._keyDowned,32===e&&this.domElem.attr("href")&&(document.location=this.domElem.attr("href"))}))},destruct:function(){this.delMod("focused"),this.__base.apply(this,arguments)}},{live:function(){this.__base.apply(this,arguments);var t={mouseover:{name:"hovered",val:"yes"},mouseout:{name:"hovered"},mousedown:{name:"pressed",val:"yes"},mouseup:{name:"pressed"},focusin:{name:"focused",val:"yes"},focusout:{name:"focused"}};this.liveBindTo("mouseover mouseout mouseup focusin focusout",function(e){var i=t[e.type];this.setMod(i.name,i.val||"")}).liveBindTo("mousedown",function(e){var i=t[e.type];1===e.which&&this.setMod(i.name,i.val||"")})}}),BEM.DOM.decl("input",{onSetMod:{js:function(){this._val=this.elem("control").val()},disabled:function(t,e){this.elem("control").attr("disabled","yes"===e)},focused:function(t,e){if(this.hasMod("disabled","yes"))return!1;var i="yes"===e;i?this._focused||this._focus():this._focused&&this._blur(),this.afterCurrentEvent(function(){this.trigger(i?"focus":"blur")})}},isDisabled:function(){return this.hasMod("disabled","yes")},val:function(t,e){if("undefined"==typeof t)return this._val;t=null===t?"":t.toString();var i=this.elem("control");return i.val()!==t&&i.val(t),this._val=t,this.trigger("change",e),this},name:function(){return this.elem("control").attr("name")},getSelectionEnd:function(){var t=this.elem("control")[0],e=0;if("number"==typeof t.selectionEnd)e=t.selectionEnd;else{var i=document.selection.createRange();if(i&&i.parentElement()===t){var n=t.value.length,s=t.createTextRange();s.moveToBookmark(i.getBookmark());var o=t.createTextRange();o.collapse(!1),e=s.compareEndPoints("EndToEnd",o)>-1?n:-s.moveEnd("character",-n)}}return e},_onFocus:function(){return this._focused=!0,this.setMod("focused","yes")},_onBlur:function(){return this._returnFocus?(this.afterCurrentEvent(function(){this._focus()}),this):this.hasMod(this.elem("clear"),"pressed")?this:(this._focused=!1,this.delMod("focused"))},_focus:function(){return this.hasMod("disabled","yes")?!1:(this.elem("control").focus(),void 0)},_blur:function(){this._returnFocus=!1,this.elem("control").blur()},destruct:function(){this._blur(),this.__base.apply(this,arguments)}},{live:function(){this.liveBindTo("control","focusin focusout",function(t){this["focusin"===t.type?"_onFocus":"_onBlur"](t)})}}),function(){var t,e=[],i=function(){e.forEach(function(t){t.val(t.elem("control").val())})},n=function(t){try{return t.activeElement}catch(e){}};BEM.DOM.decl("input",{onSetMod:{js:{inited:function(){this.__base.apply(this,arguments),this._instanceIndex=e.push(this)-1;var s=this.elem("control"),o=n(this.__self.doc[0]),r=this.params.autoFocus&&(!o||!$(o).is("input, textarea"));(o===s[0]||r)&&(this.setMod("focused","yes")._focused=!0),t||(t=this.channel("sys").on({tick:i,idle:function(){t.un("tick",i)
},wakeup:function(){t.on("tick",i)}})),this.params.shortcut&&this.bindToDoc("keydown",function(t){t.ctrlKey&&38===t.which&&!$(t.target).is("input, textarea")&&this.setMod("focused","yes")})}}},val:function(t,e){var i="undefined"!=typeof t,n=this.elem("control");return t=i?null===t?"":t.toString():n.val(),this._val!==t&&(this._val=t,n.val()!==t&&n.val(t),this.trigger("change",e)),i?this:t},_focus:function(){var t=this.elem("control")[0];if(t.createTextRange&&!t.selectionStart){var e=t.createTextRange();e.move("character",t.value.length),e.select()}else t.focus()},destruct:function(){this.__base.apply(this,arguments),this.params.shortcut&&this.unbindFromDoc("keydown"),e.splice(this._instanceIndex,1),e.slice(this._instanceIndex).forEach(function(t){t._instanceIndex--})}},{})}(),BEM.DOM.decl("input",{_onBlur:function(){return this._focused=!1,this.delMod("focused")}}),BEM.DOM.decl("input",{onSetMod:{js:function(){this.__base.apply(this,arguments),this.on("change",this._updateClear)._updateClear()}},_onBoxClear:function(){this.hasMod("clear","visibility","visible")||this.setMod("focused","yes")},_onClearClick:function(){return this.trigger("clear"),this.removeInsets&&this.removeInsets(),this.clearInput({source:"clear"})._focus()},clearInput:function(t){return this.val("",t),this},_updateClear:function(){return this.toggleMod(this.elem("clear"),"visibility","visible","",!!this._val)}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo("clear","mousedown",function(t){1===t.which&&this.setMod(this.elem("clear"),"pressed","yes")}).liveBindTo("clear","leftclick tap",function(){this.delMod(this.elem("clear"),"pressed"),this._onClearClick()}).liveBindTo("box","leftclick tap",function(){this._onBoxClear()})}}),BEM.DOM.decl({block:"input",modName:"assigned",modVal:"form"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params.required&&this.findBlockOutside("b-wiki-form")._requiredFields.push(this)},focused:{yes:function(){this.__base.apply(this,arguments),this._parentField||(this._parentField=this.findBlockOutside("b-wiki-form-field")),this._parentField.errorMessage&&(this.elem("control").on("input.formerror",function(){this._parentField.errorMessage=null,this._parentField.delMod("validation"),this.channel("errors").trigger("errorHide"),this.elem("control").off("input.formerror")}.bind(this)),BEM.channel("wiki-form").trigger("error",{text:this._parentField.errorMessage,node:this._parentField}))}}}}),BEM.DOM.decl({block:"b-link",modName:"pseudo",modVal:"yes"},{_onClick:function(t){t.preventDefault(),this.hasMod("disabled","yes")||this.afterCurrentEvent(function(){this.trigger("click")})}},{live:function(){this.__base.apply(this,arguments),this.liveBindTo({modName:"pseudo",modVal:"yes"},"leftclick",function(t){this._onClick(t)})}}),BEM.HTML.decl({name:"b-link",modName:"pseudo",modVal:"yes"},{onBlock:function(t){t.tag(t.param("url")?"a":"span"),t.wrapContent({elem:"inner"}),t.js(!0)},onElem:{inner:function(t){t.tag("span")}}}),BEM.DOM.decl({block:"wiki-change",modName:"type",modVal:"doc"},{onSetMod:{js:function(){this._bPage=this.findBlockOutside("b-page"),~this.__self.tools.indexOf(this._bPage.params.login)&&(this._connectAttempts=this.__self._connectAttempts,this._viewLock=!0,this._enableCheckboxes=!0,this._justReconnect=!1,this.initInplace())}},_bindToFocusBlur:function(){this.bindToWin("focus",function(){this.dontDisconnectOnBlur||this.__alreadyFocused||(console.log("focus: in."),this.__alreadyFocused=!0,delete this.__self._lock,this._justReconnect=!0,this.initInplace())}),this.bindToWin("blur",function(){this.dontDisconnectOnBlur||(console.log("focus: out."),this.__alreadyFocused=!1,this.__self._lock=!0,this._disconnect())})},_unbindFocusBlur:function(){this.unbindFromWin("focus"),this.unbindFromWin("blur")},disableAllElements:function(){$.each(this.findBlocksInside({block:"chBox"}),function(t,e){e.domElem.prop("disabled",!0)})},enableAllElements:function(){$.each(this.findBlocksInside({block:"chBox"}),function(t,e){e.domElem.prop("disabled",!1)})},docDefine:function(){this._docBlock=this.findBlockOn("wiki-doc")},prepareDocument:function(t){var e=this;t.whenReady(function(){t.type||t.create("yawikitext","",function(t){t&&console.error("failed to create document",t)}),t.type&&"yawikitext"===t.type.name?(e.__self._methodContext=t.createContext(),e.__self._eventContext=t.createContext(),e.trigger("contextsReady"),e.__self._eventContext.onInsert=function(t,i,n){e.trigger("insert",{startPos:t,shift:n,bemjson:i})},e.__self._eventContext.onRemove=function(t,i){e.trigger("remove",{startPos:t,shift:i})}):console.log("unhandled situation - not text?")})},_getShardId:function(){return Array.prototype.map.call(this._docBlock.params.hemul_uid,function(t){return t.charCodeAt(0)}).reduce(function(t,e){return t+e},0)%this.__self._shardsCount+1},_createShardsIdArray:function(){for(var t=[],e=0;e<this.__self._shardsCount;e++)t.push(e+1);return t},_disconnect:function(t){this.disableAllElements(),this._doc&&this._doc.subscribed?this._doc.unsubscribe(function(){this._bcsocketClose(),t&&t()}.bind(this)):(this._bcsocketClose(),t&&t())},_bcsocketClose:function(){this.__self._bcsocket&&this.__self._bcsocket.close()},_setConnection:function(t,e,i){var n=this;!this._justReconnect||this.__self._bcsocket&&0===this.__self._bcsocket.readyState?(console.log("init: _bcsocket."),this._justReconnect=!1,this.__self._bcsocket=new BCSocket("/_hemule/"+t,{reconnect:!0,failFast:!0})):3===this.__self._bcsocket.readyState?(console.log("reopen: _bcsocket."),this.__self._bcsocket.open()):n.enableAllElements(),this.__self._bcsocket.onopen=function(){console.log("_bcsocket was opened."),n._viewLock=!1,n.enableAllElements(),n._justReconnect||(console.log("init: _sjs."),n.__self._sjs=new window.sharejs.Connection(n.__self._bcsocket)),n.__self._sjs.state="connecting",n.__self._sjs.canSend=!0,n.__self._sjs.socket.onerror=function(s){n._onConnectionError(s,t,e,i)},n.__self._sjs.on("error",function(){n._showBcSocketErrorMsg(),n.disableAllElements(),n._disconnect(),n._unbindFocusBlur()}),n._connectAttempts=n.__self._connectAttempts,i()},this.__self._bcsocket.onerror=function(s){n._onConnectionError(s,t,e,i)}},_showBcSocketErrorMsg:function(){var t;this.__self._errorBlock||(t=BEMHTML.apply({block:"wiki-change-error",content:BEM.I18N("wiki-change","text")}),BEM.DOM.prepend(this._doc._bemObj.domElem,t),this.__self._errorBlock=this._doc._bemObj.findBlockInside("wiki-change-error")),this.__self._errorBlock.length&&this.__self._errorBlock.show()},_onConnectionError:function(t,e,i,n){this._disconnect(),i.length?this._setConnection(i.pop(),i,n):this._connectRetry(),console.log("Ошибка соединения с шардом id: %d. Сообщение: %s",e,t)},_connectRetry:function(){this._connectAttempts&&!this.__self._lock&&setTimeout(function(){console.log("Опять пробуем соединиться с шардами..."),this.initInplace(),this._connectAttempts--}.bind(this),this.__self._shardReconnectTime)},initInplace:function(){var t,e,i=this;this.docDefine(),this.disableAllElements(),this._docBlock.params&&this._docBlock.params.hemul_uid&&(t=this._createShardsIdArray(),e=this._getShardId(),t.splice(t.indexOf(e),1),this._setConnection(e,t,function(){i._justReconnect||(console.log("init: _doc."),i._doc=i.__self._sjs.get(i._docBlock.params.hemul_collection,i._docBlock.params.hemul_uid),i._bindToFocusBlur()),i._doc.subscribe(),i._doc._bemObj=i,!i._justReconnect&&i.prepareDocument(i._doc)}))}},{_shardsCount:3,_shardReconnectTime:2e4,_connectAttempts:10,tools:["vladmos","kolomeetz","granatka","ananke","bosnyakova","boulochka","lerarunge","dkoryavov","zhora","puroman","yasabirova","gnoma","aleksundra","theigel","msahnov","den-lesnov","dmirain","wlame","chapson","elisei","yurgis","alexkoshelev","q210","zubchick","knopka","artemredkin","abobukh","vbuldakov","another","dm-tim","vshakhov","abulgakov","sibirev","terrmit","markov","letitbee","ablazh","wmute","vchimishuk","nordaux","kostya","xaraven","dukeartem","buckstabu","zivot","chrono","altruistka","doombu","rzhavsky","parikmaher","user3370","user3371","wiki-tester3"]}),BEM.DOM.decl({block:"wiki-change",modName:"type",modVal:"checkbox"},{onSetMod:{js:function(){var t=this;this.wikiChangeDoc=this.findBlockOutside({block:"wiki-change",modName:"type",modVal:"doc"}),this.wikiChangeDoc&&(this.findElements(),this.wikiChangeDoc._enableCheckboxes&&(this.wikiChangeDoc.__self._eventContext?this.runElem():this.wikiChangeDoc.on("contextsReady",function(){t.runElem()})))}},runElem:function(){this.subscribeElementsEvents(),this.subscribeContextEvents(),this.enableElements()},findElements:function(){this.chBox=this.findBlockInside("chBox")},disableAllElements:function(){$.each(this.wikiChangeDoc.findBlocksInside("wiki-change"),function(t,e){e.disableElements()})},disableElements:function(){this.chBox.domElem.prop("disabled",!0)},enableElements:function(){!this.wikiChangeDoc._viewLock&&this.chBox.domElem&&this.chBox.domElem.prop("disabled",!1)},subscribeElementsEvents:function(){var t=this.findBlockInside("chBox");t.domElem&&t.domElem.on("change",function(t){this.onChangeCheckbox(t)}.bind(this))},subscribeContextEvents:function(){var t=this;setTimeout(function(){t.wikiChangeDoc.on("insert",t.onInsert,t),t.wikiChangeDoc.on("remove",t.onRemove,t)},0)},unsubscribeContextEvents:function(){this.chBox.domElem.off("change"),this.wikiChangeDoc.un("contextsReady"),this.wikiChangeDoc.un("insert",this.onInsert,this),this.wikiChangeDoc.un("remove",this.onRemove,this)},onInsert:function(t,e){this.domElem&&(this.disableElements(),this.params.startPos==e.startPos&&BEM.DOM.before(this.domElem,BEMHTML.apply(e.bemjson)),this.updateId(e.startPos,e.shift),this.enableElements())},onRemove:function(t,e){this.domElem&&(this.disableElements(),this.params.startPos==e.startPos?(this.unsubscribeContextEvents(),this.destruct()):this.updateId(e.startPos,e.shift),this.enableElements())},updateId:function(t,e){var i=parseInt(t,10),n=parseInt(this.params.startPos,10),s=this.params.element_id.split("x"),e=parseInt(e,10);s[0]=parseInt(s[0],10),s[1]=parseInt(s[1],10),n>=i&&(s[0]+=e,s[1]+=e,this.params.startPos=n+e,this.params.element_id=s.join("x"),this.setMod("id",this.params.element_id)),s[0]<i&&s[1]>i&&(s[1]+=e,this.params.element_id=s.join("x"),this.setMod("id",this.params.element_id))},onChangeCheckbox:function(t){var e=this;this.disableAllElements(),setTimeout(function(){$(t.target).prop("checked")===!0?e.wikiChangeDoc.__self._methodContext.setAllCheckboxes(e.params.element_id):e.wikiChangeDoc.__self._methodContext.unsetCheckbox(e.params.element_id)},0)}}),BEM.DOM.decl("wiki-change-error",{show:function(){this.setMod("visible","yes")},hide:function(){this.delMod("visible")}}),BEM.HTML.decl("b-icon",{onBlock:function(t){var e,i={src:"//yastatic.net/lego/_/La6qi18Z8LwgnZdsAr1qy1GwCwo.gif",alt:""},n=t.params(),s=["alt","width","height"];for(n.url&&(i.src=n.url);e=s.shift();)n[e]&&(i[e]=n[e]);t.tag("img").attrs(i)}}),BEM.DOM.decl("wiki-cut",{onSetMod:{js:{inited:function(){this.bindTo(this._getToggler(),"click",this.toggle)}}},_getToggler:function(){return this.findBlockInside({blockName:"b-link",modName:"pseudo",modVal:"yes"}).domElem},recursiveExpand:function(){"expanded"!=this.getMod("type")&&this.toggle();var t=this.findBlockOutside("wiki-cut__cbody");t&&t.findBlockOutside("wiki-cut").recursiveExpand()},toggle:function(){this.toggleMod("type","expanded")}}),BEM.DOM.decl("wiki-err",{onSetMod:{js:{inited:function(){this.bindTo(this._getToggler(),"click",this.toggle)}}},_getToggler:function(){return this.findElem("more")},recursiveExpand:function(){"expanded"!=this.getMod("type")&&this.toggle()},toggle:function(){this.toggleMod("type","expanded")}}),BEM.DOM.decl("wiki-head",{onSetMod:{js:function(){var t=this;this.__self._bPage||(this.__self._bPage=this.findBlockOutside("b-page")),this.__base.apply(this,arguments),this._editLink=this.findElem("link","type","edit"),this._editLink.on("click",function(){var e=$(this).attr("href"),i=/[.]\S+/g.exec(e);return WikiHistory._pushState(i),WikiHistory._getRoute(t.__self._bPage),t._saveButton||(t._saveButton=t.__self._bPage.findBlockInside("b-editor-save-button")),keymaster("ctrl+enter, command+enter",t._saveButton._onClick.bind(t._saveButton)),!1})}}}),BEM.DOM.decl("wiki-headcut",{onSetMod:{js:{inited:function(){this.bindTo(this._getChead(),"click",this._toggle)}}},_getChead:function(){return this.elem("head").eq(0)},_toggle:function(){this.toggleMod("visibility","visible")}}),BEM.DOM.decl("wiki-docviewer",{_links:[],_popupa:{},_owner:{},onSetMod:{js:function(){this._getLinks(),this._popupa=this.findBlockOn("b-popupa")}},_getLinks:function(){this._links=this.findBlocksInside("b-link")},_setContent:function(t){for(var e=this._links,i=0;i<e.length;i++){var n=e[i];"view"==n.getMod("type")?n.domElem.attr("href",t.docviewer):n.domElem.attr("href",t.url)}},toggle:function(t,e){this._popupa._isShowed&&this._popupa.hide(),this._owner!==t&&(this._owner=t,this._setContent(e)),this._popupa.toggle(t)}}),function(t){var e=["down-right","down","down-left","up","up-right","up-left","right-down","right","right-up","left-down","left","left-up"];BEM.DOM.decl("b-popupa",{onSetMod:{js:function(){this._owner=null,this._isShowed=!1,this._direction=this.getMod("direction")||"down",this._lastDirection=null,this._hasTail=!!this.elem("tail").length,this._hasTail||Object.keys(this.params).forEach(function(t){0===t.indexOf("tail")&&(this.params[t]=0)},this)}},show:function(t){return this._isShowed&&this._owner===t||(this._owner=t,this._getUnder().show({left:-1e4,top:-1e4}),this.pos(),this._getUnder().setMod("animate","yes")),this},hide:function(){return this._isShowed&&this._getUnder().hide(),this},toggle:function(t){return this.isShowed()?this.hide():this.show(t)},_pos:function(){var t=this._calcParams(this._owner);return this._hasTail&&this.elem("tail").css(t.tailOffsets),this.setMod("direction",t.direction)._getUnder().show(t.offsets),this},pos:function(){return this._isShowed?this._pos():this},isShowed:function(){return this._isShowed},setDirection:function(t){this._direction!=t&&(this._direction=t,this.isShowed()&&this.pos())},setContent:function(t,e,i){return BEM.DOM.update(this.elem("content"),t,e,i),this.isShowed()?this.pos():this},_isOwnerNode:function(){return!(!this._owner||!this._owner.jquery)},_calcDimensions:function(){var t=this._getUnder().domElem,e=this._getUnder()._getUnder(),i=this.__self.win,n=this._owner,s=this._isOwnerNode(),o=s?n.offset():n,r=s?n.outerWidth():0,a=s?n.outerHeight():0,l=i.scrollLeft(),c=i.scrollTop(),d=this.__self.getWindowSize(),u=parseInt(this.elem("content").css("border-top-width"),10);return{ownerWidth:r,ownerHeight:a,ownerLeft:o.left,ownerTop:o.top,ownerRight:o.left+r,ownerBottom:o.top+a,ownerHorizMiddle:o.left+r/2,ownerVertMiddle:o.top+a/2,posWidth:t.outerWidth(),posHeight:t.outerHeight(),underWidth:e.outerWidth(),underHeight:e.outerHeight(),borderWidth:isNaN(u)?0:u,windowLeft:l,windowRight:l+d.width,windowTop:c,windowBottom:c+d.height}},_calcParams:function(){var e=this._calcDimensions();if(this.hasMod("adjustable","no"))return this.calcDirectionParams(this._direction,e);var i={},n=this.params.directions,s=t.inArray(this._direction,n);s>-1||(s=0);var o,r,a=s;do{if(o=n[s],r=i[o]=this.calcDirectionParams(o,e),!r.factor)return this._lastDirection=o,r;++s==n.length&&(s=0)}while(s!==a);return i[this._lastDirection||n[0]]},calcDirectionParams:function(t,e){var i,n=this.params,s={top:0,left:0},o={marginLeft:0,marginTop:0},r=t.split("-")[0],a=this._hasTail&&e.ownerWidth<n.tailWidthVertical?(n.tailWidthVertical-e.ownerWidth)/2:0,l=this._hasTail&&e.ownerHeight<n.tailHeightHorizontal?(n.tailHeightHorizontal-e.ownerHeight)/2:0;switch(t){case"up":case"down":s.left=e.ownerHorizMiddle-e.posWidth/2,s.top="down"==t?e.ownerBottom+n.tailHeightVertical:e.ownerTop-e.posHeight-n.tailHeightVertical,o.marginLeft=e.posWidth/2-n.tailWidthVertical/2,o.marginTop="down"==t?0-n.tailHeightVertical:0;break;case"up-left":case"up-right":case"down-left":case"down-right":s.left="down-right"==t||"up-right"==t?e.ownerLeft-a:e.ownerRight-e.posWidth+a,s.top="down"==r?e.ownerBottom+n.tailHeightVertical:e.ownerTop-e.posHeight-n.tailHeightVertical,o.marginLeft=e.ownerWidth>e.posWidth?e.posWidth/2-n.tailWidthVertical/2:e.ownerHorizMiddle-s.left-n.tailWidthVertical/2,o.marginTop="down"==r?e.borderWidth-n.tailHeightVertical:0-e.borderWidth;break;case"left-down":case"right-down":s.left="left-down"==t?e.ownerLeft-e.posWidth-n.tailWidthHorizontal:e.ownerRight+n.tailWidthHorizontal,s.top=e.ownerTop-l,o.marginLeft="left-down"==t?0-e.borderWidth:e.borderWidth-n.tailWidthHorizontal,o.marginTop=e.ownerHeight<e.posHeight?e.ownerVertMiddle-s.top-n.tailHeightHorizontal/2:e.posHeight/2-n.tailHeightHorizontal/2;break;case"left":case"right":s.left="left"==t?e.ownerLeft-e.posWidth-n.tailWidthHorizontal:e.ownerRight+n.tailWidthHorizontal,s.top=e.ownerVertMiddle-e.posHeight/2,o.marginLeft="left"==t?0-e.borderWidth:e.borderWidth-n.tailWidthHorizontal,o.marginTop=e.posHeight/2-n.tailHeightHorizontal/2;break;case"left-up":case"right-up":s.left="left-up"==t?e.ownerLeft-e.posWidth-n.tailWidthHorizontal:e.ownerRight+n.tailWidthHorizontal,s.top=e.ownerBottom-e.posHeight+l,o.marginLeft="left"==r?0-e.borderWidth:e.borderWidth-n.tailWidthHorizontal,o.marginTop=e.ownerHeight>e.posHeight?e.posHeight/2-n.tailHeightHorizontal/2:e.ownerVertMiddle-s.top-n.tailHeightHorizontal/2}return i=this.calcInWindowFactor(s,e),{direction:r,factor:i,offsets:s,tailOffsets:o}},calcInWindowFactor:function(t,e){var i=0;return e.windowTop>t.top&&(i+=e.windowTop-t.top),t.top+e.underHeight>e.windowBottom&&(i+=t.top+e.underHeight-e.windowBottom),e.windowLeft>t.left&&(i+=e.windowLeft-t.left),t.left+e.underWidth>e.windowRight&&(i+=t.left+e.underWidth-e.windowRight),i},getDefaultParams:function(){return{tailOffset:19,tailWidthHorizontal:9,tailWidthVertical:19,tailHeightHorizontal:19,tailHeightVertical:10,shadowSize:7,directions:e}},destruct:function(){var t=this._under;t?this._destructing||(this._destructing=!0,this.hide(),BEM.DOM.destruct(!1,t.domElem),this.__base(!0)):this.__base.apply(this,arguments)},_getUnder:function(){if(!this._under){var e=t(BEM.HTML.build({block:"i-popup",zIndex:this.params.zIndex,mods:{autoclosable:this.getMod("autoclosable")||"yes",fixed:this.hasMod("direction","fixed")&&"yes"},underMods:this.params.underMods,underMix:[{block:"b-popupa",elem:"under"}]}));(this._under=this.findBlockOn(e,"i-popup")).on({show:this._onUnderShowed,hide:this._onUnderHidden,"outside-click":this._onUnderOutsideClicked},this).elem("content").append(this.domElem)}return this._under},_onUnderShowed:function(){this._isShowed=!0,this.bindToWin("resize",this.pos)._isOwnerNode()&&this.bindToDomElem(this._owner.parents().add(this.__self.win),"scroll",this.pos),this.trigger("show")},_onUnderHidden:function(){this._isShowed=!1,this.unbindFromWin("resize")._isOwnerNode()&&this.unbindFromDomElem(this._owner.parents().add(this.__self.win),"scroll"),this.trigger("hide")},_onUnderOutsideClicked:function(){this.trigger.apply(this,arguments)}},{live:function(){this.liveBindTo("close","leftclick",function(){this.hide()})}}),BEM.HTML.decl("b-popupa",{onBlock:function(e){var i=!1;t.each(e.param("content"),function(t,e){return!(i="close"==e.elem)}),e.mods({theme:"ffffff",direction:"down","has-close":i&&"yes"}).js(!0).afterContent({elem:"shadow"})},onElem:{content:function(t){t.wrap({elem:"wrap-cell",tag:"td"}).wrap({tag:"tr"}).wrap({elem:"wrap",tag:"table"})},close:function(t){t.tag("i")},shadow:function(t){t.tag("i")},tail:function(t){t.tag("i").wrapContent({elem:"tail-i",tag:"i"})}}})}(jQuery),function(t){function e(){return o.length?o.shift():s?s.clone():s=n()}function i(t){o.push(t)}function n(){return t((r.safari||r.webkit)&&navigator.userAgent.toLowerCase().indexOf("mobile")>-1?"<div/>":"<iframe"+(r.msie&&r.version<9?' frameborder="0"':"")+"/>")}var s,o=[],r=t.browser;BEM.DOM.decl("i-popup",{onSetMod:{js:function(){var e=t.browser;e.msie&&parseInt(e.version)>=9&&(this.domElem[0].onresize=function(){this.className+=""})},visibility:{visible:function(){var t=this._getUnder(),e=t.parent();this.hasMod(t,"type","paranja")?e.is("body")||t.appendTo("body"):e[0]!==this.domElem[0]&&t.prependTo(this.domElem),this._inBody||(this._inBody=!!this.domElem.appendTo("body")),this.trigger("show")},"":function(){var t=this._getUnder();this.hasMod(t,"type","paranja")&&t.remove(),this._putUnder(),this.trigger("hide")}}},_getUnder:function(){return this._under||(this._under=e().attr("class",this._underClass||(this._underClass=this.findElem("under").remove().attr("class"))))},_putUnder:function(){i(this._under),delete this._under},show:function(t){return t&&this.domElem.css(t),this.setMod("visibility","visible")},hide:function(){return this.delMod("animate").delMod("visibility")}},{live:!0})}(jQuery),BEM.HTML.decl("i-popup",{onBlock:function(t){t.mod("autoclosable","yes").js(!0).wrapContent({elem:"content"}).afterContent({elem:"under",mods:t.param("underMods"),mix:t.param("underMix")}).param("zIndex")&&t.attr("style","z-index:"+(32700+t.param("zIndex")))}}),function(t){var e=t.browser.opera&&t.browser.version<12.1?"keypress":"keydown";BEM.DOM.decl({name:"i-popup",modName:"autoclosable",modVal:"yes"},{onSetMod:{visibility:{visible:function(){this.afterCurrentEvent(function(){if(this.hasMod("visibility","visible")){var i=this._under;this.bindToDoc("leftclick",function(e){this.containsDomElem(t(e.target))||this._onOutClick(e)}).bindToDoc(e,function(t){27==t.keyCode&&this.hide()}),i&&i.is("iframe")&&this.hasMod(i,"type","paranja")&&this.bindToDomElem(t([i[0].contentWindow,i[0].contentWindow.document]),"leftclick",this._onOutClick)}}),this.__base.apply(this,arguments)},"":function(){return this.unbindFromDoc("leftclick "+e).__base.apply(this,arguments)}}},_onOutClick:function(e){var i=t.Event("outside-click");this.trigger(i,{domEvent:e}),i.isDefaultPrevented()||this.hide()}})}(jQuery),BEM.DOM.decl("wiki-ticket",{onSetMod:{js:{inited:function(){this.bindTo(this._getTrigger(),"click",this._toggle)}}},_getTrigger:function(){return this.elem("summary")},_getDescription:function(){return this.elem("description")},_toggle:function(){this.toggleMod(this._getDescription(),"visibility","visible")}}),BEM.DOM.decl({name:"wiki-ref",modName:"type",modVal:"docviewer"},{_docviewer:{},onSetMod:{js:function(){this._getDocviewer(),this.bindTo(this.domElem,"click",this.docviewerTrigger)}},_getDocviewer:function(){this._docviewer=this.findBlockOutside("wiki-doc").findBlockInside("wiki-docviewer")},docviewerTrigger:function(t){t.preventDefault(),this._docviewer.toggle(this.domElem,this.params)}}),function(t,e){e.block["b-hidereferer"]=function(i){function n(t){var e=window.open(t);return null==e?(alert(r),!1):!0}function s(e,i){var n=t(e);if(t.browser.msie)var s=n.text();n.attr("href",i),t.browser.msie&&n.text(s)}if(!t.browser.opera){var o=i.i18n||{};if(o.blocked)var r=o.blocked;else var r=e.message("b-hidereferer:blocked-popups","Ваш браузер блокирует всплывающие окна. Измените, пожалуйста, настройки браузера.");t("a",this).andSelf().each(function(){if("A"!=this.nodeName.toUpperCase())return!0;var e="h.yandex.net",o=i.service?i.service:e,r=t(this).attr("href").match(new RegExp("^(https?:)?//"+o+"/\\?(.*)"));if(r){var a=t(this).attr("href"),l=r[2];if(l=decodeURIComponent(l.replace(/\+/g,"%20")),s(this,l),t.browser.webkit)return;t(this).mousedown(function(t){t.which>1?s(this,a):n(a)}),t(this).keypress(function(t){13==t.keyCode&&(t.preventDefault(),window.open(a))}),t(this).click(function(t){return t.preventDefault(),s(this,l),!1})}})}}}(jQuery,window.Lego),BEM.DOM.decl("wiki-toc",{onSetMod:{js:{inited:function(){var t=this.findBlockOutside("wiki-doc").findBlocksInside("wiki-head");this.setHeaders(t)}}},_headers:{},getHeader:function(t){return this._headers[t]},setHeaders:function(t){for(var e=0,i=t.length;i>e;e++){var n=t[e],s=n.elemParams(n.domElem).anchor;this._headers[s]=n}}}),BEM.DOM.decl({block:"wiki-toc",modName:"type",modVal:"sidebar"},{onSetMod:{js:{inited:function(){var t=this.findBlockOutside("b-page").findBlockInside({block:"wiki-doc",modName:"status",modVal:"main"}).findBlocksInside("wiki-head");this.setHeaders(t)}}}}),BEM.DOM.decl("wiki-tocitem",{onSetMod:{js:function(){var t=this.elemParams(this.domElem).anchor;this.bindTo(this.findElem("link"),"click",function(e){e.preventDefault(),this._goToHeader(t)})}},_goToHeader:function(t){var e=this.findBlockOutside("wiki-toc"),i=e.getHeader(t),n=i.findBlockOutside("wiki-cut");n&&n.recursiveExpand();var s=i.findElem("anchor").eq(0).position();location.hash="#"+t,window.scrollTo(s.left,s.top)}}),BEM.DOM.decl("wiki-tocitem",{_goToHeader:function(t){var e,i,n=this.findBlockOutside("wiki-toc"),s=n.getHeader(t),o=s.findBlockOutside("wiki-cut");this._bPage||(this._bPage=this.findBlockOutside("b-page")),o&&o.recursiveExpand(),location.hash="#"+t,(e=s.findBlockOutside("wiki-headcut"))&&e.setMod("visibility","visible"),i=s.findElem("anchor").eq(0).position(),this._bPage.hasMod("page-info")?window.scrollTo(i.left,i.top+$(".b-page-info").height()):window.scrollTo(i.left,i.top-$(".b-page-info").height())}}),BEM.DOM.decl("wiki-warnholder",{onSetMod:{js:function(){var t=this;this.bindTo("click",function(){var e=$(".wiki-doc .wiki-warnset").eq(0),i=$(".wiki-doc").bem("wiki-doc");if(i.toggleMod("show-warnsets","yes",""),i.hasMod("show-warnsets","yes")){var n=e.bem("wiki-warnset").findBlocksOutside("wiki-cut"),s=e.bem("wiki-warnset").findBlocksOutside("wiki-headcut");n.forEach(function(t){t.hasMod("type","expanded")||jQuery.contains(t._getToggler().get(0),e.get(0))||t.toggle()}),s.forEach(function(t){t.hasMod("visibility","visible")||jQuery.contains(t._getChead().get(0),e.get(0))||t._toggle()}),t.destruct(),$("html, body").animate({scrollTop:e.offset().top},1e3,function(){t._notDestructed&&(e.bem("wiki-warnset")._getIco().domElem.trigger("mouseover"),t._notDestructed=!1)})}else e.bem("wiki-warnset")._getIco().domElem.trigger("mouseout")})}},_notDestructed:!0}),BEM.DOM.decl("wiki-warnset",{timeoutId:!1,warns:!1,popupa:!1,isContent:!1,onSetMod:{js:function(){this._getPopupa(),this.bindTo(this._getIco().domElem,"mouseover mouseout",this.popupaTrigger)}},_getPopupa:function(){this.popupa=this.findBlockInside("b-popupa")},_getIco:function(){return this.findBlockInside("b-icon")},popupaTrigger:function(t){var e=this;this._popupaSetContent(),"mouseover"==t.type?(this.timeoutId=setTimeout(function(){e.popupa.show(e._getIco().domElem),e.setMod("state","hover")},1e3),this.status(this.warns.join(", "))):(clearTimeout(this.timeoutId),this.delMod("state",""),this.popupa.hide(),this.status())},_popupaSetContent:function(){this.isContent||(this.warns=this.elemParams(this.domElem),this.popupa.setContent(this.popupa.findElem("content").html()+this.renderWarningList(this.warns)),this.isContent=!0)},renderWarningList:function(){var t=this;return BEM.HTML.build([{block:"wiki-list",tag:"ul",content:function(){for(var e=[],i=0,n=t.warns.length;n>i;i++)e.push({block:"wiki-li",tag:"li",content:[t.warns[i]]});return e}()}])},status:function(t){window.status=t||""}}),BEM.DOM.decl({block:"b-page",modName:"type",modVal:"article"},{onSetMod:{js:function(){var t=this;this.__base.apply(this,arguments),this.channel("comments").on("loaded",this._onCommentsLoaded,this),this.highLightCode(),BEM.blocks["i-explainer"].explainAllLinks(this),WikiHistory._getRoute(this),$(window).on("statechange",function(){WikiHistory._getRoute(t)}),("ontouchstart"in window||window.navigator.msPointerEnabled)&&this.setMod("browser","touch")}},_onCommentsLoaded:function(){var t=window.location.hash.split("-")[1];t&&(window.location.hash="",this.__self.win.scrollTop($("#comments-"+t).offset().top),window.location.hash="#comments-"+t)}}),BEM.DOM.decl("b-action-widget",{onSetMod:{js:function(){BEM.create("api-request",{_:"api-response",apiPath:".actions/"+this.params.action,urlParams:[this.params.actionParams],path:WikiHistory._getCorrectPath()}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this))}},_onGotData:function(t){var e=t;this.setMod("loading","no"),"string"==typeof e?BEM.DOM.update(this.domElem,t):(e=BEMHTML.apply(e.data),BEM.DOM.update(this.domElem,e))},_onFailedData:function(){this.setMod("loading","no"),BEM.DOM.update('gettext("b-action-widget:CannotLoadData")')}}),BEM.DOM.decl("b-breadcrumbs",{onSetMod:{js:function(){var t,e=this;this._wrapperChildrenWidth=0,this._wrapper=this.findBlockOutside("b-panel").domElem,this._breadcrumbsOriginalWidth=this.domElem.width(),this._wrapperChildren=this._wrapper.children(),this._widthStatus=this._checkBreadCrumbsWidth(),this._calculateMaxWidth(),this._widthStatus&&this.setMod("roll","yes"),$(window).on("resize",function(){t=e.hasMod("roll"),e._widthStatus=e._checkBreadCrumbsWidth(),e._widthStatus?t||e.setMod("roll","yes"):t&&e.delMod("roll")})}},_checkBreadCrumbsWidth:function(){return this._breadcrumbsOriginalWidth>=this._wrapper.outerWidth(!0)?!0:void 0},_calculateMaxWidth:function(){var t=this;this.findBlocksInside("b-link").forEach(function(e,i){var n=e.domElem,s=e.elem("wrapper"),o=n.width();o<=t.params.crumbWidth&&i>0&&(n.css("max-width",o),s.css("max-width",o))})}}),BEM.DOM.decl("b-subscribe-button",{onSetMod:{js:function(){var t,e;this._bPage=this.findBlockOutside("b-page"),this._subscribeList=this._bPage.findBlockInside({block:"popup",modName:"action",modVal:"subscribe"}),this._subscribeList.bindTo("click",function(i){t=$(i.target).bem("b-popup-select-item"),e=t.getMod("type"),BEM.create("api-request",{_:"api-response",apiPath:"."+e,method:"POST",data:!1,urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(this._onSubscribe.bind(this),this._onSubscribeError.bind(this))}.bind(this))}},_onSubscribe:function(){},_onSubscribeError:function(t){this.channel("errors").trigger("error",this._getErrorData(t.message))},_getErrorData:function(t){return{node:this.domElem,content:{head:BEM.I18N("b-subscribe-button","cant_subscribe"),body:t}}}}),BEM.DOM.decl("dropdown",{onSetMod:{js:function(){var t=this,e=t.params,i=t._popup=t.findBlockOn(t.elem(e.popupElem),"popup").on("show",function(){t.setMod("action","open").trigger("show")}).on("hide",function(){t.setMod("action","closed").trigger("hide")});e.popupMethods.map(function(e){t[e]=i[e].bind(i)});var n=t.params.switcherBlock,s=t.elem("switcher");n&&(t._switcher=t.findBlockOn(s,n).domElem),s.attr({"aria-haspopup":!0,"aria-expanded":!1})},action:function(t,e){this.elem("switcher").attr("aria-expanded","open"===e)}},getPopup:function(){return this._popup},getDefaultParams:function(){return{popupElem:"popup",popupMethods:["toggle","show","hide","setContent"]}},destruct:function(){this._popup&&this._popup.domElem&&this._popup.destruct.apply(this._popup,arguments),this.__base.apply(this,arguments)},_toggle:function(){this._popup.toggle(this._switcher)},_onSwitcherClick:function(){this._switcher||(this._switcher=this.elem("switcher")),this._toggle()},_onSwitcherKeyUp:function(t){if(!(t.shiftKey||t.ctrlKey||t.altKey||t.metaKey)){var e=this.elem("switcher")[0].tagName.toLowerCase();"button"!==e&&("a"!==e&&13===t.which||32===t.which)&&(t.preventDefault(),this.params.switcherBlock||this._toggle())}}},{live:function(){this.liveBindTo("switcher","leftclick tap",function(t){this._onSwitcherClick(t)}).liveBindTo("switcher","keyup",function(t){this._onSwitcherKeyUp(t)})}}),BEM.DOM.decl({name:"button",modName:"pseudo",modVal:"yes"},{_onClick:function(t){this.__base.apply(this,arguments),this._href&&t.preventDefault()}}),BEM.DOM.decl("b-panel-more-button",{_onClick:function(){this.checkButton||(this.checkButton=this.findBlockOn("check-button")),this.checkButton.on("change",this._onCheckBoxChange,this)},_onCheckBoxChange:function(){this.bPanel||(this.bPanel=this.findBlockOutside("b-panel")),"yes"===this.checkButton.getMod("checked")?this.bPanel.setMod(this.bPanel.elem("more"),"visible","yes"):this.bPanel.delMod(this.bPanel.elem("more"),"visible")}},{live:function(){this.liveBindTo("click",function(t){this._onClick(t)
})}}),BEM.DOM.decl("b-form-button",{onSetMod:{js:function(){var t=this.isDisabled();(this._href=this.domElem.attr("href"))&&t&&this.domElem.removeAttr("href"),this.elem("input").attr("disabled",t)},focused:{yes:function(){var t=this;return t.isDisabled()?!1:(t.bindTo("keydown",this._onKeyDown).elem("input").is(":focus")||t.elem("input").focus(),t._unloadInited||(t._unloadInited=$(window).bind("unload",function(){t.delMod("focused")})),void 0)},"":function(){this.unbindFrom("keydown").elem("input").blur()}},disabled:function(t,e){var i="yes"==e;this._href&&(i?this.domElem.removeAttr("href"):this.domElem.attr("href",this._href)),i&&this.domElem.keyup(),this.afterCurrentEvent(function(){this.domElem&&this.elem("input").attr("disabled",i)})},pressed:function(t,e){this.isDisabled()||this.trigger("yes"==e?"press":"release")},hovered:{"":function(){this.delMod("pressed")}},"*":function(t){return this.isDisabled()&&"hovered pressed".indexOf(t)>-1?!1:void 0}},isDisabled:function(){return this.hasMod("disabled","yes")},url:function(t){return"undefined"==typeof t?this._href:(this._href=t,this.isDisabled()||this.domElem.attr("href",t),this)},_onKeyDown:function(t){var e=t.keyCode;13!=e&&32!=e||this._keyDowned||(this._keyDowned=!0,this.setMod("pressed","yes").bindTo("keyup",function(){this.delMod("pressed").unbindFrom("keyup"),delete this._keyDowned,32==e&&this.domElem.attr("href")&&(document.location=this.domElem.attr("href"))}))},_onClick:function(t){this.isDisabled()?t.preventDefault():this.afterCurrentEvent(function(){this.trigger("click")})},destruct:function(){this.delMod("focused"),this.__base.apply(this,arguments)}},{live:function(){var t={mouseover:{name:"hovered",val:"yes"},mouseout:{name:"hovered"},mousedown:{name:"pressed",val:"yes"},mouseup:{name:"pressed"},focusin:{name:"focused",val:"yes"},focusout:{name:"focused"}};this.liveBindTo("leftclick",function(t){this._onClick(t)}).liveBindTo("mouseover mouseout mouseup focusin focusout",function(e){var i=t[e.type];this.setMod(i.name,i.val||"")}).liveBindTo("mousedown",function(e){var i=t[e.type];1==e.which&&this.setMod(i.name,i.val||"")})}}),BEM.HTML.decl("b-form-button",{onBlock:function(t){t.tag(t.param("url")?"a":"span").attrs({href:t.param("url"),target:t.param("target")}).mods({size:t.mod("size"),theme:t.mod("theme")}).content([{elem:"left",tag:"i"},{elem:"content",tag:"span",content:{elem:"text",tag:"span",content:t.content()}}],!0).afterContent(t.param("type")?{elem:"input",attrs:{value:t.param("value")||"",type:t.param("type"),name:t.param("name"),disabled:t.mod("disabled")&&"disabled"}}:{elem:"click"}).js(!0)},onElem:{input:function(t){t.tag("input")},click:function(t){t.tag("i")}}}),BEM.DOM.decl("b-editor-open-button",{onSetMod:{js:function(){this._bPage=BEM.blocks["i-global"].getbPage(),this._button=this.findBlockOn("button"),this._pageBlock=this.findBlockOutside("b-page"),this._bPanel=this._bPage.findBlockInside("b-panel"),this._bSidebar=this._bPage.findBlockInside("b-sidebar"),this._togglerButton=this._bPanel.findBlockInside({block:"check-button",modName:"toggler",modVal:"sidebar"}),this._localStorage=BEM.blocks["mi-storage"],this.bindTo("click",this._onClick.bind(this))}},_clearFields:function(){this.__self._textareaBlock.elem("control").val("")},_showSpinner:function(){this.__self._spinner.setMod("show","yes"),this.__self._spinner.setMod("progress","yes")},_hideSpinner:function(){this.__self._spinner.setMod("show","no"),this.__self._spinner.delMod("progress")},_onClick:function(){var t="";switch(this.params.revisionId&&(t="?revision="+this.params.revisionId),this._saveButton=this._bPage.findBlockInside("b-editor-save-button"),this._saveButton&&keymaster("ctrl+enter, command+enter",this._saveButton._onClick.bind(this._saveButton)),this._initEditor(),this._button.setMod("disable","yes"),this._button.params.type){case"edit":this._showSpinner(),WikiHistory._pushState(".edit"+t);break;case"create":this._clearFields(),this._pageBlock.setMod("new-page","visible"),this._subPagePreview()}this.__self._saveButton.setMod("status",this._button.params.type),this._hideSidebar(),this.__self._textareaBlock.elem("control").get(0).setSelectionRange(0,0)},_hideSidebar:function(){!this._bPage.hasMod("special")&&this._localStorage.getItem("wiki-sidebar")?this._bSidebar.refreshSidebarContent():this._togglerButton.delMod("checked")},_getDataForEditor:function(){var t=[];this.__self._editor.saveParams&&(this.__self._editor.saveParams.section&&t.push("section_id="+this.__self._editor.saveParams.section),this.__self._editor.saveParams.revision&&(this._pageBlock.setMod("revision","edit"),t.push("revision="+this.__self._editor.saveParams.revision))),t.length||(t=!1),this._pageBlock.setMod("editor","visible"),!this._bPage.hasMod("special")&&this._localStorage.getItem("wiki-sidebar")&&(this._bSidebar.togglerButton.setMod("checked","yes"),this._bSidebar.refreshSidebarContent()),BEM.create("api-request",{_:"api-response",apiPath:".raw",method:"GET",data:!1,urlParams:t,path:WikiHistory._getCorrectPath()}).run().then(this._onGetEditorData.bind(this),this._onGetEditorDataError.bind(this))},_onGetEditorData:function(t){this._clearFields(),this.__self._editor.setDataToEditor(t.data.body,this.__self._editor.saveParams||null),this._hideSpinner()},_onGetEditorDataError:function(t){this.channel("errors").trigger("error",this._getErrorData(t.message))},_getErrorData:function(t){return{content:{block:"m-error",content:[{elem:"header",content:BEM.I18N("b-editor-open-button","cant_load_wiki_text")},{elem:"body",content:[{elem:"para",content:t},{elem:"para",content:BEM.I18N("b-editor-open-button","please_reload_page")}]}]}}},_subPagePreview:function(){this._subPageHint&&this._subPageHint.domElem.html(this._editor.params.url+"'"+BEM.I18N("b-editor-open-button","subpage_address")+"'"),this._subpageBlock||(this._subpageBlock=this._editor.findBlockInside({block:"input",modName:"type",modVal:"subpage"}),this._subPageHint=this._editor.findBlockInside("b-subpage-hint"),this._subpageBlock.on("change",function(){this._subPageHint.domElem.html(this._editor.params.url+"/"+this._subpageBlock.elem("control").val())},this))},_initEditor:function(){this.__self._editor||(BEM.DOM.after(this._pageBlock.findBlockInside("b-content").domElem,BEMHTML.apply({block:"b-editor-struct"})),this.__self._editor=this._pageBlock.findBlockInside({block:"m-editor",modName:"type",modVal:"edit-page"}),this.__self._textareaBlock=this.__self._editor.findBlockInside({block:"input",modName:"type",modVal:"textarea"}),this.__self._spinner=this._pageBlock.findBlockInside({block:"spin",modName:"editor",modVal:"open"}),this.__self._saveButton=this._pageBlock.findBlockInside("b-editor-save-button"),this.__self._editorButtons=this._pageBlock.findBlockInside("m-editor-buttons"),this.__self._editor.init(this.__self._editorButtons))},onURL:function(t){this._initEditor(),this.__self._editor.saveParams=t,this._clearFields(),this.__self._saveButton.setMod("status","edit"),this._showSpinner(),this._getDataForEditor()}}),BEM.DOM.decl("b-page-more",{onSetMod:{js:function(){this._bPage=BEM.blocks["i-global"].getbPage(),this._mHead=this._bPage.findBlockInside("m-head"),this.findBlockOn("button").on("click",this._onClick,this)}},_onClick:function(){this._popup||(BEM.DOM.after(this.domElem,BEMHTML.apply({block:"popup",js:!0,mods:{more:"yes"},content:[{elem:"content",content:{block:"b-page-more-panel",actuality:this._bPage.getMod("actuality")}}]})),this._popup=this._bPage.findBlockInside({block:"popup",modName:"more",modVal:"yes"}),this._bSubPage=this._popup.findBlockInside("b-action-sub"),this._bSubscribeUsers=this._popup.findBlockInside("b-action-subscribe"),this._bSubPage.bindTo("click",this._createSubPage.bind(this)),this._bSubscribeUsers.bindTo("click",this._subscribeUsers.bind(this))),this._popup.setMod("visibility","visible")},_createSubPage:function(){this._newPageWidget||(BEM.DOM.append(this._bPage.domElem,BEMHTML.apply({block:"b-widget",mods:{type:"new-page"}})),this._newPageWidget={_widget:this._bPage.findBlockInside({block:"b-widget",modName:"type",modVal:"new-page"})}),this._newPageWidget._widget.open("sub")},_subscribeUsers:function(){this._subscribeWidget||(BEM.DOM.append(this._bPage.domElem,BEMHTML.apply({block:"b-widget",mods:{type:"subscribe"}})),this._subscribeWidget=this._bPage.findBlockInside({block:"b-widget",modName:"type",modVal:"subscribe"})),this._subscribeWidget.show()}}),BEM.DOM.decl("b-action-move",{onSetMod:{js:function(){this._bPage=BEM.blocks["i-global"].getbPage(),this._path=this.params.source||WikiHistory._getCorrectPath()}},_movePage:function(){var t;this._moveWidget?this._moveWidget.show():(t=BEMHTML.apply({block:"b-widget",mods:{type:"page-move","page-move":this.params.type},js:{type:this.params.type}}),BEM.DOM.append(this._bPage.domElem,t),this._initWidget())},_initWidget:function(){BEM.create("api-request",{_:"api-response",apiPath:".move",method:"GET",data:!1,urlParams:!1,path:this._path}).run().then(this._onSuccess.bind(this),this._onError.bind(this))},_onSuccess:function(t){var e=this;this._subpagesCount=t.data.subpages_count,this._moveWidget=this._bPage.findBlockInside({block:"b-widget",modName:"page-move",modVal:this.params.type}),this._subpages=this._moveWidget.findBlockInside("b-cluster-subpages"),this._suggestIntput=this._moveWidget.findBlockInside({block:"input",modName:"action",modVal:"suggest"}),this._checkbox=this._moveWidget.findBlockInside({block:"checkbox",modName:"type",modVal:"clusters"}),this._moveButton=this._moveWidget.findBlockInside({block:"button",modName:"type",modVal:"move-cluster"}),this._cancelButton=this._moveWidget.findBlockInside({block:"button",modName:"type",modVal:"move-cluster-cancel"}),this._spin=this._moveWidget.findBlockInside({block:"spinner",modName:"type",modVal:"move-load"}),this._fillWidgetWithData(),this._setNewPageHTML(),this._moveWidget.on("show",function(){e._suggestIntput.elem("control").val("/"),e._moveWidget.elem("new-url-page").html(e.pageSlug)}),this._cancelButton.bindTo("click",function(){e._moveWidget.hide()}),this._moveButton.bindTo("click",function(){e._spin.setMod("progress","yes"),BEM.create("api-request",{_:"api-response",apiPath:".move",method:"PUT",data:{destination:e._movedUrl,move_cluster:e._checkbox.isChecked()},urlParams:!1,path:e._path}).run().then(e._onPageMove.bind(e),e._onPageMoveError.bind(e))}),this._moveWidget.show()},_onError:function(t){console.log(t)},_onPageMove:function(){window.location.reload()},_onPageMoveError:function(t){this._spin.delMod("progress"),this.channel("errors").trigger("error",this._getErrorData(this._moveButton.domElem,BEM.I18N("b-action-move","cant_move_cluster"),t.message))},_getErrorData:function(t,e,i){return{node:t,content:{head:e,body:i}}},_fillWidgetWithData:function(){this.supertag=this._bPage.params.supertag,this.params.isAction&&this.params.source&&(this.supertag=this.params.source),this.pageSlug="/"+this.supertag.split("/").pop(),this._subpagesCount&&(this._moveWidget.setMod(this._moveWidget.elem("current-address-subpages"),"visibility","visible"),this._subpages.elem("num").html("+"+this._subpagesCount)),this._moveWidget.elem("current-address-url").html(location.host+this.supertag+"/"),this._moveWidget.elem("new-url").html(location.host)},_setNewPageHTML:function(){var t=this;this._moveWidget.findBlockInside("b-cluster-autocomplete").on("select",function(e,i){var n="";"/"!=i&&(n=i),n+=t.pageSlug,this._moveWidget.elem("new-url-page").html(n),this._movedUrl=i},this)}},{live:function(){this.liveBindTo("click",function(){this._movePage()})}}),BEM.DOM.decl("b-action-delete",{onSetMod:{js:function(){this._bPage=BEM.blocks["i-global"].getbPage(),this._type=this.params.type,this._isAction=this.params.isAction||!1,this._source=this.params.source||!1}},_deletePage:function(){confirm("grid"==this._type?BEM.I18N("b-action-delete","do_you_want_delete_table")+"?\n\n"+(this._source&&BEM.I18N("b-action-delete","table_address")+": "+location.host+this._source+"\n\n")+BEM.I18N("b-action-delete","remove_table_with_content")+". "+BEM.I18N("b-action-delete","all_data_will_disapeared"):BEM.I18N("b-action-delete","do_you_want_delete_page"))&&(this._preloader(),BEM.create("api-request",{_:"api-response",apiPath:"",method:"DELETE",data:!1,urlParams:!1,path:this.params.source||WikiHistory._getCorrectPath()}).run().then(this._onPageDelete.bind(this),this._onPageDeleteError.bind(this)))},_onPageDelete:function(){this._isAction?window.location.reload():window.location.pathname="/"},_onPageDeleteError:function(t){this.channel("errors").trigger("error",this._getErrorData(this._bDelete.domElem,BEM.I18N("b-action-delete","cant_delete_page"),t.message))},_getErrorData:function(t,e,i){return{node:t,content:{head:e,body:i}}},_preloader:function(){BEM.DOM.after(this.domElem,BEMHTML.apply({block:"spinner",mods:{size:"xs"}}))}},{live:function(){this.liveBindTo("click",function(){this._deletePage()})}}),BEM.DOM.decl("b-editor-actions",{onSetMod:{js:function(){this._bPage=this.findBlockOutside("b-page"),this._button=this.findBlockOn("radio-button"),this._struct=this._bPage.findBlockInside("b-editor-struct"),this._spinner=this._struct.findBlockInside({block:"spin",modName:"type",modVal:"edit-preview"}),this._editor=this._struct.findBlockInside({block:"m-editor",modName:"type",modVal:"edit-page"}),this._textarea=this._editor.findBlockInside({block:"input",modName:"editor",modVal:"wiki"}),this._replacer=this._bPage.findBlockInside({block:"m-replacer",modName:"type",modVal:"page-title"}),this._button.on("change",this._onChange,this)}},_onChange:function(t){switch(this.channel("errors").trigger("errorHide"),this._replacer.delMod("disabled"),t.block._val){case"view":this._disableElements(),this._getDataForPreview();break;case"edit":this._abortPreviewRequest(),this._enableElements()}},_abortPreviewRequest:function(){this._previewRequest&&(this._previewRequest.abortRequest(),this._spinner.delMod("progress"))},_getDataForPreview:function(){this._isError&&(delete this._isError,this.channel("errors").trigger("errorHide")),this._pageData=this._textarea.elem("control").val(),this._spinner.setMod("progress","yes"),this._previewRequest=BEM.create("api-request",{_:"api-response",apiPath:".preview",method:"POST",data:{body:this._pageData},urlParams:!1,path:WikiHistory._getCorrectPath()}),this._previewRequest.run().then(this._onGetData.bind(this),this._onGetDataError.bind(this))},_onGetData:function(t){this._preview||this._createPreviewBlock(),this._spinner.delMod("progress"),this._preview.setMod("visibility","visible"),this._preview.domElem.empty(),this._replacer.setMod("disabled","yes"),BEM.DOM.append(this._preview.domElem,BEMHTML.apply(t.data.bemjson)),this._preview.findBlocksInside({block:"button",modName:"type",modVal:"form-submit"}).forEach(function(t){t.setMod("disabled","yes")})},_createPreviewBlock:function(){BEM.DOM.after(this._editor.domElem,BEMHTML.apply({block:"b-editor-preview"})),this._preview=this._bPage.findBlockInside("b-editor-preview")},_disableElements:function(){this._bottom||(this._bottom=this._struct.findBlockInside("b-editor-bottombar")),this._editorButtons||(this._editorButtons=this._struct.findBlockInside("m-editor-buttons")),this._struct.setMod("visibility","hidden"),this._editorButtons.setMod("visibility","hidden")},_enableElements:function(){this._preview&&this._preview.delMod("visibility"),this._struct.delMod("visibility"),this._bottom.delMod("visibility"),this._editorButtons.delMod("visibility")},_onGetDataError:function(t){this._isError=!0,this._spinner.delMod("progress"),this.channel("errors").trigger("error",this._getErrorData(t.message))},_getErrorData:function(t){return{node:this.domElem,content:{body:t}}}}),BEM.DOM.decl("checkbox",{onSetMod:{js:function(){this.setMod("checked",this.elem("control").prop("checked")?"yes":""),this._isControlFocused()&&this.setMod("focused","yes")},focused:{yes:function(){return this.isDisabled()?!1:(this._isControlFocused()||this.elem("control").focus(),this.setMod(this.elem("box"),"focused","yes"),this.afterCurrentEvent(function(){this.trigger("focus")}),void 0)},"":function(){this._isControlFocused()&&this.elem("control").blur(),this.delMod(this.elem("box"),"focused"),this.afterCurrentEvent(function(){this.trigger("blur")})}},checked:function(t,e){return this.isDisabled()?!1:(this.elem("control").prop("checked","yes"===e),this.afterCurrentEvent(function(){this.trigger("change",{checked:"yes"===e})}),this.setMod(this.elem("box"),"checked",e),void 0)},disabled:function(t,e){this.elem("control").prop("disabled","yes"===e)}},isDisabled:function(){return this.hasMod("disabled","yes")},isChecked:function(){return this.hasMod("checked","yes")},toggle:function(){this.toggleMod("checked","yes","")},val:function(t){var e=this.elem("control");return"undefined"==typeof t?e.val():(e.val(t),this)},_onClick:function(t){this.isDisabled()||(t.target!==this.elem("control")[0]&&(t.preventDefault(),this.toggle()),this.setMod("focused","yes"))},_onChange:function(t){t.target.checked?this.setMod("checked","yes"):this.delMod("checked")},_onFocusInFocusOut:function(t){this.setMod("focused","focusin"===t.type?"yes":"")},_onMouseOverMouseOut:function(t){this.isDisabled()||this.setMod("hovered","mouseover"===t.type?"yes":"")},_isControlFocused:function(){try{return this.containsDomElem($(this.__self.doc[0].activeElement))}catch(t){return!1}}},{live:function(){return this.liveBindTo("leftclick tap",function(t){this._onClick(t)}).liveBindTo("control","change",function(t){this._onChange(t)}).liveBindTo("control","focusin focusout",function(t){this._onFocusInFocusOut(t)}).liveBindTo("mouseover mouseout",function(t){this._onMouseOverMouseOut(t)}),!1}}),BEM.DOM.decl({block:"checkbox",modName:"assigned",modVal:"form"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params.required&&this.findBlockOutside("b-wiki-form")._requiredFields.push(this)}}}),BEM.DOM.decl({block:"check-button",baseBlock:"checkbox"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.elem("control").attr({role:"button","aria-labelledby":this.elem("text").attr("id"),"aria-pressed":this.hasMod("checked","yes")}),this.bindTo("keyup",function(t){t.shiftKey||t.ctrlKey||t.altKey||13===t.which&&this.elem("control").click()})},checked:function(t,e){if(this.__base.apply(this,arguments)===!1)return!1;var i="yes"===e;this.elem("control").attr("aria-pressed",i)},pressed:function(){return this.isDisabled()?!1:void 0}},_onMouseDown:function(t){t.preventDefault(),this.setMod("pressed","yes"),this.bindToDoc("mouseup touchend",function(){this.afterCurrentEvent(function(){this.delMod("pressed")}),this.unbindFromDoc("mouseup touchend")})}},{live:function(){return this.__base.apply(this,arguments),this.liveBindTo("mousedown",function(t){this._onMouseDown(t)}),!1}}),BEM.DOM.decl("m-replacer",{onSetMod:{js:function(){this.bindToDomElem(this.elem("text"),"click",this._onClick.bind(this))}},_onClick:function(){this.hasMod("disabled")||(this.findElem("field").length?(this.delMod(this.elem("field"),"hidden"),this._input.val(this.elem("text").html()),this._input.elem("control").focus()):(BEM.DOM.after(this.elem("text"),BEMHTML.apply({block:this.__self._name,elem:"field",val:this.elem("text").html()})),this._input=this.findBlockInside("input"),this._input.on("blur",this._closeInput,this),this._input.bindTo("keypress",this._onInputKeypress.bind(this))),this.setMod(this.elem("text"),"hidden","yes"),this.trigger("change"))},_onInputKeypress:function(t){13===t.keyCode&&this._closeInput()},_closeInput:function(){this.delMod(this.elem("text"),"hidden"),this.setMod(this.elem("field"),"hidden","yes"),this._input.val()&&this.elem("text").html(this._input.val()),this.trigger("change")},getValue:function(){return this.elem("text").text()}}),BEM.DOM.decl("b-old-page",{onSetMod:{js:function(){this.__self._bPage||(this.__self._bPage=BEM.blocks["i-global"].getbPage())}},_showWidget:function(){var t;this.__self._widget||(t=BEMHTML.apply({block:"b-widget",mods:{type:"old-page"}}),BEM.DOM.append(this.__self._bPage.domElem,t),this.__self._widget=this.__self._bPage.findBlockInside({block:"b-widget",modName:"type",modVal:"old-page"}),this._initWidget()),this.__self._widget.setMod("actuality",this.params.actuality),this.__self._widget.show()},_initWidget:function(){var t=this,e=this.__self._widget;this.__self._linksContainer=e.findElem("links"),this.__self._addLinksButton=e.findBlockInside("link"),this.__self._cancelButton=e.findBlockInside({block:"button",modName:"type",modVal:"old-page-cancel"}),this.__self._sendButton=e.findBlockInside({block:"button",modName:"type",modVal:"old-page"}),this.__self._spinner=e.findBlockInside({block:"spinner",modName:"type",modVal:"old-page"}),this.__self._addLinksButton.bindTo("click",function(){BEM.DOM.append(t.__self._linksContainer,BEMHTML.apply({block:"b-widget",elem:"link",content:{block:"input",mods:{size:"s"},content:[{elem:"hint",content:BEM.I18N("b-old-page","link_wiki_page")},{elem:"control"}]}}))}),this.__self._cancelButton.on("click",function(){e.hide()}),this.__self._sendButton.on("click",function(){var i,n=e.findBlockInside(e.elem("comment"),"input"),s=e.findBlocksInside(t.__self._linksContainer,"input"),o=e.getMod("actuality"),r=[];s.forEach(function(t){var e=t.val();e&&r.push(e)}),i={actual:"actual"!=o,comment:n.val(),links:r},t.__self._spinner.setMod("progress","yes"),BEM.create("api-request",{_:"api-response",apiPath:".actuality",method:"POST",data:i,urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(t._onSuccess.bind(t),t._onError.bind(t))})},_onSuccess:function(){var t,e=this.__self._bPage.findBlockInside("b-page-date")||this.__self._bPage.findBlockInside("b-old-page-mark"),i=this.__self._widget.getMod("actuality"),n="actual"==i?"obsolete":"actual",s="actual"==i?"b-old-page-mark":"b-page-date",o=this.__self._bPage.findBlockInside({block:"b-page-more-panel-item",modName:"type",modVal:"old-page"}),r=this.__self._bPage.findBlockInside({block:"b-grid-table-options-item",modName:"action",modVal:"old-page"}),a=o||r;this.__self._spinner.delMod("progress"),BEM.DOM.before(e.domElem,BEMHTML.apply({block:s,mix:[{block:"b-page-info",elem:"item"}],modified_at:e.params.modified_at,js:{modified_at:e.params.modified_at}})),e.destruct(),this.__self._widget.hide(),this._refreshWidgetForm(),"possibly-obsolete"==this.__self._bPage.getMod("actuality")&&(t=this.__self._bPage.findBlockInside({block:"b-notification",modName:"type",modVal:"old-page-maybe"}),t&&t.close()),this.__self._bPage.setMod("actuality",n),a&&(a.domElem.text("obsolete"===n?BEM.I18N("b-old-page","mark_as_actual"):BEM.I18N("b-old-page","mark_as_obsolete")),a.findBlockOn("b-old-page").params.actuality=n)},_onError:function(t){this.__self._spinner.delMod("progress"),this.channel("errors").trigger("error",this._getErrorData(this.__self._sendButton.domElem,BEM.I18N("b-old-page","mark_failed"),t.message))},_getErrorData:function(t,e,i){return{node:t,content:{head:e,body:i}}},_refreshWidgetForm:function(){var t=this.__self._widget,e=t.findBlockInside(t.elem("comment"),"input"),i=t.findBlocksInside(this.__self._linksContainer,"input");e.val(""),i.forEach(function(t,e){t.val(""),e>0&&t.destruct()})}},{live:function(){this.liveBindTo("click",function(){this._showWidget()})}}),BEM.DOM.decl("b-old-page-mark",{onSetMod:{js:function(){this.bPage=BEM.blocks["i-global"].getbPage(),this._popup=this.findBlockInside("popup")}},_onClick:function(){this._popup.hasMod("visibility","visible")?this._popup.hide():this._showPopup()},_showPopup:function(){this._loaded?this._popup.show(this):BEM.create("api-request",{_:"api-response",apiPath:".actuality",path:WikiHistory._getCorrectPath(),urlParams:["format=json"]}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this))},_onGotData:function(t){var e=BEMHTML.apply(this._getContentBEMJSON(t.data)),i=this;BEM.DOM.append(this._popup.elem("content"),e),this._button=this._popup.findBlockInside({block:"button",modName:"type",modVal:"old-page-mark"}),this._button.on("click",function(){i._popup.hide()}),this._popup.show(this),this._loaded=!0},_getContentBEMJSON:function(t){var e=t.marked_at,i=t.user,n=t.comment,s=t.links,o=[];return e&&i&&o.push({block:"b-old-page-mark",elem:"user-date",content:[{block:"b-user",mix:[{block:"mi-staff-card",js:{user:i.login}}],mods:{is_dismissed:i.is_dismissed},url:"http://staff.yandex-team.ru/"+i.login,content:i.display},": "+BEM.I18N("b-old-page-mark","marked_obsolete")+" ",{block:"m-date",format:"full",timestamp:e}]}),n&&o.push({block:"b-old-page-mark",elem:"comment",content:n}),s&&s.length&&(o.push({block:"b-old-page-mark",elem:"links-title",content:BEM.I18N("b-old-page-mark","actual_pages")+":"}),s.forEach(function(t){o.push({block:"b-old-page-mark",elem:"link",content:{block:"link",url:t,content:t}})})),o.push({block:"b-old-page-mark",elem:"button",content:{block:"button",mods:{size:"s",type:"old-page-mark"},mix:[{block:"b-old-page",js:{actuality:"obsolete"}}],content:BEM.I18N("b-old-page-mark","unmark")}}),o},_onFailedData:function(t){console.log(t),this._popup.show(this)}},{live:function(){this.liveBindTo("click",function(t){this._onClick(t)})}}),function(){var t={};BEM.decl("i-request",{onSetMod:{js:function(){this._preventCache=!1}},get:function(t,e,i,n){$.isFunction(i)||(n=i,i=this.params.onError),this._get(t,e,i,$.extend({},this.params,n))},_get:function(e,i,n,s){var o=this._buildCacheKey(e,s),r=t[s.cacheGroup];s.cache&&r&&o in r.data?this.afterCurrentEvent(function(){i.call(this.params.callbackCtx,r.data[o])},this):this._do(e,i,n,s)},_do:function(){},_onSuccess:function(t,e,i,n){n.cache&&!this._preventCache&&this.putToCache(n,t,i),this._preventCache=!1},_buildCacheKey:function(t){return"string"==typeof t?t:$.param(t)},putToCache:function(e,i,n){var s=t[e.cacheGroup]||(t[e.cacheGroup]={keys:[],data:{}});s.keys.length>=e.cacheSize&&delete s.data[s.keys.shift()];var o=this._buildCacheKey(i,e);s.data[o]=n,s.keys.push(o)},dropCache:function(){delete t[this.params.cacheGroup]},getDefaultParams:function(){return{cache:!1,cacheGroup:"default",cacheSize:100,callbackCtx:this}}},{_cache:t})}(),BEM.decl({block:"i-request_type_ajax",baseBlock:"i-request"},{onSetMod:{js:function(){this.__base(),this._requestNumber=this._number=this._preventNumber=this._retryCount=0}},_get:function(t,e,i,n){this._number++,this._requestNumber++,this._retryCount=n.retryCount,this.__base.apply(this,arguments)},_do:function(t,e,i,n){var s=this;if(s._number>s._preventNumber){var o=arguments,r={data:n.data?$.extend({},n.data,t):t},a=s._wrapCallback(function(i,o,r){s._onSuccess(s._buildCacheKey(t,n),t,i[0],n),s._allowCallback(o,r)&&e.apply(n.callbackCtx,i)}),l=s._wrapCallback(function(t,e,r){s._allowCallback(e,r)&&(s._retryCount-->0?setTimeout(function(){s._do.apply(s,o)},n.retryInterval):i&&i.apply(n.callbackCtx,t))});$.each(["url","dataType","timeout","type","jsonp","jsonpCallback"].concat(n.paramsToSettings||[]),function(t,e){r[e]=n[e]}),$.ajax(r).done(a).fail(l)}},_wrapCallback:function(t){var e=this._requestNumber,i=this._number;return function(n){null!==n&&t(arguments,e,i)}},_allowCallback:function(t,e){return e>this._preventNumber&&this._requestNumber==t},_buildCacheKey:function(t,e){return"string"==typeof t?t:this.__base(t)+e.url},abort:function(){this._preventNumber=++this._number},preventCallbacks:function(){this.abort()},getDefaultParams:function(){return $.extend(this.__base(),{cache:!0,type:"GET",dataType:"jsonp",timeout:2e4,retryCount:0,retryInterval:2e3})}}),function(){var t=BEM.DOM,e=$.browser.opera&&$.browser.version<12.1?"keypress":"keydown";t.decl({name:"input",modName:"suggest",modVal:"yes"},{onSetMod:{js:function(){var t=this;t.params.foot&&(t.foot=t.params.foot),t._preventRequest=!0,t.__base.apply(t,arguments),t._userVal=t.val();var e=t._focused;e&&t.delMod("focused"),t.elem("control").attr("autocomplete","off"),t._preventRequest=!1,e&&t.setMod("focused","yes"),t._items=[],t._curItemIndex=-1,t._doRequest=$.debounce(t._doRequest,t.params.debounceDelay),this.bindToWin("resize",$.throttle(this._setWidth,60))},focused:{yes:function(){this.__base();var t=this.params.showListOnFocus?this._onChange():this._onChange;this.on("change",t)},"":function(){this.__base(),this.un("change",this._onChange)._preventHide||this._getPopup().hide()}}},getDataprovider:function(){var t=this.params.dataprovider.url;return this._dataprovider||(this._dataprovider=BEM.create(this.params.dataprovider.name||this.__self.getName()+"__dataprovider",$.extend(this.params.dataprovider,{url:t,callbackCtx:this})))},_onChange:function(){return this._preventRequest||this._doRequest(),this._onChange},_onKeyDown:function(t){var e=38===t.which||40===t.which;if(e&&!t.shiftKey){t.preventDefault();var i=this._items.length,n=!1;if(i){var s=t.which-39,o=this._curItemIndex,r=0;do n=(0===o&&-1===s||o+s>=i)&&this._onLeaveItem(this._items[o],!0),o+=s,0>o?o=i-1:o>=i&&(o=0);while(!n&&this._onEnterItem(this._items[o],!0)===!1&&++r<i)}}},_onKeyPress:function(t){13===t.which&&this._curItemIndex>-1&&this._isCurItemEnteredByKeyboard&&(t.preventDefault(),this._onSelectItem(this._items[this._curItemIndex],!0))},_getPopup:function(){var i=this;if(!i._popup){var n=i.__self.getName(),s=[{elem:"items",tag:"ul",mix:[{block:n,elem:"popup-items"}]}],o=Array.isArray(i.params.popupMixs)?i.params.popupMixs:[],r={directions:"bottom-left"};i._hasPopupFade()&&s.push({block:n,elem:"fade"}),$.extend(r,i.params.popupParams),o.push({block:n,elem:"popup",mods:i.params.popupMods,js:{uniqId:i._uniqId}}),i._popup=$(BEMHTML.apply({block:"popup",mods:{animate:"no"},mix:o,js:r,content:{elem:"content",content:s}})).bem("popup").on({show:function(){i.bindTo("keypress",i._onKeyPress).bindTo(e,i._onKeyDown)},hide:function(){i.unbindFrom("keypress "+e)._curItemIndex=-1}}),$.each({mouseover:i._onEnterItem,mouseout:i._onLeaveItem,mousedown:i._onSelectItem,mouseup:i._onItemMouseUp},function(t,e){BEM.blocks["b-autocomplete-item"].on(i._popup.domElem,t,function(t){e.call(i,t.block)})}),t.init(i._popup.domElem)}return i._popup},getPopup:function(){return this._getPopup()},_hasPopupFade:function(){return"yes"===(this.params.popupMods||{}).fade},_onEnterItem:function(t,e){if(t.hasMod("enterable","no"))return!1;var i=this._items,n=this._curItemIndex;n>-1&&i[n].delMod("hovered"),n=this._getItemIndex(t),n>-1&&i[n].setMod("hovered","yes"),this._curItemIndex=n,this._isCurItemEnteredByKeyboard=!!e,e&&this.params.updateOnEnter&&(this._preventRequest=!0,this.val(t.enter()!==!1?t.val():this._userVal,{source:"autocomplete",itemIndex:this._curItemIndex}).del("_preventRequest"))},_onLeaveItem:function(t,e){var i=this._curItemIndex;return i>-1&&i===this._getItemIndex(t)&&(this._items[i].delMod("hovered"),this._curItemIndex=-1),e&&this.val(this._userVal),!0},_onSelectItem:function(t,e){var i=t.select(e||!1),n="object"==typeof i?i.needUpdate:i!==!1,s="object"==typeof i&&i.needEvent;this._preventRequest=!0,n&&(this._userVal=t.val(),this.val(this._userVal,{source:"autocomplete",itemIndex:this._curItemIndex})),e?this.del("_preventRequest")._getPopup().hide():(this._returnFocus=!0,n||(this._preventHide=!0),this.afterCurrentEvent(function(){this.setMod("focused","yes").del("_preventRequest","_preventHide")})),(n||s)&&this.trigger("select",{item:t,byKeyboard:e})},_onItemMouseUp:function(){this.del("_returnFocus")._getPopup().hide()},_getItemIndex:function(t){return $.inArray(t,this._items)},_doRequest:function(){var e=this;e._userVal=e.val(),e.trigger("data-requested").getDataprovider().get(e.val(),function(i){e.trigger("data-received",i);var n=e._getPopup(),s=i.items||i;e.foot&&s.length&&-1===$.inArray(e.foot,s)&&s.push(e.foot),s.length?(e._curItemIndex=-1,t.update(n.elem("items"),e._buildItemsHtml(s),function(){n.isShown()||(n.show(e.elem("box")),e._setWidth()),n.repaintShadowIfNeeded(),e._items=n.findBlocksInside("b-autocomplete-item"),e.trigger("update-items")})):n.hide()})},_setWidth:function(){this._hasPopupFade()&&this._getPopup().domElem.css("width",this.elem("box").outerWidth())},_buildItemsHtml:function(t){var e=this;
return BEMHTML.apply($.map(t,function(t){var i,n={block:"b-autocomplete-item",data:t,mods:{type:$.isArray(t)?t[0]:"text"},suggestVersion:e.params.dataprovider.version||4};return $.isArray(t)&&$.isPlainObject(i=t.concat().pop())&&$.extend(n,i),n}))},setFoot:function(t){return this.foot=t,this.foot},getDefaultParams:function(){return $.extend(this.__base(),{updateOnEnter:!0,debounceDelay:50,showListOnFocus:!0})}})}(),BEM.decl({name:"input__dataprovider",baseBlock:"i-request_type_ajax"},{get:function(t,e){return this.__base({part:t},function(t){e.call(this,{items:t[1],metainfo:t[2]})})}}),BEM.DOM.decl("b-autocomplete-item",{val:function(){return this.params.val||this.elem("text").text()||this.domElem.text()},enter:function(){},select:function(){}},{live:function(){this.liveBindTo("mouseover mouseout mousedown mouseup",function(t){this.trigger(t.type)})}}),BEM.HTML.decl("b-autocomplete-item",{onBlock:function(t){var e=t.param("data"),i=BEM.blocks["i-common__string"].escapeHTML($.isArray(e)?e[1]:e);$.isArray(t.param("search_cgi"))&&t.js({cgi:t.param("search_cgi")}),t.tag("li").mod("pers",t.param("pers")?"yes":!1).content(BEM.blocks["i-common__string"].highlight(i,t.param("hl"))).js(!0)}}),BEM.DOM.decl("b-autocomplete-item",{val:function(){return this.params.val||this.domElem.text()}}),BEM.HTML.decl("b-autocomplete-item",{onBlock:function(t){var e=t.param("data");if(e instanceof Array){var i=e[1];t.tag("li").content({block:"b-isuggest-item",data:e,mods:t.param("mods")}).js({val:i.href||i.title})}else t.tag("li").content(e).js(!0)}}),BEM.DOM.decl({block:"b-autocomplete-item",modName:"nav",modVal:"yes"},{enter:function(){return!1},select:function(t){return t&&$('<form style="display:none" action="'+this.val()+'" target="_blank"/>').appendTo("body").submit().remove(),{needEvent:!0}}},{getUrl:function(t){return(t.match(/^\w[\w-]*:\/\//g)?"":"http://")+t}}),BEM.DOM.decl({block:"b-autocomplete-item",modName:"type",modVal:"nav"},{onSetMod:{js:function(){this.setMod("nav","yes")}},enter:function(){return this.__base.apply(this,arguments)},select:function(){return this.__base.apply(this,arguments)}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"nav"},{onBlock:function(t){var e=t.param("data"),i=4==t.param("suggestVersion"),n=e[4]||e[3],s=(n.match(/^\w[\w-]*:\/\//g)?"":"http://")+n;t.js({val:s}).content({elem:"link",url:s,title:BEM.blocks["i-common__string"].escapeHTML(i?e[3]:e[2]),description:BEM.blocks["i-common__string"].highlight(i?e[2]:e[1],t.param("hl"))})},onElem:{link:function(t){t.tag("a").attrs({href:t.param("url"),target:"_blank"}).content([{elem:"link-url",tag:"span",content:t.param("title")},{elem:"link-info",tag:"span",content:["&nbsp;&mdash; "].concat(t.param("description"))}])}}}),BEM.HTML.decl({name:"b-autocomplete-item",modName:"type",modVal:"nav"},{onBlock:function(t){t.stop();var e=t.param("data");if(e instanceof Array){if("yes"==t.mod("intranet")){var i=e[1];t.tag("li").content({block:"b-isuggest-item",data:e,mods:t.param("mods")}).js({val:i.href||i.title})}}else t.tag("li").content(e).js(!0)}}),BEM.DOM.decl({block:"b-autocomplete-item",modName:"type",modVal:"foot"},{select:function(){return!1}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"foot"},{onBlock:function(t){t.mod("enterable","no").content($.map(t.param("data").slice(1),function(t){return $.isArray(t)?{tag:"span",elem:"foot",content:t[0]}:t}))}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"lingvo"},{onBlock:function(t){var e=t.param("data")[1];t.content([{tag:"span",elem:"text",content:e.text},{tag:"span",elem:"translation",content:[" — ",e.translation]}])}}),BEM.DOM.decl("b-widget",{onSetMod:{js:function(){this._bPage=this.findBlockOutside("b-page"),this._spinner=this.findBlockInside({block:"spin",modName:"type",modVal:"load"})}},show:function(t){var e,i=this;$(document).on("keyup.widget",function(t){27===t.keyCode&&i.hide()}),e=this._bPage.findBlockInside({block:"b-widget",modName:"visibility",modVal:"yes"}),e&&e.delMod("visibility"),e=this._bPage.findBlockInside({block:"b-favs-widget",modName:"visibility",modVal:"yes"}),e&&e.hide(),this.setMod("visibility","yes"),this.trigger("show"),this._bPage.setMod("scroll","disable"),$(document).scrollTop(0),t&&this.showSpinner()},hide:function(){$(document).off("keyup.widget"),this.delMod("visibility"),this.trigger("hide"),this._bPage.delMod("scroll")},showSpinner:function(){this._spinner.setMod("progress","yes")},hideSpinner:function(){this._spinner.delMod("progress")}}),function(){var t,e,i=function(){for(var e,i=0;e=t[i++];)e.val(e.elem("input").val())},n=function(t){try{return t.activeElement}catch(e){}};BEM.DOM.decl("b-form-input",{onSetMod:{js:function(){var s=this,o=s.elem("input"),r=n(s.__self.doc[0]),a=s.params.autoFocus&&!(r&&$(r).is("input, textarea"));s._val=o.val(),s._input0=o[0],(r===s._input0||a)&&(s._autoFocus=!0,s.setMod("focused","yes")._focused=!0,delete s._autoFocus),e||(t=[],e=s.channel("sys").on({tick:i,idle:function(){e.un("tick",i)},wakeup:function(){e.on("tick",i)}})),s._instanceIndex=t.push(s.bindTo(o,{focus:s._onFocus,blur:s._onBlur}))-1,s.params.shortcut&&s.bindToDoc("keydown",function(t){t.ctrlKey&&38==t.keyCode&&!$(t.target).is("input, textarea")&&s.setMod("focused","yes")})},disabled:function(t,e){this.elem("input").attr("disabled","yes"==e)},focused:function(t,e){if(this.hasMod("disabled","yes"))return!1;var i="yes"==e;i?this._focused||this._focus():this._focused&&this._blur(),this.afterCurrentEvent(function(){this.trigger(i?"focus":"blur")})}},onElemSetMod:{message:{visibility:function(t,e,i){var n=this,s=n.getMod(t,"type");if(s){var o=!0;i||n.elem("message","type",s).each(function(){this!=t[0]&&n.hasMod($(this),"visibility","visible")&&(o=!1)}),o&&n.toggleMod("message-"+s,"yes","","visible"===i)}}}},val:function(t,e){if("undefined"==typeof t)return this._val;if(this._val!=t){var i=this.elem("input");i.val()!=t&&i.val(t),this._val=t,this.trigger("change",e)}return this},getSelectionEnd:function(){var t=this.elem("input")[0],e=0;if("number"==typeof t.selectionEnd)e=t.selectionEnd;else{var i=document.selection.createRange();if(i&&i.parentElement()==t){var n=t.value.length,s=t.createTextRange();s.moveToBookmark(i.getBookmark());var o=t.createTextRange();o.collapse(!1),e=s.compareEndPoints("EndToEnd",o)>-1?n:-s.moveEnd("character",-n)}}return e},name:function(){return this.elem("input").attr("name")},_onFocus:function(){return this._focused=!0,this.setMod("focused","yes")},_onBlur:function(){var t=this;if(n(document)!==t._input0)return t._preventBlur?(setTimeout(function(){t._focus()},0),t):(t._focused=!1,t.delMod("focused"))},_focus:function(){var t=this.elem("input")[0];if(t.createTextRange&&!t.selectionStart){var e=t.createTextRange();e.move("character",t.value.length),e.select()}else t.focus()},_blur:function(){this.elem("input").blur()},destruct:function(){this.__base.apply(this,arguments),this.params.shortcut&&this.unbindFromDoc("keydown"),t.splice(this._instanceIndex,1);for(var e,i=this._instanceIndex;e=t[i++];)--e._instanceIndex}}),BEM.HTML.decl("b-form-input",{onBlock:function(t){var e=t.param("id")||t.generateId();t.tag("span").tParam("id",e).tParam("has-clear","yes"===t.mod("has-clear")).tParam("type",t.mod("type")||"input").afterContent({elem:"box",tag:"span",content:{elem:"input",attrs:{value:t.param("value"),name:t.param("name"),id:e}}}).js(!0)},onElem:{input:function(t){t.tag(t.tParam("type"))},label:function(t){t.tag("label").attr("for",t.tParam("id"))},box:function(t){t.tParam("has-clear")&&t.afterContent({elem:"clear",tag:"span"})},hint:function(t){t.tag("label").attr("for",t.tParam("id"))}}})}(),BEM.decl({name:"i-suggest-data",baseBlock:"i-request_type_ajax"},{get:function(t,e){var i=[],n=t.length,s=this;return n?(n>0&&i.push("people"),n>1&&i.push("nav"),this.__base({text:t,s:i},function(n){var o=[],r=0;i.forEach(function(e){n.hasOwnProperty(e)&&n[e]&&n[e].length&&(r++,n[e].forEach(function(i){var n=[e,i];i.order=r%2?"odd":"even",["title","name","login","phone","department","tag"].forEach(function(e){i.hasOwnProperty(e)&&(i[e+"_hl"]=s._hiliteText(i[e],t))}),n.push(s._getGroupTitle(e)),o.push(n)}))}),e.call(s,{items:o})})):!1},_hiliteText:function(t,e){return t.replace(new RegExp("((^|\\s)"+this._escapeRegExp(e)+")","ig"),"<strong>$1</strong>")},_escapeRegExp:function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},_getGroupTitle:function(t){switch(t){case"nav":return"Cсылки";case"people":return"Люди";case"text":return"Запросы";case"wiki":return"Вики"}return""}}),function(t){var e,i=BEM.HTML,n=BEM.DOM;t(function(){t(window).bind("focus",function(){e=document.activeElement})}),n.decl({name:"b-form-input",modName:"autocomplete",modVal:"yes"},{onSetMod:{js:function(){var e=this;e.params.foot&&(e.foot=e.params.foot),e._preventRequest=!0,e._preventPopupShow=!1,e._isPopupShown=!1,e.__base.apply(e,arguments),e._userVal=e.val();var i=e._focused,n=e._autoFocus;i&&e.delMod("focused"),e._input0=e.elem("input").filter("input[autocomplete]").attr("autocomplete","off")[0],e._preventRequest=!1,e._autoFocus=!0,i&&e.setMod("focused","yes"),n||delete e._autoFocus,e._items=[],e._curItemIndex=-1,e._doRequest=t.debounce(e._doRequest,e.params.debounceDelay)},focused:{yes:function(){this.__base();var t=this.params.showListOnFocus&&!this._autoFocus?this._onChange():this._onChange;this.on("change",t)},"":function(){this.__base(),this.un("change",this._onChange)._preventHide||this._getPopup().hide()}}},onElemSetMod:{popup:{fixed:{yes:function(){this._isPopupShown&&this.afterCurrentEvent(function(){this._updatePopupPos()})},"":function(){this._isPopupShown&&this.afterCurrentEvent(function(){this._updatePopupPos()})}}}},getDataprovider:function(){var e=this.params.dataprovider.url;return this._dataprovider||(this._dataprovider=BEM.create(this.params.dataprovider.name||this.__self.getName()+"__dataprovider",t.extend(this.params.dataprovider,{url:e,callbackCtx:this})))},_onChange:function(){return e===this._input0?e=null:this._preventRequest||this._doRequest(),this._onChange},_onKeyDown:function(t){var e=this,i=38==t.keyCode||40==t.keyCode;if(i&&!t.shiftKey)if(t.preventDefault(),e._isPopupShown){var n=e._items.length,s=!1;if(n){var o=t.keyCode-39,r=e._curItemIndex,a=0;do s=(0==r&&-1==o||r+o>=n)&&e._onLeaveItem(e._items[r],!0),r+=o,r=0>r?n-1:r>=n?0:r;while(!s&&e._onEnterItem(e._items[r],!0)===!1&&++a<n)}}else e._getHiddenPopup()},_onKeyPress:function(t){13==t.keyCode&&(this._curItemIndex>-1&&this._isCurItemEnteredByKeyboard&&(t.preventDefault(),this._onSelectItem(this._items[this._curItemIndex],!0)),this._getPopup().hide())},_getHiddenPopup:function(){this._preventRequest||this._focused&&!this._isPopupShown&&this._doRequest()},_getPopup:function(){var e=this;if(!e._popup){var s=t.browser.opera&&t.browser.version<12.1?"keypress":"keydown",o=e.__self.getName(),r=[{elem:"items",tag:"ul",mix:[{block:o,elem:"popup-items"}]},{block:"b-form-input",elem:"shadow",tag:"i"}];e._hasPopupFade()&&r.push({block:o,elem:"fade"}),e._popup=t(i.build({block:"i-popup",mix:[{block:o,elem:"popup",mods:e.params.popupMods,js:{uniqId:e._uniqId}}],content:r})).bem("i-popup").on({show:function(){e.trigger("popup-shown").bindTo("keypress",e._onKeyPress).bindToWin("resize",e._updatePopupPos).unbindFrom("input","click")._isPopupShown=!0},"outside-click":function(i,n){e.containsDomElem(t(n.domEvent.target))&&i.preventDefault()},hide:function(){e.trigger("popup-hidden").unbindFrom("keypress").unbindFromWin("resize").bindTo("input","click",e._getHiddenPopup)._curItemIndex=-1,e._isPopupShown=!1}}),e.bindTo(s,e._onKeyDown),t.each({mouseover:e._onEnterItem,mouseout:e._onLeaveItem,mousedown:e._onSelectItem,mouseup:e._onItemMouseUp},function(t,i){BEM.blocks["b-autocomplete-item"].on(e._popup.domElem,t,function(t){i.call(e,t.block)})}),n.init(e._popup.domElem)}return e._popup},getPopup:function(){return this._getPopup()},_hasPopupFade:function(){return"yes"==(this.params.popupMods||{}).fade},_updatePopupPos:function(){var t=this.elem("box"),e=t.offset();e.top+=t.outerHeight(),this.hasMod(this.elem("popup"),"fixed")&&(e.top-=n.win.scrollTop()),this._hasPopupFade()&&(e.width=t.outerWidth()),this._preventPopupShow||this._getPopup().show(e)},_onEnterItem:function(t,e){if(t.hasMod("enterable","no"))return!1;var i=this._items,n=this._curItemIndex;n>-1&&i[n].delMod("hovered"),n=this._getItemIndex(t),n>-1&&i[n].setMod("hovered","yes"),this._curItemIndex=n,this._isCurItemEnteredByKeyboard=!!e,e&&this.params.updateOnEnter&&(this._preventRequest=!0,this.val(t.enter()!==!1?t.val():this._userVal,{source:"autocomplete",itemIndex:this._curItemIndex}).del("_preventRequest"))},_onLeaveItem:function(t,e){var i=this._curItemIndex;return i>-1&&i==this._getItemIndex(t)&&(this._items[i].delMod("hovered"),this._curItemIndex=-1),e&&this.val(this._userVal),!0},_onSelectItem:function(t,e){var i=t.select(e||!1),n="object"==typeof i?i.needUpdate:i!==!1,s="object"==typeof i&&i.needEvent;this._preventRequest=!0,this._preventBlur=!e,n&&this.val(this._userVal=t.val(),{source:"autocomplete",itemIndex:this._curItemIndex}),e?this.del("_preventRequest"):(n||(this._preventHide=!0),this.afterCurrentEvent(function(){this.setMod("focused","yes").del("_preventRequest","_preventHide")})),(n||s)&&this.trigger("select",{item:t,byKeyboard:e})},_onItemMouseUp:function(){this.del("_preventBlur")._getPopup().hide()},_getItemIndex:function(e){return t.inArray(e,this._items)},_doRequest:function(){var e=this;e.enablePopup(),e._userVal=e.val(),e.trigger("data-requested").getDataprovider().get(e.val(),function(i){e.trigger("data-received",i);var s=e._getPopup(),o=i.items||i;e.foot&&o.length&&-1==t.inArray(e.foot,o)&&o.push(e.foot),o.length?(e._curItemIndex=-1,n.update(s.elem("items"),e._buildItemsHtml(o),function(){e._updatePopupPos(),e._items=s.findBlocksInside("b-autocomplete-item"),e.trigger("update-items")})):s.hide()})},_buildItemsHtml:function(e){var n=this;return i.build(t.map(e,function(e){var i,s={block:"b-autocomplete-item",data:e,mods:{type:t.isArray(e)?e[0]:"text"},suggestVersion:n.params.dataprovider.version};return t.isArray(e)&&t.isPlainObject(i=e.concat().pop())&&t.extend(s,i),s}))},setFoot:function(t){return this.foot=t},getDefaultParams:function(){return t.extend(this.__base(),{updateOnEnter:!0,debounceDelay:50,showListOnFocus:!0})},enablePopup:function(){this._preventPopupShow=!1},disablePopup:function(){this._preventPopupShow=!0}})}(jQuery),BEM.DOM.decl({name:"b-form-input",modName:"autocomplete",modVal:"yes"},{_buildItemsHtml:function(t){var e=this;return BEM.HTML.build($.map(t,function(t){return{block:"b-autocomplete-item",data:t,mods:{type:$.isArray(t)?t[0]:"text",intranet:e.getMod("intranet")}}}))}}),BEM.decl({name:"b-form-input__dataprovider",baseBlock:"i-request_type_ajax"},{get:function(t,e){return this.__base({part:t},function(t){e.call(this,{items:t[1],metainfo:t[2]})})}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"hl"},{onBlock:function(t){t.content($.map(t.param("data").slice(1),function(t){return $.isArray(t)?{tag:"span",elem:"highlight",content:t[0]}:t}))}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"fact"},{onBlock:function(t){var e=t.param("data").slice(1);t.content([{tag:"span",elem:"text",content:BEM.blocks["i-common__string"].highlight(e[0],t.param("hl"))},{tag:"span",elem:"fact",content:[" — ",BEM.blocks["i-common__string"].escapeHTML(e[1])]}])}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"nah"},{onBlock:function(t){t.content(t.param("data")[1])}}),BEM.DOM.decl({block:"b-autocomplete-item",modName:"type",modVal:"href"},{url:function(){return this.findBlockInside("b-link").domElem.attr("href")},enter:function(){return!1},select:function(t){return t&&(location.href=this.url()),!1}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"href"},{onBlock:function(t){var e=t.param("data").slice(1);t.content({block:"b-link",content:e[0],url:e[1]})}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"weather"},{onBlock:function(t){var e=t.param("data").slice(1),i=BEM.blocks["i-common__string"].escapeHTML;t.content([{tag:"span",elem:"text",content:i(e[0])},{tag:"i",elem:"icon",mods:{weather:e[2].replace("-","minus-").replace("+","plus-").replace(/_/g,"-")}},{tag:"span",elem:"value",content:i(e[1].replace("-","&ndash;"))}])}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"traffic"},{onBlock:function(t){var e=t.param("data").slice(1),i=BEM.blocks["i-common__string"].escapeHTML;t.content([{tag:"span",elem:"text",content:i(e[0])},{tag:"i",elem:"icon",mods:{traffic:e[2]}},{tag:"span",elem:"value",content:i(e[1])}])}}),BEM.HTML.decl("b-autocomplete-item",{onElem:{nav:function(t){var e=BEM.blocks["b-autocomplete-item"].getUrl;t.tag("a").attrs({href:e(t.param("url")),target:"_blank"}).content(t.content)}}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"icon"},{onBlock:function(t){var e=t.param("data").slice(1),i=e[0]||"",n=e[1]||{},s=BEM.blocks["i-common__string"].escapeHTML,o=BEM.blocks["b-autocomplete-item"].getUrl;if(n.icon){var r={};Array.isArray(n.icon[0])?n.icon.forEach(function(t){r[t[0]]=t[1]}):r[n.icon[0]]=n.icon[1];var a=r.svg?"background-image:none,url("+r.svg+")":"",l=r.png?"background-image:url("+r.png+");":"",c=[{tag:"span",elem:"text",content:s(i)},{tag:"i",elem:"icon",attrs:{style:l+a}},{tag:"span",elem:"value",content:n.fact&&s(n.fact.replace("-","&ndash;"))}];n.url?t.mod("nav","yes").js({val:o(n.url)}).content({block:"b-autocomplete-item",elem:"nav",url:n.url,content:c}):t.content(c)}}}),BEM.DOM.decl({name:"b-autocomplete-item",modName:"intranet",modVal:"yes"},{enter:function(){return!1},select:function(t){var e=this.getMod("type");return"text"==e?($('<form style="display:none" action="http://search.yandex-team.ru/search"><input type="hidden" name="text" value="'+this.val()+'"/></form>').appendTo("body").submit().remove(),!1):(t&&$('<form style="display:none" action="'+this.val()+'"/>').appendTo("body").submit().remove(),!1)}},{live:function(){this.liveBindTo("mouseover mouseout mousedown",function(t){this.trigger(t.type)})}}),BEM.HTML.decl({name:"b-autocomplete-item",modName:"intranet",modVal:"yes"},{onBlock:function(t){var e=t.param("data");if(e instanceof Array){var i=e[1];t.tag("li").content({block:"b-isuggest-item",data:e,mods:t.param("mods")}).js({val:i.href||i.title})}else t.tag("li").content(e).js(!0)}}),BEM.HTML.decl("b-isuggest-item",{onBlock:function(t){var e=t.param("data");t.tag("span").mods({order:e[1].order}).content([{elem:"i",data:e}])},onElem:{i:function(t){t.tag("span").content({elem:"text",data:t.param("data")})},text:function(t){var e=t.param("data")[1];t.tag("span").content(e.title_hl||e.title)}}}),BEM.HTML.decl({name:"b-isuggest-item",modName:"type",modVal:"nav"},{onElem:{i:function(t){var e=t.param("data");t.tag("a").attrs({href:e[1].href}).content({elem:"text",data:e})}}}),BEM.HTML.decl({name:"b-isuggest-item",modName:"type",modVal:"ml"},{onElem:{i:function(t){var e=t.param("data");t.tag("a").attrs({href:e[1].href}).content({elem:"text",data:e})}}}),BEM.HTML.decl({name:"b-isuggest-item",modName:"type",modVal:"people"},{onElem:{i:function(t){var e=t.param("data"),i=e[1];t.tag("a").attrs({href:i.href}).content([{block:"b-employee-userpic",data:e,tag:"img",attrs:{src:"http://center.yandex-team.ru/api/v1/user/"+i.login+"/photo/40/square.jpg"}},{elem:"text",mods:{type:"phone"},data:e,tag:"span",content:i.phone?"тел. "+(i.phone_hl||i.phone):""},{elem:"text",mods:{type:"main"},data:e,tag:"span",content:(i.title_hl||i.title)+",&nbsp"},{elem:"text",mods:{type:"login"},data:e,tag:"span",content:i.login_hl||i.login},{elem:"text",mods:{type:"note"},data:e,tag:"span",content:i.department_hl||i.department}])}}}),BEM.HTML.decl({name:"b-isuggest-item",modName:"type",modVal:"wiki"},{onElem:{i:function(t){var e=t.param("data"),i=e[1];t.tag("a").attrs({href:i.href}).content([{elem:"text",mods:{type:"main"},data:e,tag:"span",content:i.title_hl||i.title},{elem:"text",mods:{type:"note"},data:e,tag:"span",content:[{elem:"group",tag:"span",content:"Wiki / "},i.tag_hl||i.tag||i.supertag]}])}}}),BEM.HTML.decl({name:"b-isuggest-item",modName:"type",modVal:"wiki-lock"},{onElem:{i:function(t){var e=t.param("data"),i=e[1];t.tag("a").attrs({href:i.href}).content([{elem:"text",mods:{type:"main"},data:e,tag:"span",content:i.title_hl||i.title},{elem:"text",mods:{type:"note"},data:e,tag:"span",content:i.tag_hl||i.tag||i.supertag}])}}}),BEM.DOM.decl({block:"b-form-input",modName:"multicomplete",modVal:"yes"},{_itemData:void 0,onSetMod:{js:function(){this.on("change",function(){""===this.val()&&(this._itemData=void 0,this._typeInput.val(""),this._valueInput.val(""))}),this._valueInput=this.elem("hidden-input").eq(0),this._typeInput=this.elem("hidden-input").eq(1),this.__base()}},getData:function(){return this._itemData},setData:function(t){this._itemData=t,this._typeInput.val(t._type),this._valueInput.val(t._id)},getType:function(){return this._itemData?this._itemData._type:void 0},_onEnterItem:function(t){this.setData(t.getItemData()),this.__base.apply(this,arguments)},_buildItemsHtml:function(t){return BEM.HTML.build($.map(t,function(t){return{block:"b-autocomplete-item",data:t,mods:{multicomplete:"yes",type:t._type||"text"}}}))}}),BEM.decl({name:"b-form-input__multicomplete-dataprovider",baseBlock:"i-request_type_ajax"},{onSetMod:{js:function(){this._url=this.params.multicomplete.url||"//center.yandex-team.ru/api/autocomplete/multi/",delete this.params.multicomplete.url,this.__base()}},get:function(t,e){return t?this.__base($.extend(this.params.multicomplete,{q:t}),function(t){e.call(this,{items:t})},{url:this._url}):e.call(this,[])}}),BEM.DOM.decl({block:"b-autocomplete-item",modName:"multicomplete",modVal:"yes"},{val:function(){return this.params.data._text||""},getItemData:function(){return this.params.data}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"multicomplete",modVal:"yes"},{onBlock:function(t){var e=t.param("data");t.tag("li").js({data:e}).content(e._text||"")}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"staff"},{onBlock:function(t){var e=t.param("data");t.content([{elem:"userpic",tag:"img",attrs:{src:"//center.yandex-team.ru/api/v1/user/"+e.login+"/photo/40/square.jpg"}},{elem:"phone",content:e.work_phone},e.first_name+" "+e.last_name+", ",{elem:"brief",content:e.login},{elem:"info",content:e.department__name}],!0)}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"maillist"},{onBlock:function(t){var e=t.param("data").email.split("@");t.content([{elem:"email",content:e[0]},{elem:"domain",content:"@"+e[1]}],!0)}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"department"},{onBlock:function(t){var e=t.param("data");t.mod("height","auto"),t.content([{elem:"color",attrs:{style:"background-color:"+e.bg_color}},e.name,{elem:"ancestors",content:$.map(e.ancestors,function(t){return 1==e.ancestors.length||1!==t.id?t.name:void 0}).join(" / ")}],!0)}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"table"},{onBlock:function(t){var e=t.param("data");t.mod("height","auto"),t.content([e.name+", ",{elem:"brief",content:e.status_display},{elem:"info",content:e.office_name+", "+e.floor_display}],!0)}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"tablereserve"},{onBlock:function(t){t.mod("type","table",!0)}}),BEM.DOM.decl({block:"b-autocomplete-item",modName:"type",modVal:"room"},{val:function(){return this.params.data.name||this.params.data.num}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"room"},{onBlock:function(t){var e=t.param("data"),i=e.name||e.num;i+=e.name_alternative?" ("+e.name_alternative+")":"",i+=i?", ":"",t.mod("height","auto"),t.content([i,{elem:"brief",content:e.type_display},{elem:"info",content:e.office_name+", "+e.floor_display}],!0)}}),BEM.HTML.decl({block:"b-autocomplete-item",modName:"type",modVal:"equipment"},{onBlock:function(t){var e=t.param("data");t.mod("height","auto"),t.content([e.name+", ",{elem:"brief",content:e.type_display},{elem:"info",content:e.office_name+", "+e.floor_display}],!0)}}),BEM.DOM.decl({name:"b-form-input",modName:"has-clear",modVal:"yes"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.on("change",this._updateClear)._updateClear()}},_onClearClick:function(){this.trigger("clear"),this.removeInsets&&this.removeInsets(),this.val("").setMod("focused","yes")},_updateClear:function(){return this.toggleMod(this.elem("clear"),"visibility","visible","",!!this._val)}},{live:function(){return this.__base(),this.liveBindTo("clear","leftclick",function(){this._onClearClick()}),!1}}),BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"new-page"},{onSetMod:{js:function(){var t=this;this.__base.apply(this,arguments),this.__self.placeholders.url||(this.__self.placeholders.url={cluster:"- "+BEM.I18N("b-widget","page_in_home_cluster"),sub:"- "+BEM.I18N("b-widget","page_in_current_cluster"),_404:"- "+BEM.I18N("b-widget","page_on_current_address")}),this._localStorage=BEM.blocks["mi-storage"],this._bPage=this.findBlockOutside("b-page"),this._bHead=this._bPage.findBlockInside("b-head"),this._cancel=this.findBlockInside({block:"button",modName:"type",modVal:"new-page-cancel"}),this._save=this.findBlockInside({block:"button",modName:"type",modVal:"new-page-save"}),this._type=this.findBlockInside({block:"radio-button",modName:"type",modVal:"new-page"}),this._url=this.findBlockInside({block:"input",modName:"type",modVal:"new-page-url"}),this._title=this.findBlockInside({block:"input",modName:"type",modVal:"new-page-title"}),this._spinner=this.findBlockInside({block:"spinner",modName:"type",modVal:"create-load"}),setTimeout(function(){t._title.elem("control").eq(0).focus()},0),this._cancel.on("click",this.hide,this),this._save.on("click",this._onSave,this)}},_lockWidget:function(){this._spinner.setMod("progress","yes"),this._cancel.setMod("disabled","yes"),this._save.setMod("disabled","yes")},_unlockWidget:function(){this._spinner.delMod("progress"),this._cancel.delMod("disabled"),this._save.delMod("disabled")},_createUrl:function(){var t=this._url.val(),e=this._type.val();switch(e){case"page":return t;case"grid":return t+"/.grid/create"}return t},_checkIsTitleFilled:function(){return this._title.val()?!0:(this.channel("errors").trigger("error",this._getErrorData(BEM.I18N("b-widget","input_page_name"))),!1)},_normalizeUrl:function(t){var e,i=this;return this._prefix=null,t=t.trim(),Object.keys(this.__self.prefixes).forEach(function(n){i.__self.prefixes[n].forEach(function(s){!e&&~t.indexOf(s)&&(e=n,i._prefix=s)})}),t=t.replace(/\/{2,}/,"/"),this._prefix?"cluster"===e?"users/"+this._bPage.params.login+"/"+t.split(this._prefix).pop():location.pathname.substr(1)+t.split(this._prefix).pop():/^\/?(\S+)/.exec(t)[1]},_pageExist:function(t){var e=this,i=(this._bPage.params.login,this._url.val()),n=this._normalizeUrl(i);this._checkIsTitleFilled()&&(this._lockWidget(),BEM.create("api-request",{_:"api-response",apiPath:n,method:"HEAD",data:!1,urlParams:["format=json"],path:""}).run().then(function(){var t=e._type.val(),i=BEM.I18N("b-widget","page_already_exist");switch(t){case"page":i=BEM.I18N("b-widget","page_already_exist");break;case"grid":i=BEM.I18N("b-widget","grid_already_exist")}e._unlockWidget(),e.channel("errors").trigger("error",e._getErrorData(i))},t.bind(this)))},_validateUrl:function(t){var e=this._normalizeUrl(this._type.val());"/"===e.charAt(0)&&(e=e.substr(1,e.length)),BEM.create("api-request",{_:"api-response",apiPath:".validate_tag",method:"GET",urlParams:["tag="+e],path:""}).run().then(t.bind(this),this._onPageValidationError.bind(this))},_onPageValidationError:function(t){this.channel("errors").trigger("error",this._getErrorData(t.message)),this._unlockWidget()},_onSave:function(){this._pageExist(function(){BEM.create("api-request",{_:"api-response",apiPath:this._normalizeUrl(this._createUrl()),method:"POST",data:{title:this._title.val(),body:""},path:""}).run().then(this._onSaveData.bind(this),this._onPageSaveError.bind(this))})},_onSaveData:function(t){var e=this._type.val();switch(e){case"page":location="/"+t.data.supertag+"/.edit";break;case"grid":t.data.tag&&(this._localStorage.setItem("wiki-sidebar","true"),this._localStorage.setItem("wiki-new-grid","true"),location="/"+t.data.tag)}},_onPageSaveError:function(){this._unlockWidget(),this.channel("errors").trigger("error",this._getErrorData(BEM.I18N("b-widget","validation_error")))},_getErrorData:function(t){return{node:this._save.domElem,content:{head:"",body:t}}},_validUrlError:function(){this.channel("errors").trigger("error",this._getErrorData(BEM.I18N("b-widget","not_valid_url")))},open:function(t){var e,i;this._pageType=t,"_404"!==t?(e=this.__self.placeholders.page[t],this._prefix=this.__self.prefixes[t][0]):(i=location.pathname.split("/"),e=i.pop(),this._prefix=i.join("/")+"/"),this._pageUrl=this._prefix,this._url.elem("prefix").text(this._prefix),this._url.elem("placeholder").text(this.__self.placeholders.url[t]),this._pageUrl+=e,this._url.elem("url").text(decodeURI(e)),this._url.val(decodeURI(this._pageUrl)),this._widgetInited||(this._newPageInput(),this._widgetInited=!0),this._title.val(""),delete this._isUrlChanged,this.show()},_newPageInput:function(){var t,e,i=this;this._url.on("change",function(){i._lockInputChange||(this.val(this.val().replace(/\s/g,"-").replace(/-{2,}/g,"-")),t=null,i._isUrlChanged||(i._isUrlChanged=!0,i._url.setMod(i._url.elem("placeholder"),"visibility","hidden")),"_404"!==i._pageType&&Object.keys(i.__self.prefixes).forEach(function(n){i.__self.prefixes[n].forEach(function(s){!t&&~i._url.val().indexOf(s)&&(e=n,t=s)})}),t?i._url.elem("url").text(this.val().split(t).pop()):i._url.elem("url").empty(),i._url.elem("prefix").text(t))}),this._title.on("change",function(){if(!i._isUrlChanged&&"_404"!==i._pageType){var t=this.val().replace(/\s/g,"-").replace(/-{2,}/g,"-");i._lockInputChange=!0,i._url.elem("url").text(t),i._url.val(i._prefix+t),delete i._lockInputChange}})}},{prefixes:{cluster:["~/","~"],sub:["!/","!"]},placeholders:{page:{cluster:"newpage",sub:"newpage",_404:"404page"}}}),BEM.DOM.decl("b-cluster-autocomplete",{onSetMod:{js:function(){var t=this;this._path=window.location.pathname,this.codes=[40,39,38,37,13,9],"/"===this._path.split("").pop()&&(this._path=this._path.substr(0,this._path.length-1)),this._input=this.findBlockInside("input"),this._popup=this.findBlockInside({block:"popup",modName:"type",modVal:"suggest"}),this._spinner=this.findBlockInside("spinner"),this._addPrefixUrlField(),this._input.bindTo("keyup",function(e){t._rejectedKeys(e.keyCode)||(t.delMod("access"),t._spinner.setMod("progress","yes"),t._input.elem("prefix-url").html(""),t.trigger("select",this._val),t._request&&t._request.abortRequest(),t._request=BEM.create("api-request",{_:"api-response",apiPath:".autocomplete",method:"GET",data:!1,urlParams:["tag="+this._val+"&offset=0&limit=10"],path:WikiHistory._getCorrectPath()}),t._request.run().then(t._onSuccess.bind(t),t._onError.bind(t)))}),this._selectItem()}},_rejectedKeys:function(t){return-1!==this.codes.indexOf(t)?!0:void 0},_addPrefixUrlField:function(){var t=BEMHTML.apply({block:"input",elem:"prefix-url"});BEM.DOM.before(this._input.elem("control"),t)},_onSuccess:function(t){var e,i,n=this,s=t.data.data;this.channel("errors").trigger("errorHide"),n._popup.elem("content").html(""),s.length&&(s.forEach(function(t,s){"/"!==t.supertag[0]&&(t.supertag="/"+t.supertag),e=t.supertag.replace(n._input.elem("control").val(),""),i=BEMHTML.apply({block:"b-autocomplete-select-item",attrs:{"data-tag":t.supertag},mods:{status:0===s?"active":""},content:[{elem:"static",content:n._input.elem("control").val()},{elem:"sub",content:e}]}),0===s&&n._input.elem("prefix-url").html(t.supertag),BEM.DOM.append(n._popup.elem("content"),i)}),this._popup.show(this._input)),this._spinner.delMod("progress")},_onError:function(t){this._spinner.delMod("progress"),this._popup.elem("content").html(""),this._input.elem("prefix-url").html(""),this.channel("errors").trigger("error",this._getErrorData(t.message))
},_getErrorData:function(t){return{node:this._input.domElem,content:{head:BEM.I18N("b-cluster-autocomplete","get_data_error"),body:t}}},_getCurrentItem:function(){return this._popup.findBlockInside({block:"b-autocomplete-select-item",modName:"status",modVal:"active"})},_selectNewItem:function(t,e){t&&t.delMod("status"),e.setMod("status","active"),this._input.elem("prefix-url").html(e.domElem.data("tag"))},_itemBEMObject:function(t){return t.bem("b-autocomplete-select-item")},_selectItem:function(){var t,e,i,n=this;this._popup.bindTo("click",function(e){var i=$(e.target).closest(".b-autocomplete-select-item"),s=i.data("tag");t=n._getCurrentItem(),n._selectNewItem(t,n._itemBEMObject(i)),t=n._getCurrentItem(),n._popup.hide(),n._input.elem("control").val(s),n.trigger("select",s)}),this._popup.on("hide",function(){n._input.elem("prefix-url").html("")}),this._input.bindTo("keyup",function(s){switch(s.keyCode){case 40:t=n._getCurrentItem(),e=t?t.domElem.next():[],e.length&&n._selectNewItem(t,n._itemBEMObject(e));break;case 38:t=n._getCurrentItem(),i=t?t.domElem.prev():[],i.length&&n._selectNewItem(t,n._itemBEMObject(i));break;case 13:t=n._getCurrentItem(),t&&(n._input.elem("control").val(t.domElem.data("tag")),n._popup.hide(),n.trigger("select",t.domElem.data("tag")))}})}}),BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"subscribe"},{_subscribeUsersUids:[],onSetMod:{js:function(){this.__base.apply(this,arguments),this._suggestBlock=this.findBlockInside("m-suggest"),this._commentBlock=this.findBlockInside({block:"input",modName:"subscribe",modVal:"comment"}),this._cancel=this.findBlockInside({block:"button",modName:"type",modVal:"cancel"}),this._close=this.findBlockInside({block:"button",modName:"type",modVal:"close"}),this._save=this.findBlockInside({block:"button",modName:"type",modVal:"save"}),this._spinner=this.findBlockInside({block:"spinner",modName:"type",modVal:"subscribe-load"}),this._suggestBlock._input.on("change",this._lockUnlockSubscribeButton,this),this._suggestBlock.on("select",this._onSuggestChange,this),this._cancel.on("click",this.hide,this),this._close.on("click",this.hide,this),this._save.on("click",this._onSave,this)}},show:function(){this.__base.apply(this,arguments),this._suggestBlock._input.clearInput(),this._commentBlock.clearInput()},hide:function(){this.__base.apply(this,arguments),this._clearData(),this.delMod("status")},_clearData:function(){this._subscribeUsersUids=[],this._suggestBlock.clearData()},_lockUnlockSubscribeButton:function(t){t.block.val().length<2?!this._save.hasMod("disabled")&&this._save.setMod("disabled","yes"):this._save.hasMod("disabled")&&this._save.delMod("disabled")},_onSuggestChange:function(t,e){this._subscribeUsersUids.push(e.uid)},_getDataForRequest:function(){return{uids:this._subscribeUsersUids,comment:this._commentBlock.val()}},_onSave:function(){this._save.setMod("disabled","yes"),this._spinner.setMod("progress","yes"),BEM.create("api-request",{_:"api-response",apiPath:".masswatch",method:"POST",data:this._getDataForRequest(),urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(this.onSuccessSubscribe.bind(this),this.onSubscribeError.bind(this))},onSuccessSubscribe:function(){this._save.delMod("disabled"),this._spinner.delMod("progress"),this.setMod("status","subscribed")},onSubscribeError:function(t){console.log("ERROR",t),this._save.delMod("disabled"),this._spinner.delMod("progress")}}),BEM.DOM.decl({block:"m-suggest-item"},{},{live:function(){return this.liveBindTo("click mousedown mouseout mousemove mouseover",function(t){this.trigger(t.type,t)}),!1}}),BEM.DOM.decl({block:"m-suggest-item",modName:"labels",modVal:"yes"},{onSetMod:{js:function(){this._inputData=this.params.inputData,this._popup=this.findBlockOutside({block:"popup",modName:"role",modVal:"suggest-items"}),this._label=this.elem("item-label"),this._info=this.elem("info-wrapper"),this.__base.apply(this,arguments),this._popup.domElem.offset().top?this._setOffset():this._popup.on("show",this._onPopupShow,this)}},_onPopupShow:function(t){t.block.un("show",this._onPopupShow,this),this._setOffset()},_setOffset:function(){var t="staff"===this.getMod("type");this._info.css("padding-left",this._inputData.offset.left-this._popup.domElem.offset().left-1),this._label.css("left",this._inputData.offset.left-this._popup.domElem.offset().left-10-this._label.outerWidth()),this.params.inSearchHeader&&(t&&this.findBlockInside("m-userpic").domElem.css("left",this._inputData.offset.left+this._inputData.width-52),this.domElem.css("padding-right",this._popup.domElem.outerWidth()-this._inputData.offset.left-this._inputData.width+(t&&52)))}}),BEM.DOM.decl({block:"m-suggest"},{onSetMod:{js:function(){this._input=this.findBlockInside("input"),this._input.on("change focus",this._onChange,this),this._input.on("blur",this._onBlur,this),this._input.elem("clear").length&&this._input.bindTo(this._input.elem("clear"),"click",this._onClearText.bind(this)),this._notSendRequest=0}},val:function(t,e){var i,n,s,o,r=this._input.val(),a=typeof t;return"undefined"===a||e||this._notSendRequest++,"string"===a?this._input.val(t):"object"===a&&(i=t.params.value,n=t.params.fullData,i!==r&&this._notSendRequest++,o={fullData:n,value:i},this.params.multiple?(s=r.substr(0,r.lastIndexOf(",")+1),s?this._input.val(s+" "+i):this._input.val(i),this._val?this._val.push(o):this._val=[o]):(this._input.val(i),this._val=o.fullData)),this._input.val()},name:function(){return this._input.name()},getData:function(){var t,e,i=null;return this._val&&this.params.multiple?(t=this._input.val().split(","),i=this._val.filter(function(i){return e=!0,t.forEach(function(t){-1!==t.indexOf(i.value)&&(e=!1)}),!e}).map(function(t){return t.fullData})):this._val&&(i=this._val),i},clearData:function(){this._val=null,this._input&&this._input.clearInput()},_onChange:function(){var t=this._getInputValue4Request();!this._notSendRequest&&t?(this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=setTimeout(this._sendRequest(),200)):this._notSendRequest?this._notSendRequest--:this._input.val()||this._popup&&this._popup.hide()},_getInputValue4Request:function(){var t=this._input.val(),e=t.lastIndexOf(",");return this.params.multiple&&-1!==e&&(t=t.substr(e+1)),t},_sendRequest:function(){var t,e=this._getInputValue4Request();this._input.val()?(t=$.extend(this._requestSettings,{data:$.extend(this._getData(e),this.params.addRequestParams)}),$.ajax(t).done(this._processResult.bind(this)).fail($.noop)):this._popup&&this._popup.hide()},_processResult:function(t){var e=this._getPopup();this._isNotEmptyResult(t)&&this._input.val()?(BEM.DOM.update(e.elem("items"),this._getItemsHTML(t),function(){this._updatePopupPos(),this._items=e.findBlocksInside("m-suggest-item"),this.trigger("update-items")}.bind(this)),this._curItemIndex=-1):e.hide()},_getItemTypeFromOptions:function(t){var e=null;return this.params.types.forEach(function(i){"object"==typeof i?i.name===t&&(e=i):i===t&&(e={name:i})}),e},_onClearText:function(){this._notSendRequest=1},_getPopupBEMJSON:function(){return{block:"popup",mods:{type:"modal",role:"suggest-items"},mix:[{block:this.__self.getName(),elem:"popup",mods:{labels:(this.params.inHeader||this.params.inSearchHeader)&&"yes",header:this.params.inHeader&&"yes","search-header":this.params.inSearchHeader&&"yes"},js:{uniqId:this._uniqId}}],js:{directions:"bottom"},content:{elem:"content",content:{elem:"items",cls:this.params.inSearchHeader&&"m-suggest-in-search-header",mix:[{block:this.__self.getName(),mods:{size:this.getMod("size")},elem:"popup-items"}]}}}},_getPopup:function(){var t=this;return t._popup||(t._popup=$(BEMHTML.apply(t._getPopupBEMJSON())).bem("popup").on({show:t._onPopupShow,hide:t._onPopupHide},t).bindTo("mousedown",t._onPopupMouseDown.bind(t)),t.bindTo("keydown",t._onKeyDown),BEM.blocks["m-suggest-item"].on(t._popup.domElem,{mouseover:t._onMouseOverInItem,mouseout:t._onLeaveItem,click:t._onClickItem},this),BEM.DOM.init(t._popup.domElem)),t._popup},_updatePopupPos:function(){var t=this._input.findElem("box"),e=t.offset();this.params.inHeader?(e.right=0,e.left-=100,e.top=this.findBlockOutside("m-head").domElem.outerHeight()):this.params.inSearchHeader?(e.right=0,e.left=0,e.top=this.findBlockOutside("m-head").domElem.outerHeight()):e.top+=t.outerHeight()+9,this._getPopup().show(e)},_onLeaveItem:function(t,e){(!e.toElement||!$(t.block.domElem[0]).has(e.toElement).length&&t.block.domElem[0]!==e.toElement)&&(this._items[this._curItemIndex]&&this._items[this._curItemIndex].delMod("hovered"),this._curItemIndex=-1)},_onBlur:function(){this._popup&&!this._notHide&&this._popup.hide(),this._notHide=!1},_onClickItem:function(t){this._selectItem(t.block)},_onPopupMouseDown:function(){this._notHide=!0,this._notSendRequest=1,setTimeout(function(){this._input.elem("control")[0].focus()}.bind(this),0)},_onPopupShow:function(){this.trigger("popup-shown")._isPopupShown=!0,this._input.unbindFrom("click",this._getHiddenPopup)},_onPopupHide:function(){this.trigger("popup-hidden")._curItemIndex=-1,this._input.bindTo("click",this._showHiddenPopup.bind(this)),this._isPopupShown=!1,BEM.blocks["m-suggest-item"].un(this._popup.domElem,"mousemove",this._onMouseMoveInItem,this)},_showHiddenPopup:function(){!this._isPopupShown&&this._onChange()},_selectItem:function(t,e,i){!i&&this.trigger("select",t.params.fullData)},_toggleItem:function(t){BEM.blocks["m-suggest-item"].on(this._popup.domElem,"mousemove",this._onMouseMoveInItem,this),this._items[this._curItemIndex]&&this._items[this._curItemIndex].delMod("hovered"),this._curItemIndex+=38===t?-1:1,this._curItemIndex===this._items.length&&(this._curItemIndex=-1),-2===this._curItemIndex&&(this._curItemIndex=this._items.length-1),this._items[this._curItemIndex]&&this._items[this._curItemIndex].setMod("hovered","yes")},_onMouseOverInItem:function(t){if(!t.block.hasMod("hovered")){var e;this._items[this._curItemIndex]&&this._items[this._curItemIndex].hasMod("hovered")&&this._items[this._curItemIndex].delMod("hovered"),e=this._items.indexOf(t.block),this._curItemIndex=e,this._items[this._curItemIndex].setMod("hovered","yes")}},_onMouseMoveInItem:function(t){this._onMouseOverInItem(t),BEM.blocks["m-suggest-item"].un(this._popup.domElem,"mousemove",this._onMouseMoveInItem,this)},_onKeyDown:function(t){this._isPopupShown&&(38===t.keyCode||40===t.keyCode?(t.preventDefault(),this._toggleItem(t.keyCode)):13===t.keyCode&&this._curItemIndex>-1&&(t.preventDefault(),this._selectItem(this._items[this._curItemIndex],!0)))},_getItemBEMJSON:function(t,e,i){return{block:"m-suggest-item",mods:{type:t,size:this.getMod("size"),link:i?"yes":"",labels:this.params.inHeader||this.params.inSearchHeader?"yes":"","in-search-header":this.params.inSearchHeader&&"yes"},data:e,inputData:{text:this._getInputValue4Request(),offset:this._input.findElem("box").offset(),width:this._input.domElem.outerWidth()},inSearchHeader:this.params.inSearchHeader}}},{REQUEST_TYPE:"GET",REQUEST_DATA_TYPE:"jsonp",REQUEST_TIMEOUT:2e4}),BEM.DOM.decl("input",{onSetMod:{js:function(){this.__base.apply(this,arguments),(this._hasHint=Boolean(this.elem("hint")[0]))&&this.on("change",this._updateHint)._updateHint()},focused:function(){return this.__base.apply(this,arguments)===!1?!1:(this._hasHint&&this._updateHint(),void 0)}},_updateHint:function(){this.toggleMod(this.elem("hint"),"visibility","visible",!this.val())}}),BEM.DOM.decl({block:"m-suggest",modName:"type",modVal:"multicomplete"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._requestSettings={type:this.__self.REQUEST_TYPE,url:"//center.yandex-team.ru/api/autocomplete/multi/",dataType:this.__self.REQUEST_DATA_TYPE,timeout:this.__self.REQUEST_TIMEOUT}}},_getData:function(t){var e,i="";return this.params.types.forEach(function(n,s){e=0===s?"":"|","object"==typeof n?(!n.symbolsToSend||n.symbolsToSend<=t.length)&&(i+=e+n.name):i+=e+n}),{q:t,types:i}},_isNotEmptyResult:function(t){return!!t.length},_getItemsHTML:function(t){var e,i={},n=this;return t.forEach(function(t){e=n._getItemTypeFromOptions(t._type),i[t._type]?(!e.maxCount||i[t._type].length<e.maxCount)&&i[t._type].push(t):i[t._type]=[t]}),BEMHTML.apply($.map(i,function(t,e){return{block:"m-suggest-group",groupLabel:!(n.params.inHeader||n.params.inSearchHeader)&&"staff"!==e&&e,content:$.map(i[e],function(t){return n._getItemBEMJSON(t._type,t)})}}))},_toggleItem:function(){this.__base.apply(this,arguments),this._items[this._curItemIndex]&&this.val(this._items[this._curItemIndex],!0)},_selectItem:function(t){this.val(t,!0),this.__base.apply(this,arguments),this._items[this._curItemIndex]&&this._items[this._curItemIndex].delMod("hovered"),this._curItemIndex=-1,this._popup.hide()}}),BEM.DOM.decl("mi-sticky",{placeHolder:null,currentStyleAttr:null,lastScroll:0,winHeight:0,elemHeight:0,onSetMod:{js:function(){var t,e,i=this;this.userOffsetTop=this.params.offset&&this.params.offset.top?parseInt(this.params.offset.top):0,this.offset=this.domElem.offset(),this.position="undefined"!=typeof this.params.position?this.params.position:"auto",this.winHeight=BEM.DOM.win.height(),this.elemHeight=this.domElem.outerHeight(!0),"manual"!==this.params.position&&(setTimeout(function(){i._checkScroll()},0),t=this.params.throttleTimeout?$.throttle(this._checkScroll,this.params.throttleTimeout):this._checkScroll,this.bindToDoc("scroll.sticky",t)),e=this.params.throttleTimeout?$.throttle(this._checkResize,this.params.throttleTimeout):this._checkResize,this.bindToWin("resize.sticky",e)},undocked:{yes:function(){var t=this.params.preventCollapse,e=this.params.offset||{},i={top:e.top?parseInt(e.top):0,right:"undefined"!=typeof e.right?parseInt(e.right):"auto",bottom:"undefined"!=typeof e.bottom?parseInt(e.bottom):"auto",left:"undefined"!=typeof e.left?parseInt(e.left):"auto"};"auto"===i.bottom&&this.hasMod("full-height")&&(i.bottom=""),"auto"===i.right&&"auto"===i.left&&(i.left=this.domElem.offset().left),this.currentStyleAttr=this.domElem.attr("style"),this.domElem.css({position:"",top:i.top,right:i.right,bottom:i.bottom,left:i.left}),t&&(this.placeHolder=$("<div>").css({position:this.domElem.css("position"),top:this.domElem.css("top"),right:this.domElem.css("right"),bottom:this.domElem.css("bottom"),left:this.domElem.css("left"),visibility:"hidden","float":this.domElem.css("float"),width:this.domElem.outerWidth(!0),height:this.domElem.outerHeight(!0)}),this.domElem.after(this.placeHolder)),this._checkHeight(),this.trigger("undocked")},"":function(){this.placeHolder&&(this.placeHolder.remove(),this.placeHolder=null),this.domElem.attr("style",this.currentStyleAttr),this.trigger("docked")}},biggerThanWindow:{yes:function(){},"":function(){var t=this.params.offset||{};this.domElem.css({top:t.top?parseInt(t.top):0,bottom:"undefined"!=typeof t.bottom?parseInt(t.bottom):"auto"})}}},destruct:function(){this.placeHolder&&(this.placeHolder.remove(),this.placeHolder=null),this.__base.apply(this,arguments)},_checkScroll:function(){var t,e=BEM.DOM.win.scrollTop(),i=this.lastScroll-e,n="auto"===this.position?this.offset.top:parseInt(this.position);this.lastScroll=e,e>n-this.userOffsetTop?(this.setMod("undocked","yes"),this.hasMod("biggerThanWindow","yes")&&(t=this.winHeight-this.elemHeight,i>0||t>0?this.domElem.css({top:"auto",bottom:0}):this.domElem.css({top:0,bottom:"auto"}))):this.delMod("undocked")},_checkResize:function(){this.winHeight=BEM.DOM.win.height(),this.elemHeight=this.domElem.outerHeight(),this.placeHolder&&this.placeHolder.css({width:this.domElem.outerWidth(),height:this.elemHeight}),this.hasMod("undocked","yes")&&this._checkHeight(),this._checkScroll()},_checkHeight:function(){var t=this.elemHeight+this.userOffsetTop>this.winHeight;this.setMod("biggerThanWindow",t?"yes":"")}}),BEM.DOM.decl("b-editor-close-button",{onSetMod:{js:function(){this._bPage=BEM.blocks["i-global"].getbPage(),this._togglerButton=this._bPage.findBlockInside({block:"check-button",modName:"toggler",modVal:"sidebar"}),this._bSidebar=this._bPage.findBlockInside("b-sidebar"),this._bEditor=this._bPage.findBlockInside("m-editor"),this._localStorage=BEM.blocks["mi-storage"],this.bindTo("click",this._onClick.bind(this)),this.bindToDoc("keyup",this._closeOnESC.bind(this))}},_onClick:function(){return this._bEditor._localStorageOverdraft?(confirm(BEM.I18N("b-editor-close-button","cant_save_draft"))&&(this._bEditor._storageOverdraft=!1,this._closeEditor()),void 0):(this._bEditor._isDraftExist()?confirm(BEM.I18N("b-editor-close-button","want_to_close"))&&this._closeEditor():this._closeEditor(),void 0)},_closeOnESC:function(t){var e=this._bPage.findBlockInside({block:"popup",modName:"editor",modVal:"yes"});27===t.keyCode&&(this._bPage.hasMod("editor")||this._bPage.hasMod("new-page"))&&(e&&e._isShown||this._onClick())},_closeEditor:function(){this._bEditor._close(),!this._bPage.hasMod("special")&&this._localStorage.getItem("wiki-sidebar")?this._bSidebar.refreshSidebarContent():this._togglerButton.delMod("checked"),keymaster.unbind("ctrl+enter, command+enter"),this._bEditor._deleteDraft()}}),BEM.DOM.decl("b-editor-save-button",{onSetMod:{js:function(){this._button=this.findBlockOn("button"),this._bPage=this.findBlockOutside("b-page"),this._bTitle=this._bPage.findBlockInside("b-page-title"),this._buttonOpen=this._bPage.findBlockInside("b-editor-open-button"),this._bEditor=this._bPage.findBlockInside("m-editor"),this._pageTitle=this._bPage.findBlockInside({block:"m-replacer",modName:"type",modVal:"page-title"}),this._getMainDoc(),this._spinner=this._bPage.findBlockInside({block:"spin",modName:"editor",modVal:"save"}),this._closeButton=this._bPage.findBlockInside("b-editor-close-button").findBlockOn("button"),this._editorActions=this._bPage.findBlockInside("b-editor-actions").findBlockOn("radio-button"),this._sidebar=this._bPage.findBlockInside("b-sidebar"),this.bindTo("click",this._onClick.bind(this)),this._buttonOpen._saveButton||(keymaster.unbind("ctrl+enter, command+enter"),keymaster("ctrl+enter, command+enter",this._onClick.bind(this)))}},_getMainDoc:function(){return this._bContent=this._bPage.findBlockInside("b-content").findBlockInside({block:"wiki-doc",modName:"status",modVal:"main"})},_onClick:function(){this._urlParams=WikiHistory._parseQueryParams(),this._status=this.getMod("status"),this._showSpinner(),this._savePage(),this._disableElements()},_showSpinner:function(){this._spinner.setMod("show","yes"),this._spinner.setMod("progress","yes")},_hideSpinner:function(){this._spinner.setMod("show","no"),this._spinner.delMod("progress")},_savePage:function(){var t="",e={body:this._bEditor.getEditorData(),title:this._pageTitle.getValue(),page_type:"article"};this._urlParams&&this._urlParams.section&&(e.section_id=this._urlParams.section),"create"===this._status&&(t=this._subpageBlock.elem("control").val()),BEM.create("api-request",{_:"api-response",apiPath:t,method:"POST",data:e,urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(this._onSaveData.bind(this),this._onPageSaveError.bind(this))},_redefineWikiDoc:function(t){BEM.DOM.replace(this._getMainDoc().domElem,BEMHTML.apply(t.data.bemjson)),this._getMainDoc(),this._sidebar.refreshSidebarToc(t)},_updateDocumentContent:function(t,e){var i;"wiki-doc"===t.data.bemjson.block?(t.data.bemjson.mods=t.data.bemjson.mods||{},t.data.bemjson.mods.status="main",i=this._bContent.findBlockOn({block:"wiki-change",modName:"type",modVal:"doc"}),i?i._disconnect(function(){i.destruct(!0),this._redefineWikiDoc(t),e()}.bind(this)):(this._redefineWikiDoc(t),e())):BEM.DOM.update(this._bContent.domElem,BEMHTML.apply(t.data.bemjson),e)},_onSaveData:function(t){"edit"===this._status?this._updateDocumentContent(t,function(){document.title=(t.data.title||BEM.I18N("b-editor-save-button","page_title_prefix"))+" @ Wiki",this._bTitle.domElem.html(t.data.title),this._bPage.highLightCode(),BEM.blocks["i-explainer"].explainAllLinks(this._bPage),this._bEditor._deleteDraft(),this._bPage.delMod("editor"),this._bPage.setMod("revision",""),this._hideSpinner(),this._enableElements(),WikiHistory._clearUrl(),jsMath.Process(),this._bPage.findBlockInside("b-events-log").inited=!1,this._sidebar.refreshSidebarContent(),keymaster.unbind("ctrl+enter, command+enter")}.bind(this)):this._redirectOnSave(t)},_redirectOnSave:function(t){window.location.pathname=t.data.supertag},_disableElements:function(){this._button.setMod("disabled","yes"),this._closeButton.setMod("disabled","yes"),this._editorActions.setMod("disabled","yes")},_enableElements:function(){this._button.delMod("disabled"),this._closeButton.delMod("disabled"),this._editorActions.delMod("disabled")},_onPageSaveError:function(t){this._hideSpinner(),this._button.delMod("disabled"),this.channel("errors").trigger("error",this._getErrorData(t.message))},_getErrorData:function(t){return{node:this.domElem,content:{head:BEM.I18N("b-editor-save-button","cant_save_page"),body:t}}}}),function(t,e){t.DOM.decl("radiobox",{onSetMod:{js:function(){var t=this;t._val=t.findElem(t.elem("radio","checked","yes"),"control").val(),t.elem("control").each(function(e,i){var n=[];if(t._isControlFocused($(i))&&n.push("focused"),i.checked&&n.push("checked"),n[0]){var s=t.__self._getRadioByElem($(i));n.forEach(function(e){t.setMod(s,e,"yes")})}})},disabled:{yes:function(){this.setMod(this.elem("radio"),"disabled","yes")},"":function(){this.delMod(this.elem("radio"),"disabled")}}},onElemSetMod:{radio:{focused:{yes:function(t){this.delMod(this.elem("radio","focused","yes"),"focused");var e=this.findElem(t,"control");this._isControlFocused(e)||e.focus(),this.afterCurrentEvent(function(){this.trigger("focus",{current:t})})},"":function(t){this.afterCurrentEvent(function(){this.trigger("blur",{prev:t})})}},checked:{yes:function(t){this._val=this.findElem(t,"control").prop("checked",!0).val();var e=this.elem("radio","checked","yes");this.delMod(e,"checked"),this.trigger("change",{current:t,prev:e})}},hovered:function(t){return!this.isDisabled(t)},disabled:function(t,e,i){t.find(this.buildSelector("control")).prop("disabled","yes"===i)}}},_isControlFocused:function(t){try{return t[0]===this.__self.doc[0].activeElement}catch(e){return!1}},isDisabled:function(t){return this.hasMod(t,"disabled","yes")},val:function(t){if("undefined"==typeof t)return this._val;var e=this;return this.elem("control").each(function(i,n){return n.value===t?(e.setMod(e.__self._getRadioByElem($(n)),"checked","yes"),!1):void 0}),e},getCurrent:function(){return this.findElem("radio","checked","yes")},uncheckAll:function(){var t=this.elem("radio","checked","yes");return this.delMod(t,"checked").findElem(t,"control").prop("checked",!1),this._val=e,this.trigger("change",{current:e,prev:t}),this},_onLeftClick:function(t){this.isDisabled(t.data.domElem)||this.setMod(t.data.domElem,"focused","yes")},_onChange:function(t){this.setMod(this.__self._getRadioByElem(t.data.domElem),"checked","yes")}},{live:function(){return this.liveBindTo("radio","leftclick tap",function(t){this._onLeftClick(t)}).liveBindTo("control","change",function(t){this._onChange(t)}).liveBindTo("radio","mouseover mouseout",function(t){this.setMod(t.data.domElem,"hovered","mouseover"===t.type?"yes":"")}).liveBindTo("control","focusin focusout",function(t){this.setMod(this.__self._getRadioByElem(t.data.domElem),"focused","focusin"===t.type?"yes":"")}),!1},_getRadioByElem:function(t){return t.closest(this.buildSelector("radio"))}})}(BEM),function(t){t.DOM.decl({block:"radio-button",baseBlock:"radiobox"},{onElemSetMod:{radio:{checked:function(t,e,i){this.__base.apply(this,arguments),this.setMod(t,"pressed",i)},"next-for-pressed":{yes:function(){this.delMod(this.elem("radio","next-for-pressed","yes"),"next-for-pressed")}},pressed:{yes:function(t){this.delMod(this.elem("radio"),"pressed").setMod(t.next(),"next-for-pressed","yes")},"":function(t){this.delMod(t.next(),"next-for-pressed")}}}},_onMouseDown:function(t){var e=t.data.domElem;this.isDisabled(e)||this.hasMod(e,"checked","yes")||(this.setMod(e,"pressed","yes"),this.bindToDoc("mouseup touchend",function(t){this.afterCurrentEvent(function(){var i=this.findElem(e,"control");i.prop("checked")||(e.find(t.target).add(e).length?i.trigger("change").focus():this.delMod(e,"pressed").setMod(this.elem("radio","checked","yes"),"pressed","yes"))}),this.unbindFromDoc("mouseup touchend")}))}},{live:function(){return this.__base.apply(this,arguments),this.liveBindTo("radio","mousedown",function(t){this._onMouseDown(t)}),!1}})}(BEM),BEM.blocks["mi-helpers"]={getDateFromHumanString:function(t){var e,i=Math.abs(~t.search(/\./)||~t.search("Z")),n=t;return n=n.replace(/-/g,",").replace("T",",").replace(/:/g,","),n=i?n.substr(0,i-1):n,n=n.split(","),n[1]=n[1]-1,e=new Date(n[0],n[1],n[2]),n[3]&&e.setHours(n[3]),n[4]&&e.setMinutes(n[4]),n[5]&&e.setSeconds(n[5]),e},getHumanStringFromDate:function(t){var e,i,n,s,o,r,a,l;return t&&t.date?(i=t.date,n=i.getFullYear(),s=(i.getMonth()+1).toString(),o=i.getDate().toString(),r=i.getHours().toString(),a=i.getMinutes().toString(),l=i.getSeconds().toString(),1===s.length&&(s="0"+s),e=n+"-"+s,t.needDay!==!1&&(1===o.length&&(o="0"+o),e=e+"-"+o,t.needHours&&(1===r.length&&(r="0"+r),e=e+"T"+r,t.needMinutes&&(1===a.length&&(a="0"+a),e=e+":"+a,t.needSeconds&&(1===l.length&&(l="0"+l),e=e+":"+l)))),e):null},validateNumberOnlyInput:function(t){var e=$(t.target),i=e.val(),n=/\d+(?:[.,]{0,1}\d{0,})/.exec(i);n?e.val(n[0]):e.val(i.slice(0,-1))}},function(t){"function"==typeof define&&define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t:t(jQuery)}(function(t){function e(e){var s,o=e||window.event,r=[].slice.call(arguments,1),a=0,l=0,c=0,d=0,u=0;return e=t.event.fix(o),e.type="mousewheel",o.wheelDelta&&(a=o.wheelDelta),o.detail&&(a=-1*o.detail),o.deltaY&&(c=-1*o.deltaY,a=c),o.deltaX&&(l=o.deltaX,a=-1*l),void 0!==o.wheelDeltaY&&(c=o.wheelDeltaY),void 0!==o.wheelDeltaX&&(l=-1*o.wheelDeltaX),d=Math.abs(a),(!i||i>d)&&(i=d),u=Math.max(Math.abs(c),Math.abs(l)),(!n||n>u)&&(n=u),s=a>0?"floor":"ceil",a=Math[s](a/i),l=Math[s](l/n),c=Math[s](c/n),r.unshift(e,a,l,c),(t.event.dispatch||t.event.handle).apply(this,r)}var i,n,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],o="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"];if(t.event.fixHooks)for(var r=s.length;r;)t.event.fixHooks[s[--r]]=t.event.mouseHooks;t.event.special.mousewheel={setup:function(){if(this.addEventListener)for(var t=o.length;t;)this.addEventListener(o[--t],e,!1);else this.onmousewheel=e},teardown:function(){if(this.removeEventListener)for(var t=o.length;t;)this.removeEventListener(o[--t],e,!1);else this.onmousewheel=null}},t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}),BEM.DOM.decl("b-sidebar",{onSetMod:{js:function(){var t=this;this._sidebarTop=this.domElem.offset().top,this.bPage=BEM.blocks["i-global"].getbPage(),this._bContent=this.bPage.findBlockInside("b-content"),this.bPanel=this.bPage.findBlockInside("b-panel"),this._togglerButtonHolder=this.bPanel.findBlockInside("b-check-button-holder"),this.bTabbedPane=this.findBlockInside("b-tabbed-pane"),this._bPageUser=this.bPage.findBlockInside("b-page-user")||this.bPage.findBlockInside("b-page-official"),this._filesBlock=this.bPage.findBlockInside("b-files2"),this._eventsBlock=this.bPage.findBlockInside("b-events-log"),this._clusterTreeBlock=this.bPage.findBlockInside("b-cluster-tree"),this._getRadioGroup(),this._openSidebarTab()||this._setCurrentPanel(),this._scrollToDocBind(),this.togglerButton=this.bPanel.findBlockInside({block:"check-button",modName:"toggler",modVal:"sidebar"}),this.togglerButton.on("change",this.toggleSidebar,this),this.bindToDoc("scroll",this._lockOnScroll,this),this._localStorage=BEM.blocks["mi-storage"],!this.bPage.hasMod("special")&&this._localStorage.getItem("wiki-sidebar")?(this.togglerButton.setMod("checked","yes"),this.togglerButton.delMod("pressed")):this.bPage.delMod("animation"),this._lockUnlockPageScroll(),setTimeout(function(){t._radio.on("change",t._onRadioButtonPress,t)},0),this._closeAllPanelsListener()}},_closeAllPanelsListener:function(){this.on("clearPanels",function(){this.findBlocksInside("b-sidebar-panel").forEach(function(t){t.delMod("visibility")})},this)},_lockUnlockPageScroll:function(){var t=this;this.bindTo("mouseover",function(){t._mouseOver||(t._mouseOver=!0,t.bPage.setMod("scroll","lock"))}),this.bindTo("mouseout",function(){t._mouseOver=!1,t.bPage.delMod("scroll")}),BEM.channel("sidebar").on("close",function(){t._mouseOver=!1,t.bPage.delMod("scroll")})},_getSidebarPanelsType:function(){return this.bPage.hasMod("editor")?"edit":"view"},_getRadioGroup:function(){this._radio=this.bPage.hasMod("editor")?this.findBlockInside({block:"radio-button",modName:"status",modVal:"edit"}):this.findBlockInside({block:"radio-button",modName:"status",modVal:"view"})},_closeAllPanels:function(){this.findBlocksInside("b-sidebar-panel").forEach(function(t){t.delMod("visibility")})},_setCurrentPanel:function(){var t=this.findBlockInside({block:"b-sidebar-panel",modName:"type",modVal:this._getSidebarPanelsType()});t.setMod("visibility","yes"),this._radio.val(t.getMod("action"))},_onRadioButtonPress:function(){switch(this._getRadioGroup(),this._radio.val()){case"files":this._filesBlock._onFilesButtonClick();break;case"events":this._eventsBlock.initBlock();break;case"cluster-tree":this._clusterTreeBlock.initBlock()}},_lockOnScroll:function(){window.scrollY>=this._sidebarTop?this.hasMod("locked")||this.setMod("locked","yes"):this.delMod("locked")},_openSidebar:function(t){this.togglerButton.setMod("checked","yes"),this.togglerButton.trigger("change"),BEM.channel("sidebar").trigger("open"),t&&this._radio.val(t)},_showCurrentPanel:function(){this.findBlockInside({block:"b-sidebar-panel",modName:"action",modVal:this._radio.val()}).setMod("visibility","yes")},toggleSidebar:function(){var t=this;this.togglerButton.hasMod("checked","yes")?(this.bPage.setMod("show","sidebar"),BEM.DOM.append(this.elem("switch"),this.togglerButton.domElem),this._localStorage.setItem("wiki-sidebar","true"),this.refreshSidebarContent(),this.bPage.hasMod("animation")&&setTimeout(function(){t.bPage.delMod("animation")},0),this._bContent.setMod("close","wiki-toc"),BEM.channel("sidebar").trigger("open"),this._isOpen=!0):(this.togglerButton.delMod("focused"),this.bPage.delMod("show"),this._togglerButtonHolder.containsDomElem(this.domElem)||(this.bPage.hasMod("page-info")?BEM.DOM.before(this._bPageUser.domElem,this.togglerButton.domElem):BEM.DOM.append(this._togglerButtonHolder.domElem,this.togglerButton.domElem)),this._localStorage.removeItem("wiki-sidebar"),this._bContent.delMod("close"),BEM.channel("sidebar").trigger("close"),this._isOpen=!1)},refreshSidebarContent:function(t){this.trigger("clearPanels"),this._onRadioButtonPress(),t?this._setCurrentPanel():this._showCurrentPanel()},refreshSidebarToc:function(t){t.data.toc.content[0].mods={type:"sidebar"},BEM.DOM.update(this.findBlockInside("b-toc").domElem,BEMHTML.apply(t.data.toc))},_scrollToDocBind:function(){this.bindToDoc("scroll.sidebar",this.setSidebarTopPosition)},_getPanelBottomOffset:function(){return this.bPanel.domElem.offset().top-BEM.DOM.win.scrollTop()+this.bPanelHeight},setSidebarTopPosition:function(){return this.domElem.css("top",this._getPanelBottomOffset()),!1},_openSidebarTab:function(){function t(t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var e=new RegExp("[\\?&]"+t+"=([^&#]*)"),i=e.exec(location.search);return null==i?"":decodeURIComponent(i[1].replace(/\+/g," "))}var e=t("sidetab");return e&&this._radio.val(e),e},onURL:function(){this.bPage.setMod("show","sidebar"),this.togglerButton.setMod("checked","yes")}}),BEM.DOM.decl("b-tabbed-pane",{onSetMod:{js:function(){this._enableTabs()}},onElemSetMod:{panel:{state:{current:function(t){if(-1!==this.getPanel().index(t)){this.currentPanel=t;var e=this.getPanel("state","current");this.delMod(e,"state").trigger("current",{prev:e,current:t})
}}}},tab:{state:{current:function(t){if(-1!==this.getTab().index(t)){this.currentTab=t;var e=this.getTab("state","current");this.delMod(e,"state")}}}}},getPanels:function(){return this.domElem.filter(this.buildSelector("panels"))},getPanel:function(t,e){return this.getPanels().children(this.buildSelector("panel",t,e))},getTabs:function(){return this.domElem.filter(this.buildSelector("tabs"))},getTab:function(t,e){return this.findElem(this.getTabs(),"tab",t,e)},getPanelByTab:function(t){return this.getPanel().eq(this.getTab().index(t))},getTabByPanel:function(t){return this.getTab().eq(this.getPanel().index(t))},_enableTabs:function(t){return BEM.blocks["b-menu"][t===!1?"liveCtxUnbind":"liveCtxBind"](this.getTabs(),"current",this._onSelectTab,this),this},_onSelectTab:function(t,e){this.selectByIndex(e.current?this.getTab().index(e.current):-1)},selectByIndex:function(t){if(t>=0){var e=this.getTab().eq(t);this._enableTabs(!1).setMod(e,"state","current").findBlockOn(this.getTabs(),"b-menu").setMod(e,"state","current"),this.setMod(this.getPanel().eq(t),"state","current")._enableTabs()}else{this.delMod(this.getTab("state","current"),"state").delMod(this.getPanel("state","current"),"state");var i=this.findBlockOn(this.getTabs(),"b-menu");i.delMod(i.elem("item"),"state")}},toggleByIndex:function(t){var e=this.getTab().eq(t);this._enableTabs(!1).toggleMod(e,"state","current","").findBlockOn(this.getTabs(),"b-menu").toggleMod(e,"state","current",""),this.toggleMod(this.getPanel().eq(t),"state","current","")._enableTabs()},destruct:function(){this._enableTabs(!1).__base.apply(this,arguments)}},{live:function(){this.liveInitOnBlockInit("b-menu")}}),BEM.DOM.decl("b-menu",{onElemSetMod:{trigger:{state:function(t,e,i){this.toggleMod(this.findElem(t.closest(this.buildSelector("layout-vert-cell")),"item-content").eq(0),"visibility","visible","opened"==i).trigger("trigger",{domElem:t,state:i})}},item:{state:{current:function(t){var e=this,i=e.__self.getName(),n=e.elem("item","state","current").filter(function(){return $(this).closest(e.buildSelector()).bem(i)===e});e.findElem(t.parents(e.buildSelector("item-content")).prev(e.buildSelector("item")),"trigger").each(function(){e.setMod($(this),"state","opened")}),e.delMod(n,"state").trigger("current",{prev:n,current:t})}}}},onTriggerClick:function(t){t.preventDefault(),this.toggleMod(t.data.domElem,"state","opened")},onItemSelectorClick:function(t){var e=this._getItemByEvent(t);this.hasMod(e,"state","disabled")||this.setMod(e,"state","current")},_getItemByEvent:function(t){return t.data.domElem.closest(this.buildSelector("item"))}},{live:function(){this.liveBindTo("trigger","leftclick",function(t){this.onTriggerClick(t)}).liveBindTo("item-selector","leftclick",function(t){this.onItemSelectorClick(t)})}}),function(t,e){var i="object"==typeof process?process.nextTick:t.setImmediate?t.setImmediate:t.postMessage?function(){var e="__bem"+ +new Date,i=function(t){t.data===e&&(t.stopPropagation&&t.stopPropagation(),s())};return t.addEventListener?t.addEventListener("message",i,!0):t.attachEvent("onmessage",i),function(i){1===n.push(i)&&t.postMessage(e,"*")}}():"onreadystatechange"in t.document.createElement("script")?function(){var e=function(){var e=document.createElement("script");e.onreadystatechange=function(){e.parentNode.removeChild(e),e=e.onreadystatechange=null,s()},(t.document.documentElement||t.document.body).appendChild(e)};return function(t){1===n.push(t)&&e()}}():function(t){setTimeout(t,0)},n=[],s=function(){var t=n,e=0,i=n.length;for(n=[];i>e;)t[e++]()},o={_:{nextTick:function(t,n){i(t.bind(n||e.blocks["i-handler"]))},unique:function(t){for(var e=[],i=t.length;i--;)e.indexOf(t[i])<0&&e.push(t[i]);return e}}};e.decl("i-handler",o,o)}(this,BEM),function(t,e){e.decl({block:"i-handler__response",baseBlock:"i-handler"},{onSetMod:{js:{inited:function(){this._processor=this.params.processor}}},run:function(){throw"not implemented"},_runHandler:function(t,e){return this._processor.runHandler(t,e,this.__self.getName())},_releaseHandler:function(t){this._processor.releaseHandler(t,this.__self.getName())},getDefaultParams:function(){return{}}},{isBulk:function(){return!1},mergeParams:function(){throw"not implemented"},getFutureHandlers:function(){return[]}})}(this,BEM,Vow),function(t,e,i){function n(t){for(var e,i=0;e=o[i++];)if(e.key===t)return e}function s(t){return 1===o.push(t)}var o=[];e.decl({block:"i-handler__request",baseBlock:"i-handler"},{abortRequest:function(){return this.__self._ajaxRequest.abort(),this.__self._ajaxRequest},run:function(){if(this._promise)return this._promise;var t;if(this.isCacheable()){var e=n(t=this.getKey());if(e)return this._promise=e.block._promise}else t="__";var o=i.promise(),r=s({block:this,key:t});return"api-response"===this.params._?this.__self._doRequest.bind(this.__self)():r&&this._.nextTick(this.__self._doRequest,this.__self),this._promise=o},getKey:function(){var t=[];return[this.__self.getName(),JSON.stringify(this.params,function(e,i){if("object"==typeof i){if(~t.indexOf(i))return"[Circular]";t.push(i)}return i})].join("")},isCacheable:function(){return!0},postProcess:function(t){return t}},{_getQueuedHandlers:function(){var t=o;return o=[],t},_doRequest:function(){throw"not implemented"},_onRequestDone:function(t,e){t.forEach(function(t,i){var n=e[i].error,s=t.block;"undefined"!=typeof n?(0===["{","["].indexOf(n.charAt(0))&&(n=JSON.parse(n)),s._promise.reject(n)):s._promise.fulfill(s.postProcess(e[i].data))})},_onRequestFailed:function(t,e){t.forEach(function(t){t.block._promise.reject(Error(e.statusText))})}})}(this,BEM,Vow),function(t,e,i){e.decl("i-handler__request",{},{_doRequest:function(){var t=this._getQueuedHandlers();this._ajaxRequest=i.ajax({url:this.getProviderUrl(),type:"POST",data:{handlers:JSON.stringify(t.map(function(t){return t.block.params}))},dataType:"json"}).then(this._onRequestDone.bind(this,t),this._onRequestFailed.bind(this,t))},getProviderUrl:function(){return"/"}})}(this,BEM,jQuery),function(t,e,i){var n=Array.prototype.concat;e.decl({block:"i-handler__processor",baseBlock:"i-handler"},{onSetMod:{js:{inited:function(){this._isRun=!1,this._inputHandlers=this.params.handlers,this._bulkHandlersMap=this._buildBulkHandlersMap()}}},run:function(){if(this._isRun)throw"already run";return this._isRun=!0,i.allResolved(this._inputHandlers.map(function(t){return this.runHandler(t._,t)},this)).then(function(t){return t.map(function(t){var e,i=t.valueOf();return e=t.isFulfilled()?{data:i}:i instanceof Error?{error:i.message}:"object"==typeof i?{error:JSON.stringify(i)}:{error:i.toString()}})})},runHandler:function(t,e,i){var n=this._bulkHandlersMap[t];if(n){n.params.push(e);var s=this._bulkHandlersMap[i];return(n.pendingCnt-=s?s.cnt:1)||this._runBulkHandler(t,n.params),n.promise}return this._runHandler(t,e)},releaseHandler:function(t,e){var i=this._getHandlerFutureBulkHandlers(t);this._bulkHandlersMap[t]&&i.push(t),i.forEach(function(t){var i=this._bulkHandlersMap[t],n=this._bulkHandlersMap[e];i.releasedFromBulkHandlers[e]||(i.releasedFromBulkHandlers[e]=!0,!(i.pendingCnt-=n?n.cnt:1)&&i.params.length&&this._runBulkHandler(t,i.params))},this)},_buildBulkHandlersMap:function(){return n.apply([],this._inputHandlers.map(function(t){return this._getHandlerFutureBulkHandlers(t._)},this)).reduce(function(t,e){return t[e]||(t[e]={pendingCnt:0,cnt:0,releasedFromBulkHandlers:{},params:[],promise:i.promise()}),++t[e].pendingCnt,++t[e].cnt,t},{})},_getResponseHandlerCls:function(t){var e=this.__self.blocks;return e[t]||e["i-handler__response"]},_getHandlerFutureBulkHandlers:function(t){var e,i,n=[],s=[],o=this._getResponseHandlerCls(t);for(o&&(s=o.getFutureHandlers());s.length;)i=this._getResponseHandlerCls(e=s.shift()),i.isBulk()&&n.push(e),s=s.concat(i.getFutureHandlers());return n},_runHandler:function(t,n){this.trigger("run",{handler:t,params:n});var s=this._getResponseHandlerCls(t);return i.promise(e.create(s.getName(),$.extend(n,{processor:this})).run()).then(function(e){return this.trigger("success",{handler:t,result:e}),e}.bind(this),function(e){throw this.trigger("fail",{handler:t,error:e}),e}.bind(this))},_runBulkHandler:function(t,e){var i=this._bulkHandlersMap[t];this._runHandler(t,this._getResponseHandlerCls(t).mergeParams(e)).then(function(t){i.promise.fulfill(t)},function(t){i.promise.reject(t)})}})}(this,BEM,Vow),BEM.decl({block:"api-request",baseBlock:"i-handler__request"},{postProcess:function(t){return t}},{getProviderUrl:function(){return"/handlers/"},_onRequestDone:function(t,e){t.forEach(function(t,i){var n=e[i].error,s=t.block;"undefined"!=typeof n?(0===["{","["].indexOf(n.charAt(0))&&(n=JSON.parse(n)),503==n.code&&BEM.channel("readonly").trigger("enable"),500==n.code&&Raven.captureException(n,{tags:{type:"ajax"},extra:{res:e[i]}}),s._promise.reject(n)):s._promise.fulfill(s.postProcess(e[i].data))})},_onRequestFailed:function(t,e){var i;switch(e.statusText){case"abort":i=!1;break;case"parsererror":break;case"timeout":break;default:i=!0}t.forEach(function(t){i&&t.block._promise.reject(Error(e.statusText))})}}),BEM.DOM.decl("b-comments2",{onSetMod:{js:function(){this.loaded=this.params.loaded,this.total=this.params.total,this.findBlockInside("b-comment2-create").on("addedComment",this._addedCommentHandler,this),this.bPage=this.findBlockOutside({block:"b-page",modName:"type",modVal:"article"})}},_addedCommentHandler:function(){this.loaded++,this.total++},_onMoreClick:function(){this.loaded||(this.loaded=this.params.loaded),this.findBlockInside("b-spin").setMod("progress","yes"),BEM.create("api-request",{_:"api-response",apiPath:".comments",path:WikiHistory._getCorrectPath(),urlParams:["format=json","start="+this.loaded,"limit=5"]}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this))},_getCommentsBEMJSON:function(t){var e,i=[];return this.total||(this.total=this.params.total),this.loaded=this.loaded+t.length,e=this.total-this.loaded,t.forEach(function(t){i.push({block:"b-comments2",elem:"item",content:{block:"b-comment2",content:[{elem:"head",content:[{elem:"user",content:{block:"b-user",url:"//staff.yandex-team.ru/"+t.user.login,content:t.user.login}},{elem:"date",content:{block:"m-date",timestamp:t.created_at}}]},{elem:"body",content:t.bemjson}]}})}),5>e&&(0>=e?BEM.DOM.destruct(this.elem("more-link")):this.elem("more-link").text(BEM.I18N("b-comments2","more")+e+BEM.I18N("b-comments2","comments"))),i},_onGotData:function(t){this.findBlockInside("more","b-spin").delMod("progress"),BEM.DOM.append(this.elem("list"),BEMHTML.apply(this._getCommentsBEMJSON(t.data.data)))},_onFailedData:function(t){this.findBlockInside("more","b-spin").delMod("progress"),this.channel("errors").trigger("error",this._getErrorData(t.message))},_getErrorData:function(t){return{node:this.elem("more-link"),content:{head:BEM.I18N("b-comments2","cant_load_comments"),body:t}}},onURL:function(){var t=0,e=(this.bPage.findBlockInside("b-sidebar"),this.findBlockOutside("mi-sticky-list").elem("blocks-wrapper"));bCommentsIndex=this.domElem.index(),parentBlock=this.domElem.parent(),blocksAbove=parentBlock.find(".mi-sticky-list-block:lt("+bCommentsIndex+")"),this.bPage.setMod("show","sidebar"),blocksAbove.each(function(){t+=$(this).outerHeight(!0)}),e.scrollTop(t)}},{live:function(){this.liveBindTo("more-link","click",function(){this._onMoreClick()})}}),BEM.DOM.decl("b-spin",{onSetMod:{js:function(){this._size=this.getMod("size")||/[\d]+/.exec(this.getMod("theme"))[0],this._bgProp="background-position",this._posPrefix="0 -",this.elem("icon").css("background-position-y")&&(this._bgProp="background-position-y",this._posPrefix="-"),this._curFrame=0,this.hasMod("progress")&&this.channel("sys").on("tick",this._onTick,this)},progress:{yes:function(){this.channel("sys").on("tick",this._onTick,this)},"":function(){this.channel("sys").un("tick",this._onTick,this)}}},_onTick:function(){var t=++this._curFrame*this._size;t>=36*this._size&&(this._curFrame=t=0),this.elem("icon").css(this._bgProp,this._posPrefix+t+"px")},destruct:function(){this.channel("sys").un("tick",this._onTick,this),this.__base.apply(this,arguments)}}),BEM.DOM.decl("b-comment2-create",{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),this.bComments=this.findBlockOutside("b-comments2"),this.bButton=this.findBlockInside("button"),this.bSpin=this.findBlockInside("b-spin"),this.bindTo("submit",this._submitHandler),this.findBlockInside("input").bindTo("control","keyup",this._enableButton)}},_submitHandler:function(){var t={body:this.findBlockInside("input").elem("control").val()};return this.bSpin.setMod("progress","yes"),this.bButton.setMod("disabled","yes"),BEM.create("api-request",{_:"api-response",apiPath:".comments",method:"POST",data:t,urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(this._onGetData.bind(this),this._onDataError.bind(this)),!1},_onGetData:function(t){var e=this.findBlockOutside("b-comments2").elem("list"),i=this._newCommentHTML(t);this.trigger("addedComment"),this.bSpin.delMod("progress"),BEM.DOM.prepend(e,i),this._increaseCommentsCount(),this.domElem[0].reset()},_onDataError:function(t){this.bSpin.delMod("progress"),this.channel("errors").trigger("error",this._getErrorData(t.message))},_getErrorData:function(t){return{node:this.bButton.domElem,content:{head:BEM.I18N("b-comment2-create","cant_send_comment"),body:t}}},_newCommentHTML:function(t){return BEMHTML.apply({block:"b-comments2",elem:"item",content:{block:"b-comment2",content:[{elem:"head",content:[{elem:"user",content:{block:"b-user",mix:[{block:"mi-staff-card",js:{user:t.user.login}}],url:"//staff.yandex-team.ru/"+t.user.login,content:t.user.login}},{elem:"date",content:{block:"m-date",timestamp:t.data.created_at}}]},{elem:"body",content:t.data.bemjson}]}})},_enableButton:function(){var t=this.findBlockOutside("b-comment2-create").findBlockInside("button");this.val().replace(" ","").length>0?t.delMod("disabled"):t.setMod("disabled","yes")},_increaseCommentsCount:function(){BEM.DOM.update(this.bComments.elem("num"),parseInt(this.bComments.elem("num").text(),10)+1)}},{}),BEM.DOM.decl("b-files2",{onSetMod:{js:function(){this._FilesGetLimit=10,this._FilesStart=0,this._spinner=this.findBlockInside({block:"spinner",modName:"type",modVal:"sidebar-files"})}},_onFilesButtonClick:function(){this._onceClicked||this._getFiles()},_getFiles:function(){this.loaded||(this.loaded=this.params.loaded),this.bPage||(this.bPage=this.findBlockOutside({block:"b-page",modName:"type",modVal:"article"})),this._onceClicked=!0,this._spinner.setMod("progress","yes"),BEM.create("api-request",{_:"api-response",apiPath:".files",path:WikiHistory._getCorrectPath(),urlParams:["format=json","start="+this._FilesStart,"limit="+this._FilesGetLimit]}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this))},_getFilesBEMJSON:function(t){var e,i=[];return this._FilesStart+=t.length,e=this.params.total-this.loaded,t.forEach(function(t){i.push({block:"b-files2",elem:"item",mix:[{block:"b-file-wrapper"}],content:{block:"b-file2",js:{url:t.url},content:[{elem:"preview",content:function(){return{block:"awesome-icon",mods:{icon:"file-alt"}}}()},{elem:"name",content:[{block:"link",url:t.docviewer_url||"#",attrs:{target:t.docviewer_url?"_blank":"_self",title:t.name},content:[{block:"b-file2",elem:"text",content:t.name.split(".").shift()},{block:"b-file2",elem:"ext",content:"."+t.name.split(".").pop()}]},{elem:"description",content:[{block:"b-user",mix:[{block:"mi-staff-card",js:{user:t.user_name}}],url:"http://staff.yandex-team.ru/"+t.user_name,content:t.user_name+"@"},", ",{block:"b-file2",elem:"date",timestamp:t.upload_date}]}]},{elem:"size",content:t.size+" MB"}]}})}),5>e&&(0>=e?BEM.DOM.destruct(this.elem("more-link")):this.elem("more-link").text(BEM.I18N("b-files2","more")+" "+e+" "+BEM.I18N("b-files2","files_text"))),i},_onGotData:function(t){this._spinner.delMod("progress"),this.elem("more").show(),this._addFilesToDom(t.data),this.trigger("filesLoaded")},_addFilesToDom:function(t,e){var i=this.elem("list"),n=BEMHTML.apply(this._getFilesBEMJSON(t.data));"prepend"===e?BEM.DOM.prepend(i,n):BEM.DOM.append(i,n),t.total-this._FilesStart||this.elem("more").hide(),this.elem("more-link-number").html(t.total-this._FilesStart)},_onFailedData:function(t){this.findBlockInside("more","b-spin").delMod("progress"),this.channel("errors").trigger("error",this._getErrorData(t.message))},_getErrorData:function(t){return{node:this.elem("more-link"),content:{head:BEM.I18N("b-files2","cant_load_files"),body:t}}},onURL:function(){var t=0,e=this.bPage=this.findBlockOutside({block:"b-page",modName:"type",modVal:"article"}),i=(this.bPage.findBlockInside("b-sidebar"),this.findBlockOutside("mi-sticky-list").elem("blocks-wrapper"));bCommentsIndex=this.domElem.index(),parentBlock=this.domElem.parent(),blocksAbove=parentBlock.find(".mi-sticky-list-block:lt("+bCommentsIndex+")"),e.setMod("show","sidebar"),blocksAbove.each(function(){t+=$(this).outerHeight(!0)}),i.scrollTop(t)}},{live:function(){this.liveBindTo("more-link","click",function(){this._getFiles()})}}),BEM.DOM.decl("b-file2",{onSetMod:{js:function(){this.__self._bFiles||(this.__self._bFiles=this.findBlockOutside("b-files2")),this.bindTo("click",this._onClick)}},_onClick:function(){var t;this._isLocked||(t=this.findBlockOutside("b-file-wrapper"),t.hasMod("active","yes")?(t.delMod("active"),this.__self.fileButtons.domElem.hide()):(this.__self._deactiveItems(),t.setMod("active","yes"),this._setFileButtons()))},_setFileButtons:function(){var t;this.__self.fileButtons?(BEM.DOM.append(this.domElem,this.__self.fileButtons.domElem),this.__self.fileButtons.domElem.show(),this.__self.fileButtons.findBlockInside(this.__self.fileButtons.elem("download"),"link").domElem.prop("href",this.params.url+"?download=1")):(t=BEMHTML.apply({block:"b-file-buttons",content:[{elem:"download",attrs:{title:BEM.I18N("b-file2","icon_upload")},content:{block:"link",url:this.params.url+"?download=1",content:{block:"awesome-icon",mods:{icon:"download-alt"}}}},{elem:"remove",attrs:{title:BEM.I18N("b-file2","icon_remove")},mix:[{block:"b-readonly-item",js:!0}],content:{block:"awesome-icon",mods:{icon:"trash"}}}]}),BEM.DOM.append(this.domElem,t),this.__self.fileButtons=this.findBlockInside("b-file-buttons"),this.bindToDomElem(this.__self.fileButtons.elem("remove"),"click",this._removeFile))},_removeFile:function(){this._isLocked=!0,BEM.create("api-request",{_:"api-response",method:"DELETE",apiPath:"",path:this.params.url,urlParams:!1}).run().then(this._onFileRemove.bind(this),this._onFileRemoveError.bind(this))},_onFileRemove:function(){BEM.DOM.destruct(this.domElem),delete this._isLocked,delete this.__self.fileButtons},_onFileRemoveError:function(t){console.log(t)}},{_deactiveItems:function(){var t=this._bFiles.findBlockInside({block:"b-file-wrapper",modName:"active",modVal:"yes"});t&&t.delMod("active")}}),BEM.DOM.decl("m-uploader",{onSetMod:{js:function(){this.files=this.__self.getFiles(),this.summary=this.__self.getSummary(),this.popup=this.__self.getPopup(this.params),this.box=this.popup.findBlockInside("uploader-box"),this.info=this.__self.getInfo(),this.dragFlag=!0,this._initParams(),this._bind(),this.__self.checkBind()&&(this._bindPopup(),this._infoDrag(),this._initParamsPopup())}},_initParamsPopup:function(){this.params.autoupload&&"yes"===this.params.autoupload?this.params.autoupload=!0:(this.params.autoupload=!1,this.readyForUpload=this.__self.getFilesList())},_initParams:function(){this.params.choosefile="no"===this.params.choosefile?!1:!0,this.params.dropzone=this.params.dropzone&&"no"===this.params.dropzone?!1:!0},getSummary:function(){return this.summary},getFiles:function(){return Object.keys(this.files).map(function(t){return this.files[t]},this)},sendFiles:function(){this.readyForUpload.forEach(function(t){this._send(t)}.bind(this)),this.readyForUpload=this.__self.getFilesList()},uploadsAbort:function(){Object.keys(this.files).forEach(function(t){"uploading"===this.files[t].status&&(this.files[t].req.abort(),this.files[t].status="aborted",BEM.DOM.destruct(this.files[t].node.domElem),delete this.files[t],this.trigger("uploadabort"))},this),this.trigger("uploadsabort")},_bindRow:function(t){this.files[t].node.findElem("abort").on("click",function(e){e.stopPropagation(),this.files[t].req&&this.files[t].req.abort(),BEM.DOM.destruct(this.files[t].node.domElem),delete this.files[t],this.trigger("uploadabort",t)}.bind(this))},_infoDrag:function(){function t(t){var e=t.get(0).getBoundingClientRect(),i=document.body,n=document.documentElement,s=window.pageYOffset||n.scrollTop||i.scrollTop,o=window.pageXOffset||n.scrollLeft||i.scrollLeft,r=n.clientTop||i.clientTop||0,a=n.clientLeft||i.clientLeft||0,l=e.top+s-r,c=e.left+o-a;return{top:Math.round(l),left:Math.round(c)}}var e=this.info.domElem,i=this.info.findElem("box");i.on("dragstart",function(){return!1}),i.on("mousedown",function(n){{var s=t(i),o=t(e),r=n.pageX-s.left;n.pageY-s.top}return document.onmousemove=function(t){var n=t.pageX-r-o.left,s=e.width()-i.width();0>n&&(n=0),n>s&&(n=s),i.css("left",n+"px")},document.onmouseup=function(){document.onmousemove=document.onmouseup=null},!1})},_bindPopup:function(){var t=this,e=this.info,i=this.box.findElem("drop-popup"),n=this.box.findBlockInside("attach"),s=this.box.findBlockInside({block:"button",modName:"type",modVal:"start-upload"}),o=this.box.findBlockInside({block:"button",modName:"type",modVal:"abort-uploads"}),r=this.box.findBlockInside({block:"button",modName:"type",modVal:"clear-list"}),a=this.box.findBlockInside({block:"button",modName:"type",modVal:"close"});n&&n.on("change",function(){t._prepareData(n.findElem("control")[0])}),!this.params.autoupload&&s&&s.bindTo("click",this.sendFiles.bind(t)),a&&a.bindTo("click",function(){t._clearList.apply(t),t.popup.hide()}),o&&o.bindTo("click",this.uploadsAbort.bind(this)),r&&r.bindTo("click",this._clearList.bind(this)),i.on("drop",function(e){e.preventDefault();var n=e.originalEvent.dataTransfer;t.delMod(i,"is"),t.box.delMod(i,"is"),t._prepareData(n)}).on("dragover",function(t){t.preventDefault()}),this.box.domElem.on("dragenter",function(){t.dragFlag&&(t.dragFlag=!1,t.box.setMod(i,"is","show"),t._unlockDrag())}),this.box.domElem.on("dragleave",function(){t.dragFlag&&(t.dragFlag=!1,t.box.delMod(i,"is"),t._unlockDrag())}),this.popup.on("hide",function(){t.summary.filesTotal&&e.setMod("is","show")}),e.findElem("box").on("dblclick",function(){t.popup.show(),e.delMod("is")})},_bind:function(){var t=this,e=this.findElem("drop-zone"),i=this.findBlockInside("attach");this.params.choosefile&&i.on("change",function(){t._prepareData(i.findElem("control")[0])}),this.params.dropzone&&e.on("dragenter dragleave",function(){t.dragFlag&&(t.dragFlag=!1,t.toggleMod(e,"is","hovered",""),t._unlockDrag())}).on("drop",function(i){i.preventDefault();var n=i.originalEvent.dataTransfer;t.delMod(e,"is"),t.box.delMod(e,"is"),t._prepareData(n)}).on("dragover",function(t){t.preventDefault()}),this.on("uploadabort uploadsabort filesready fileready uploadsuccess uploaderror clearlist",function(){t._updateSummary(),t._updateSummaryRow()}),this.on("progress drag",function(e,i){t._updateSummary(),t._updateSummaryRow(),t._progressUpdate(i)}),this.on("thumbready",function(e,i){var n=i.key;t.files[n].dataurl=i.dataurl,t.files[n].previewHeight=i.height,t.files[n].previewWidth=i.width,BEM.DOM.update(t.files[n].node.findElem("icon"),i.img)})},_unlockDrag:function(){setTimeout(function(){this.dragFlag=!0}.bind(this),0)},_clearList:function(){Object.keys(this.files).forEach(function(t){"uploading"!=this.files[t].status&&(this.files[t].hasOwnProperty("req")&&this.files[t].req.abort(),BEM.DOM.destruct(this.files[t].node.domElem),delete this.files[t])},this),this.trigger("clearlist")},_prepareData:function(t){if(t.files.length)this._handleFiles(t.files);else if(t.getData("text/html")&&t.getData("text/html").substr("img")){var e,i,n,s,o,r,a,l=this,c=t.getData("text/html"),d=new DOMParser,u=d.parseFromString(c,"text/html")||d.parseFromString(c,"text/xml"),h=$("img",u).attr("src"),p=";base64,";if(~h.indexOf(p)){e=h.split(p),i=e[0].split(":")[1],n=atob(e[1]),s=n.length,o=new Uint8Array(s);for(var m=0;s>m;++m)o[m]=n.charCodeAt(m);r=[new Blob([o],{type:i})],this._handleFiles(r)}else a=l.box.findElem("drop-popup"),$.ajax({type:l.params.ajaxType||"POST",url:this.params.url,data:h,beforeSend:function(){l.popup.show(),l.box.setMod(a,"is","waiting"),BEM.DOM.update(a,BEMHTML.apply(l._getSpin())),l.box.findBlockInside(a,"spin").setMod("progress","yes")},success:function(t){BEM.DOM.destruct(l.box.findBlockInside(a,"spin").domElem),l.box.delMod(a,"is"),l._handleFiles([JSON.parse(t)])}})}},_toBytes:function(t){var e=["kb","mb","gb"];return calc=t.value*Math.pow(1024,e.indexOf(t.prefix)+1)},_calculateStatus:function(t){var e="ready",i=this.params.fileLimit;return i&&t.size>this._toBytes(fileLim)?e="fileIsToLarge":t.hasOwnProperty("data")&&(e="done"),e},_handleFiles:function(t){{var e=this,i=Array.prototype.slice.apply(t);this.findElem("list")}this.popup.show(),this.info.hasMod("is","show")&&this.info.delMod("is"),i.forEach(function(t){var i=Object.keys(e.files).length,n="file_"+i,s=e._calculateStatus(t),o=BEMHTML.apply(e._getFileRow(n,e._getFriendlyData(t)));if(BEM.DOM.prepend(e.box.findElem("list"),o),e.files[n]=t,t.total=t.size+(t.name&&t.name.length||0)+t.type.length+164,t.node=e.box.findBlockInside({block:"uploader-row",modName:"file",modVal:n}),t.status=s,t.data&&(t.progress=100,t.loaded=t.total,t.node.setMod("status","done"),e.trigger("drag",n)),e._bindRow(n),t.type.match(/image.*/)){BEM.DOM.update(e.files[n].node.findElem("icon"),BEMHTML.apply(e._getSpin()));var r=e.files[n].node.findBlockInside("spin");r.setMod("progress","yes"),e._getThumbnail(t,n)}e.trigger("fileready",n)}),this.trigger("filesready"),this.readyForUpload=this.__self.getFilesList(),Object.keys(this.files).forEach(function(t){var i="ready"===e.files[t].status;i&&e.params.autoupload?e._send(t):i&&e.readyForUpload.push(t)})},_getOverallPercent:function(){var t=this,e=0,i=0,n=0,s=0;return Object.keys(this.files).length&&(Object.keys(this.files).forEach(function(n){e+=t.files[n].total||0,i+=t.files[n].loaded||0}),s=e/100,n=Math.round(i/s)),n},_send:function(t){var e=this,i=new FormData;i.append("data",this.files[t]),this.files[t].req=$.ajax({xhr:function(){var i=new window.XMLHttpRequest;return i.upload.addEventListener("progress",function(i){if(i.lengthComputable){var n=i.loaded/i.total*100<<0;e.files[t].progress=n,e.files[t].loaded=i.loaded,e.files[t].total=i.total,e.trigger("progress",t)}},!1),i},type:e.params.ajaxType||"POST",url:this.params.url,data:i,processData:!1,contentType:!1,beforeSend:function(){e._beforeUpload(t)},success:function(i){e._uploadSuccess(i,t),e.files[t].loaded=e.files[t].total,e.files[t].progress=100,e._progressUpdate(t)},error:function(){e._uploadError(t)}}),this.params.hasOwnProperty("ajaxExtend")&&this._ajaxExtend(t)},_ajaxExtend:function(t){var e=this.params.ajaxExtend;Object.keys(e).forEach(function(i){this.files[t].req[i]=e[i]}.bind(this))},_beforeUpload:function(t){this.files[t].status="uploading"},_uploadError:function(t){this.files[t].node.setMod("status","error"),this.trigger("uploaderror")},_uploadSuccess:function(t,e){this.files[e].response=t,this.files[e].status="done",this.files[e].node.setMod("status","done"),this.trigger("uploadsuccess",this.files[e])},_progressUpdate:function(t){var e=this.files[t],i=this._getOptimalSize(e.loaded)+" / "+this._getOptimalSize(e.total);e.node.findElem("bar").css("width",e.progress+"%"),BEM.DOM.update(e.node.findElem("calc"),i)},_updateSummary:function(){var t=this,e=Object.keys(this.files),i=0,n=0;this.summary.filesTotal=e.length,this.summary.filesUploaded=0,this.summary.percent=this._getOverallPercent(),e.forEach(function(e){"done"===t.files[e].status&&t.summary.filesUploaded++,i+=t.files[e].total,n+=t.files[e].loaded}),this.summary.bytesTotal=i,this.summary.total=this._getOptimalSize(i),this.summary.uploaded=this._getOptimalSize(n)},_updateSummaryRow:function(){var t=this.box.findElem("panel"),e="Загружено файлов: ".concat(this.summary.filesUploaded," из ",this.summary.filesTotal," (",this.summary.percent,"%)");BEM.DOM.update(t,e),BEM.DOM.update(this.info.findElem("box"),e)},_getFriendlyData:function(t){var e={type:this._getFileType(t.name||t.type),name:t.name,size:this._getOptimalSize(t.size)};return e},_getThumbnail:function(t,e){var i=this,n=new FileReader;t.data?this._getThumbImage(t.data,t.type,e):(n.onloadend=function(){i._getThumbImage(n.result,t.type,e)},n.readAsDataURL(t))},_getSpin:function(){return{block:"spin",mods:{theme:"gray-32"}}},_getThumbImage:function(t,e,i){var n=this,s=new Image,o=this.params.thumbnail;s.onload=function(){function t(){var o=new Image;if(o.onload=function(){s=o,t()},m&&s.width>>1>r||f&&s.height>>1>a||_&&s.height>>1>a)p=!0,l>>=1,c>>=1,d.width=l,d.height=c,u=d.getContext("2d"),u.drawImage(s,0,0,l,c),h=d.toDataURL(e),o.src=h;else{m?(c*=r/l,l=r,c>a&&(l*=a/c,c=a)):(f||_)&&(l*=a/c,c=a,l>r&&(c*=r/l,l=r)),l=Math.round(l),c=Math.round(c),d.width=l,d.height=c,u=d.getContext("2d"),u.drawImage(s,0,0,l,c),h=d.toDataURL(e);var g=new Image;g.src=h,(p||s.width>r>>2||s.height>a>>2)&&(l>c&&l/c>2?(g.width=l>>2,$(g).addClass("by-width can-increased")):(g.height=c>>2,$(g).addClass("by-height can-increased"))),resultData.key=i,resultData.img=g,resultData.dataurl=h,resultData.width=l,resultData.height=c,n.trigger("thumbready",resultData)}}var r=o&&o.width||240,a=o&&o.height||140,l=s.width,c=s.height,d=document.createElement("canvas"),u=null,h=null,p=!1;resultData={};var m=l>c&&l>r,f=c>l&&c>a,_=c===l&&c>a;t()},s.src=t},_getFileType:function(t){{var e=["zip",0,"rar",0,"gif",1,"jpg",2,"jpeg",2,"png",3,"eml",4,"exe",5,"mov",6,"mp4",7,"avi",8,"xls",9,"xlsx",9,"doc",10,"docx",10,"txt",11,"pdf",12,"ppt",13,"mp3",14,"wav",15,"wma",16],i=t.split(".")?t.split("."):t.split("/"),n=i[i.length-1];e.indexOf(n.toLowerCase())}return n},_getOptimalSize:function(t){for(var e=["B","Kb","Mb","Gb"],i=0;i<e.length;i++){var n=t/1024;{if(!(n>1))return t.toFixed(2)+e[i];t=n}}},_getFileRow:function(t,e){return{block:"uploader-row",mods:{file:t},content:[{elem:"icon",elemMods:{type:e.type},content:"."+e.type},{elem:"progress",content:[{elem:"bar"},{elem:"name",content:e.name},{elem:"calc"}]},{elem:"abort"}]}}},{getFiles:function(){return this.files||(this.files={})},getSummary:function(){return this.summary||(this.summary={})},getFilesList:function(){return this.readyForUpload||(this.readyForUpload=[])},getInfo:function(){function t(){var t=$(BEMHTML.apply({block:"uploader-info",content:{elem:"box"}}));return t.appendTo("body"),t=t.bem("uploader-info")}return this.info||(this.info=t())},checkBind:function(){return this.binded?!1:(this.binded=!0,!0)},getPopup:function(t){function e(){var e=$(BEMHTML.apply({block:"popup",mods:{"m-uploader":"yes",type:"modal",position:"fixed","has-close":"yes",behaviour:"scrollable"},underMods:{type:"paranja"},content:[{elem:"content",content:i.getContent(t)}]}));return e.appendTo("body"),e=e.bem("popup")}var i=this;return this.popup||(this.popup=e())},getContent:function(t){return{block:"uploader-box",content:[{elem:"drop-popup"},{elem:"panel"},{elem:"list"},{elem:"controls",content:this.getControls(t)}]}},getControls:function(t){var e={upload:this.buttonUpload.bind(this,t),attach:this.buttonAttach,abort:this.buttonAbort,clear:this.buttonClear,close:this.buttonClose},i={upload:this.buttonUpload.bind(this,t),attach:this.buttonAttach,abort:this.buttonAbort,clear:this.buttonClear};return t.controls?t.controls.map(function(t){return e[t]()}):Object.keys(i).map(function(t){return i[t]()})},buttonUpload:function(t){return(!t.autoupload||"no"===t.autoupload)&&{block:"button",mods:{theme:"action",type:"start-upload",size:"s"},content:"Загрузить"}},buttonAttach:function(){return{block:"attach",mods:{size:"s"},content:[{block:"button",mods:{size:"s"},mix:[{block:"attach",elem:"button"}],controlAttrs:{multiple:"yes"},content:"Выбрать файл"}]}
},buttonAbort:function(){return{block:"button",mods:{size:"s",type:"abort-uploads"},content:"Отменить все загрузки"}},buttonClear:function(){return{block:"button",mods:{size:"s",type:"clear-list"},content:"Очистить"}},buttonClose:function(){return{block:"button",mods:{size:"s",type:"close"},content:"Закрыть"}}}),BEM.DOM.decl("m-uploader",{onSetMod:{js:function(){this.files=this.__self.getFiles(),this.summary=this.__self.getSummary(),this.info=this.__self.getInfo(),this.dragFlag=!0,this._initParams(),this._bind()}},_bind:function(){var t=this,e=this.params.isGlobalDrop?this.domElem:this.findElem("drop-zone");this._attach=!this.params.isGlobalDrop&&this.findBlockInside("attach"),this.params.choosefile&&this._attach&&this._attach.on("change",function(e){e.preventDefault(),t._prepareData(t._attach.findElem("control")[0]),e.stopPropagation()}),this.params.dropzone&&e.on("dragenter dragleave",function(i){i.preventDefault(),t.dragFlag&&(t.dragFlag=!1,t.toggleMod(e,"is","hovered",""),t._unlockDrag()),i.stopPropagation()}).on("drop",function(i){var n=i.originalEvent.dataTransfer;t.delMod(e,"is"),t._prepareData(n),i.preventDefault()}).on("dragover",function(t){t.preventDefault()})},_handleFiles:function(t){{var e=this,i=Array.prototype.slice.apply(t);this.findElem("list")}i.forEach(function(t){var i=Object.keys(e.files).length,n="file_"+i,s=e._calculateStatus(t);e.files[n]=t,t.total=t.size+(t.name&&t.name.length||0)+t.type.length+164,t.status=s,t.data&&(t.progress=100,t.loaded=t.total,t.node.setMod("status","done"),e.trigger("drag",n)),e.trigger("fileready",n)}),this.trigger("filesready"),this.readyForUpload=this.__self.getFilesList(),Object.keys(this.files).forEach(function(t){var i="ready"===e.files[t].status;i&&e.params.autoupload?e._send(t):i&&e.readyForUpload.push(t)})},_uploadSuccess:function(t,e){this.files[e].response=t,this.files[e].status="done",this.trigger("uploadsuccess",this.files[e])},_uploadError:function(){this.trigger("uploaderror")},_progressUpdate:function(){}}),function(t){var e=t.event.special.outsideclick={add:function(i){t(document).on("click."+i.guid,e.handler.bind(this))},remove:function(e){t(document).off("click."+e.guid)},handler:function(e){t.contains(this,e.target)||(e.type="outsideclick",t.event.dispatch.apply(this,arguments),e.type="click")}}}(jQuery),BEM.DOM.decl("attach",{onSetMod:{js:function(){this._noFileText=this.elem("text").text(),this._update({mode:"clear"}),this.bindTo("reset","click",this.resetFile)},disabled:function(t,e){this.elem("control").prop("disabled","yes"===e),this.findBlockOn("button","button").setMod("disabled",e)}},val:function(){return this.elem("control").val()},resetFile:function(){var t=this.elem("control");return t.replaceWith(BEMHTML.apply({block:"attach",elem:"control",attrs:{name:t.attr("name"),tabindex:t.attr("tabindex")}})),this.dropElemCache("control"),this.findBlockOn("button","button").dropElemCache("control"),this._update({mode:"clear"}),this.delMod(this.elem("reset"),"visibility"),this.trigger("reset")},_update:function(t){var e=this._getFileByPath(this.val()),i=this.elem("text").text();(t&&"clear"===t.mode||e&&e!==i)&&(this._setFile(e),this._setExtension(this._getExtension(e)),this.setMod(this.elem("reset"),"visibility","visible"),e&&this.trigger("change"))},_getFileByPath:function(t){return t.split("\\").pop()},_setFile:function(t){this.setMod(this.elem("holder"),"state",t?"":"hidden"),this.elem("text").text(t||this._noFileText)},_extensionsToMods:{zip:"archive",rar:"archive",tar:"archive",gz:"archive","7z":"archive",gif:"gif",jpg:"jpg",jpeg:"jpg",png:"png",eml:"eml",exe:"exe",m4a:"audio",ogg:"audio",mp3:"mp3",wav:"wav",wma:"wma",flv:"video",mov:"mov",wmv:"wmv",mp4:"mp4",avi:"avi",xls:"xls",doc:"doc",docx:"doc",txt:"txt",pdf:"pdf",ppt:"ppt"},_getExtension:function(t){return this._extensionsToMods[t.split(".").pop().toLowerCase()]||""},_setExtension:function(t){this.setMod(this.elem("holder"),"file",t||this.params.unknownType)},getDefaultParams:function(){return{unknownType:"unknown"}}},{live:function(){return this.liveBindTo("change",function(){this._update()}),!1}}),BEM.DOM.decl("b-file-loader",{onSetMod:{js:function(){this.bindToDomElem(this.elem("close"),"click",this._removeFileBlock,this)}},_removeFileBlock:function(){this.file.req.abort(),this.trigger("removed"),this.findBlockOutside("b-file-loader").destruct()}}),BEM.DOM.decl({block:"m-uploader",modName:"type",modVal:"sidebar"},{onSetMod:{js:function(){this._bPage=this.findBlockOutside("b-page"),this._bFilesBlock=this._bPage.findBlockInside("b-files2"),this._bSidebar=this._bPage.findBlockInside("b-sidebar"),this._bSidebarFiles=this._bFilesBlock.findBlockOutside("b-sidebar-panel"),this._uploadersPopup=this._bPage.findBlockInside({block:"popup",modName:"m-uploader",modVal:"yes"}),this.__base.apply(this,arguments),this.on("fileready",this._loadFiles,this)}},_addProgressBlock:function(t){var e=BEMHTML.apply({block:"b-file-loader",name:t.name});return BEM.DOM.prepend(this._bSidebar.elem("upload-progress"),e),this._bSidebar.findBlockInside("upload-progress","b-file-loader")},_loadFiles:function(t,e){this._bSidebar.trigger("clearPanels"),this._bSidebar._openSidebar("files"),this._bFilesBlock._onceClicked||this._bFilesBlock._getFiles(),this._bFilesBlock._onceClicked?this._loadFilesRequest(t,e):this._bFilesBlock.on("filesLoaded",function(t){this._loadFilesRequest(t,e)},this)},_loadFilesRequest:function(t,e){var i=this,n=new FormData;n.append("data",this.files[e]),this.files[e].req=$.ajax({xhr:function(){var t=new window.XMLHttpRequest,n=i._addProgressBlock(i.files[e]);return n.file=i.files[e],t.upload.addEventListener("progress",function(t){if(t.lengthComputable){var s=t.loaded/t.total*100<<0;i.files[e].progress=s,i.files[e].loaded=t.loaded,i.files[e].total=t.total,n.elem("wrapper").html(s+"%"),n.elem("progress").css("width",s+"%")}},!1),t},type:"POST",url:"/.upload",data:n,processData:!1,contentType:!1,success:function(t){i._uploadSuccess(t,e),i.files[e].loaded=i.files[e].total,i.files[e].progress=100,i.sendFile(e,t.data.storage_id)}})},sendFile:function(t,e){var i=this;$.ajax({type:"POST",url:/handlers/,data:{handlers:JSON.stringify([{_:"api-response",apiPath:".attach",method:"POST",data:{files:[e]},path:WikiHistory._getCorrectPath()}])},dataType:"json",success:function(t){i._bFilesBlock._addFilesToDom(t[0].data.data,"prepend")},error:function(t){i.channel("errors").trigger("error",i._getErrorData(t.message))}}),this.params.hasOwnProperty("ajaxExtend")&&this._ajaxExtend(t)},_getErrorData:function(t){return{node:this.domElem,content:{head:BEM.I18N("m-uploader","cant_save_page"),body:t}}}}),BEM.DOM.decl("b-events-log",{initBlock:function(){this.inited||(this.inited=!0,this.bPage=this.bPage||this.findBlockOutside("b-page"),this.pageType=this.bPage.hasMod("type","grid")?"grid":"article",this.spinner=this.spinner||this.findBlockInside("spinner"),this.mask=this.mask||this.elem("mask"),this.maskSpin=this.maskSpin||this.findBlockInside(this.mask,"spinner"),this.loaded=0,this.limit=10,this.types="create,edit",this.currentEvent=null,this.diffEvent=null,this.firstLoad=!0,this.currentRevisionId=null,this._getEvents(!1))},_getEvents:function(t){t?this.spinner.setMod("progress","yes"):(this.loaded=0,this._showMask()),BEM.create("api-request",{_:"api-response",apiPath:".events",path:WikiHistory._getCorrectPath(),urlParams:["format=json","event_types="+this.types,"start="+this.loaded,"limit="+this.limit]}).run().then(this._onGotData.bind(this,t),this._onFailedData.bind(this,t))},_onMoreClick:function(){this._getEvents(!0)},_getRevisionsBEMJSON:function(t){var e,i=[];return this.loaded=this.loaded+t.length,e=this.total-this.loaded,t.forEach(function(t){var e={block:"b-events-log",elem:"item",mix:[],content:[]};"edit"==t.event_type||"create"==t.event_type?(e.mix.push({block:"b-event",mods:{type:t.event_type,selectable:"yes"},js:{revisionId:t.revision.id,timestamp:t.created_at,user:t.author.display}}),e.content.push({block:"checkbox",mods:{size:"m"},mix:[{block:"b-event",elem:"check"},{block:"b-revision-diff",js:!0}],js:{revisionId:t.revision.id}})):e.mix.push({block:"b-event",mods:{type:t.event_type}}),e.content.push({block:"b-event",elem:"type",content:BEM.I18N("b-events-log",t.event_type)+" "},{block:"b-event",elem:"user",content:{block:"b-user",mix:[{block:"mi-staff-card",js:{user:t.author.login}}],url:"//staff.yandex-team.ru/"+t.author.login,content:t.author.login+"@"}},{block:"b-event",elem:"date",timestamp:t.created_at}),i.push(e)}),e>0?this.elem("more-link").show():this.elem("more-link").hide(),i},_getNoRevisionsBEMJSON:function(){var t={block:"b-events-log",elem:"item",mix:[],content:BEM.I18N("b-events-log","no_events")};return this.elem("more-link").hide(),[t]},_onGotData:function(t,e){var i;this.total=e.data.total,i=BEMHTML.apply(this.total?this._getRevisionsBEMJSON(e.data.data):this._getNoRevisionsBEMJSON()),t?(this.spinner.delMod("progress"),BEM.DOM.append(this.elem("list"),i)):(this._hideMask(),BEM.DOM.update(this.elem("list"),i)),this.currentEvent=this.findBlockInside({block:"b-event",modName:"selectable",modVal:"yes"}),this.currentEvent&&this.currentEvent._setSelection(),this.diffEvent=null,this.firstLoad&&this.currentEvent&&(this.currentRevisionId=this.currentEvent.params.revisionId),this.currentEvent&&!t&&this.currentEvent._getRevisionBEMJSON()},_onFailedData:function(t,e){t?this.spinner.delMod("progress"):this._hideMask(),this.channel("errors").trigger("error",this._getErrorData(e.message))},_getErrorData:function(t){return{node:this.elem("more-link"),content:{head:BEM.I18N("b-events-log","cant_load_revision"),body:t}}},_showMask:function(){this.mask.show(),this.maskSpin.setMod("progress","yes")},_hideMask:function(){this.mask.hide(),this.maskSpin.delMod("progress")},showRevisionInfo:function(){var t,e,i,n=this.bPage.findBlockInside("b-page-info"),s=this.bPage.findBlockInside({block:"b-revision-info",modName:"type",modVal:"view"});s?(BEM.DOM.update(s.elem("text"),BEMHTML.apply(this.getRevisionInfoTextBEMJSON())),"article"==this.pageType&&(t=this.bPage.findBlockInside("b-editor-open-button"),t.params.revisionId=this.currentEvent.params.revisionId)):(BEM.DOM.after(n.domElem,BEMHTML.apply(this.getRevisionInfoBEMJSON())),s=this.bPage.findBlockInside({block:"b-revision-info",modName:"type",modVal:"view"}),"article"==this.pageType&&(t=this.bPage.findBlockInside("b-editor-open-button"),e=this.bPage.findBlockInside("b-page-more"),BEM.DOM.append(s.elem("button"),t.domElem),t=this.bPage.findBlockInside("b-editor-open-button"),t.params.revisionId=this.currentEvent.params.revisionId,i=t.findBlockOn("button"),i.delMod("side"),i.delMod("pseudo"),i.setMod("size","s"),i.setMod("theme","clear"),i.elem("text").text(BEM.I18N("b-events-log","edit_version")),e.domElem.hide()))},getRevisionInfoBEMJSON:function(){return{block:"b-revision-info",mods:{type:"view"},content:[{elem:"text",content:this.getRevisionInfoTextBEMJSON()},{elem:"button",content:""}]}},getRevisionInfoTextBEMJSON:function(){return["article"==this.pageType?BEM.I18N("b-events-log","old_page_version"):BEM.I18N("b-events-log","old_table_version"),{block:"m-date",format:"full",timestamp:this.currentEvent.params.timestamp},". "+BEM.I18N("b-events-log","author")+" "+this.currentEvent.params.user+"."]},hideRevisionInfo:function(){var t,e,i,n=this.bPage.findBlockInside({block:"b-revision-info",modName:"type",modVal:"view"});n&&("article"==this.pageType&&(t=this.bPage.findBlockInside("b-editor-open-button"),e=this.bPage.findBlockInside("b-page-more"),i=t.findBlockOn("button"),e.domElem.show(),BEM.DOM.before(e.domElem,t.domElem),t.params.revisionId=null,i.setMod("size","m"),i.setMod("side","left"),i.setMod("pseudo","yes"),i.setMod("theme","pseudo"),i.elem("text").text(BEM.I18N("b-events-log","page_edit"))),BEM.DOM.destruct(n.domElem))}},{live:function(){this.liveBindTo("more-link","click",function(){this._onMoreClick()})}}),BEM.DOM.decl("b-event",{onSetMod:{js:function(){this.__self.bPage||(this.__self.bPage=BEM.blocks["i-global"].getbPage()),this.__self.bEventsLog||(this.__self.bEventsLog=this.findBlockOutside("b-events-log")),this.checkbox=this.findBlockInside("checkbox"),this.channel("update-diff").on("showDiff",this._onShowDiff,this),this.channel("update-diff").on("uncheckDiff",this._onUncheckDiff,this)}},revisionCache:null,_setSelection:function(){this.setMod("selected","yes"),this.checkbox.setMod("checked","yes"),this.checkbox.setMod("disabled","yes")},_removeSelection:function(){this.delMod("selected"),this.checkbox.delMod("disabled"),this.checkbox.delMod("checked")},_getRevisionApiPath:function(t){return("grid"==this.__self.bEventsLog.pageType?".grid/revisions/":".revisions/")+t},_getRevisionBEMJSON:function(){this.revisionCache?this._showRevision():(this.__self.bEventsLog._showMask(),BEM.create("api-request",{_:"api-response",apiPath:this._getRevisionApiPath(this.__self.bEventsLog.currentEvent.params.revisionId),path:WikiHistory._getCorrectPath(),urlParams:["format=json"]}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this)))},_onGotData:function(t){this.__self.bEventsLog._hideMask(),this.revisionCache="grid"==this.__self.bEventsLog.pageType?t:BEMHTML.apply(t.data.bemjson),this.__self.bEventsLog.firstLoad?(this.__self.bEventsLog.hideRevisionInfo(),this.__self.bEventsLog.firstLoad=!1):this._showRevision()},_onFailedData:function(t){this.__self.bEventsLog._hideMask(),this.channel("errors").trigger("error",this._getErrorData(t.message))},_getErrorData:function(t){return{node:this.domElem,content:{head:BEM.I18N("b-event","cant_load_revision"),body:t}}},_showRevision:function(){var t;"grid"==this.__self.bEventsLog.pageType?(this.__self.bGridTable||(this.__self.bGridTable=this.__self.bPage.findBlockInside("b-grid-table"),this.__self.bGridTable.setMod("readonly","true"),this.__self.bGridTable.setMod("revision","true"),this.__self.bGridTable.readOnly=!0),this.__self.bGridTable._onGotData(this.revisionCache)):(this.__self.bContent||(this.__self.bContent=this.__self.bPage.findBlockInside("b-content")),this.__self.bContent.findBlockInside({block:"wiki-doc",modName:"status",modVal:"main"})&&(this.__self.wikiDoc=this.__self.bContent.findBlockInside({block:"wiki-doc",modName:"status",modVal:"main"}),this.__self.wikiDoc.findBlocksInside("wiki-doc").forEach(function(t){t.domElem&&!t.hasMod("status")&&BEM.DOM.destruct(t.domElem)}),this.__self.wikiDoc.findBlockInside("b-diff-content")&&BEM.DOM.destruct(this.__self.wikiDoc.findBlockInside("b-diff-content").domElem),BEM.DOM.update(this.__self.wikiDoc.domElem,this.revisionCache)),this.isCurrentRevision()||(t=this.__self.wikiDoc.findBlocksInside("b-wiki-form"),t.length&&t.forEach(function(t){var e=t.findBlockInside({block:"button",modName:"type",modVal:"form-submit"});e&&e.setMod("disabled","yes")})),this.__self.bPage.highLightCode()),this.isCurrentRevision()?this.__self.bEventsLog.hideRevisionInfo():this.__self.bEventsLog.showRevisionInfo()},isCurrentRevision:function(){return this.__self.bEventsLog.currentRevisionId===this.__self.bEventsLog.currentEvent.params.revisionId},_onRevisionClick:function(){this.__self.bEventsLog.currentEvent&&this.__self.bEventsLog.currentEvent._removeSelection(),this.__self.bEventsLog.diffEvent&&(this.__self.bEventsLog.diffEvent._removeSelection(),this.__self.bEventsLog.diffEvent=null),this.__self.bEventsLog.currentEvent=this,this._setSelection(),this._getRevisionBEMJSON()},_onShowDiff:function(){this.__self.bEventsLog.currentEvent.findBlockInside("checkbox").delMod("disabled")},_onUncheckDiff:function(){this.__self.bEventsLog.currentEvent._getRevisionBEMJSON(),this.__self.bEventsLog.currentEvent.findBlockInside("checkbox").setMod("disabled","yes")}},{live:function(){this.liveBindTo("click",function(t){this.hasMod("selectable")&&this._onRevisionClick(t)}),this.liveBindTo("check","click",function(t){t.stopPropagation()})}}),BEM.DOM.decl("b-events-select",{onSetMod:{js:function(){this.bEventsLog=this.findBlockOutside("b-events-log"),this.select=this.findBlockInside("select"),this.select.on("change",this._onSelect,this)}},_onSelect:function(){this.bEventsLog.types=this.select.val(),this.bEventsLog._getEvents(!1)}}),BEM.DOM.decl({block:"popup",modName:"autosize",modVal:"yes"},{getDefaultParams:function(){var t=this.__base();return t.offsetWithoutTail=5,t},repaint:function(){return this._saveDefault(),this.__base(),this.domElem.css({maxWidth:this.size.width,height:this.size.height}),this},_saveDefault:function(){this._defSize||(this._defSize=this.getPopupSize())},_resetDefault:function(){return this._defSize=null,this.domElem.css({maxWidth:"",height:""}),this},_getAvailableSpace:function(t){return this._owner?{width:this._getAvailableWidth(t),height:this._getAvailableHeight(t)}:$.extend({},this._defSize)},_getAvailableWidth:function(t){var e=BEM.DOM.getWindowSize(),i=e.width,n=t.offset,s=this._owner[0].getBoundingClientRect(),o=$.extend({},this._defSize);switch(t.to){case"left":i=s.left,"number"==typeof n&&(i-=n),"object"==typeof n&&(n.left&&(i+=n.left),n.right&&(i-=n.right));break;case"right":i=e.width-s.right,"number"==typeof n&&(i-=n),"object"==typeof n&&(n.left&&(i-=n.left),n.right&&(i+=n.right))}return("left"===t.to||"right"===t.to)&&(i-=this._tailPos?2*this.params.tail.width:this.params.offsetWithoutTail),Math.min(o.width,i)},_getAvailableHeight:function(t){var e=BEM.DOM.getWindowSize(),i=e.height,n=t.offset,s=this._owner[0].getBoundingClientRect(),o=$.extend({},this._defSize);switch(t.to){case"bottom":i=e.height-s.bottom,"number"==typeof n&&(i-=n),"object"==typeof n&&(n.bottom&&(i+=n.bottom),n.top&&(i-=n.top));break;case"top":i=s.top,"number"==typeof n&&(i-=n),"object"==typeof n&&(n.bottom&&(i-=n.bottom),n.top&&(i+=n.top))}return("bottom"===t.to||"top"===t.to)&&(i-=this._tailPos?2*this.params.tail.height:this.params.offsetWithoutTail),Math.min(o.height,i)},_calcTop:function(t){var e,i=this.__base(t),n=$(window).scrollTop(),s=BEM.DOM.getWindowSize(),o=this.getPlacingSize(),r=this.getOwnerPos(),a=this.getOwnerSize();return 0>i&&(i=0),e=Math.max(s.height+n,r.top+a.height),i+o.height>e&&(i=e-o.height),i},_calcLeft:function(t){var e,i=this.__base(t),n=$(window).scrollLeft(),s=BEM.DOM.getWindowSize(),o=this.getPlacingSize(),r=this.getOwnerPos(),a=this.getOwnerSize();return 0>i&&(i=0),e=Math.max(s.width+n,r.left+a.width),i+o.width>e&&(i=e-o.width),i},getPlacingSize:function(){return this._availSizes},_calcPlacingSize:function(t){return this._availSizes=this._getAvailableSpace(t),this._availSizes},_calcVisibilityFactor:function(){var t=this._defSize,e=this.getPlacingSize(),i=e.height*e.width,n=t.height*t.width;return i/n*100}}),function(t,e){function i(t){var e={};return"option"===t.item?(e={block:r,elem:"option",tag:"option",attrs:{value:t.value},content:t.content},t.disabled&&(e.attrs.disabled="disabled"),t.selected&&(e.attrs.selected="selected")):"optgroup"===t.item&&(e={elem:"option-group",tag:"optgroup",attrs:{label:t.label}},t.disabled&&(e.attrs.disabled="disabled"),e.content=Array.isArray(t.content)?t.content.map(function(t,e){return i(t,e)}):t.content),e.block=r,e}var n=t.browser.opera&&t.browser.version<12.1?"keypress":"keydown",s=t.browser.msie&&parseInt(t.browser.version,10)<=10,o=null,r="select";e.DOM.decl("select",{onSetMod:{js:function(){this._items=[],this._curItemIndex=-1,this._rowHeight=22,this.on("change",this._redrawParentPopup),this._getSelectedText()!==this._buttonText()&&this.elem("control").trigger("change")},disabled:function(t,e){var i="yes"===e;this.elem("control").attr("disabled",i),this._getButton().setMod(t,e),i&&this.delMod("opened").delMod("focused")},focused:{yes:function(){return this.hasMod("disabled","yes")?!1:(this._useNativeControl()||this.bindTo(n,this._onKeyDown),this.afterCurrentEvent(function(){this.trigger("focus")}),void 0)},"":function(){this._useNativeControl()||this.delMod("opened").unbindFrom(n),this.afterCurrentEvent(function(){this.trigger("blur")})}}},isDisabled:function(){return this.hasMod("disabled","yes")},isOpened:function(){return this.hasMod("opened","yes")},open:function(){return this.setMod("opened","yes")},close:function(){return this.delMod("opened")},val:function(e){if("undefined"==typeof e)return this.elem("control").val();var i,n=-1;return this.findElem("option").each(function(s){this.value===e&&!this.disabled&&(i=t(this).parent("optgroup")[0],!(i&&i.disabled))&&(n=s)}),n>-1&&(this.params.selected=n,this._selectedIndex(n)),this},_selectedIndex:function(t){var e=this._getSelectedIndex();return"undefined"==typeof t||t===e?e:(this.elem("control").prop("selectedIndex",t),this._useNativeControl()||(this._buttonText(this._getSelectedText()),this._items[0]&&this.delMod(this._items,"selected").setMod(this._items.eq(t),"selected","yes")),this.trigger("change",{index:t,prev:e}),t)},setOptions:function(n){return n?(e.DOM.update(this.elem("control"),BEMHTML.apply(t.map(n,i))),this.redraw()):this},redraw:function(){return this._popup&&this._redrawList(),this.elem("control").trigger("change"),this},_useNativeControl:function(){return null!==o?o:o="none"!==this.elem("control").css("display")},_redrawParentPopup:function(){return this._isParentPopup()&&this._popup._parent.repaint(),this},_isParentPopup:function(){return this._popup&&this._popup._parent&&!this.hasMod("layout","fixed")},_onSelectChange:function(){var t=this;t._buttonText(t._getSelectedText()),this.trigger("change",{index:t._getSelectedIndex(),prev:-1})},_onControlFocusInOut:function(t){this._useNativeControl()&&this.toggleMod("focused","yes","","focusin"===t.type)},_onMouseDown:function(t){this._isControlFocused()&&t.preventDefault()},_onKeyDown:function(t){var e=38===t.keyCode,i=40===t.keyCode,n=13===t.keyCode,s=32===t.keyCode;if(e||i){if(t.preventDefault(),!this.isOpened())return this.open();var o=this._items.length,r=this._curItemIndex;if(e&&0===r||i&&r>o-2)return;if(o){var a=i?1:-1,l=0;for(l=r;l>=0&&o>=l;)if(l+=a,this._isSelectableItem(this._items.eq(l))){r=l;break}this._onEnterItem(this._items.eq(r),!0)}}(n||s)&&this._onEnterItem(this._items.eq(this._curItemIndex),!0,!0)},_onEnterItem:function(t,e,i){this.elem("button").attr("aria-activedescendant",t.attr("id"));var n=this._curItemIndex,s=this._getItemIndex(t),o=this._items;n>-1&&this.delMod(o.eq(n),"hovered"),s>-1&&(this._curItemIndex=s,this.setMod(o.eq(s),"hovered","yes")),i&&this._selectedIndex(this._curItemIndex),e&&(this.params.selected=s,this._scrollToCurrent())},_onLeaveItem:function(t){var e=this._curItemIndex;e>-1&&e===this._getItemIndex(t)&&(this.delMod(this._items.eq(e),"hovered")._curItemIndex=-1)},_onSelectItem:function(t){return this._isSelectableItem(t)&&this._selectedIndex(this._curItemIndex),this.close()},_onButtonFocus:function(){this.setMod("focused","yes")},_onButtonBlur:function(){return this.isOpened()&&this._isPopupFocused()?(this._focusButton(),void 0):(this.delMod("focused"),void 0)},_onButtonPress:function(){this.toggleMod("opened","yes","")},_focusButton:function(){return this._getButton().setMod("focused","yes"),this},_blurButton:function(){return this._getButton().delMod("focused"),this},_isPopupFocused:function(){try{return this._getPopup().containsDomElem(t(document.activeElement))}catch(e){return!1}},_buttonText:function(t){return"undefined"==typeof t?this._getButton().elem("text").text():(this._getButton().elem("text").html(t||" &nbsp; "),s&&this.domElem.parent().css("outline",""),void 0)},_isOutsideClicked:function(e,i){return this.containsDomElem(t(i.target))},_getItemIndex:function(e){return t.inArray(e.get(0),this._items)},_getSelectedText:function(){return this.elem("control").find(":selected").text()},_getSelectedIndex:function(){return this.elem("control").prop("selectedIndex")},_isSelectableItem:function(t){var e;return e=this.hasMod(t,"disabled","yes")||this.hasMod(t,"label","yes")?!1:!0},_getButton:function(){return this._button||(this._button=this.findBlockOn("button","button"))},_getRowHeight:function(){return this.findElem(this._getPopup().domElem,"item").outerHeight()},_isControlFocused:function(){try{return this.containsDomElem(t(this.__self.doc[0].activeElement))}catch(e){return!1}},destruct:function(){this._outPopup&&this._outPopup.un("outside-click"),this.delMod("opened");var t=this._popup;t&&t.domElem&&t.destruct(),this.__base.apply(this,arguments)},getDefaultParams:function(){return{rows:15,popupMods:{direction:"down"}}}},{live:function(){return this.liveBindTo("control","change",function(){this._onSelectChange()}),this.liveBindTo("control","focusin focusout",function(t){this._onControlFocusInOut(t)}),this.liveBindTo("mousedown",function(t){this._onMouseDown(t)}),!1}})}(jQuery,BEM),function(t,e){var i=t.browser.opera&&t.browser.version<15;e.DOM.decl("select",{onElemSetMod:{item:{hovered:function(){i&&this._popup.domElem.css("display","inline").css("display","")}}}})}(jQuery,BEM),function(t){function e(t,e,i){var n={block:"select",elem:"item",content:{elem:"text",tag:"span",content:e||" &nbsp; "},elemMods:{}};return i&&(n.elemMods=i),n}function i(t){function i(t,n){var l=t.length;if(l){var c=0;do{var d=$(t[c]),u=d.attr("disabled")&&{disabled:"yes"};if(d.is("optgroup")){a=!0,!d.prev().is("optgroup")&&o.push(s),r.push(o),o=[],o.push(e(d,d.attr("label"),$.extend({label:"yes"},u,n))),i(d.children(),$.extend({inner:"yes"},u,n));var h=o;o=r.pop(),o.push({block:"select",elem:"group",content:h})}else o.push(e(d,d.text(),$.extend(u,d.is(":selected")&&{selected:"yes"},n)))}while(++c<l||a&&(o.push(s),a=!1))}}var n="select",s={block:n,elem:"separator",tag:"i"},o=[],r=[],a=!1;return i(t),BEMHTML.apply(o)}t.DOM.decl("select",{onSetMod:{js:function(){this.__base.apply(this,arguments),this._initButton()}},_initButton:function(){this._getButton().on("focus",this._onButtonFocus,this).on("blur",this._onButtonBlur,this).on("press",this._onButtonPress,this)},_redrawList:function(){var e,n=this,s=this._getPopup().domElem;return t.DOM.update(this.findElem(s,"list"),i(this.elem("control").children())),e=this.findElem(s,"item"),this._curItemIndex=-1,this._items=e.filter(function(){return!n.hasMod($(this),"label","yes")}),this}})}(BEM),BEM.DOM.decl("select",{_redrawList:function(){this.__base();var t=this;this.bindTo(t._items,{mouseup:function(e){1===e.which&&(e.preventDefault(),t._onSelectItem(e.data.domElem))},mouseover:function(e){t._onEnterItem(e.data.domElem)},mouseout:function(e){t._onLeaveItem(e.data.domElem)}})}}),BEM.DOM.decl("select",{onSetMod:{opened:{yes:function(){if(this.hasMod("disabled","yes"))return!1;this._drawPopup();var t=this.findElem(this._popup.domElem,"item","selected","yes");this.elem("button").attr({"aria-activedescendant":t.attr("id"),"aria-expanded":!0})},"":function(){this.elem("button").attr("aria-expanded",!1).removeAttr("aria-activedescendant"),this._getPopup().hide()}}},_getPopup:function(){if(this._popup)return this._popup;var t=this,e=t.params,i=t.__self.getName(),n={block:i,elem:"list"},s={block:i,elem:"popup",elemMods:{}},o={animate:"no"},r={directions:["bottom-left","top-left"]};["size","layout","theme","width"].forEach(function(e){t.hasMod(e)&&(s.elemMods[e]=t.getMod(e))}),$.extend(s.elemMods,e.elemPopupMods),$.extend(o,e.popupMods),$.extend(r,e.popupParams);var a=$(BEMHTML.apply({block:"popup",mods:o,mix:[s],js:r,content:{elem:"content",content:n}}));return(t._popup=t.findBlockOn(a,"popup")).on({show:function(){t._curItemIndex=t._getSelectedIndex();var e=t._items.eq(t._curItemIndex);t.delMod(t._items,"selected").setMod(e,"hovered","yes").setMod(e,"selected","yes")},"outside-click":function(e,i){t._isOutsideClicked(e,i)?e.preventDefault():t._blurButton()},hide:function(){t.delMod("opened").delMod(t._items,"hovered").delMod(t.findElem(t._popup.domElem,"popup"),"scrollable")}}).bindTo("mousedown",function(t){t.preventDefault()}),BEM.DOM.append(BEM.DOM.scope,t._popup.domElem),t._redrawList(),t._outPopup=t.findBlockOutside("button","popup"),t._outPopup&&t._outPopup.on("outside-click",function(e,i){t._popup.containsDomElem($(i.target))&&e.preventDefault()}),t._popup},_calcPopupDimensions:function(){this._popupContent||(this._popupContent=this._getPopup().findBlockInside("popup").elem("content"));var t=parseInt(this.params.rows,10)||!1;if(t&&this.findElem(this._popupContent,"item").size()>t){this._rowHeight=this._getRowHeight();var e=parseInt(getComputedStyle(this._popup.domElem[0]).height,10);if(e>t*this._rowHeight)this._getPopup().setSize({height:t*this._rowHeight}),this.setMod(this.findElem(this._getPopup().domElem,"popup"),"scrollable","yes");else{var i=t*this._rowHeight+"px";this._popup.domElem.css("height")!==i&&this._getPopup().setSize({height:i})}}else this._popupContent.css("height","auto")},_drawPopup:function(){var t=this.findBlockInside("select"),e=this._getPopup();e.show(t),this._calcPopupDimensions(),this._scrollToCurrent()},_scrollToCurrent:function(){if(this.params.selected&&this._popupContent&&!(this._curItemIndex<0)){var t,e=this._items.eq(this.params.selected).get(0).offsetTop,i=this._popupContent,n=i.scrollTop(),s=e-n,o=2*this._rowHeight;s>i.height()-o?t=e-o:n&&o>s&&(t=e-i.height()+o),t&&i.scrollTop(t)}}},{SHADOW_OFFSET:1}),BEM.DOM.decl({block:"select",modName:"assigned",modVal:"form"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params.required&&this.findBlockOutside("b-wiki-form")._requiredFields.push(this)}}}),BEM.DOM.decl("b-revision-diff",{onSetMod:{js:function(){this.__self.bEventsLog||(this.__self.bEventsLog=this.findBlockOutside("b-events-log"))}},_onCheckboxChange:function(){var t=this.findBlockOn("checkbox"),e=this.findBlockOutside("b-event");if(!this.__self.bEventsLog.currentEvent)return!1;if(t.isChecked()){if(this.__self.bEventsLog.currentEvent==e)return!1;this.__self.bEventsLog.diffEvent&&this.__self.bEventsLog.diffEvent!=e&&this.__self.bEventsLog.diffEvent._removeSelection(),this.__self.bEventsLog.diffEvent=e,this._getDiff(),this.__self.bEventsLog.diffEvent.setMod("selected","yes"),this.channel("update-diff").trigger("showDiff")}else{if(this.__self.bEventsLog.currentEvent!=e&&this.__self.bEventsLog.diffEvent!=e)return!1;this.__self.bEventsLog.currentEvent==e&&(this.__self.bEventsLog.currentEvent.delMod("selected"),this.__self.bEventsLog.currentEvent=this.__self.bEventsLog.diffEvent),this.__self.bEventsLog.diffEvent==e&&this.__self.bEventsLog.diffEvent.delMod("selected"),this.__self.bEventsLog.diffEvent=null,this.channel("update-diff").trigger("uncheckDiff")}},_getDiff:function(){this.__self.bPage||(this.__self.bPage=this.findBlockOutside("b-page")),this.__self.bEventsLog._showMask(),BEM.create("api-request",{_:"api-response",apiPath:".diff",path:WikiHistory._getCorrectPath(),urlParams:["format=json","a="+this.__self.bEventsLog.currentEvent.params.revisionId,"b="+this.__self.bEventsLog.diffEvent.params.revisionId]}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this))},_onGotData:function(t){var e={block:"b-diff-content",content:[]};e.content=t.data.diff?this._buildDiffStringBEMJSON(t.data.diff):this._buildDiffGridBEMJSON(t.data),this.__self.bEventsLog._hideMask(),this._showDiffData(BEMHTML.apply(e))},_buildDiffStringBEMJSON:function(t){var e=[];return t.forEach(function(t){var i={block:"b-diff-string",mods:{"diff-type":t.changes},content:[]};t.chunks.forEach(function(t){i.content.push({elem:"chunk",elemMods:{"diff-type":t.action},content:t.substring})}),e.push(i)}),e},_buildDiffGridBEMJSON:function(t){var e=this,i={block:"b-diff-grid",content:[]};return t.deleted_rows.forEach(function(t){var e={elem:"row",mods:{"diff-type":"deleted"},content:[]};t.fields.forEach(function(t){e.content.push({elem:"field",content:t.raw_content})}),i.content.push(e)}),t.added_rows.forEach(function(t){var e={elem:"row",mods:{"diff-type":"added"},content:[]};t.fields.forEach(function(t){e.content.push({elem:"field",content:t.raw_content})}),i.content.push(e)}),t.changed_rows.forEach(function(t){var n={elem:"row",mods:{"diff-type":"changed"},content:[]};t.fields.forEach(function(t){n.content.push({elem:"field",content:e._buildDiffStringBEMJSON(t.diff_raw_content)})}),i.content.push(n)}),i
},_onFailedData:function(t){this.__self.bEventsLog._hideMask(),this.channel("errors").trigger("error",this._getErrorData(t.message))},_getErrorData:function(t){return{content:{head:BEM.I18N("b-revision-diff","canr_load_diff"),body:t}}},_showDiffData:function(t){this.__self.bContent||(this.__self.bContent=this.__self.bPage.findBlockInside("b-content")),this.__self.bContent.findBlockInside({block:"wiki-doc",modName:"status",modVal:"main"})&&(this.__self.wikiDoc=this.__self.bContent.findBlockInside({block:"wiki-doc",modName:"status",modVal:"main"}),this.__self.wikiDoc.findBlocksInside("wiki-doc").forEach(function(t){t.hasMod("status")||BEM.DOM.destruct(t.domElem)}),this.__self.wikiDoc.findBlockInside("b-diff-content")&&BEM.DOM.destruct(this.__self.wikiDoc.findBlockInside("b-diff-content").domElem),BEM.DOM.update(this.__self.wikiDoc.domElem,t))}},{live:function(){this.liveInitOnBlockEvent("change","checkbox",function(t){this._onCheckboxChange(t)})}}),BEM.DOM.decl("b-cluster-tree",{initBlock:function(){this.inited||(this.inited=!0,this.bPage=BEM.blocks["i-global"].getbPage(),this._localStorage=BEM.blocks["mi-storage"],this.sortBy=this._localStorage.getItem("wiki-ct-sort")||"title",this.pageTypes=this._localStorage.getItem("wiki-ct-filter")||"G",this._getClusterTree(),this._clusterTreeSort=this.findBlockInside("b-cluster-tree-sort"),this._clusterTreeSort.initBlock(),this._clusterTreeFilter=this.findBlockInside("b-cluster-tree-filter"),this._clusterTreeFilter.initBlock(),this.findBlockOutside("scroll").elem("native").on("scroll",this._closePopups.bind(this)),this.bindToDoc("scroll",this._closePopups,this))},_getClusterTree:function(){var t="&sort_order="+this.sortBy;this.pageTypes&&(t+="&page_types="+this.pageTypes),BEM.create("api-request",{_:"api-response",apiPath:".treecluster",path:WikiHistory._getCorrectPath(),urlParams:["format=json"+t]}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this))},_onGotData:function(t){BEM.DOM.update(this.elem("total-count"),t.data.length),this.setMod("sort",this.sortBy.replace("_","-"));var e=BEMHTML.apply(this._getClusterTreeBEMJSON(t.data));BEM.DOM.update(this.elem("list"),e,this._cutTitles,this)},_getClusterTreeBEMJSON:function(t){var e=this,i=[];return t.forEach(function(t){var n={block:"link",url:"/"+t.supertag+"?sidetab=cluster-tree",content:[],mods:{type:t.page_type},mix:[{block:"b-cluster-tree",elem:"item"},{block:"clearfix"}]};switch("P"==t.page_type&&(n.mods["no-icon"]=!0),t.page_type){case"G":n.content.push({block:"b-cluster-tree",elem:"type",content:{block:"awesome-icon",mods:{icon:"table"}}});break;case"R":n.content.push({block:"b-cluster-tree",elem:"type",content:{block:"awesome-icon",mods:{icon:"share-alt"}}});break;case"403":n.content.push({block:"b-cluster-tree",elem:"type",content:{block:"awesome-icon",mods:{icon:"lock"}}});break;case"404":n.content.push({block:"b-cluster-tree",elem:"type",content:{block:"awesome-icon",mods:{icon:"plus-sign"}}})}n.content.push({block:"b-cluster-tree",elem:"title",content:t.title||t.supertag,attrs:{title:t.title||t.supertag}}),t.children_count&&n.content.push({block:"b-cluster-tree",elem:"count",content:t.children_count}),n.content.push({block:"b-cluster-tree",elem:"supertag",content:t.supertag.replace(e.params.supertag,"")}),n.content.push({block:"b-cluster-tree",elem:"date",elemMods:{type:"created-at"},timestamp:t.created_at||""},{block:"b-cluster-tree",elem:"date",elemMods:{type:"modified-at"},timestamp:t.modified_at||""}),i.push(n)}),i},_onFailedData:function(t,e){this.channel("errors").trigger("error",this._getErrorData(e.message))},_getErrorData:function(t){return{node:this.elem("list"),content:{head:BEM.I18N("b-cluster-tree","cant_load_cluster_tree"),body:t}}},_cutTitles:function(){var t,e,i,n=60,s=this.findElem("title");for(t=0;t<s.length;t++)for(e=null;n<s[t].clientHeight;)i=(n+10)/s[t].clientHeight,e=this._resizeText(e||$(s[t]).html(),i),$(s[t]).html(e)},_resizeText:function(t,e){return t.substring(0,t.length*e)+"&hellip;"},changeSorting:function(t){this.sortBy=t,this._localStorage.setItem("wiki-ct-sort",t),this._getClusterTree()},changeFilter:function(t){this.pageTypes=t,this._localStorage.setItem("wiki-ct-filter",t),this._getClusterTree()},_closePopups:function(){this._clusterTreeSort.findBlockInside("select").close(),this._clusterTreeFilter.findBlockInside("select").close()}}),BEM.DOM.decl("b-cluster-tree-sort",{initBlock:function(){this.clusterTree=this.findBlockOutside("b-cluster-tree"),this.select=this.findBlockInside("select"),this.select.val(this.clusterTree.sortBy),this.select.on("change",this._onSelect,this)},_onSelect:function(){this.clusterTree.changeSorting(this.select.val())}}),BEM.DOM.decl("b-cluster-tree-filter",{initBlock:function(){var t,e;for(this.filters=[{item:"option",value:"G",content:BEM.I18N("b-cluster-tree-filter","tables")},{item:"option",value:"R",content:BEM.I18N("b-cluster-tree-filter","redirects")},{item:"option",value:"404",content:BEM.I18N("b-cluster-tree-filter","non_existent")},{item:"option",value:"403",content:BEM.I18N("b-cluster-tree-filter","closed_pages")}],this.clusterTree=this.findBlockOutside("b-cluster-tree"),this.select=this.findBlockInside("select"),e=this.clusterTree.pageTypes.split(","),t=0;t<this.filters.length;t++)e.indexOf(this.filters[t].value)>-1&&(this.filters[t].selected=1,this.select._selectedIndexes.push(t));this.select.setOptions(this.filters),this.select.on("change",this._onSelect,this)},_onSelect:function(){this.clusterTree.changeFilter(this.select.val())}}),BEM.DOM.decl({name:"select",modName:"type",modVal:"cluster-tree"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._selectedIndexes=[]}},_buttonText:function(){},_getSelectedIndex:function(){return this._selectedIndexes},_selectedIndex:function(t){var e=this._selectedIndexes.indexOf(t),i=this;return this._useNativeControl()||(-1==e?(this._selectedIndexes.push(t),this.setMod(this._items.eq(t),"selected","yes")):(this._selectedIndexes.splice(e,1),this.delMod(this._items.eq(t),"selected"))),this.findElem("option").each(function(t){i._selectedIndexes.indexOf(t)>-1&&$(this).attr("selected","selected")}),this.trigger("change",{index:t,prev:-1}),t},_onSelectItem:function(t){return this._isSelectableItem(t)&&this._selectedIndex(this._curItemIndex),this},val:function(){var t=[],e=this;return this.findElem("option").each(function(i){e._selectedIndexes.indexOf(i)>-1&&t.push(this.value)}),t.join()},_getPopup:function(){if(this._popup)return this._popup;var t=this,e=t.params,i=t.__self.getName(),n={block:i,elem:"list"},s={block:i,elem:"popup",elemMods:{}},o={animate:"no"},r={directions:["bottom-left","top-left"]};["size","layout","theme","width"].forEach(function(e){t.hasMod(e)&&(s.elemMods[e]=t.getMod(e))}),$.extend(s.elemMods,e.elemPopupMods),$.extend(o,e.popupMods),$.extend(r,e.popupParams);var a=$(BEMHTML.apply({block:"popup",mods:o,mix:[s],js:r,content:{elem:"content",content:n}}));return(t._popup=t.findBlockOn(a,"popup")).on({"outside-click":function(e,i){t._isOutsideClicked(e,i)?e.preventDefault():t._blurButton()},hide:function(){t.delMod("opened").delMod(t._items,"hovered").delMod(t.findElem(t._popup.domElem,"popup"),"scrollable")}}).bindTo("mousedown",function(t){t.preventDefault()}),BEM.DOM.append(BEM.DOM.scope,t._popup.domElem),t._redrawList(),t._outPopup=t.findBlockOutside("button","popup"),t._outPopup&&t._outPopup.on("outside-click",function(e,i){t._popup.containsDomElem($(i.target))&&e.preventDefault()}),t._popup}}),BEM.DOM.decl("b-grid-table-settings",{onSetMod:{js:function(){this.bPage=BEM.blocks["i-global"].getbPage(),this._table=this.bPage.findBlockInside("b-grid-table"),this._title=this.findBlockInside(this.elem("grid-title"),"input"),this._sorting=this.findBlockInside("b-grid-table-sorting-controll"),this._saveButton=this.findBlockInside(this.elem("submit"),"button"),this._saveButton.on("click",this._onSave,this)}},_onSave:function(){this._table._saveTitle(this._title.val()),this._sorting.changed&&(this._table._saveSorting(this._sorting.getSortingValue()),this._sorting.changed=!1)}}),BEM.DOM.decl("b-grid-table-sorting-controll",{onSetMod:{js:function(){this._addSortingLink=this.findBlockInside(this.elem("add-sorting"),"link"),this._addSortingLink.on("click",this._onAddSortingClick,this),this.sortings=[],this.fields=[],this.changed=!1,this.bindTo("click",this._onClick.bind(this))}},_onRemoveSorting:function(t){var e=this.findBlockInside(t.data.domElem.closest(this.elem("sorting")),"select").params.defaultValue;this.sortings=this.getCurrentSortings(),this.sortings=this.sortings.filter(function(t){return t.name!==e}),this._buildBlock(),this.elem("sortings")[0].className=this.elem("sortings")[0].className},_onAddSortingClick:function(){var t=!1;this.sortings=this.getCurrentSortings();for(var e=0;e<this.fields.length;e++){for(var i=0;i<this.sortings.length;i++){if(this.fields[e].name===this.sortings[i].name){t=!0;break}t=!1}if(!t){this.sortings.push({type:"asc",name:this.fields[e].name});break}}this._buildBlock()},_buildBlock:function(){BEM.DOM.update(this.elem("sortings"),BEMHTML.apply(this._getBEMJSON())),this.dropElemCache(),this.bindTo(this.elem("delete"),"click",this._onRemoveSorting),this.sortings&&this.sortings.length===this.fields.length?this._addSortingLink.setMod("disabled","yes"):this._addSortingLink.delMod("disabled")},_getBEMJSON:function(){var t=this;return this.sortings&&this.sortings.map(function(e,i){var n={block:t.__self.getName(),elem:"sorting",content:[{elem:"title",content:[{elem:"title-text",tag:"span",content:0===i?BEM.I18N("b-grid-table-sorting-controll","sort"):BEM.I18N("b-grid-table-sorting-controll","then")},{elem:"delete",tag:"span",content:[{block:"awesome-icon",attrs:{title:BEM.I18N("b-grid-table-sorting-controll","remove_sort")},mods:{icon:"remove"}}]}]},{block:t.__self.getName(),elem:"sorting-field",content:{block:"b-grid-table-fields-list",fields:t.fields,selected:e.name}},{block:t.__self.getName(),elem:"sorting-type",content:{block:"b-grid-table-sorting-list",selected:e.type}}]};return n})},_onClick:function(){this.changed=!0},getSortingValue:function(){var t=this,e=[];return this.findElem("sorting").each(function(){var i=t.findBlockInside($(this),"select").val(),n=t.findBlockInside($(this),"radio-button").val(),s={};s[i]=n,e.push(s)}),e},getCurrentSortings:function(){var t=this;return this.findElem("sorting").map(function(){return{name:t.findBlockInside($(this),"select").val(),type:t.findBlockInside($(this),"radio-button").val()}}).toArray()}}),BEM.DOM.decl("b-grid-table-code-form",{onSetMod:{js:function(){this._initBlock()}},_initBlock:function(){BEM.DOM.update(this.domElem,BEMHTML.apply(this._getBEMJSON())),this._bindEvents(),this._updateCode()},_bindEvents:function(){var t=this,e=this._getControls();Object.keys(e).forEach(function(e){t._controls[e].on("change",t._updateCode,t)}),this._textarea||(this._textarea=this.findBlockInside(this.elem("code"),"input")),this._textarea.on("focus",this._onTextareaFocus,this)},_updateCode:function(){this._textarea||(this._textarea=this.findBlockInside(this.elem("code"),"input")),this._textarea.val(this._getCode())},_onTextareaFocus:function(){this._textarea.elem("control").select()},_getCode:function(){var t=this._getControls(),e='"/'+this.params.data.supertag+'" ',i=t.readonly.hasMod("checked","yes")?'readonly="1" ':"",n=t.sorting.hasMod("checked","yes")?"":'sort="0" ',s=t.numbers.hasMod("checked","yes")?"":'num="0" ',o=t.width_units.val(),r=t.width.val();return r&&(r='width="'+r+o+'" '),"{{grid page="+e+i+r+n+s+"}}"},_getControls:function(){return this._controls||(this._controls={width:this.findBlockInside(this.elem("width"),"input"),width_units:this.findBlockInside(this.elem("width"),"select"),readonly:this.findBlockInside(this.elem("readonly"),"checkbox"),sorting:this.findBlockInside(this.elem("show-sorting"),"checkbox"),numbers:this.findBlockInside(this.elem("show-numbers"),"checkbox")}),this._controls},_getBEMJSON:function(){var t=[{block:this.__self.getName(),elem:"code",content:{block:"input",value:"",mods:{type:"textarea",size:"s"},content:{elem:"control",attrs:{readonly:"readonly"}}}},{block:this.__self.getName(),elem:"width",content:{block:"b-grid-table-width-controll",width:this.params.data.width,width_units:this.params.data.width_units,label:BEM.I18N("b-grid-table-code-form","width"),size:"m"}},{block:this.__self.getName(),elem:"readonly",content:{block:"checkbox",mods:{size:"m",checked:this.params.data.read_only?"yes":!1},content:{elem:"label",content:BEM.I18N("b-grid-table-code-form","read_only")}}},{block:this.__self.getName(),elem:"show-numbers",content:{block:"checkbox",mods:{size:"m",checked:this.params.data.show_numbers?"yes":!1},content:{elem:"label",content:BEM.I18N("b-grid-table-code-form","show_line_nums")}}},{block:this.__self.getName(),elem:"show-sorting",content:{block:"checkbox",mods:{size:"m",checked:this.params.data.show_sorting?"yes":!1},content:{elem:"label",content:BEM.I18N("b-grid-table-code-form","can_sort")}}}];return t}}),BEM.DOM.decl({block:"radio-button",modName:"type",modVal:"sidebar"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._sidebar=this.findBlockOutside("b-sidebar"),this.on("change",function(){this._sidebar.refreshSidebarContent()},this)}}}),BEM.DOM.decl({block:"b-page",modName:"type",modVal:"grid"},{onSetMod:{js:function(){var t=this;this.__base.apply(this,arguments),this.highLightCode(),WikiHistory._getRoute(this),$(window).on("statechange",function(){WikiHistory._getRoute(t)}),("ontouchstart"in window||window.navigator.msPointerEnabled)&&this.setMod("browser","touch")}}});var GRID_BEMJSON_DUMMY={data:{tag:"grid",supertag:"grid",title:"grid",grid:{rows:[[{wf_version:"5.0",raw:"НЕ УДАЛЯТЬ!",transformed:{block:"wiki-doc","wiki-attrs":{lang:"ru",path:"",mode:""},content:[{block:"wiki-txt","wiki-attrs":{txt:"НЕ УДАЛЯТЬ!"}}]}},{raw:1},{raw:!0},{raw:!1},{raw:"2013-08-07"},{raw:["пункт 1"]},{raw:["пункт 1"]},{sort:"Филатов Дмитрий",raw:["dfilatov"],transformed:[{login:"dfilatov",first_name:"Дмитрий",last_name:"Филатов"}]},{raw:["bacek","sams"],transformed:[{login:"bacek",first_name:"Василий",last_name:"Чекалкин"},{login:"sams",first_name:"Александр",last_name:"Амилющенко"}]},{raw:"WIKI-1234",transformed:{block:"wiki-doc","wiki-attrs":{lang:"ru",path:"",mode:""},content:[{block:"wiki-jira","wiki-attrs":{status:"Closed",description:"вот здесь: https://wiki.test.tools.yandex-team.ru/WackoWiki почему то раскрыты комменты, хотя я не просил (в урле нет параметра, в настройках показ комментов отключен) https://jing.yandex-team.ru/files/sorgoz/2009-09-11_1646.png",ticket_type:"startrek",assignee_link:"http://staff.yandex-team.ru/thasonic",summary:"На Вики в Тесте всегда показаываются комментарии",project:"WIKI",assignee_login:"thasonic",link_view:"http://st.yandex-team.ru/WIKI-1234",ticket:"1234"}}]}}],[{raw:null,transformed:{}},{raw:null},{raw:!1},{raw:!1},{raw:null},{raw:[]},{raw:[]},{raw:[],transformed:[]},{raw:[],transformed:[]},{raw:null,transformed:{}}],[{wf_version:"5.0",raw:"НЕ УДАЛЯТЬ!",transformed:{block:"wiki-doc","wiki-attrs":{lang:"ru",path:"",mode:""},content:[{block:"wiki-txt","wiki-attrs":{txt:"НЕ УДАЛЯТЬ!"}}]}},{raw:1},{raw:!1},{raw:!1},{raw:"2013-08-07"},{raw:["пункт 1"]},{raw:["пункт 1","пункт 2"]},{sort:"Филатов Дмитрий",raw:["dfilatov"],transformed:[{login:"dfilatov",first_name:"Дмитрий",last_name:"Филатов"}]},{raw:["bacek","sams"],transformed:[{login:"bacek",first_name:"Василий",last_name:"Чекалкин"},{login:"sams",first_name:"Александр",last_name:"Амилющенко"}]},{raw:"WIKI-1234",transformed:{block:"wiki-doc","wiki-attrs":{lang:"ru",path:"",mode:""},content:[{block:"wiki-jira","wiki-attrs":{status:"Closed",description:"вот здесь: https://wiki.test.tools.yandex-team.ru/WackoWiki почему то раскрыты комменты, хотя я не просил (в урле нет параметра, в настройках показ комментов отключен) https://jing.yandex-team.ru/files/sorgoz/2009-09-11_1646.png",ticket_type:"startrek",assignee_link:"http://staff.yandex-team.ru/thasonic",summary:"На Вики в Тесте всегда показаываются комментарии",project:"WIKI",assignee_login:"thasonic",link_view:"http://st.yandex-team.ru/WIKI-1234",ticket:"1234"}}]}}],[{wf_version:"5.0",raw:"НЕ УДАЛЯТЬ!",transformed:{block:"wiki-doc","wiki-attrs":{lang:"ru",path:"",mode:""},content:[{block:"wiki-txt","wiki-attrs":{txt:"НЕ УДАЛЯТЬ!"}}]}},{raw:1},{raw:!0},{raw:!1},{raw:"2013-08-07"},{raw:["пункт 1"]},{raw:["пункт 1"]},{sort:"Филатов Дмитрий",raw:["dfilatov"],transformed:[{login:"dfilatov",first_name:"Дмитрий",last_name:"Филатов"}]},{raw:["bacek","sams"],transformed:[{login:"bacek",first_name:"Василий",last_name:"Чекалкин"},{login:"sams",first_name:"Александр",last_name:"Амилющенко"}]},{raw:"WIKI-1234",transformed:{block:"wiki-doc","wiki-attrs":{lang:"ru",path:"",mode:""},content:[{block:"wiki-jira","wiki-attrs":{status:"Closed",description:"вот здесь: https://wiki.test.tools.yandex-team.ru/WackoWiki почему то раскрыты комменты, хотя я не просил (в урле нет параметра, в настройках показ комментов отключен) https://jing.yandex-team.ru/files/sorgoz/2009-09-11_1646.png",ticket_type:"startrek",assignee_link:"http://staff.yandex-team.ru/thasonic",summary:"На Вики в Тесте всегда показаываются комментарии",project:"WIKI",assignee_login:"thasonic",link_view:"http://st.yandex-team.ru/WIKI-1234",ticket:"1234"}}]}}],[{wf_version:"5.0",raw:"НЕ УДАЛЯТЬ!",transformed:{block:"wiki-doc","wiki-attrs":{lang:"ru",path:"",mode:""},content:[{block:"wiki-txt","wiki-attrs":{txt:"НЕ УДАЛЯТЬ!"}}]}},{raw:1},{raw:!1},{raw:!1},{raw:"2013-08-07"},{raw:["пункт 1"]},{raw:["пункт 1","пункт 2"]},{sort:"Филатов Дмитрий",raw:["dfilatov"],transformed:[{login:"dfilatov",first_name:"Дмитрий",last_name:"Филатов"}]},{raw:["bacek","sams"],transformed:[{login:"bacek",first_name:"Василий",last_name:"Чекалкин"},{login:"sams",first_name:"Александр",last_name:"Амилющенко"}]},{raw:"WIKI-1234",transformed:{block:"wiki-doc","wiki-attrs":{lang:"ru",path:"",mode:""},content:[{block:"wiki-jira","wiki-attrs":{status:"Closed",description:"вот здесь: https://wiki.test.tools.yandex-team.ru/WackoWiki почему то раскрыты комменты, хотя я не просил (в урле нет параметра, в настройках показ комментов отключен) https://jing.yandex-team.ru/files/sorgoz/2009-09-11_1646.png",ticket_type:"startrek",assignee_link:"http://staff.yandex-team.ru/thasonic",summary:"На Вики в Тесте всегда показаываются комментарии",project:"WIKI",assignee_login:"thasonic",link_view:"http://st.yandex-team.ru/WIKI-1234",ticket:"1234"}}]}}]],meta:{autoincrement:4},structure:{fields:[{required:!1,type:"string",sorting:!0,name:"0",title:"Тестовое поле"},{sorting:!0,name:"1",format:"%.2f",required:!1,title:"Число",type:"number"},{markdone:!0,sorting:!0,name:"2",title:"Чекбокс x",required:!1,type:"checkbox"},{markdone:!1,sorting:!0,name:"3",title:"Чекбокс",required:!1,type:"checkbox"},{sorting:!0,name:"4",format:"d.m.Y",required:!1,title:"Дата",type:"date"},{sorting:!0,multiple:!1,name:"5",title:"Список",required:!1,type:"select",options:["пункт 1","пункт 2","пункт 3","пункт 4"]},{sorting:!1,multiple:!0,name:"6",title:"Список мн.",required:!1,type:"select",options:["пункт 1","пункт 2","пункт 3","пункт 4"]},{sorting:!0,multiple:!1,name:"7",title:"Сотрудник",format:"i_first_name i_last_name",required:!1,type:"staff"},{sorting:!1,multiple:!0,name:"8",title:"Сотрудник мн",format:"i_first_name i_last_name",required:!1,type:"staff"},{required:!1,type:"ticket",sorting:!0,name:"9",title:"Jira"}],sorting:[],width:"100%"}}}};!function(t,e,i){"$:nomunge";function n(n,s){function o(e){t(r).each(function(){var i=t(this);this===e.target||i.has(e.target).length||i.triggerHandler(s,[e.target])})}s=s||n+i;var r=t(),a=n+"."+s+"-special-event";t.event.special[s]={setup:function(){r=r.add(this),1===r.length&&t(e).bind(a,o)},teardown:function(){r=r.not(this),0===r.length&&t(e).unbind(a)},add:function(t){var e=t.handler;t.handler=function(t,i){t.target=i,e.apply(this,arguments)}}}}t.map("click dblclick mousemove mousedown mouseup mouseover mouseout change select submit keydown keypress keyup".split(" "),function(t){n(t)}),n("focusin","focus"+i),n("focusout","blur"+i),t.addOutsideEvent=n}(jQuery,document,"outside"),function(t){function e(t,e){for(var i=t.length;i--;)if(t[i]===e)return i;return-1}function i(t,e){if(t.length!=e.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0}function n(t){for(k in y)y[k]=t[I[k]]}function s(t){var i,s,o,r,l,c;if(i=t.keyCode,-1==e(B,i)&&B.push(i),(93==i||224==i)&&(i=91),i in y){y[i]=!0;for(o in w)w[o]==i&&(a[o]=!0)}else if(n(t),a.filter.call(this,t)&&i in v)for(c=p(),r=0;r<v[i].length;r++)if(s=v[i][r],s.scope==c||"all"==s.scope){l=s.mods.length>0;for(o in y)(!y[o]&&e(s.mods,+o)>-1||y[o]&&-1==e(s.mods,+o))&&(l=!1);(0!=s.mods.length||y[16]||y[18]||y[17]||y[91])&&!l||s.method(t,s)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0))}}function o(t){var i,n=t.keyCode,s=e(B,n);if(s>=0&&B.splice(s,1),(93==n||224==n)&&(n=91),n in y){y[n]=!1;for(i in w)w[i]==n&&(a[i]=!1)}}function r(){for(k in y)y[k]=!1;for(k in w)a[k]=!1}function a(t,e,i){var n,s;n=f(t),void 0===i&&(i=e,e="all");for(var o=0;o<n.length;o++)s=[],t=n[o].split("+"),t.length>1&&(s=_(t),t=[t[t.length-1]]),t=t[0],t=E(t),t in v||(v[t]=[]),v[t].push({shortcut:n[o],scope:e,method:i,key:n[o],mods:s})}function l(t,e){var n,s,o,r,a,l=[];for(n=f(t),r=0;r<n.length;r++){if(s=n[r].split("+"),s.length>1&&(l=_(s),t=s[s.length-1]),t=E(t),void 0===e&&(e=p()),!v[t])return;for(o=0;o<v[t].length;o++)a=v[t][o],a.scope===e&&i(a.mods,l)&&(v[t][o]={})}}function c(t){return"string"==typeof t&&(t=E(t)),-1!=e(B,t)}function d(){return B.slice(0)}function u(t){var e=(t.target||t.srcElement).tagName;return!("INPUT"==e||"SELECT"==e||"TEXTAREA"==e)}function h(t){M=t||"all"}function p(){return M||"all"}function m(t){var e,i,n;for(e in v)for(i=v[e],n=0;n<i.length;)i[n].scope===t?i.splice(n,1):n++}function f(t){var e;return t=t.replace(/\s/g,""),e=t.split(","),""==e[e.length-1]&&(e[e.length-2]+=","),e}function _(t){for(var e=t.slice(0,t.length-1),i=0;i<e.length;i++)e[i]=w[e[i]];return e}function g(t,e,i){t.addEventListener?t.addEventListener(e,i,!1):t.attachEvent&&t.attachEvent("on"+e,function(){i(window.event)})}function b(){var e=t.keymaster;return t.keymaster=S,e}var k,v={},y={16:!1,18:!1,17:!1,91:!1},M="all",w={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},x={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220},E=function(t){return x[t]||t.toUpperCase().charCodeAt(0)},B=[];for(k=1;20>k;k++)x["f"+k]=111+k;var I={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey"};for(k in w)a[k]=!1;g(document,"keydown",function(t){s(t)}),g(document,"keyup",o),g(window,"focus",r);var S=t.keymaster;t.keymaster=a,t.keymaster.setScope=h,t.keymaster.getScope=p,t.keymaster.deleteScope=m,t.keymaster.filter=u,t.keymaster.isPressed=c,t.keymaster.getPressedKeyCodes=d,t.keymaster.noConflict=b,t.keymaster.unbind=l,"undefined"!=typeof module&&(module.exports=key)}(this),keymaster.filter=function(){return!0},BEM.DOM.decl("b-grid-table",{onSetMod:{js:function(){this.params.getTableData&&(this.readOnly=this.params.getTableReadOnly===!0,this.showNumbers=this.params.getTableNumbers!==!1,this.bPage=BEM.blocks["i-global"].getbPage(),this.setMod("readonly",Boolean(this.readOnly)),this.tableId="id_"+Date.now(),this.buildGrid(),BEM.blocks["b-grid-table-cell"].on(this.domElem,"save",this._onCellSave,this),BEM.blocks["b-grid-table-head"].on(this.domElem,"sort",this._onSort,this))},mode:{edit:function(){this._editButton.elem("text").text(BEM.I18N("b-grid-table","finish")),this._bindEvents(),this.trigger("start-edit"),this.bindToDomElem(this.elem("row-delete"),"click",this._onRowDeleteClick),this._newRow.setMod("ready","yes")},"":function(){this._editButton.elem("text").text(BEM.I18N("b-grid-table","edit")),this._unbindEvents(),this.trigger("stop-edit"),this.unbindFromDomElem(this.elem("row-delete"),"click"),this._newRow.setMod("ready","no")}},edit:{row:function(){},"":function(){}}},_onSort:function(t,e){this._gridData=e,this.rebuild(),this.trigger("sorted")},createRowAfter:function(t,e){var i,n,s=this;this._newRow.hasMod("ready","no")||(this._newRow.setMod("ready","no"),n={version:this._gridData.version,changes:[{added_row:{after_id:t?t.params.row_id:"-1",data:{}}}]},t?(BEM.DOM.after(t.domElem,BEMHTML.apply(this._getEmptyRow())),t.delMod("state"),t._activeCell&&t._activeCell.delMod("state"),i=t.domElem.next().bem("b-grid-table-row")):(BEM.DOM.prepend(this.elem("body"),BEMHTML.apply(this._getEmptyRow())),i=this.findBlockInside(this.elem("body"),"b-grid-table-row")),i.setMod("state","edit").delMod("type"),e||setTimeout(function(){i.findBlocksInside("b-grid-table-cell")[s.showNumbers?1:0].setMod("state","edit")},0),BEM.create("api-request",{_:"api-response",apiPath:".grid/rows",path:"/"+this.params.getTableData,method:"POST",data:n,urlParams:this.gridOptionsUrlParams()}).run().then(this._onAddRow.bind(this,i),this._onFailedAddRow.bind(this)))},_onAddRow:function(t,e){this._gridData.version=e.data.version,t.params.row_id=e.data.id,t._activeCell&&(t._activeCell.params.row_id=e.data.id),this.trigger("row-added"),this._rebindEvents(),this.delMod("empty"),this._newRow.setMod("ready","yes")},_onFailedAddRow:function(t){console.log(t),this._newRow.setMod("ready","yes")},_onEdit:function(){this.readOnly||(this.toggleMod("mode","edit"),this.trigger("grid-edit"))},buildGrid:function(){this._notNew||BEM.DOM.update(this.domElem,BEMHTML.apply({block:this.__self.getName(),elem:"i",content:{block:"spinner",mods:{size:"s",progress:"yes"}}}),this._buildContent,this)},_buildContent:function(t){return t===!0&&(this._setEditAfterRebuild=!0),BEM.create("api-request",{_:"api-response",apiPath:".grid",path:"/"+this.params.getTableData,urlParams:this.gridOptionsUrlParams(["format=json"])}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this))},_onGotData:function(t){return this._gridData=t.data,this._gridData.structure?(this.rebuild(),void 0):(this._showGridError(BEM.I18N("b-grid-table","incorrect_format")),void 0)},rebuild:function(){var t=this;this.params.isAction?this.params.getTableWidth&&this.domElem.css({width:this.params.getTableWidth}):this.domElem.css({width:"100%"}),this._notNew&&(this.delMod("mode"),this.dropElemCache()),BEM.blocks["b-grid-table-token"].un(this.domElem,"remove"),BEM.blocks["b-grid-table-cell"].un(this.domElem,"start-edit"),BEM.blocks["b-grid-table-row"].un(this.domElem,"start-edit"),BEM.blocks["b-grid-table-cell"].un(this.domElem,"save"),setTimeout(function(){BEM.DOM.update(t.elem("i"),BEMHTML.apply(t._buildGridBEMJSON()),t._afterUpdate,t)},0),BEM.blocks["b-grid-table-cell"].on(this.domElem,"save",this._onCellSave,this),this._updateSidebarSettings()},_afterUpdate:function(){this._notNew=!0,this._editButton=this.findBlockInside({block:"button",modName:"type",modVal:"edit"}),this._editButton&&this._editButton.on("click",this._onEdit,this),this._newRow=this.findBlockInside("b-grid-table-new-row"),this._setEditAfterRebuild&&(this._onEdit(),this._setEditAfterRebuild=!1),window.localStorage["wiki-new-grid"]&&(this._onEdit(),this.findBlockInside({block:"b-grid-table-head",modName:"type",modVal:"new-col"})._onEditClick("create"),window.localStorage.removeItem("wiki-new-grid"))},_bindEvents:function(){this.bindTo(this.findElem("body","tr"),"mouseenter",this._onRowMouseEnter),BEM.blocks["b-grid-table-head"].on(this.domElem,"delete",this._onColDelete,this),this.bindTo(this.domElem,"clickoutside",this._onTableOutsideClick)},_unbindEvents:function(){this.unbindFrom(this.elem("tr"),"mouseenter"),BEM.blocks["b-grid-table-head"].un(this.domElem,"delete"),this.unbindFrom(this.domElem,"clickoutside")},_rebindEvents:function(){this._unbindEvents(),this.dropElemCache(),this._bindEvents()},_onColDelete:function(t,e){var i;e.table==this.tableId&&(i={version:this._gridData.version,changes:[{removed_column:{name:t.block.params.id}}]},BEM.create("api-request",{_:"api-response",apiPath:".grid/change_and_get_document",path:"/"+this.params.getTableData,method:"POST",data:i,urlParams:this.gridOptionsUrlParams()}).run().then(this._onColDeleteSuccess.bind(this),this._onColDeleteFail.bind(this)))},_onColDeleteSuccess:function(t){this.dropElemCache(),this._setEditAfterRebuild=!0,this._gridData=t.data.grid,this.rebuild()},_onColDeleteFail:function(){console.log(e)},_onCellSave:function(t,e){var i={version:this._gridData.version,changes:[{edited_row:{id:e.rowId,data:{}}}]};i.changes[0].edited_row.data[t.block.params.name]=e.val?e.val:"",BEM.create("api-request",{_:"api-response",apiPath:".grid/change_get_cell",path:"/"+this.params.getTableData,method:"POST",data:i,urlParams:this.gridOptionsUrlParams()}).run().then(this._onCellSaveSuccess.bind(this,t),this._onCellSaveFail.bind(this))},_onCellSaveSuccess:function(t,e){this._gridData.version=e.data.version,t.block.trigger("saved",e)},_onCellSaveFail:function(t){t.block.trigger("save-error"),console.log(t)},_onRowDeleteClick:function(){var t={version:this._gridData.version,changes:[{removed_row:{id:this._currentRow.bem("b-grid-table-row").params.row_id}}]};BEM.create("api-request",{_:"api-response",apiPath:".grid/change",path:"/"+this.params.getTableData,method:"POST",data:t,urlParams:this.gridOptionsUrlParams()}).run().then(this._onRowDelete.bind(this),this._onRowDeleteFail.bind(this))},_onRowDelete:function(t){var e=this._currentRow.next();this._gridData.version=t.data.version,BEM.DOM.destruct(this._currentRow),this._currentRow=e,0===this._currentRow.prev().length&&0===this._currentRow.next().length&&this.setMod("empty","body"),this.elem("row-delete").css({top:0,height:0}),this.trigger("row-delete")},_onRowDeleteFail:function(t){console.log(t)},_onRowMouseEnter:function(t){this._currentRow=$(t.currentTarget),this.elem("row-delete").css({top:this._currentRow.offset().top-this.domElem.offset().top,height:this._currentRow.outerHeight()})},_onFailedData:function(t){console.log(t),t.message?this._showGridError(t.message):this._showGridError(BEM.I18N("b-grid-table","cant_load_table"),!0)},_showGridError:function(t,e){var i=[];i.push(t),e&&i.push({block:"button",mods:{size:"s",type:"build"},content:BEM.I18N("b-grid-table","try_more")}),BEM.DOM.update(this.domElem,BEMHTML.apply({block:"b-grid-error",content:{elem:"message",content:i}}),this._onGridErrorMessage,this)},_onGridErrorMessage:function(){this._buildButton=this.findBlockInside({block:"button",modName:"type",modVal:"build"}),this._buildButton&&this._buildButton.on("click",this._onBuildButtonClick,this)},_onBuildButtonClick:function(){this.buildGrid()},_onTableOutsideClick:function(){this._preventRowOutside||this._lockOutsideClicks||this._onEdit()},_saveTitle:function(t){var e;this._gridData.structure.title!=t&&(e={version:this._gridData.version,changes:[{title_changed:{title:t}}]},BEM.create("api-request",{_:"api-response",apiPath:".grid/change",path:"/"+this.params.getTableData,method:"POST",data:e,urlParams:this.gridOptionsUrlParams()}).run().then(this._onTitleSaveSuccess.bind(this,t),this._onTitleSaveFail.bind(this)))},_onTitleSaveSuccess:function(t,e){var i=this.bPage.findBlockInside("b-grid-table-settings");this._gridData.version=e.data.version,document.title=(t||BEM.I18N("b-grid-table","page"))+" @ Wiki",this.bPage.findBlockInside("b-page-title").domElem.text(t),this._gridData.structure.title=t,i.findBlockInside(i.elem("grid-title"),"input").val(t)},_onTitleSaveFail:function(){console.log(e)},_saveSorting:function(t){var e={version:this._gridData.version,changes:[{sorting_changed:{sorting:t}}]};BEM.create("api-request",{_:"api-response",apiPath:".grid/change_and_get_document",path:"/"+this.params.getTableData,method:"POST",data:e,urlParams:this.gridOptionsUrlParams()}).run().then(this._onSortingSaveSuccess.bind(this),this._onSortingSaveFail.bind(this))
},_onSortingSaveSuccess:function(t){this.dropElemCache(),this._gridData=t.data.grid,this.rebuild()},_onSortingSaveFail:function(t){console.log(t)},_buildGridBEMJSON:function(){var t=[{block:this.__self.getName(),elem:"head-indicator"},{block:this.__self.getName(),elem:"row-indicator"},{block:this.__self.getName(),elem:"row-dragger",attrs:{draggable:!0},content:{block:"awesome-icon",mods:{icon:"ellipsis-vertical"}}},{block:this.__self.getName(),elem:"row-delete",content:{block:"awesome-icon",mods:{icon:"remove"}}},{block:this.__self.getName(),elem:"table",content:[this._buildGridHeadBEMJSON()].concat(this._buildGridBodyBEMJSON())}];return this.readOnly||t.push({block:"b-grid-table-bar",js:!0,content:[{block:"b-grid-table-options",js:{gridUrl:this.params.getTableData,isAction:this.params.isAction,actuality:this.bPage.getMod("actuality")}},{block:"button",mods:{size:"s",theme:"action",type:"edit"},content:BEM.I18N("b-grid-table","edit")}]}),t},_buildGridHeadBEMJSON:function(){var t,e=this._gridData.structure.fields,i=this._getRowBEMJSON(),n=!0;return i.mods={type:"head"},this.showNumbers&&i.content.push({block:"b-grid-table-head",mods:{type:"settings"},tag:"th"}),e.forEach(function(t){var e=t.type,s=t.sorting?"asc"===t.sorting?"sort-down":"sort-up":"angle-down",o={block:"b-grid-table-head",attrs:{draggable:!0},mix:[{block:"b-grid-table-head-draggable",js:!0}],tag:"th",js:{id:t.name,required:t.required?!0:!1,value:t.title,width:t.width?t.width:!1,width_units:t.width?t.width_units:!1,markdone:t.markdone?!0:!1,options:t.options?t.options:!1},content:{elem:"i",content:[{elem:"text",content:t.title},{elem:"edit",content:{block:"awesome-icon",mods:{icon:"reorder"}}},{elem:"sort",content:{block:"awesome-icon",mods:{icon:s,type:"sort"}}}]}};t.width&&(o.attrs.style="width: "+t.width+t.width_units),"select"===t.type&&t.multiple===!0&&(e="multiselect"),"staff"===t.type&&t.multiple===!0&&(e="multistaff"),o.js.type=e,"px"!=t.width_units&&(n=!1),i.content.push(o)}),n&&this.domElem.css({width:"auto"}),this._newColId=Date.now(),i.content.push({block:"b-grid-table-head",js:{id:this._newColId},mods:{type:"new-col"},tag:"th",content:{elem:"edit",content:{block:"awesome-icon",mods:{icon:"plus"}}}}),t={block:this.__self.getName(),elem:"head",tag:"thead",content:i}},_buildGridBodyBEMJSON:function(){var t,e,i=this,n={block:this.__self.getName(),elem:"body",tag:"tbody",content:[]},s=this._gridData.rows;return s.forEach(function(s){e={raw:[]},t=i._getRowBEMJSON(),i.showNumbers&&t.content.push({block:"b-grid-table-cell",mods:{type:"counter"},tag:"td"}),t.mix.push({block:"b-grid-table-row-draggable",js:!0}),s.forEach(function(n,s){var o=i._gridData.structure.fields[s],r=o.type;e.raw.push(n.raw),"checkbox"===r&&o.markdone&&n.raw===!0&&(t=i._markRowChecked(t)),"select"===r&&o.multiple===!0&&(r="multiselect"),"staff"===r&&o.multiple===!0&&(r="multistaff"),"ticket"===r&&(i.isTicket=!0),t.content.push(i._getCell(r,n,o))}),e.row_id=s[0]?s[0].row_id:-1,t.js=e,t.content.push(i._getNewColCell()),n.content.push(t)}),n.content.push(this._getNewRow()),s.length||this.setMod("empty","body"),n},_getNewColCell:function(){return{block:"b-grid-table-cell",mods:{type:"new-col"},tag:"td"}},_getCell:function(t,e,i){var n={block:"b-grid-table-cell",mods:{type:t},js:{raw:e.raw,name:i.name},tag:"td",content:[this._getContentByType(t,e,i)]};return i.required&&(n.mods.required="yes",e._isEmpty&&(n.mods["required-empty"]="yes"),n.content.push({block:"b-grid-table-required-info",content:BEM.I18N("b-grid-table","this_required")})),-1===t.search(/^ticket-/)&&(n.mods.editable="yes"),i.options&&(n.js.options=i.options),("staff"===t||"multistaff"===t)&&(n.js.transformed=e.transformed),n},_swapStructure:function(t,e,i){var n=this._gridData.structure[i];n.splice(e,0,n.splice(t,1)[0])},_getNewRow:function(){return{block:"b-grid-table-new-row",js:!0,tag:"tr",content:{elem:"cell",attrs:{colspan:this._gridData.structure.fields.length+2},tag:"td",content:BEM.I18N("b-grid-table","add_line")}}},_getEmptyRow:function(){var t,e,i={raw:[]},n=this._gridData.structure.fields.length,s=this._getRowBEMJSON(),o=this._gridData.structure.fields;s.mods={type:"new"},this.showNumbers&&s.content.push({block:"b-grid-table-cell",mods:{type:"counter"},tag:"td"}),s.mix.push({block:"b-grid-table-row-draggable",js:!0});for(var r=0;n>r;r++)t=o[r].type,"select"===o[r].type&&o[r].multiple===!0&&(t="multiselect"),"staff"===o[r].type&&o[r].multiple===!0&&(t="multistaff"),e={raw:""},"number"===o[r].type&&(e.raw=null),"checkbox"===o[r].type&&(e.raw=!1),("select"===o[r].type||"staff"===o[r].type)&&(e.raw=[],e.transformed=[]),i.raw.push(e),s.content.push(this._getCell(t,e,o[r]));return s.js=i,s.content.push(this._getNewColCell()),s},_getRowBEMJSON:function(){return{block:"b-grid-table-row",mix:[{block:this.__self.getName(),elem:"tr"}],tag:"tr",content:[]}},_getContentByType:function(t,e,i){var n;switch(t){case"string":n=this._getStringBEMJSON(e);break;case"number":n=this._getNumberBEMJSON(e);break;case"checkbox":n=this._getCheckBoxBEMJSON(e,i);break;case"date":n=this._getDateBEMJSON(e);break;case"select":n=this._getSelectBEMJSON(e);break;case"multiselect":n=this._getMultiSelectBEMJSON(e);break;case"staff":n=this._getStaffBEMJSON(e);break;case"multistaff":n=this._getStaffBEMJSON(e);break;case"ticket":n=this._getTicketBEMJSON(e);break;case"ticket-subject":n=e.view||e.raw||"";break;case"ticket-type":n=e.view||e.raw||"";break;case"ticket-assignee":n="";break;case"ticket-reporter":n="";break;case"ticket-status":n=e.view||e.raw||"";break;case"ticket-priority":n=e.view||e.raw||"";break;case"ticket-createdat":n=this._getTicketDateString(e);break;case"ticket-updatedat":n=this._getTicketDateString(e);break;default:n=BEM.I18N("b-grid-table","undefined_column")}return n},_getTicketDateString:function(t){var e,i;return t.view&&(i=BEM.blocks["mi-helpers"].getDateFromHumanString(t.view),i=BEM.blocks["mi-helpers"].getHumanStringFromDate({date:i}),e={block:"m-date","short":!0,format:"middle",alwaysShowYear:!0,timestamp:i}),e?e:""},_getTicketBEMJSON:function(t){var e={block:"b-grid-table-ticket"};return t.raw&&(e.content={block:"link",url:t.url,content:t.raw}),e},_getStringBEMJSON:function(t){var e="";return t.transformed?e=JSON.parse(t.transformed):t._isEmpty=!0,e},_getNumberBEMJSON:function(t){var e={block:"b-grid-table-number-cell",content:null===t.raw?"":t.raw};return null===t.raw&&(t._isEmpty=!0),e},_getCheckBoxBEMJSON:function(t,e){var i={block:"b-grid-table-checkbox",mods:{}};return e.markdone&&(i.mods.markdone="yes"),t.raw===!0&&(i.mods.checked="yes"),this.readOnly&&(i.mods.disabled="yes"),{block:"b-grid-table-cell",elem:"edit",content:i}},_getDateBEMJSON:function(t){return dateBEMJSON="",t.raw?dateBEMJSON={block:"m-date","short":!0,format:"middle",alwaysShowYear:!0,timestamp:t.raw}:t._isEmpty=!0,dateBEMJSON},_getMultiSelectBEMJSON:function(t){var e=t.raw,i={block:"b-grid-table-plain-list"};return e&&e.length?i.content=e.join(", "):t._isEmpty=!0,i},_getSelectBEMJSON:function(t){var e={block:"b-grid-table-plain-list",content:""};return t.raw&&t.raw.length?e.content=t.raw:t._isEmpty=!0,e},_getStaffBEMJSON:function(t){var e=t.transformed,i={block:"b-grid-table-cell",elem:"i",content:{block:"b-grid-table-users"}};return e&&e.length?(i.content.content=[],e.forEach(function(t,n){i.content.content.push({block:"b-user",mix:[{block:"mi-staff-card",js:{user:t.login}}],url:"http://staff.yandex-team.ru/"+t.login,content:t.first_name+" "+t.last_name}),n!=e.length-1&&i.content.content.push(", ")})):t._isEmpty=!0,i},_markRowChecked:function(t){return t.mods=t.mods||{},t.mods.checked="yes",t},_updateSidebarSettings:function(){var t=this._gridData.structure.title,e=this._gridData.structure.sorting,i=this._gridData.structure.fields,n=this.bPage.findBlockInside("b-grid-table-settings");n&&(n.findBlockInside(n.elem("grid-title"),"input").val(t),n.findBlockInside("b-grid-table-sorting-controll").sortings=e,n.findBlockInside("b-grid-table-sorting-controll").fields=i,n.findBlockInside("b-grid-table-sorting-controll")._buildBlock())},gridOptionsUrlParams:function(t){var e=t||[];return this.params.getTableSort&&e.push("sort="+this.params.getTableSort),this.params.getTableFilter&&e.push("filter="+this.params.getTableFilter),this.params.getTableWidth&&e.push("width="+this.params.getTableWidth),this.params.getTableNumbers&&e.push("num="+this.params.getTableNumbers),this.params.getTableColumns&&e.push("columns="+this.params.getTableColumns),e.length?e:!1}}),BEM.DOM.decl("b-grid-table-cell",{onSetMod:{state:{edit:function(){this._initBlock(),this.trigger("start-edit")},"":function(){this.domElem.removeAttr("style"),this.unbindFrom(this.domElem,"clickoutside"),this.unbindFrom(BEM.DOM.win,"resize.cellWidth"),this.trigger("stop-edit"),this._save()}}},val:function(){return this.hasMod("state","edit")||this.hasMod("saving","yes")?!0:!1},_initBlock:function(){this._storage||this._createStorage(),this._storage._row=this.findBlockOutside("b-grid-table-row"),this._storage._table.hasMod("mode","edit")&&this._storage._row.setMod("state","edit"),!this.params.row_id&&this._storage._row.params.row_id&&(this.params.row_id=this._storage._row.params.row_id),this.bindTo(this.domElem,"clickoutside",this._onClickOutside),this.on("saved",this._onSaved),this.on("save-error",this._onSaveError)},_onClick:function(){this.hasMod("state","edit")||(this._storage||this._createStorage(),this._storage._table.hasMod("mode","edit")&&(this._setSizes(),this.setMod("state","edit")))},_onClickOutside:function(){this.delMod("state")},_resetValue:function(){},_setSizes:function(){this._getSizesInfo(),this.domElem.css({width:this._sizes.width,height:this._sizes.height})},_getSizesInfo:function(){this._sizes={width:this.domElem.width(),height:this.domElem.height(),outerWidth:this.domElem.outerWidth(),outerHeight:this.domElem.outerHeight()}},_onSaved:function(t,e){this.delMod("saving").delMod("required-empty"),this._clearEditSize(),this.params.raw=e.data.cell.raw,this._isRequiredAndEmpty()&&this.setMod("required-empty","yes"),this.channel("errors").trigger("errorHide")},_onSaveError:function(){this._clearEditSize()},_isRequiredAndEmpty:function(){return this.hasMod("required")?this.params.raw?"object"!=typeof this.params.raw||this.params.raw.length?!1:!0:!0:!1},_createStorage:function(){var t=this.findBlockOutside("b-grid-table");this.__self[t.tableId]||(this.__self[t.tableId]={_table:t}),this._storage=this.__self[t.tableId]},_setEdit:function(){this._resizeEdit(),this.bindTo(BEM.DOM.win,"resize.cellWidth",this._resizeEdit,this),this.setMod("state","edit")},_resizeEdit:function(){},_clearEditSize:function(){},_save:function(){return{rowId:this.params.row_id,cellPosition:this.domElem.index()-(this._storage._table.showNumbers?1:0),tableId:this._storage._table.tableId}},_hasChanges:function(t,e){if(e.length!==t.length)return!1;for(var i=0;i<t.length;i++)if(t[i]!=e[i])return!1;return!0}},{live:function(){this.liveBindTo("click",function(){return this.hasMod("editable","yes")?(this._onClick(),void 0):(this._storage||this._createStorage(),this._storage._row&&this._storage._row.delMod("state"),!1)}),this.liveBindTo("dblclick",function(){this._storage||this._createStorage(),!this._storage._table.hasMod("mode","edit")&&this.hasMod("editable","yes")&&this._storage._table._onEdit(),this._onClick()})}}),BEM.DOM.decl("b-grid-table-token",{_onClick:function(){this.trigger("remove")}},{live:function(){this.liveBindTo("remove","click",function(){return this._onClick(),!1})}}),BEM.DOM.decl("m-calendar",{_popUpOpened:!1,onSetMod:{js:function(){this.params.value&&(this._notTriggerChange=!0,this.setDate(this.params.value))}},getDatePicker:function(){return this._datePicker||!1},setDate:function(t){this._datePicker&&this._popUpOpened||(this.params.value=t,this._buildDatePicker()),this._datePicker.setDate(t,!0)},getDate:function(){return this._datePicker||this._buildDatePicker(),this._datePicker.getDate()},clearDate:function(){this._datePicker||this._buildDatePicker(),this._datePicker.clearDate()},_onDateChange:function(){this._popUpOpened&&this.params.autoclose&&this._datePickerPopup.hide(),!this._notTriggerChange&&this.trigger("change",this._datePicker.getDate()),this._notTriggerChange=!1},_onTogglerClick:function(){this._datePicker||this._buildDatePicker(),this._datePickerPopup.show(this.elem("toggler")),this._datePicker.setSizes()},_onDatePickerPopupHide:function(){this.input._isDatePickerOpened=!1,this._popUpOpened=!1,this.trigger("hide")},_onDatePickerPopupShow:function(){this._popUpOpened=!0,this.trigger("show")},_buildDatePicker:function(){this._buildPopup(),this._datePicker=$(BEMHTML.apply(this._getDatePickerBEMJSON())).bem("m-datepicker"),this._datePicker.on("change",this._onDateChange,this),this._datePickerPopup.setContent(this._datePicker.domElem).on("hide",this._onDatePickerPopupHide,this).on("show",this._onDatePickerPopupShow,this)},_buildPopup:function(){this._datePickerPopup||(this._datePickerPopup=$(BEMHTML.apply({block:"popup",mix:[{block:"m-calendar",elem:"popup",elemMods:{type:this.getMod("type")}}],content:[{elem:"tail"},{elem:"content"}]})).bem("popup"))}});var dateFormat=function(){var t=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,e=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,i=/[^-+\dA-Z]/g,n=function(t,e){for(t=String(t),e=e||2;t.length<e;)t="0"+t;return t};return function(s,o,r){var a=dateFormat;1!=arguments.length||"[object String]"!=Object.prototype.toString.call(s)||/\d/.test(s)||(o=s,s=void 0);try{if(s=s?new Date(s):new Date,isNaN(s))throw SyntaxError("invalid date");o=String(a.masks[o]||o||a.masks["default"]),"UTC:"==o.slice(0,4)&&(o=o.slice(4),r=!0);var l=r?"getUTC":"get",c=s[l+"Date"](),d=s[l+"Day"](),u=s[l+"Month"](),h=s[l+"FullYear"](),p=s[l+"Hours"](),m=s[l+"Minutes"](),f=s[l+"Seconds"](),_=s[l+"Milliseconds"](),g=r?0:s.getTimezoneOffset(),b={d:c,dd:n(c),ddd:BEM.I18N("i-tanker__days","short"+(d+1)),dddd:BEM.I18N("i-tanker__days","n"+(d+1)),m:u+1,mm:n(u+1),mmm:BEM.I18N("i-tanker__months","short"+(u+1)),mmmm:BEM.I18N("i-tanker__months","short"+(u+1)),yy:String(h).slice(2),yyyy:h,h:p%12||12,hh:n(p%12||12),H:p,HH:n(p),M:m,MM:n(m),s:f,ss:n(f),l:n(_,3),L:n(_>99?Math.round(_/10):_),t:12>p?"a":"p",tt:12>p?"am":"pm",T:12>p?"A":"P",TT:12>p?"AM":"PM",Z:r?"UTC":(String(s).match(e)||[""]).pop().replace(i,""),o:(g>0?"-":"+")+n(100*Math.floor(Math.abs(g)/60)+Math.abs(g)%60,4),S:["th","st","nd","rd"][c%10>3?0:(c%100-c%10!=10)*c%10]};return o.replace(t,function(t){return t in b?b[t]:t.slice(1,t.length-1)})}catch(k){}}}();dateFormat.masks={"default":"d mmm yyyy"},BEM.DOM.decl({name:"m-calendar",modName:"toggler",modVal:"button"},{onSetMod:{js:function(){this.input=this.findBlockInside({block:"button",modName:"toggler",modVal:"datepicker"}),this.__base.apply(this,arguments),this.input.on("click",this._onTogglerClick,this),this.bindTo(this.input.domElem,"mouseout",this._onInputMouseOut)}},_onInputMouseOut:function(){this._popUpOpened||(this.input._isDatePickerOpened=!1,this.input.delMod("pressed").delMod("focused"))},_onTogglerClick:function(){var t=this;return this._preventClick?(this._preventClick=!1,!1):(this.__base.apply(this,arguments),this._datePickerPopup.on("outside-click",function(e,i){i.target==t.input.elem("input")[0]&&(t._preventClick=!0,t._hideWithFocus())}),this.bindToDoc("keydown.close",function(e){(13===e.which||32===e.which)&&(t._preventClick=!0,t._hideWithFocus()),(9===e.which||27===e.which)&&(t._preventClick=!1,t._hideWithFocus())}),void 0)},_hideWithFocus:function(){this._datePickerPopup.hide(),this.input.setMod("focused","yes")},_onDateChange:function(t,e){var i=this.input.elem("input"),n=this.input.elem("text");e?e.from?(i.val(BEM.blocks["mi-helpers"].getHumanStringFromDate({date:e.from})+" — "+BEM.blocks["mi-helpers"].getHumanStringFromDate({date:e.to})),n.text(dateFormat(e.from)+" — "+dateFormat(e.to))):(i.val(e.toISOString()),n.text(dateFormat(e))):(i.val(""),n.text(this.params.defaultText)),this.__base.apply(this,arguments)},_onDatePickerPopupHide:function(){this.__base.apply(this,arguments),this.input.delMod("focused"),this.input.delMod("pressed"),this._datePickerPopup.un("outside-click"),this.unbindFromDoc("keydown.close")}}),BEM.DOM.decl({name:"m-calendar",modName:"type",modVal:"month"},{_getDatePickerBEMJSON:function(){var t={block:"m-datepicker",mods:{type:"month"},js:{}};return this.hasMod("has","clear")&&(t.mods.has="clear"),t.js.value=this.params.value,t.js.date=this.params.date,this.params.specialDays&&(t.js.specialDays=this.params.specialDays),t},setSpecialDays:function(t){this._datePicker.setSpecialDays(t)}}),BEM.DOM.decl("m-datepicker",{getDate:function(){return this._isDateSelected?this._selectedDate:!1},getSelectedDay:function(){return this._isDateSelected?this._selectedDate.getDate():!1},setDate:function(t,e){if("string"==typeof t)this._selectedDate=BEM.blocks["mi-helpers"].getDateFromHumanString(t);else{if("object"!=typeof t)throw new Error("Wrong argument! Should be ISOString string or { from: ISOString, to: ISOString } object");this._selectedDate={from:BEM.blocks["mi-helpers"].getDateFromHumanString(t.from),to:BEM.blocks["mi-helpers"].getDateFromHumanString(t.to)}}this._isDateSelected=!0,this.trigger("change",this.getDate()),e||this._buildDatepicker(),this.clearButton&&this.clearButton.delMod("disabled")},clearDate:function(){this._isDateSelected=!1,this.trigger("change",this.getDate())},_getFootElemBEMJSON:function(t){return{block:"m-datepicker",elem:"foot",content:t}},_getStartDay:function(t,e,i){var n;return"string"==typeof t||"number"==typeof t?(i=e,e=t,n=new Date(i,e,1).getDay()):n=t.getDay(),0===n&&(n=7),n},_getMonthDays:function(t,e){var i=[31,28,31,30,31,30,31,31,30,31,30,31],n=i[t];return 1!=t||e%4!==0||e%100===0&&e%400!==0||(n=29),n},_isDateSelected:!1}),BEM.DOM.decl({name:"m-datepicker",modName:"type",modVal:"month"},{onSetMod:{js:function(){this.hasMod("disable","change")&&(this.changeDisabled=!0),this._todayDate=new Date,this.params.specialDays&&(this._specialDays=this.params.specialDays,this.setMod("special-days","yes")),this.params.value?this.setDate(this.params.value):this._buildDatepicker(),this.changeDisabled||this.bindTo("mousewheel",this._onMouseWheel)}},setSpecialDays:function(t){this._specialDays=t,this._buildDatepicker()},_onMouseWheel:function(t,e,i,n){return t.preventDefault(),this._isChangeCalendarRunning?!1:(this._isChangeCalendarRunning=!0,(0>i||n>0)&&this._changeMonth("next"),(i>0||0>n)&&this._changeMonth("previous"),void 0)},setSizes:function(){var t,e=this.findElem("bodies");if(!this._sizes){if(t=this.findElem("grid-table"),!t.width()||!t.height())return;this._sizes={gridWidth:t.width(),gridHeight:t.height(),titleHeight:this.findElem("title","position","current").height()}}e.css({width:this._sizes.gridWidth,height:this._sizes.gridHeight}),this.findElem("head").height(this._sizes.titleHeight),this._blockSizeSet||(this.domElem.width(this.domElem.outerWidth()),this.domElem.height(this.domElem.outerHeight()),this._blockSizeSet=!0)},_onTitleClick:function(){var t=this;this.toggleMod("show","great-chooser"),this.hasMod("show","great-chooser")?(this._subscribeChooserControlls(),this.gereatChooserData={year:this._dates.current.year,month:this._dates.current.month},this.yearChooser.val(this._dates.current.year),this.monthChooserButtons.forEach(function(e){e.val(t._dates.current.month.toString())})):this._unsubscribeChooserControlls()},_subscribeChooserControlls:function(){var t=this;this.monthChooserButtons.forEach(function(e){e.on("change",t._onChooserMonthChange,t)}),this.yearChooser.on("change",this._onChooserYearChange,this),this.chooserSubmit.on("click",this._onChooserSubmit,this)},_unsubscribeChooserControlls:function(){this.monthChooserButtons.forEach(function(t){t.un("change")}),this.yearChooser.un("change"),this.chooserSubmit.un("click")},_onChooserSubmit:function(){this.delMod("show"),this._buildDatepicker(new Date(this.gereatChooserData.year,this.gereatChooserData.month,1))},_onChooserMonthChange:function(t){this.gereatChooserData.month=t.target.val()},_onChooserYearChange:function(t){var e=parseInt(t.target.val(),10);isNaN(e)?t.target.val(t.target.val().substring(1)):t.target.val(e),this.gereatChooserData.year=t.target.val()},_bindToDates:function(){this.bindTo(this.findElem("dates"),"click",this._onDateChoose)},_onChangeMonthButtonClick:function(t){var e=t.target.getMod("target");this._isChangeCalendarRunning||this._changeMonth(e)},_changeMonth:function(t){var e=this,i=BEM.I18N("i-tanker__months","n"+(this._dates[t].month+1))+" "+this._dates[t].year,n=this.findElem("body","position","back"),s=this.findElem("body","position","current"),o=this.findElem("title","position","back"),r=this.findElem("title","position","current"),a=n.add(o),l=s.add(r),c=n.add(s).add(o).add(r);this.setMod(c,"transition","no").setMod(a,"direction",t)._isChangeCalendarRunning=!0,BEM.DOM.update(n,BEMHTML.apply(this._buildDatepickerGridBEMJSON(this._dates[t]))),BEM.DOM.update(o,BEMHTML.apply(this._getTitleClickBEMJSON(i))),this._createDateContext(new Date(this._dates[t].year,this._dates[t].month,1)),setTimeout(function(){e.delMod(c,"transition").delMod(a,"direction").setMod(l,"direction",t)},50),n.on("TransitionEnd webkitTransitionEnd transitionend oTransitionEnd MSTransitionEnd",function(){e.setMod(c,"transition","no").setMod(a,"position","current").setMod(l,"position","back").delMod(l,"direction"),BEM.DOM.update(l,""),n.off(),e._bindToDates(),e._bindTitleClick(),e._isChangeCalendarRunning=!1,e.setSizes()})},_getTitleClickBEMJSON:function(t){return{block:"m-datepicker",elem:"title-click",tag:"span",content:t}},_bindTitleClick:function(){this.bindTo(this.findElem("title-click"),"click",this._onTitleClick)},_createDateContext:function(t){var e,i,n=new Date(t);n.setDate(1),e=new Date(n),e.setMonth(e.getMonth()-1),i=new Date(n),i.setMonth(i.getMonth()+1),this._dates={current:this._fillDateContext(n),previous:this._fillDateContext(e),next:this._fillDateContext(i)}},_fillDateContext:function(t){var e={month:t.getMonth(),year:t.getFullYear()};return e.startDay=this._getStartDay(e.month,e.year),e.monthDays=this._getMonthDays(e.month,e.year),e},_buildDatepicker:function(t){t?this._createDateContext(t):this.params.date?this._createDateContext(BEM.blocks["mi-helpers"].getDateFromHumanString(this.params.date+"-01")):this._isDateSelected?this._createDateContext(this._selectedDate):this._createDateContext(this._todayDate),BEM.DOM.update(this.domElem,BEMHTML.apply(this._getDatePickerBEMJSON())),this.changeDisabled||(this._findMainControlls(),this._subscribeMainControlls(),this._bindToDates()),this.setSizes()},_findMainControlls:function(){this.previousButton=this.findBlockInside({block:"button",modName:"target",modVal:"previous"}),this.nextButton=this.findBlockInside({block:"button",modName:"target",modVal:"next"}),this.monthChooserButtons=this.findBlocksInside("choose-month","radio-button"),this.yearChooser=this.findBlockInside("choose-year","input"),this.chooserSubmit=this.findBlockInside("chooser-submit","button"),this.hasMod("has","clear")&&(this.clearButton=this.findBlockInside({block:"button",modName:"action",modVal:"clear"}))},_subscribeMainControlls:function(){this.previousButton.on("click",this._onChangeMonthButtonClick,this),this.nextButton.on("click",this._onChangeMonthButtonClick,this),this.clearButton&&this.clearButton.on("click",this.clearDate,this),this._bindTitleClick()},_onDateChoose:function(t){$(t.target).hasClass(BEM.INTERNAL.buildClass(this.__self.getName(),"day"))&&(this._selectedDate=new Date(this._dates.current.year,this._dates.current.month,$(t.target).attr("data-content")),this._isDateSelected||(this._isDateSelected=!0),this.delMod(this.findElem("day","selected","yes"),"selected").setMod($(t.target),"selected","yes").trigger("change",this.getDate()),this.clearButton&&this.clearButton.delMod("disabled"))},_getDatePickerBEMJSON:function(){var t,e=[{block:"m-datepicker",elem:"head",content:this._getDatePickerHeadBEMJSON()},{block:"m-datepicker",elem:"bodies",content:[{elem:"body",mods:{position:"back"}},{elem:"body",mods:{position:"current"},content:this._buildDatepickerGridBEMJSON(this._dates.current)}]}];return this.changeDisabled||e.push({block:"m-datepicker",elem:"great-chooser",content:this._buildGreatChooserBEMJSON()}),this.hasMod("has","clear")&&(t=this._getFootElemBEMJSON({block:"button",mods:{type:"simple",size:"s",action:"clear"},content:BEM.I18N("m-datepicker","clear")}),this._isDateSelected||(t.content.mods.disabled="yes"),e.push(t)),e},_buildGreatChooserBEMJSON:function(){return[{elem:"choose-year",content:{block:"input",mods:{size:"s",clear:"no"},content:{elem:"control",attrs:{type:"number"}}}},{elem:"choose-month",content:function(){for(var t=1,e=[],i=0;4>i;i++)e.push({block:"radio-button",mods:{size:"s",quorter:"q"+(i+1)},js:{id:"1234"},name:"myName",inputAttrs:{name:"q"+(i+1)},content:function(){for(var e=[],i=1;4>i;i++)e.push({elem:"radio",controlAttrs:{value:t-1},content:BEM.I18N("i-tanker__months","short"+t)}),t++;return e}()});return e}()},{elem:"chooser-submit",content:{block:"button",mods:{size:"s",type:"month"},type:"button",content:"OK"}}]},_getDatePickerHeadBEMJSON:function(){var t,e=BEM.I18N("i-tanker__months","n"+(this._dates.current.month+1))+" "+this._dates.current.year;return t=this.changeDisabled?{elem:"titles",content:{elem:"title",mods:{position:"current"},content:e}}:[{elem:"left",content:{block:"button",mods:{type:"simple",size:"s",target:"previous"},content:"←"}},{elem:"titles",content:[{elem:"title",mods:{position:"current"},content:this._getTitleClickBEMJSON(e)},{elem:"title",mods:{position:"back"}}]},{elem:"right",content:{block:"button",mods:{type:"simple",size:"s",target:"next"},content:"→"}}]},_buildDatepickerGridBEMJSON:function(t){var e=this,i=[],n=this._buildGridMap(t);return i.push({elem:"thead",tag:"thead",content:{elem:"thead-line",tag:"tr",content:function(){var t,e=[];for(t=0;7>t;t++)e.push({elem:"day-name",tag:"th",content:{elem:"day-name-i",content:BEM.I18N("m-datepicker__short-days",""+(t+1))}});return e}()}}),i.push({elem:"dates",tag:"tbody",content:function(){for(var i=[],s=0;s<n.length;s++)i.push({elem:"week",tag:"tr",content:function(){var i,o,r,a,l=[],c=t.month==e._todayDate.getMonth()&&t.year==e._todayDate.getFullYear(),d=e._selectedDate&&t.month==e._selectedDate.getMonth()&&t.year==e._selectedDate.getFullYear();a=1===(t.month+1).toString().length?"0"+(t.month+1):t.month+1;for(var u=0;7>u;u++)n[s][u]?(i={elem:"day",tag:"td",elemMods:{},attrs:{"data-content":n[s][u]}},e._specialDays&&(o=1===n[s][u].toString().length?"0"+n[s][u].toString():n[s][u],r=t.year+"-"+a+"-"+o,e._specialDays[r]&&(i.attrs.style="background: "+e._specialDays[r].background+"; ",e._specialDays[r].color&&(i.attrs.style=i.attrs.style+"color: "+e._specialDays[r].color),i.attrs.title=e._specialDays[r].title)),(5===u||6===u)&&(i.elemMods.weekend="yes"),d&&n[s][u]===e.getSelectedDay()&&(i.elemMods.selected="yes"),c&&n[s][u]===e._todayDate.getDate()&&(i.elemMods.today="yes"),l.push(i)):(i={elem:"day-empty",tag:"td"},l.push(i));return l}()});return i}()}),{block:"m-datepicker",elem:"grid",content:[{elem:"grid-table",tag:"table",content:i}]}},_buildGridMap:function(t){var e,i=0,n=new Array(7),s=[];for(e=1;e<=t.monthDays;e++)1==e&&(i=t.startDay-1),n[i]=e,6==i?(s.push(n),n=new Array(7),i=0):i++,e+1>t.monthDays&&s.push(n);return s.length<6&&s.push(new Array(7)),s},_isChangeCalendarRunning:!1}),function(){var t=function(t){var e=t.charCode||t.keyCode||t.which||0;return t.ctrlKey||t.altKey||t.metaKey||!(e>=48&&57>=e||e>=96&&105>=e||e>=65&&90>=e||e>=1025&&1071>=e||0===e)?void 0:!0};BEM.DOM.decl({name:"b-form-input",modName:"autofocus",modVal:"yes"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.bindToDoc("keydown",this._autoFocusBind)},autofocus:{yes:function(){this.bindToDoc("keydown",this._autoFocusBind)},"":function(){this.unbindFromDoc("keydown")}}},_autoFocusBind:function(e){if(!this.hasMod("focused","yes")){var i;try{i=document.activeElement.tagName.toLowerCase()}catch(e){}if(t(e)&&"input"!==i&&"textarea"!==i){var n=this.elem("input")[0],s=this.val();if(s.length>0&&" "!=s.substr(s.length-1,1)&&(s+=" ",this.val(s)),n.createTextRange){var o=n.createTextRange();o.collapse(!1),o.select()}else"undefined"!=typeof n.selectionStart&&n.setSelectionRange(s.length,s.length);this.setMod("focused","yes")}}}})}(),BEM.DOM.decl("mi-error",{onSetMod:{js:function(){this.channel("errors").on("error",this._onError,this),this.channel("errors").on("errorHide",this._onErrorHide,this)}},_popup:null,_modal:null,_onError:function(t,e){var i;e&&(i=BEMHTML.apply(this._getErrorBEMJSON(e.content)),e.node?(this._getPopup(),this._popup.setContent(i).show(e.node)):(this._getModal(),this._modal.setContent(i).show()))},_onErrorHide:function(){this._popup&&this._popup.hide(),this._modal&&this._modal.hide()},_getErrorBEMJSON:function(t){var e,i;return"string"==typeof t?i=t:t.hasOwnProperty("body")&&(i=t.body),e={block:"m-error",content:[t.header&&{elem:"header",content:t.header||BEM.I18N(this.__self.getName(),"title")},{elem:"body",content:[{elem:"para",content:i||BEM.I18N(this.__self.getName(),"body")}]}]}},_getModal:function(){return this._modal||(this._modal=$(BEMHTML.apply({block:"popup",attrs:{style:"width:400px"},mods:{type:"modal",position:"fixed","has-close":"yes",purpose:"error"},underMods:{type:"paranja"},content:[{elem:"content",content:""}]})),BEM.DOM.append(this.domElem,this._modal),this._modal=this.findBlockInside({block:"popup",modName:"purpose",modVal:"error"})),this._modal},_getPopup:function(){return this._popup||(this._popup=$(BEMHTML.apply({block:"popup",mods:{adaptive:"yes"},mix:[{block:"mi-error",elem:"popup"}],js:{tail:{offset:10},directions:["right-middle","left-middle","bottom-right-center","bottom-left-center","top-right-center","top-left-center"]},content:[{elem:"tail"},{elem:"content",content:""}]})),this._popup=this._popup.bem("popup")),this._popup}}),BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"string"},{val:function(){var t;return this.__base.apply(this,arguments)?(t=this._textarea.val(),t.length?t:null):void 0},_initBlock:function(){return this.__base.apply(this,arguments),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit")||this.hasMod("saving","yes")?!1:(this._setEdit(),void 0)},_onSaved:function(t,e){var i=this.findBlockInside("wiki-doc");this.__base.apply(this,arguments),i&&BEM.DOM.destruct(i.domElem),BEM.DOM.prepend(this.domElem,BEMHTML.apply(JSON.parse(e.data.cell.transformed)))},_setEdit:function(){this._textarea||(BEM.DOM.append(this.domElem,this._getTextarea()),this._textarea=this.findBlockInside("input"),this._textarea.val(this.params.raw||"")),this.__base.apply(this,arguments),this.afterCurrentEvent(function(){this._textarea.setMod("focused","yes").elem("control").select()})},_getTextarea:function(){return BEMHTML.apply({block:"input",mods:{type:"textarea",size:"s"},content:{elem:"control"}})},_resizeEdit:function(){this._textarea.elem("box").width(this.domElem.width()+21),this._textarea.elem("control").height(this.domElem.height()+21)},_clearEditSize:function(){this._textarea.elem("box").width("auto"),this._textarea.elem("control").height("auto")},_save:function(){var t=this.__base.apply(this,arguments);t.val=this.val(),t.val!==this.params.raw?this.setMod("saving","yes").trigger("save",t):(this.delMod("state"),this._clearEditSize())},_resetValue:function(){this.val()!==this.params.raw&&this._textarea.val(this.params.raw),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"checkbox"},{onSetMod:{state:{edit:function(){var t=this;this._storage||this._createStorage(),this._setEdit(),this.trigger("start-edit"),this._resizeEdit(),setTimeout(function(){keymaster("space",function(e){e.preventDefault(),t._toggleCheckbox(e)})},0)},"":function(){this.domElem.removeAttr("style"),this._checkbox.domElem.blur(),this.unbindFrom(this.domElem,"clickoutside"),this.unbindFrom(BEM.DOM.win,"resize.cellWidth"),keymaster.unbind("space"),this.trigger("stop-edit"),this._clearEditSize()
}}},val:function(){return this._checkbox.hasMod("checked")},_initBlock:function(){this.__base.apply(this,arguments),this._setEdit()},_onClick:function(){this.__base.apply(this,arguments),this._initBlock()},_setEdit:function(){this._checkbox||(this._checkbox=this.findBlockInside("b-grid-table-checkbox"),this._checkbox.on("change",this._save,this))},_resizeEdit:function(){this.elem("edit").css({"min-width":this.domElem.width(),"min-height":this.domElem.height()})},_clearEditSize:function(){this.hasMod("saving","yes")||this.elem("edit").removeAttr("style")},_toggleCheckbox:function(){this._checkbox.toggleMod("checked","yes")},_onSaved:function(t,e){this.delMod("saving"),this._checkbox.delMod("disabled"),this.params.raw=e.data.cell.raw,this.channel("errors").trigger("errorHide")},_onSaveError:function(){},_save:function(){var t=this.__base.apply(this,arguments);t.val=this.val(),t.val!==this.params.raw&&(this._checkbox.setMod("disabled","yes"),this._checkbox.hasMod("markdone","yes")&&this._storage._row.toggleMod("checked","yes"),this.trigger("save",t))}}),BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"select"},{val:function(){if(this.__base.apply(this,arguments)){var t=this._select.val();return t!==BEM.I18N("b-grid-table-cell","select")?t:void 0}},_initBlock:function(){return this.__base.apply(this,arguments),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit")?!1:(this._setEdit(),void 0)},_resizeEdit:function(){this.elem("edit").css({"min-width":this.domElem.width(),"min-height":this.domElem.height()})},_clearEditSize:function(){this.elem("edit").removeAttr("style")},_onClickOutside:function(){this._preventCellOutside||this.__base.apply(this,arguments),this._preventCellOutside=!1},_onSaved:function(){this.__base.apply(this,arguments),this._content||(this._content=this.findBlockInside("b-grid-table-plain-list")),this._content.domElem.html(this.params.raw[0]||"")},_setEdit:function(){this._select||(BEM.DOM.append(this.domElem,this._getSelect()),this._select=this.findBlockInside("select"),this._select.on("open",this._onSelectOpen,this),this._select.on("close",this._onSelectClose,this)),this.__base.apply(this,arguments)},_getSelect:function(){return BEMHTML.apply({block:this.__self.getName(),elem:"edit",content:{block:"select",js:{elemPopupMods:{celltype:"select"}},name:"rand_"+Date.now(),mods:{size:"m",theme:"normal",layout:"fixed",type:"grid"},content:[{block:"button",content:this.params.raw&&this.params.raw[0]||""},{elem:"control",content:this._getSelectContent()}]}})},_getSelectContent:function(){var t,e=this;return t=this.params.options.map(function(t){var i={elem:"option",attrs:{value:t},content:t};return(e.params.raw&&e.params.raw[0])===t&&(i.attrs.selected="selected"),i}),t.unshift({elem:"option",content:BEM.I18N("b-grid-table-cell","select")}),t},_onSelectOpen:function(){this._storage._table._preventEnter=!0,this._storage._table._preventRowOutside=!0,this._preventCellOutside=!0},_onSelectClose:function(){var t=this;setTimeout(function(){t._storage._table._preventEnter=!1,t._storage._table._preventRowOutside=!1,t._preventCellOutside=!1},0)},_save:function(){var t=this.__base.apply(this,arguments);t.val=this.val(),t.val!==this.params.raw[0]?this.setMod("saving","yes").trigger("save",t):(this.delMod("state"),this._clearEditSize())},_resetValue:function(){this.val()!==this.params.raw[0]&&this._select.val(this.params.raw[0]?this.params.raw[0]:BEM.I18N("b-grid-table-cell","select")),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"multiselect"},{val:function(){return this._raw},_onClickOutside:function(){this._preventCellOutside||this.__base.apply(this,arguments),this._preventCellOutside=!1},_initBlock:function(){return this.__base.apply(this,arguments),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit")?!1:(this._setEdit(),void 0)},_onSaved:function(){this.__base.apply(this,arguments),BEM.blocks["b-grid-table-token"].un(this.domElem,"remove",this._onTokenRemove),BEM.DOM.update(this.domElem,BEMHTML.apply(this._storage._table._getMultiSelectBEMJSON(this.params)))},_setEdit:function(){this._updateEditState(),this.__base.apply(this,arguments)},_resizeEdit:function(){var t=this.domElem.width();this.findElem("edit").css({"min-width":t,"min-height":this.domElem.height(),"max-width":400>t?400:t})},_clearEditSize:function(){this.elem("edit").removeAttr("style")},_updateEditState:function(){var t=this._getTokens(),e=this._getSelect(),i=this;content=BEMHTML.apply({block:this.__self.getName(),elem:"edit",content:[e,t]}),this._preventCellOutside=!0,BEM.DOM.update(this.domElem,content),this._select=this.findBlockInside("select"),this._select&&(this._select.on("change",this._onSelectChange,this),this._select.on("open",this._onSelectOpen,this),this._select.on("close",this._onSelectClose,this)),BEM.blocks["b-grid-table-token"].on(this.domElem,"remove",this._onTokenRemove,this),setTimeout(function(){i._preventCellOutside=!1},0)},_onTokenRemove:function(t){var e,i=t.block;i.hasMod("type","multiselect")&&this.hasMod("state","edit")&&(e=this._raw.filter(function(e){return e===t.block.params.raw?!1:!0}),this._raw=e,this._preventCellOutside=!0,this._storage._table._preventRowOutside=!0,this._updateEditState(),this._resizeEdit())},_onSelectChange:function(){var t=this._select.val();t!==BEM.I18N("b-grid-table-cell","select")&&(this._raw.push(t),this._updateEditState(),this._resizeEdit())},_onSelectOpen:function(){console.log("open"),this._storage._table._preventEnter=!0},_onSelectClose:function(){var t=this;setTimeout(function(){t._storage._table._preventEnter=!1},0)},_getSelect:function(){var t="",e=this._getSelectContent();return e&&(t={block:"select",js:{elemPopupMods:{type:"grid-multiselect"}},name:"rand_"+Date.now(),mods:{size:"m",theme:"normal",layout:"fixed",type:"grid"},content:[{block:"button",content:BEM.I18N("b-grid-table-cell","to_choose")},{elem:"control",content:e}]}),t},_getTokens:function(){var t;return this._raw||(this._raw=[].concat(this.params.raw)),this._raw.length&&(t={block:"b-grid-table-tokens"},t.content=this._raw.map(function(t){return{block:"b-grid-table-token",mods:{type:"multiselect"},js:{raw:t},content:[t,{elem:"remove",tag:"span",content:"×"}]}})),t},_getSelectContent:function(){return options=this._getOptions(),options.length?(options.unshift(BEM.I18N("b-grid-table-cell","select")),options.map(function(t){var e={elem:"option",attrs:{value:t},content:t};return e})):void 0},_getOptions:function(){var t=this;return this.params.options.filter(function(e){var i=!0;return t._raw.forEach(function(t){e===t&&(i=!1)}),i})},_save:function(){var t=this.__base.apply(this,arguments);t.val=this.val(),this._storage._table._preventRowOutside=!0,this._hasChanges(t.val,this.params.raw)?(this.delMod("state"),BEM.DOM.update(this.domElem,BEMHTML.apply(this._storage._table._getMultiSelectBEMJSON(this.params))),this._clearEditSize()):this.setMod("saving","yes").trigger("save",t)},_resetValue:function(){this._hasChanges(this.val(),this.params.raw)||(this._raw=[].concat(this.params.raw),this._updateEditState(),this._resizeEdit()),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"number"},{val:function(){var t;return this.__base.apply(this,arguments)?(t=this._input.val(),t.length?t:null):void 0},_initBlock:function(){return this.__base.apply(this,arguments),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit")||this.hasMod("saving","yes")?!1:(this._setEdit(),void 0)},_onSaved:function(){this.__base.apply(this,arguments),this._content||(this._content=this.findBlockInside("b-grid-table-number-cell")),null===this.params.raw?this._content.domElem.text(""):this._content.domElem.text(this.params.raw)},_setEdit:function(){this._input?this._input.val(null!==this.params.raw?this.params.raw:""):(BEM.DOM.append(this.domElem,this._getInput()),this._input=this.findBlockInside("input"),this._input.bindTo("input",BEM.blocks["mi-helpers"].validateNumberOnlyInput)),this.__base.apply(this,arguments),this.afterCurrentEvent(function(){this._input.setMod("focused","yes").elem("control").select()})},_resizeEdit:function(){this.elem("edit").css({"min-width":this.domElem.width(),"min-height":this.domElem.height()})},_clearEditSize:function(){this.elem("edit").removeAttr("style")},_getInput:function(){return BEMHTML.apply({block:this.__self.getName(),elem:"edit",content:{block:"input",mods:{size:"s"},content:{elem:"control"},value:this.params.raw}})},_save:function(){var t=this.__base.apply(this,arguments);t.val=this.val(),t.val!=this.params.raw?this.setMod("saving","yes").trigger("save",t):(this.delMod("state"),this._clearEditSize())},_resetValue:function(){var t=this;this.val()!=this.params.raw&&this.afterCurrentEvent(function(){t._input.val("number"==typeof t.params.raw?t.params.raw:"")}),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"date"},{val:function(){var t;if(this.__base.apply(this,arguments))return t=this._calendar.getDate(),t?BEM.blocks["mi-helpers"].getHumanStringFromDate({date:t}):""},_initBlock:function(){return this.__base.apply(this,arguments),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit")?!1:(this._setEdit(),void 0)},_setEdit:function(){this._calendar||(BEM.DOM.append(this.domElem,this._getCalendar()),this._calendar=this.findBlockInside("m-calendar"),this._calendar.on("show",this._onCalendarShow,this).on("hide",this._onCalendarHide,this)),this.__base.apply(this,arguments)},_onCalendarShow:function(){this._storage._table._lockOutsideClicks=!0},_onCalendarHide:function(){this._storage._table._lockOutsideClicks=!1},_onSaved:function(){var t=this.findBlockInside("m-date");this.__base.apply(this,arguments),t&&BEM.DOM.destruct(t.domElem),BEM.DOM.append(this.domElem,BEMHTML.apply(this._storage._table._getDateBEMJSON(this.params)))},_resizeEdit:function(){this.elem("edit").css({"min-width":this.domElem.width(),"min-height":this.domElem.height()})},_clearEditSize:function(){this.elem("edit").removeAttr("style")},_onClickOutside:function(){this._preventCellOutside||this._storage._table._lockOutsideClicks||this.__base.apply(this,arguments),this._preventCellOutside=!1},_getCalendar:function(){var t={block:"m-calendar",mods:{toggler:"button",type:"month",has:"clear"},js:{defaultText:BEM.I18N("b-grid-table-cell","choose_date"),value:this.params.raw},size:"m",theme:"grey"};return BEMHTML.apply({block:this.__self.getName(),elem:"edit",content:t})},_save:function(){{var t=this.__base.apply(this,arguments);this._calendar.getDate()}t.val=this.val(),t.val!==this.params.raw?this.setMod("saving","yes").trigger("save",t):(this.delMod("state"),this._clearEditSize())},_resetValue:function(){this.val()!==this.params.raw&&(this.params.raw?this._calendar.setDate(this.params.raw):this._calendar.clearDate()),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"staff"},{val:function(){var t;if(this.__base.apply(this,arguments))return t=this._staffSelect.getData()&&this._staffSelect.getData().login||this._staffSelect.val(),t?[t]:[]},_initBlock:function(){return this.__base.apply(this,arguments),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit")?!1:(this._setEdit(),void 0)},_onClickOutside:function(){this._preventCellOutside||this.__base.apply(this,arguments),this._preventCellOutside=!1},_setEdit:function(){this._storage._table._preventCurrentRowOutsideClick=!0,this._staffSelect||(BEM.DOM.append(this.domElem,this._getStaffSelect()),this._staffSelect=this.findBlockInside("b-form-input"),this._staffSelect.on("select",this._updateUser,this),this._staffSelect.on("popup-shown",this._onOpen,this),this._staffSelect.on("popup-hidden",this._onClose,this)),this.__base.apply(this,arguments),this.afterCurrentEvent(function(){this._staffSelect.val(this.params.raw&&this.params.raw[0]||"").setMod("focused","yes").elem("input").select()})},_onOpen:function(){this._storage._table._preventEnter=!0},_onClose:function(){var t=this;setTimeout(function(){t._storage._table._preventEnter=!1},0)},_resizeEdit:function(){this.elem("edit").css({"min-width":this.domElem.width(),"min-height":this.domElem.height()})},_clearEditSize:function(){this.elem("edit").removeAttr("style")},_getStaffSelect:function(){return BEMHTML.apply({block:this.__self.getName(),elem:"edit",content:{block:"b-form-input",mods:{size:"m",theme:"grey"},multicomplete:{types:"staff",value:this.params.raw[0]||!1},content:[{elem:"input"}]}})},_updateUser:function(){var t=this,e=this._staffSelect.getData(),i={transformed:e?[e]:[]};this._staffSelect.getPopup().hide(),BEM.DOM.destruct(this.findElem("i")),BEM.DOM.append(this.domElem,BEMHTML.apply(this._storage._table._getStaffBEMJSON(i))),this._staffSelect.elem("input").select(),this._selectOnEnter?this._selectOnEnter=!1:(this._preventCellOutside=!0,this._storage._table._preventRowOutside=!0),setTimeout(function(){t._preventCellOutside=!1},150)},_save:function(){var t=this.__base.apply(this,arguments);t.val=this.val(),t.val.length||this._updateUser(),t.val[0]!==this.params.raw[0]?this.setMod("saving","yes").trigger("save",t):(this.delMod("state"),this._clearEditSize())},_resetValue:function(){this.val()!==this.params.raw&&this.afterCurrentEvent(function(){this._staffSelect.val(this.params.raw&&this.params.raw[0]||"").setMod("focused","yes").elem("input").select(),this._updateUser()}),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"multistaff"},{val:function(){return this.__base.apply(this,arguments)?this.params.raw:void 0},_onSaved:function(){this.__base.apply(this,arguments),BEM.DOM.destruct(this.elem("edit")),BEM.DOM.destruct(this.elem("i")),BEM.DOM.prepend(this.domElem,BEMHTML.apply(this._storage._table._getStaffBEMJSON(this.params))),this.dropElemCache()},_initBlock:function(){return this.__base.apply(this,arguments),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit")?!1:(this._subscribedOnTokenRemove||(BEM.blocks["b-grid-table-token"].on(this.domElem,"remove",this._onTokenRemove,this),this._subscribedOnTokenRemove=!0),this._previousRaw=[].concat(this.params.raw),this._previousTransformed=[].concat(this.params.transformed),this._setEdit(),void 0)},_resizeEdit:function(){this.elem("edit").css({"min-width":this.domElem.width(),"min-height":this.domElem.height()})},_clearEditSize:function(){this.elem("edit").removeAttr("style")},_onClickOutside:function(){this._preventCellOutside||this.__base.apply(this,arguments),this._preventCellOutside=!1},_setEdit:function(){var t=this,e=BEMHTML.apply({block:this.__self.getName(),elem:"edit",content:[this._getMulticomplete(),{block:"b-grid-table-tokens",content:this._getUserTokens()}]});BEM.DOM.append(this.domElem,e),this._staffSelect=this.findBlockInside(this.elem("edit"),"b-form-input"),this._tokens=this.findBlockInside(this.elem("edit"),"b-grid-table-tokens"),this._staffSelect.on("select",this._onStaffSelect,this),this._staffSelect.on("popup-shown",this._onOpen,this),this._staffSelect.on("popup-hidden",this._onClose,this),setTimeout(function(){t._staffSelect.setMod("focused","yes")},0),this.__base.apply(this,arguments)},_onOpen:function(){this._storage._table._preventEnter=!0},_onClose:function(){var t=this;setTimeout(function(){t._storage._table._preventEnter=!1},0)},_onStaffSelect:function(){var t=this,e=this._staffSelect.getData();this.params.transformed.push(e),this.params.raw.push(e.login),this._staffSelect.getPopup().hide(),BEM.DOM.update(this._tokens.domElem,BEMHTML.apply(this._getUserTokens())),this._staffSelect.val(""),this._selectOnEnter?this._selectOnEnter=!1:(this._preventCellOutside=!0,this._storage._table._preventRowOutside=!0),setTimeout(function(){t._preventCellOutside=!1},150)},_onTokenRemove:function(t){var e,i,n=t.block;n.hasMod("type","multistaff")&&this.hasMod("state","edit")&&(this._preventCellOutside=!0,this._storage._table._preventRowOutside=!0,e=this.params.raw.filter(function(t){return t===n.params.user?!1:!0}),i=this.params.transformed.filter(function(t){return t.login===n.params.user?!1:!0}),this.params.raw=e,this.params.transformed=i,BEM.DOM.update(this._tokens.domElem,BEMHTML.apply(this._getUserTokens())))},_getMulticomplete:function(){return{block:"b-form-input",mods:{size:"m",theme:"grey"},multicomplete:{types:"staff"},content:[{elem:"input"}]}},_getUserTokens:function(){return this.params.transformed&&this.params.transformed.length?this.params.transformed.map(function(t){return{block:"b-grid-table-token",mods:{type:"multistaff"},js:{user:t.login},content:[{block:"b-user",mix:[{block:"mi-staff-card",js:{user:t.login}}],url:"//staff.yandex-team.ru/"+t.login,content:t.first_name+" "+t.last_name},{elem:"remove",tag:"span",content:"×"}]}}):void 0},_save:function(){var t=this.__base.apply(this,arguments);t.val=this.val(),this._hasChanges(t.val,this._previousRaw)?(this.delMod("state"),BEM.DOM.destruct(this.elem("edit")),this.dropElemCache()):this.setMod("saving","yes").trigger("save",t)},_resetValue:function(){this._hasChanges(this.val(),this._previousRaw)||(this.params.raw=[].concat(this._previousRaw),this.params.transformed=[].concat(this._previousTransformed),BEM.DOM.update(this._tokens.domElem,BEMHTML.apply(this._getUserTokens())),this._staffSelect.val("")),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"b-grid-table-cell",modName:"type",modVal:"ticket"},{val:function(){var t;return this.__base.apply(this,arguments)?(t=this._input.val(),t.length?t:null):void 0},_initBlock:function(){return this.__base.apply(this,arguments),!this._storage._table.hasMod("mode","edit")||this.hasMod("state","edit")||this.hasMod("saving","yes")?!1:(this._setEdit(),void 0)},_onSaved:function(t,e){var i=this.findBlockInside("b-grid-table-ticket");this.__base.apply(this,arguments),i&&BEM.DOM.destruct(i.domElem),BEM.DOM.prepend(this.domElem,BEMHTML.apply(this._storage._table._getTicketBEMJSON(e.data.cell)))},_setEdit:function(){this._input||(BEM.DOM.append(this.domElem,this._getInput()),this._input=this.findBlockInside("input"),this._input.val(this.params.raw||"")),this.__base.apply(this,arguments),this.afterCurrentEvent(function(){this._input.setMod("focused","yes").elem("control").select()})},_resizeEdit:function(){this.elem("edit").css({"min-width":this.domElem.width(),"min-height":this.domElem.height()})},_clearEditSize:function(){this.elem("edit").removeAttr("style")},_getInput:function(){return BEMHTML.apply({block:this.__self.getName(),elem:"edit",content:{block:"input",mods:{size:"s"},value:this.params.raw,content:{elem:"control"}}})},_save:function(){var t=this.__base.apply(this,arguments);t.val=this.val(),t.val!=this.params.raw?this.setMod("saving","yes").trigger("save",t):this.delMod("state")},_resetValue:function(){var t=this;this.val()!=this.params.raw&&this.afterCurrentEvent(function(){t._input.val(t.params.raw)}),this.__base.apply(this,arguments)}}),BEM.DOM.decl({block:"select",modName:"type",modVal:"grid"},{onSetMod:{opened:{yes:function(){this.__base.apply(this,arguments),this.trigger("open")},"":function(){this.__base.apply(this,arguments),this.trigger("close")}}}}),BEM.DOM.decl("b-grid-table-head",{_onEditClick:function(t){this._storage||this._createStorage(),"create"===t&&this._createCol(),"edit"===t&&this._editCol()},_onSortClick:function(){var t;this._storage||this._createStorage(),this._icon||(this._icon=this.findBlockInside(this.elem("sort"),"awesome-icon")),t=this._icon.hasMod("icon","angle-down")||this._icon.hasMod("icon","sort-up")?"asc":"desc",BEM.DOM.update(this.elem("sort"),BEMHTML.apply({block:"spinner",mods:{size:"xs",progress:"yes"}})),BEM.create("api-request",{_:"api-response",apiPath:".grid",path:"/"+this._storage._table.params.getTableData,urlParams:this._storage._table.gridOptionsUrlParams(["sort_"+this.params.id+"="+t])}).run().then(this._onSortSuccess.bind(this),this._onSortFail.bind(this))},_onSortSuccess:function(t){this.trigger("sort",t.data)},_onSortFail:function(t){console.log(t)},_createStorage:function(){var t=this.findBlockOutside("b-grid-table");this.__self[t.tableId]||(this.__self[t.tableId]={_table:t}),this._storage=this.__self[t.tableId]},_editCol:function(){var t=this._getPopup(),e={action:"edit",isTicket:this._storage._table.isTicket?!0:!1,id:this.params.id,required:this.params.required,value:this.params.value,type:this.params.type,markdone:this.params.markdone,options:this.params.options,width:this.params.width,width_units:this.params.width_units};t.setContent(this._getPopupContent(e)),t.show(this.elem("edit")),this._form=t.findBlockInside("b-grid-table-edit-col-form"),this._form.on("edit",this._sendData,this),this._form.on("delete-col",this._deleteCol,this)},_deleteCol:function(){this._getPopup().hide(),this.trigger("delete",{table:this._storage._table.tableId,index:this.domElem.index()-(this._storage._table.showNumbers?1:0)})},_createCol:function(){var t=this._getPopup(),e={action:"add",isTicket:this._storage._table.isTicket?!0:!1,width_units:"%",newCol:!0,markdone:!0};t.setContent(this._getPopupContent(e)),t.show(this.elem("edit")),this._form=t.findBlockInside("b-grid-table-edit-col-form"),this._form.on("add",this._sendData,this)},_sendData:function(t,e){var i={version:this._storage._table._gridData.version,changes:[{}]};this._getPopup().hide(),"edit"===t.type?(i.changes[0].edited_column=e,i.changes[0].edited_column.name=this.params.id):i.changes[0].added_column=e,BEM.create("api-request",{_:"api-response",apiPath:".grid/change_and_get_document",path:"/"+this._storage._table.params.getTableData,method:"POST",data:i,urlParams:this._storage._table.gridOptionsUrlParams()}).run().then(this._onEditCol.bind(this),this._onFailedEditCol.bind(this))},_onEditCol:function(t){this.dropElemCache(),this._storage._table._setEditAfterRebuild=!0,this._storage._table._gridData=t.data.grid,this._storage._table.rebuild()},_onFailedEditCol:function(t){console.log(t)},_getTitleBEMJSON:function(t){var e={elem:"title",content:{block:"input",mods:{size:"s"},content:{elem:"control"}}};return t.value&&(e.content.value=t.value),e},_getTypeBEMJSON:function(t){var e,i;if(t.type&&t.id){switch(t.type){case"string":i=BEM.I18N("b-grid-table-head","text");break;case"number":i=BEM.I18N("b-grid-table-head","number");break;case"checkbox":i=BEM.I18N("b-grid-table-head","checkbox");break;case"date":i=BEM.I18N("b-grid-table-head","date");break;case"select":i=BEM.I18N("b-grid-table-head","list");break;case"multiselect":i=BEM.I18N("b-grid-table-head","multiple_list");break;case"staff":i=BEM.I18N("b-grid-table-head","employee");break;case"multistaff":i=BEM.I18N("b-grid-table-head","several_employees");break;case"ticket":i=BEM.I18N("b-grid-table-head","ticket_in_tracker");break;default:i=t.type}e={block:"b-grid-table-edit-col-form",elem:"type-view",content:[i+". ",{elem:"id",content:"Id-"+t.id}]}}else e={block:"select",name:"coltypes",mods:{size:"s",theme:"normal"},content:[{block:"button",content:BEM.I18N("b-grid-table-head","text")},{elem:"control",content:[{elem:"option",attrs:{value:"string"},content:BEM.I18N("b-grid-table-head","text")},{elem:"option",attrs:{value:"number"},content:BEM.I18N("b-grid-table-head","number")},{elem:"option",attrs:{value:"checkbox"},content:BEM.I18N("b-grid-table-head","checkbox")},{elem:"option",attrs:{value:"date"},content:BEM.I18N("b-grid-table-head","date")},{elem:"option",attrs:{value:"select"},content:BEM.I18N("b-grid-table-head","list")},{elem:"option",attrs:{value:"multiple_select"},content:BEM.I18N("b-grid-table-head","multiple_list")},{elem:"option",attrs:{value:"staff"},content:BEM.I18N("b-grid-table-head","employee")},{elem:"option",attrs:{value:"multiple_staff"},content:BEM.I18N("b-grid-table-head","several_employees")},this._getTicketOptions(t)]}]};return e},_getTicketOptions:function(t){var e;return e=t.isTicket?{elem:"option-group",attrs:{label:BEM.I18N("b-grid-table-head","tickets")},content:[{elem:"option",attrs:{value:"ticket"},content:BEM.I18N("b-grid-table-head","ticket_in_tracker")},{elem:"option",attrs:{value:"ticket-subject"},content:BEM.I18N("b-grid-table-head","title")},{elem:"option",attrs:{value:"ticket-type"},content:BEM.I18N("b-grid-table-head","type")},{elem:"option",attrs:{value:"ticket-assignee"},content:BEM.I18N("b-grid-table-head","executor")},{elem:"option",attrs:{value:"ticket-reporter"},content:BEM.I18N("b-grid-table-head","author")},{elem:"option",attrs:{value:"ticket-status"},content:BEM.I18N("b-grid-table-head","status")},{elem:"option",attrs:{value:"ticket-priority"},content:BEM.I18N("b-grid-table-head","priority")},{elem:"option",attrs:{value:"ticket-createdat"},content:BEM.I18N("b-grid-table-head","date_created")},{elem:"option",attrs:{value:"ticket-updatedat"},content:BEM.I18N("b-grid-table-head","updated")}]}:{elem:"option",attrs:{value:"ticket"},content:BEM.I18N("b-grid-table-head","ticket_in_tracker")}},_getOptionsBEMJSON:function(t){var e=[{elem:"option-necessary",content:{block:"checkbox",mods:{size:"s"},content:{elem:"label",content:BEM.I18N("b-grid-table-head","mandatory")}}},{elem:"option-markdone",content:{block:"checkbox",mods:{size:"s"},content:{elem:"label",content:BEM.I18N("b-grid-table-head","mark_made")}}}];return t.required&&(e[0].content.mods.checked="yes"),t.markdone&&(e[1].content.mods.checked="yes"),e},_getDeleteBEMJSON:function(t){var e="";return t.newCol||(e={elem:"delete",content:{block:"button",mods:{size:"s",theme:"pseudo","pseudo-pressed":"yes"},content:BEM.I18N("b-grid-table-head","remove_column")}}),e},_getOkBEMJSON:function(t){var e={block:"button",mods:{theme:"action",submit:"yes",size:"s",disabled:t.newCol?!1:"yes"},content:t.newCol?BEM.I18N("b-grid-table-head","add"):BEM.I18N("b-grid-table-head","change")};return e},_getSelectListBEMJSON:function(t){var e;return e="select"!==t.type&&"multiselect"!==t.type?"":{block:"input",value:this.params.options&&this.params.options.length&&this.params.options.join("\n"),mods:{type:"textarea",size:"s"},content:{elem:"control"}}},_getPopupContent:function(t){var e={block:"b-grid-table-edit-col-form",mods:{action:t.action,type:t.type},tag:"form",js:!0,content:[this._getTitleBEMJSON(t),{elem:"type",content:this._getTypeBEMJSON(t)},{elem:"select-list",content:this._getSelectListBEMJSON(t)},{elem:"size",content:{block:"b-grid-table-width-controll",width:t.width,width_units:t.width_units,label:BEM.I18N("b-grid-table-head","width"),size:"s"}},{elem:"options",content:this._getOptionsBEMJSON(t)},this._getDeleteBEMJSON(t),{elem:"ok",content:this._getOkBEMJSON(t)}]};return("select"===t.type||"multiselect"===t.type)&&(e.mods.show="select-list"),BEMHTML.apply(e)},_getPopup:function(){return this._storage._popup||(this._storage._popup=$(BEMHTML.apply({block:"popup",attrs:{style:"width:200px"},mods:{adaptive:"yes"},js:{directions:["bottom-center","bottom-left","bottom-right"]},content:[{elem:"tail"},{elem:"content"}]})),this._storage._popup=this._storage._popup.bem("popup"),this._storage._popup.on("show",this._onPopupShow,this),this._storage._popup.on("hide",this._onPopupHide,this)),this._storage._popup},_onPopupShow:function(){this._storage._table._lockOutsideClicks=!0},_onPopupHide:function(){this._storage._table._lockOutsideClicks=!1}},{live:function(){this.liveBindTo("edit","click",function(){this.hasMod("type","new-col")?this._onEditClick("create"):this._onEditClick("edit")}),this.liveBindTo("sort","click",function(){this._onSortClick()})}}),BEM.DOM.decl("b-grid-table-edit-col-form",{onSetMod:{js:function(){this._submit=this.findBlockInside(this.elem("ok"),"button"),this._submit.on("click",this._onSubmit,this),this.bindTo(this.domElem,"submit",function(){return!1}),this._delete=this.findBlockInside(this.elem("delete"),"button"),this._delete&&this._delete.on("click",this._onDeleteCol,this),this.hasMod("action","edit")&&this._bindChange(),this.hasMod("action","add")&&this._buildSelectList()}},_onDeleteCol:function(){this.trigger("delete-col")},_buildSelectList:function(){BEM.DOM.update(this.elem("select-list"),BEMHTML.apply({block:"input",value:this.params.options&&this.params.options.length&&this.params.options.join("\n"),mods:{type:"textarea",size:"s"},content:{elem:"control"}})),this._controls||this._findControls(),this._controls.type.on("change",this._onTypeChange,this)},_onTypeChange:function(){var t=this._controls.type.val();"select"===t||"multiple_select"===t?this.setMod("show","select-list"):this.delMod("show"),this.setMod("type",t)},_bindChange:function(){this._controls||this._findControls(),this._controls.title.on("change",this._onFormChange,this),this._controls.width.on("change",this._onFormChange,this),this._controls.width_units.on("change",this._onFormChange,this),this._controls.required&&this._controls.required.on("change",this._onFormChange,this),this._controls.markdone&&this._controls.markdone.on("change",this._onFormChange,this)},_onFormChange:function(){this._controls.title.un("change",this._onFormChange),this._controls.width.un("change",this._onFormChange),this._controls.width_units.un("change",this._onFormChange),this._controls.required&&this._controls.required.un("change",this._onFormChange),this._controls.markdone&&this._controls.markdone.un("change",this._onFormChange),this._submit.delMod("disabled")},_onSubmit:function(){var t=this._getChanges();this.trigger(this.hasMod("action","add")?"add":"edit",t)},_getChanges:function(){var t={};return this._controls||this._findControls(),t.title=this._controls.title.val(),this.hasMod("action","add")&&(t.type=this._controls.type.val()),this.hasMod("show","select-list")&&(t.options=this._controls.options.val().split("\n")),this.hasMod("type","checkbox")?t.markdone=this._controls.markdone.hasMod("checked"):t.required=this._controls.required.hasMod("checked"),this._updateSize(t),t},_updateSize:function(t){var e=this._controls.width.val();""!==e&&(t.width=e,t.width_units="px"==this._controls.width_units.val()?"pixel":"percent")},_findControls:function(){this._controls={title:this.findBlockInside(this.elem("title"),"input"),width:this.findBlockInside(this.elem("size"),"input"),width_units:this.findBlockInside(this.elem("size"),"select"),required:this.findBlockInside(this.elem("option-necessary"),"checkbox"),markdone:this.findBlockInside(this.elem("option-markdone"),"checkbox"),options:this.findBlockInside(this.elem("select-list"),"input")},this.hasMod("action","add")&&(this._controls.type=this.findBlockInside(this.elem("type"),"select"))}}),BEM.DOM.decl("b-grid-table-head-draggable",{onSetMod:{js:function(){var t=this.findBlockOutside("b-grid-table");this.tableId=t.tableId,this.__self[this.tableId]||(this.__self[this.tableId]={_table:t}),this._storage=this.__self[this.tableId],this._storage._counter?this._storage._counter++:this._storage._counter=1,this._storage._table.on("start-edit",this._bindEvents,this),this._storage._table.on("stop-edit",this._unbindEvents,this)}},destruct:function(){this._storage._table.un("start-edit"),this._storage._table.un("stop-edit"),this._unbindEvents(),this._storage._counter?this._storage._counter--:delete this.__self[this.tableId],this.__base.apply(this,arguments)},_bindEvents:function(){this._storage.headers||(this._storage.parentRow=this.findBlockOutside("b-grid-table-row"),this._storage.headers=this._storage.parentRow.findBlocksInside("b-grid-table-head-draggable")),this.bindToDomElem(this.domElem,{dragstart:this._onDragStart,dragend:this._onDragEnd,drop:this._onDragDrop,dragenter:this._onDragEnter,dragover:this._onDragOver,dragleave:this._onDragLeave})},_unbindEvents:function(){this.unbindFromDomElem(this.domElem,"dragstart, dragend, drop, dragenter, dragover, dragleave")},_isMouseOnRow:function(t,e){var i=!1,n=BEM.DOM.win.scrollLeft(),s=BEM.DOM.win.scrollTop(),t=t+n,e=e+s,o=this._storage.parentRow.domElem,r={top:o.offset().top,right:o.offset().left+o.outerWidth(),bottom:o.offset().top+o.outerHeight(),left:o.offset().left},a=t>r.left&&t<r.right?!0:!1,l=e>r.top&&e<r.bottom?!0:!1;
return l&&a&&(i=!0),i},_onDragStart:function(t){var e=t.originalEvent.dataTransfer;return this._storage._table.draggingRow?!1:(this._isDragging=!0,this._storage._table.draggingHead=!0,this._storage.prev=this.domElem.prev(),this._storage.next=this.domElem.next(),this._storage.move={from:this.domElem.index()},this.setMod("dragging","yes"),e.setData("text/plain"," "),e.effectAllowed="move",e.setDragImage(this.domElem[0],0,0),void 0)},_onDragEnd:function(){return this._storage._table.draggingHead=!1,this._storage._dropAvailable&&this._moveCols(),this._isDragging?(this._isDragging=!1,this._onStopDragging(),!1):void 0},_onDragEnter:function(){return this._isDragging||this._storage._table.draggingRow?!1:void 0},_onDragLeave:function(t){return this._isMouseOnRow(t.originalEvent.clientX,t.originalEvent.clientY)||this._storage._table.elem("head-indicator").hide(),this._isDragging?!1:void 0},_onDragDrop:function(){return this._storage._table.draggingHead=!1,this._isDragging?(this._isDragging=!1,!1):(this._storage._dropAvailable&&this._moveCols(),this._onStopDragging(),void 0)},_onDragOver:function(t){var e;return this._isDragging||this._storage._table.draggingRow?!1:(e=t.originalEvent,this._handleDropPosition(e.clientX),t.preventDefault(),!1)},_onStopDragging:function(){this.delMod("dragging"),this._storage._dropAvailable=!1,this._storage._table.elem("head-indicator").hide().css({left:0})},_handleDropPosition:function(t){var e=this.domElem.offset().left+this.domElem.outerWidth()/2;this._storage._table.elem("head-indicator").css({height:this.domElem.outerHeight(),top:this.domElem.offset().top-BEM.DOM.win.scrollTop()}),t>e?this.domElem[0]!==(this._storage.prev&&this._storage.prev[0])&&this._setIndicatorPosition(this._storage._table.elem("head-indicator"),"right"):this.domElem[0]!==(this._storage.next&&this._storage.next[0])&&this._setIndicatorPosition(this._storage._table.elem("head-indicator"),"left")},_setIndicatorPosition:function(t,e){var i,n=this.domElem.offset().left,s=this.domElem.outerWidth(),o=parseInt(t.css("left"));t.show(),"right"===e?(i=Math.abs(o-(n+s)),this._storage.move.to={after:this.domElem.index()},i>1&&(this._storage._dropAvailable=!0,t.css({left:n+s}))):(i=Math.abs(o-n),this._storage.move.to={before:this.domElem.index()},i>1&&(this._storage._dropAvailable=!0,t.css({left:n})))},_moveCols:function(){var t,e,i,n=(this._storage._table.elem("table"),this._storage._table.findElem("tr")),s=this._storage.move;n.each(function(){e=$(this),i=e.children("th, td"),t=i.eq(s.from).detach(),void 0!==s.to.before?t.insertBefore(i.eq(s.to.before)):t.insertAfter(i.eq(s.to.after))}),this._sendMoveData()},_sendMoveData:function(){this.sendData={version:this._storage._table._gridData.version,changes:[{column_moved:{move_from:this._storage.move.from-1,move_to:void 0!==this._storage.move.to.before?this._storage.move.to.before-1:this._storage.move.to.after-1}}]},BEM.create("api-request",{_:"api-response",apiPath:".grid/change",path:"/"+this._storage._table.params.getTableData,method:"POST",data:this.sendData,urlParams:this._storage._table.gridOptionsUrlParams()}).run().then(this._onPostedColumnReorder.bind(this),this._onFailedColumnReorder.bind(this))},_onPostedColumnReorder:function(t){var e=this.sendData.changes[0].column_moved;this._storage._table._gridData.version=t.data.version,this._storage._table._swapStructure(e.move_from,e.move_to,"fields")},_onFailedColumnReorder:function(){this._storage._table._buildContent(!0)}}),BEM.DOM.decl("b-grid-table-row",{onSetMod:{js:function(){this.hasMod("type","head")||(this._storage||this._createStorage(),BEM.blocks["b-grid-table-cell"].on(this.domElem,"start-edit",this._onCellEditStart,this),BEM.blocks["b-grid-table-row"].on(this.domElem,"start-edit",this._onRowEditStart,this))},state:{edit:function(){var t=this;this.trigger("start-edit"),this.findBlockOn("b-grid-table-row-draggable")._onMouseEnter(),setTimeout(function(){t._storage._table.setMod("edit","row"),keymaster("ctrl+enter, command+enter",function(e){e.preventDefault(),t._createRowAfter(e)}),keymaster("tab",function(e){e.preventDefault(),t._onTab(e)}),keymaster("shift+tab",function(e){e.preventDefault(),t._onShiftTab(e)}),t.bindTo(t.domElem,"clickoutside",t._onClickOutside),keymaster("ctrl+left, command+left",function(e){e.preventDefault(),t._onArrowLeft(e)}),keymaster("ctrl+right, command+right",function(e){e.preventDefault(),t._onArrowRight(e)}),keymaster("ctrl+down, command+down",function(e){e.preventDefault(),t._onArrowDown(e)}),keymaster("ctrl+up, command+up",function(e){e.preventDefault(),t._onArrowUp(e)}),keymaster("return",function(e){return t._storage._table._preventEnter?(t._activeCell._selectOnEnter=!0,void 0):(t._storage._table._preventRowOutside=!1,t._activeCell._preventCellOutside=!1,t._onReturn(e),!1)}),keymaster("esc",function(e){e.preventDefault(),t._onEsc(e)})},0)},"":function(){this.trigger("stop-edit"),this._storage._table.delMod("edit"),keymaster.unbind("ctrl+enter, command+enter"),keymaster.unbind("tab"),keymaster.unbind("shift+tab"),keymaster.unbind("ctrl+left, command+left"),keymaster.unbind("ctrl+right, command+right"),keymaster.unbind("ctrl+down, command+down"),keymaster.unbind("ctrl+up, command+up"),keymaster.unbind("return"),keymaster.unbind("esc"),this.unbindFrom(this.domElem,"clickoutside")}}},destruct:function(){BEM.blocks["b-grid-table-cell"].un(this.domElem,"start-edit"),BEM.blocks["b-grid-table-row"].un(this.domElem,"start-edit"),this.__base.apply(this,arguments)},_onCellEditStart:function(t){this._activeCell&&(this._previousActiveCell=this._activeCell),this._activeCell=t.block},_onRowEditStart:function(t){t.block===this||this.hasMod("type","new")||this.hasMod("type","head")||this.delMod("state")},_onClickOutside:function(){this._storage._table._preventRowOutside||this._storage._table._lockOutsideClicks||this.delMod("state"),this._storage._table._preventRowOutside=!1},_onTab:function(){return this._hightlightOnTab("next"),!1},_onShiftTab:function(){return this._hightlightOnTab("prev"),!1},_hightlightOnTab:function(t,e){var i,n,e=e||this._activeCell,s=e&&e.domElem[t]();if(e.params.row_id||!e.hasMod("editable","yes"))if(s=s&&s.length?s.bem("b-grid-table-cell"):!1){if(!s.hasMod("editable","yes"))return this._hightlightOnTab(t,s);this._activeCell._onClickOutside(),s._onClick()}else i=this.domElem[t](),i=i.length?i.bem("b-grid-table-row"):!1,i&&("next"===t?s=i.findBlockInside({block:"b-grid-table-cell",modName:"editable",modVal:"yes"}):(n=i.findBlocksInside({block:"b-grid-table-cell",modName:"editable",modVal:"yes"}),s=n?n[n.length-1]:!1),s&&(this.delMod("state"),i.setMod("state","edit"),this._activeCell._onClickOutside(),s._onClick()))},_onArrowLeft:function(){return this._hightlightOnLeftRight("left"),!1},_onArrowRight:function(){return this._hightlightOnLeftRight("right"),!1},_onArrowUp:function(){return this._hightlightOnUpDown("up"),!1},_onArrowDown:function(){return this._hightlightOnUpDown("down"),!1},_onReturn:function(){return this._hightlightOnUpDown("down",!0),!1},_hightlightOnLeftRight:function(t){var e=this._activeCell,i=e.domElem["left"===t?"prev":"next"]();if(e.params.row_id&&(i=i&&i.length?i.bem("b-grid-table-cell"):!1)){if(!i.hasMod("editable","yes"))return;this._activeCell._onClickOutside(),i._onClick()}},_hightlightOnUpDown:function(t,e){var i,n,s,o=this._activeCell;o.params.row_id&&(i=this.domElem["up"===t?"prev":"next"](),i=i.next().length?i.bem("b-grid-table-row"):!1,!i&&e&&"up"!==t&&(this._storage._table.createRowAfter(this,!0),i=this.domElem.next().bem("b-grid-table-row")),i&&(s=i.findBlocksInside({block:"b-grid-table-cell"}),n=s?s[o.domElem.index()]:!1,n&&(this.delMod("state"),i.setMod("state","edit"),setTimeout(function(){o._onClickOutside(),n._onClick()},0))))},_onEsc:function(){var t=this._activeCell;t&&t._resetValue()},_createStorage:function(){var t=this.findBlockOutside("b-grid-table");this.__self[t.tableId]||(this.__self[t.tableId]={_table:t}),this._storage=this.__self[t.tableId]},_createRowAfter:function(){this._storage._table.createRowAfter(this)}}),BEM.DOM.decl("b-grid-table-new-row",{onSetMod:{ready:{yes:function(){this.bindTo(this.domElem,"click",function(){this._onClick()})},no:function(){this.unbindFrom(this.domElem,"click")}}},_onClick:function(){var t=this.domElem.prev();this._table||(this._table=this.findBlockOutside("b-grid-table")),t.length?this._table.createRowAfter(t.bem("b-grid-table-row")):this._table.createRowAfter()}}),BEM.DOM.decl("b-grid-table-row-draggable",{onSetMod:{js:function(){var t=this.findBlockOutside("b-grid-table");this.tableId=t.tableId,this.__self[this.tableId]||(this.__self[this.tableId]={_table:t}),this._storage=this.__self[this.tableId],this._storage._counter?this._storage._counter++:this._storage._counter=1,this._storage._table.hasMod("mode","edit")&&this._initBlock(),this._storage._table.on("start-edit",this._initBlock,this),this._storage._table.on("stop-edit",this._unbindEvents,this)}},destruct:function(){this._storage._table.un("start-edit"),this._storage._table.un("stop-edit"),this._unbindEvents(),this._storage._counter?this._storage._counter--:delete this.__self[this.tableId],this.__base.apply(this,arguments)},_initBlock:function(){this._dragger||(this._dragger=this._storage._table.elem("row-dragger")),setTimeout(this._setSizes.bind(this),0),this._bindToEvents()},_bindToEvents:function(){this._binded=!0,this.bindTo(this.domElem,"mouseenter",this._onMouseEnter),this.bindToWin("resize",this._setSizes),this.bindToDomElem(this._dragger,"dragstart",this._onDragStart),this.bindToDomElem(this._dragger,"dragend",this._onDragEnd),this.bindTo(this.domElem,{drop:this._onDragDrop,dragenter:this._onDragEnter,dragover:this._onDragOver,dragleave:this._onDragLeave}),this._storage._table.on("rows-reorder",this._setSizes,this),this._storage._table.on("row-delete",this._setSizes,this),this._storage._table.on("row-added",this._setSizes,this),this._storage._table.on("row-added",this._setSizes,this),BEM.blocks["b-grid-table-cell"].on(this.domElem,"saved",this._setSizes,this)},_unbindEvents:function(){this._binded&&(this.unbindFrom(this.domElem,"mouseenter"),this.unbindFrom(this.domElem,"drop"),this.unbindFrom(this.domElem,"dragenter"),this.unbindFrom(this.domElem,"dragover"),this.unbindFrom(this.domElem,"dragleave"),this.unbindFromWin("resize"),this.unbindFromDomElem(this._dragger,"dragstart, dragend"),this._storage._table.un("rows-reorder",this._setSizes,this),this._storage._table.un("row-delete",this._setSizes,this),this._storage._table.un("row-added",this._setSizes,this),BEM.blocks["b-grid-table-cell"].un(this.domElem,"saved",this._setSizes))},_onDragStart:function(t){var e=t.originalEvent.dataTransfer;this===this._storage._draggableThis&&(this._storage._table.setMod("dragging","yes"),this.setMod("dragging","yes"),this._storage._table.draggingRow=!0,this._storage.prev=this.domElem.prev(),this._storage.next=this.domElem.next(),this._storage.move={from:this.domElem.index(),draggingThis:this},e.setData("text/plain"," "),e.effectAllowed="move",e.setDragImage(this.domElem[0],0,0))},_onDragDrop:function(){return this._storage._table.draggingRow=!1,this.hasMod("dragging","yes")||this._storage._table.draggingHead||!this._dropAvailable?(this._dropAvailable=!1,!1):(this._moveRows(),this._onStopDragging(),void 0)},_onDragEnter:function(){return this.hasMod("dragging","yes")||this._storage._table.draggingHead?!1:void 0},_onDragOver:function(t){var e;return this.hasMod("dragging","yes")||this._storage._table.draggingHead?!1:(e=t.originalEvent,this._handleDropPosition(e.clientY),t.preventDefault(),!1)},_handleDropPosition:function(t){var e=this.domElem.offset().top+this.domElem.outerHeight()/2;this._storage._table.elem("row-indicator").css({width:this.domElem.outerWidth(),left:this.domElem.offset().left}),t+=BEM.DOM.win.scrollTop(),t>e?this.domElem[0]!==(this._storage.prev&&this._storage.prev[0])&&this._setIndicatorPosition(this._storage._table.elem("row-indicator"),"after"):this.domElem[0]!==(this._storage.next&&this._storage.next[0])&&this._setIndicatorPosition(this._storage._table.elem("row-indicator"),"before")},_setIndicatorPosition:function(t,e){{var i=this.domElem.offset().top-BEM.DOM.win.scrollTop(),n=this.domElem.outerHeight();parseInt(t.css("top"),10)}t.show(),"after"===e?(this._storage.move.to={after:this.domElem.index()},this._dropAvailable=!0,t.css({top:i+n-1})):(this._storage.move.to={before:this.domElem.index()},this._dropAvailable=!0,t.css({top:i-1}))},_onDragLeave:function(t){return this._isMouseOnBody(t.originalEvent.clientX,t.originalEvent.clientY)||this._storage._table.elem("row-indicator").hide(),this._dropAvailable=!1,!1},_isMouseOnBody:function(t,e){var i=!1,n=BEM.DOM.win.scrollLeft(),s=BEM.DOM.win.scrollTop(),t=t+n,e=e+s,o=this._storage._table.elem("body"),r={top:o.offset().top,right:o.offset().left+o.outerWidth(),bottom:o.offset().top+o.outerHeight(),left:o.offset().left},a=t>r.left&&t<r.right?!0:!1,l=e>r.top&&e<r.bottom?!0:!1;return a&&l&&(i=!0),i},_onDragEnd:function(){return this._storage._table.delMod("dragging"),this.hasMod("dragging","yes")?(this._dropAvailable&&this._moveRows(),this._storage._table.draggingRow=!1,this._onStopDragging(),void 0):!1},_onStopDragging:function(){this.delMod("dragging"),this._dropAvailable=!1,this._storage._table.elem("row-indicator").hide().css({top:0}),this._dragger.css({top:0,height:0})},_setSizes:function(){this._sizes={height:this.domElem.outerHeight(),top:this.domElem.offset().top-this._storage._table.domElem.offset().top}},_onMouseEnter:function(){this._storage._draggableThis=this,this._sizes||this._setSizes(),this._dragger.css({top:this._sizes.top,height:this._sizes.height})},_moveRows:function(){var t,e,i=this._storage.move,n={id:i.draggingThis.findBlockOn("b-grid-table-row").params.row_id},s=this._storage._table.findElem("body","tr"),o=s.eq(i.from).detach();void 0!==i.to.before?(t=s.eq(i.to.before),e=t.prev(),n.after_id=e.length?e.bem("b-grid-table-row").params.row_id:"-1",o.insertBefore(t)):(t=s.eq(i.to.after),e=t.bem("b-grid-table-row"),n.after_id=e.params.row_id,o.insertAfter(t)),this._storage._table.trigger("rows-reorder"),this._sendMoveData(n)},_sendMoveData:function(t){this.sendData={version:this._storage._table._gridData.version,changes:[{row_moved:t}]},BEM.create("api-request",{_:"api-response",apiPath:".grid/change",path:"/"+this._storage._table.params.getTableData,method:"POST",data:this.sendData,urlParams:this._storage._table.gridOptionsUrlParams()}).run().then(this._onPostedRowsReorder.bind(this),this._onFailedRowsReorder.bind(this))},_onPostedRowsReorder:function(t){var e=this._storage.move,i={from:e.from,to:void 0!==e.to.before?e.to.before:e.to.after};this._storage._table._gridData.version=t.data.version,this._storage._table._swapStructure(i.from,i.to,"rows")},_onFailedRowsReorder:function(){this._storage._table._buildContent(!0)}}),BEM.DOM.decl("b-grid-table-checkbox",{onSetMod:{checked:function(t,e){return this.isDisabled()?!1:(this.domElem.prop("checked","yes"===e),this.afterCurrentEvent(function(){this.trigger("change",{checked:"yes"===e})}),void 0)},disabled:function(t,e){this.domElem.prop("disabled","yes"===e)}},isDisabled:function(){return this.hasMod("disabled","yes")},isChecked:function(){return this.hasMod("checked","yes")},toggle:function(){this.toggleMod("checked","yes","")},val:function(t){var e=this.domElem;return"undefined"==typeof t?e.val():(e.val(t),this)},_onChange:function(t){t.target.checked?this.setMod("checked","yes"):this.delMod("checked")}},{live:function(){this.liveBindTo("change",function(t){this._onChange(t)})}}),BEM.DOM.decl("b-grid-table-bar",{onSetMod:{js:function(){this._table||(this._table=this.findBlockOutside("b-grid-table")),(this._content||(this._content=this.findBlockOutside("b-content")||this.findBlockOutside("b-editor-preview"),this._content))&&(this.setPosition(),this._subscribe())}},setPosition:function(){var t,e,i,n=BEM.DOM.win.scrollTop();t=this._table.elem("table").offset(),e=this._table.domElem.width(),i=parseInt(this._content.domElem.css("padding-right")),this._coords={table_top:t.top,table_bottom:t.top+this._table.elem("table").height(),table_left:t.left,table_left_real:t.left,table_width:e,table_right:t.left+e,win_top:n,win_bottom:n+BEM.DOM.win.height(),win_width:BEM.DOM.win.width(),content_width:this._content.domElem.width()+i,content_padding:i},this._coords.table_bottom>this._coords.win_bottom&&this._coords.table_top<this._coords.win_bottom?(this.setMod("position","fixed"),this.domElem.removeAttr("style"),this.domElem.css({left:this._coords.table_left_real,right:this._coords.table_width>this._coords.content_width?0:this._coords.win_width-(this._coords.table_width+this._coords.table_left)})):(this.delMod("position"),this.domElem.removeAttr("style"),this._coords.table_width>this._coords.content_width&&this.domElem.width(this._coords.content_width+this._coords.content_padding-this._coords.table_left))},_subscribe:function(){this.bindToDoc("scroll.bar",this.setPosition),this.bindToWin("resize.bar",this.setPosition),this.bindTo(this._table.elem("table"),"resize",this.setPosition),this._content.domElem.on("scroll",this.setPosition.bind(this)),this._content.domElem.on("resize",this.setPosition.bind(this)),this._table.on("grid-edit",this.setPosition,this)},destruct:function(){this._table.domElem&&(this.unbindFromDoc("scroll.bar"),this.unbindFromWin("resize.bar"),this._table&&this.unbindFrom(this._table.elem("table"),"resize"),this._content.domElem.off("scroll"),this._content.domElem.off("resize"),this._table.un("grid-edit",this.setPosition,this)),this._table.dropElemCache(),this.dropElemCache(),this._content=null,this._table=null,this.__base.apply(this,arguments)}}),function(t,e,i){"$:nomunge";function n(){s=e[a](function(){o.each(function(){var e=t(this),i=e.width(),n=e.height(),s=t.data(this,c);(i!==s.w||n!==s.h)&&e.trigger(l,[s.w=i,s.h=n])}),n()},r[d])}var s,o=t([]),r=t.resize=t.extend(t.resize,{}),a="setTimeout",l="resize",c=l+"-special-event",d="delay",u="throttleWindow";r[d]=250,r[u]=!0,t.event.special[l]={setup:function(){if(!r[u]&&this[a])return!1;var e=t(this);o=o.add(e),t.data(this,c,{w:e.width(),h:e.height()}),1===o.length&&n()},teardown:function(){if(!r[u]&&this[a])return!1;var e=t(this);o=o.not(e),e.removeData(c),o.length||clearTimeout(s)},add:function(e){function n(e,n,o){var r=t(this),a=t.data(this,c);a.w=n!==i?n:r.width(),a.h=o!==i?o:r.height(),s.apply(this,arguments)}if(!r[u]&&this[a])return!1;var s;return t.isFunction(e)?(s=e,n):(s=e.handler,e.handler=n,void 0)}}}(jQuery,this),BEM.DOM.decl("b-grid-table-options-item",{onSetMod:{js:function(){this._table=this.findBlockOutside("b-grid-table"),this._popup=this.findBlockOutside({block:"popup",modName:"type",modVal:"grid-options"}),this.hasMod("disabled","true")||this.bindTo("click",this._onClick)}},_onClick:function(){var t="/"+this._table.params.getTableData;switch(this._popup.hide(),this.getMod("action")){case"move":break;case"export":location.href=t+"/.xls";break;case"parent":location.href=t;break;case"old-page":break;case"delete":}}}),BEM.DOM.decl({block:"b-page",modName:"type",modVal:"error"},{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),this.errorBlock=this.findBlockInside("b-error-page"),this.errorCode=this.errorBlock.params.code,this["_error"+this.errorCode]&&this["_error"+this.errorCode]()}},_error404:function(){var t=this.bPage.findBlockInside({block:"button",modName:"error",modVal:"new-page"}),e=this.bPage.findBlockInside("m-head");t.on("click",function(){e._onClick()})},_error403:function(){this.button=this.bPage.findBlockInside("b-wiki-form").findBlockInside("button"),this.link=this.bPage.findBlockInside({block:"link",modName:"open",modVal:"form"}),this.link&&this.link.on("click",this._on403LinkClick,this),this.button.on("click",this._on403FormClick,this)},_on403LinkClick:function(){this.bPage.findBlockInside("b-wiki-form").toggleMod("show","yes","no"),this.link.destruct()},_on403FormClick:function(){var t=this.bPage.findBlockInside("b-wiki-form").findBlockInside("input").val();BEM.create("api-request",{_:"api-response",apiPath:".requestaccess",method:"PUT",data:{reason:t},urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(this._on403FormSubmit.bind(this),this._on403FormSubmitError.bind(this))},_on403FormSubmit:function(){this.bPage.findBlockInside("b-page").elem("text").text(BEM.I18N("b-page","access_request_sended")+".")},_on403FormSubmitError:function(t){var e={},i=BEM.I18N("b-page","error_occurred");t.message&&(i+=t.message),this.findElem("error").length&&this.findElem("error").remove(),e={block:"b-page",elem:"error",content:i},BEM.DOM.before(this.bPage.findBlockInside("b-wiki-form").domElem,BEMHTML.apply(e))}}),BEM.DOM.decl({block:"b-page",modName:"type",modVal:"new-page"},{onSetMod:{js:function(){var t=this.findBlockInside("m-editor"),e=this.findBlockInside("m-editor-buttons");saveButton=this.findBlockInside({block:"button",modName:"type",modVal:"new-page"}),this._bEditor=this.findBlockInside("m-editor"),this._bEditorTitle=this.findBlockInside({block:"input",modName:"type",modVal:"page-title"}),this._bEditorTextarea=this._bEditor.findBlockInside({block:"input",modName:"type",modVal:"textarea"}),t.init(e),this._setParamsToEditor(),saveButton.on("click",this._onNewPageSave.bind(this))}},_setParamsToEditor:function(){var t=WikiHistory._parseQueryParams();t&&(t.title&&this._bEditorTitle.elem("control").val(t.title),t.content&&this._bEditorTextarea.elem("control").val(t.content))},_onNewPageSave:function(){BEM.create("api-request",{_:"api-response",apiPath:"",method:"POST",data:{body:this._bEditor.getEditorData(),title:this._bEditorTitle.elem("control").val(),page_type:"article"},urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(this._onSaveData.bind(this),this._onPageSaveError.bind(this))},_onSaveData:function(t){window.location.pathname=t.data.supertag},_onPageSaveError:function(t){this.channel("errors").trigger("error",this._getErrorData(t.message))},_getErrorData:function(t){return{node:saveButton.domElem,content:{head:BEM.I18N("b-page","cant_delete_page"),body:t}}}}),BEM.DOM.decl("button",{onSetMod:{focused:{yes:function(){return this.hasMod("focus","no")?!1:this.__base.apply(this,arguments)}}}}),BEM.DOM.decl("m-head-arrow",{_firstCall:!0,onSetMod:{js:function(){var t=this;this.popup=this.findBlockInside("popup"),this.bindTo("click",function(){t._firstCall&&t._collectData(),t.popup.toggle(t.domElem)})}},_collectData:function(){var t,e=this;if(e._supportLS&&localStorage["m-head"]){var i=JSON.parse(localStorage.getItem("m-head"));e._compareDate(i.lastCallDate)?(e.popup.setContent(e._buildContent(i)),e._firstCall=!1):t=e._getServices()}else t=e._getServices()},_buildContent:function(t){var e;return t.error?(e={block:"m-head-services",mods:{type:"list"},content:{elem:"error",content:BEM.I18N("m-head-arrow","error")}},console.log("Error: ",t.error)):e={block:"m-head-services",mix:[{block:"i-font",mods:{face:"textbook"}}],content:[{elem:"list",elemMods:{type:"main"},content:this._buildList(t.main)},{elem:"list",content:this._buildList(t.secondary)}]},BEMHTML.apply(e)},_buildList:function(t){var e=BEM.I18N.lang(),i=[{elem:"left",content:[]},{elem:"right",content:[]}];return t.forEach(function(n){var s=t.length/2>i[0].content.length?0:1,o=n.application_id==this.params.type,r={block:"link",mods:o?{state:"current"}:void 0,url:n.url,content:[n.icon&&n.icon.length&&{block:"m-head-services",elem:"icon",icon:n.icon},"ru"==e?n.title:n["title_"+e]]};i[s].content.push(r)},this),i},_getServices:function(){var t=this;$.ajax({url:"https://staff.yandex-team.ru/navigation-api/",timeout:3e3,xhrFields:{withCredentials:!0}}).done(function(e){t.popup.setContent(t._buildContent(e)),t._saveLS(e),t._firstCall=!1}).fail(function(e,i){t.popup.setContent(t._buildContent({error:i}))})},_saveLS:function(t){var e=new Date;today=new Date(e.getFullYear(),e.getMonth(),e.getDate()).valueOf(),t.lastCallDate=today,localStorage.setItem("m-head",JSON.stringify(t))},_supportLS:function(){try{return"localStorage"in window&&null!==window.localStorage}catch(t){return!1}},_compareDate:function(t){var e=new Date,i=new Date(e.getFullYear(),e.getMonth(),e.getDate()).valueOf();return i==t?!0:void 0}}),BEM.DOM.decl("m-head-menu",{_onHasSubClick:function(t){var e=this,i=t.data.domElem;this.target=i,this.setMod(i,"is","opened"),this.__self._headMenuPopup||(this.__self._headMenuPopup=this.findBlockInside({block:"popup",modName:"theme",modVal:"head-menu"}).on("hide",function(){e.delMod(e.target,"is")})),this.__self._headMenuPopup.setContent(BEMHTML.apply(i.data("content"))).toggle(i)},_onMoreClick:function(t){this._morePopup||(this._morePopup=this.findBlockInside("more","popup")),this._morePopup.toggle(t.data.domElem)}},{live:function(){this.liveBindTo({elem:"item",modName:"hassub",modVal:"yes"},"click",function(t){this._onHasSubClick(t)}).liveBindTo("more","click",function(t){this._onMoreClick(t)})}}),BEM.DOM.decl("b-favs",{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),this.defaultFolderName=["__INBOX__",BEM.I18N("b-favs","favorite")],this.autoFolders={__OWNER__:BEM.I18N("b-favs","i_am_author"),__WATCHER__:BEM.I18N("b-favs","i_am_observer"),__LAST_EDIT__:BEM.I18N("b-favs","editerd_by_me")},this.linksCache=[]},mode:{opened:function(){this._showFavsWidget(),this.bPage.setMod("favorites","visible")},"":function(){this._hideFavsWidget(),this.bOptionsButton.delMod("mode"),this.bPage.delMod("favorites")}}},_onClick:function(t){t.preventDefault(),this.toggleMod("mode","opened")},_showFavsWidget:function(){var t;this.bWidget||(t=BEMHTML.apply({block:"b-favs-widget"}),BEM.DOM.append(this.bPage.domElem,t),this.bWidget=this.bPage.findBlockInside("b-favs-widget"),this.bWidget.on("hide",this._onWidgetHide,this),this.bFolders=this.bWidget.findBlockInside("b-favs-folders"),this.bLinks=this.bWidget.findBlockInside("b-favs-links"),this.bOptionsButton=this.bWidget.findBlockInside("b-favs-options-button")),this.bWidget.show()},_hideFavsWidget:function(){this.bWidget&&this.bWidget.hide()},_onWidgetHide:function(){this.delMod("mode")},clearLinksCache:function(t){null!=this.linksCache[t]&&delete this.linksCache[t]},clearCurrentLinksCache:function(){this.currentFolder&&this.currentFolder.params.name&&this.clearLinksCache(this.currentFolder.params.name)},changeFolderCount:function(t,e){t.params.count+=e,t.elem("count").html(t.params.count)},changeCurrentFolderCount:function(t){this.currentFolder&&this.changeFolderCount(this.currentFolder,t)},refreshFavs:function(){this.linksCache=[],this.bFolders.initBlock(),this.bLinks.initBlock()}},{live:function(){this.liveBindTo("click",function(t){this._onClick(t)})}}),BEM.DOM.decl("b-favs-widget",{onSetMod:{js:function(){this._bPage=this.findBlockOutside("b-page")}},show:function(){var t,e=this;this.hasMod("visibility","yes")||($(document).on("keyup.favs-widget",function(t){27===t.keyCode&&e.hide()}),t=this._bPage.findBlockInside({block:"b-widget",modName:"visibility",modVal:"yes"}),t&&t.hide(),this.setMod("visibility","yes"),this._bPage.setMod("scroll","disable"),$(document).scrollTop(0),setTimeout(function(){e.setMod("animate","yes")},100))},hide:function(){var t=this;this.hasMod("visibility","yes")&&(this.delMod("animate"),setTimeout(function(){$(document).off("keyup.favs-widget"),t.delMod("visibility"),t._bPage.delMod("scroll"),t.trigger("hide")},400))},_onClick:function(){this.hide()}},{live:function(){this.liveBindTo("paranja","click",function(t){this._onClick(t)})}}),BEM.DOM.decl("b-favs-folders",{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),this.bFavs=this.bPage.findBlockInside("b-favs"),this.foldersSpinner=this.findBlockInside("spinner"),this.initBlock()},mode:{edited:function(){this._setFoldersDraggable("true")},"":function(){this._setFoldersDraggable("false")}}},initBlock:function(){this._getFolders(),this.findBlockInside("scroll").elem("native").on("scroll",this.closeErrorPopup.bind(this))},_getFolders:function(){this._showSpinner(),BEM.create("api-request",{_:"api-response",apiPath:".favorites/folders",path:"",urlParams:["format=json"]}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this))},_onGotData:function(t){var e=BEMHTML.apply(this._getFoldersBEMJSON(t.data));this._hideSpinner(),BEM.DOM.update(this.elem("list"),e,this._onShowFoldersSuccess,this)},_onFailedData:function(){this._hideSpinner()},_onShowFoldersSuccess:function(){var t=this.findBlocksInside("b-favs-folder");t.length&&(this.bFavs.currentFolder=null!=this.bFavs.currentFolderIndex?t[this.bFavs.currentFolderIndex]||t[0]:t[0],this.bFavs.currentFolder&&this.bFavs.currentFolder.setMod("current","true"),this.bFavs.currentFolderIndex=null,this.hasMod("mode","edited")&&this._setFoldersDraggable("true"))},_getFoldersBEMJSON:function(t){var e=[],i=this,n=!0;return t.forEach(function(t){"A"==t.type&&n&&(e.push(i._getNewFolderBEMJSON()),n=!1),e.push(i._getFolderBEMJSON(t))}),e},_getFolderBEMJSON:function(t){var e="folder-close",i=t.name,n="custom";return"F"==t.type&&(e="bookmark",i=this.bFavs.defaultFolderName[1],n="default"),"A"==t.type&&(n="auto",i=this.bFavs.autoFolders[t.name]||t.name),{block:"b-favs-folders",elem:"item",mix:[{block:"b-favs-folder",js:{name:t.name,type:t.type,count:t.favorites_count},mods:{type:n}}],content:[{block:"b-favs-folder",elem:"icon",mix:[{block:"awesome-icon",mods:{icon:e}}]},{block:"b-favs-folder",elem:"move",content:{block:"awesome-icon",mods:{icon:"ellipsis-vertical"}}},{block:"b-favs-folder",elem:"content",content:[{block:"b-favs-folder",elem:"name",content:i},{block:"b-favs-folder",elem:"count",content:t.favorites_count}]},{block:"b-favs-folder",elem:"remove",content:{block:"awesome-icon",mods:{icon:"remove"}}}]}},_getNewFolderBEMJSON:function(){var t=BEM.I18N("b-favs-folders","new_folder");return{block:"b-favs-folders",elem:"item",mix:[{block:"b-favs-folder",mods:{type:"new-folder"}},{block:"b-favs-new-folder",js:!0}],content:[{block:"b-favs-folder",elem:"icon",mix:[{block:"awesome-icon",mods:{icon:"plus-sign-alt"}}]},{block:"b-favs-folder",elem:"name",content:t}]}},_showSpinner:function(){this.foldersSpinner.setMod("show","yes"),this.foldersSpinner.setMod("progress","yes"),this.elem("list").hide()},_hideSpinner:function(){this.foldersSpinner.setMod("show","no"),this.foldersSpinner.delMod("progress"),this.elem("list").show()},_setFoldersDraggable:function(t){this.findBlocksInside({block:"b-favs-folder",modName:"type",modVal:"custom"}).forEach(function(e){e.domElem.attr("draggable",t)})},closeErrorPopup:function(){this.channel("errors").trigger("errorHide")}}),BEM.DOM.decl("b-favs-folder",{onSetMod:{js:function(){this.__self.bPage||(this.__self.bPage=this.findBlockOutside("b-page")),this.__self.bFavs||(this.__self.bFavs=this.__self.bPage.findBlockInside("b-favs"))},current:{"true":function(){},"":function(){}},mode:{edited:function(){this.hasMod("type","custom")&&this.domElem.attr("draggable","false")},"":function(){this.hasMod("type","custom")&&this.__self.bFavs.bFolders.hasMod("mode","edited")&&this.domElem.attr("draggable","true")}}},_onNameClick:function(){this._isEditable()&&(this.folderTitle||(this.folderTitleElem=this.findElem("name"),this.folderTitle=this.folderTitleElem.text(),BEM.DOM.after(this.folderTitleElem,BEMHTML.apply({block:"input",js:{autoFocus:"yes"},mods:{size:"s"},value:this.folderTitle,content:{elem:"control"}})),this.folderNameInput=this.findBlockInside("input"),this.folderNameInput.on("blur",this._closeInput,this),this.folderNameInput.bindTo("keypress",this._onInputKeypress.bind(this))),this.setMod("mode","edited"),this.folderNameInput.elem("control").focus(),this.__self.bFavs.bFolders.closeErrorPopup())},_onInputKeypress:function(t){13===t.keyCode&&this.folderNameInput.elem("control").blur()},_closeInput:function(){var t=this.folderNameInput.val();this.delMod("mode"),t!==this.folderTitle&&(this.folderTitleElem.text(t),this._renameFolder(t))},_renameFolder:function(t){BEM.create("api-request",{_:"api-response",apiPath:".favorites/folders/"+encodeURIComponent(this.params.name),path:"",method:"POST",data:{new_name:t},urlParams:!1}).run().then(this._onRenameSuccess.bind(this,t),this._onRenameError.bind(this))
},_onRenameSuccess:function(t){this.folderTitle=t,this.params.name=t},_onRenameError:function(t){this.folderTitleElem.text(this.params.name),this.folderNameInput.val(this.params.name),this.channel("errors").trigger("error",this._getErrorData(this.domElem,BEM.I18N("b-favs-folder","cant_rename_folder"),t.message))},_onClick:function(){this.hasMod("current","true")||this.hasMod("type","new-folder")||(this.__self.bFavs.currentFolder.delMod("current"),this.setMod("current","true"),this.__self.bFavs.currentFolder=this,this.__self.bFavs.bOptionsButton.hasMod("mode","edited")&&(this.hasMod("type","auto")?this.__self.bFavs.bLinks.delMod("mode"):this.__self.bFavs.bLinks.setMod("mode","edited")),this.__self.bFavs.bLinks.getLinks(this.params.name))},_getFolderPrevName:function(){return this.domElem.prev().length&&this.domElem.prev().bem("b-favs-folder").params.name||null},_onDragStart:function(t){var e=t.originalEvent.dataTransfer;return this.__self.bFavs.bFolders.hasMod("mode","edited")?(this.setMod("mode","dragging"),this.__self.bFavs.bFolders.setMod("moving","yes"),this.__self.bFavs.draggingFolder=this,this.__self.bFavs.draggingFolderPrevName=this._getFolderPrevName(),e.setData("text/plain",""),e.effectAllowed="move",e.dropEffect="move",void 0):!1},_onDragEnd:function(t){var e=this.__self.bFavs.draggingFolder.params.name,i=this._getFolderPrevName();t.preventDefault(),this.hasMod("mode","dragging")&&this.delMod("mode"),this.__self.bFavs.bFolders.delMod("moving"),this.__self.bFavs.draggingFolderPrevName!=i&&this._dragBookmarkFolder(e,i),this.__self.bFavs.draggingFolder=!1,this.__self.bFavs.draggingFolderPrevName=null},_dragBookmarkFolder:function(t,e){BEM.create("api-request",{_:"api-response",apiPath:".favorites/folders/"+encodeURIComponent(t)+"/drag",path:"",method:"POST",data:{after:e},urlParams:!1}).run().then(this._onDragFolderSuccess.bind(this),this._onDragFolderError.bind(this))},_onDragFolderSuccess:function(){},_onDragFolderError:function(){},_isEditable:function(){return this.__self.bFavs.bFolders.hasMod("mode","edited")&&this.hasMod("current","true")&&this.hasMod("type","custom")},_isDroppable:function(){return this.__self.bFavs.bFolders.hasMod("dragging","yes")&&!this.hasMod("current","true")&&!this.hasMod("type","auto")&&!this.hasMod("type","new-folder")},_onDragEnter:function(){return this._isDroppable()?(this.setMod("dragging","over"),!1):this.__self.bFavs.bFolders.hasMod("moving","yes")&&this.__self.bFavs.draggingFolder!=this?!1:void 0},_onDragLeave:function(){return this._isDroppable()?(this.delMod("dragging"),!1):this.__self.bFavs.bFolders.hasMod("moving","yes")&&this.__self.bFavs.draggingFolder!=this?!1:void 0},_onDragOver:function(t){if(this._isDroppable())return t.preventDefault(),!1;if(this.__self.bFavs.bFolders.hasMod("moving","yes")&&this.__self.bFavs.draggingFolder!=this){var e,i;return t.preventDefault(),t.originalEvent.target.draggable&&this.__self.bFavs.draggingFolder!=this&&(e=t.target.getBoundingClientRect(),i=(t.originalEvent.clientY-e.top)/(e.bottom-e.top)>.5,this.__self.bFavs.bFolders.elem("list")[0].insertBefore(this.__self.bFavs.draggingFolder.domElem[0],i&&t.originalEvent.target.nextSibling||t.originalEvent.target)),!1}},_onDrop:function(){var t,e;this._isDroppable()&&(t=this.__self.bFavs.draggingLink,e=t.params.id,this.delMod("dragging"),this.__self.bFavs.isDropped=!0,t.setMod("mode","moving"),this._moveBookmark(e,this))},_moveBookmark:function(t,e){BEM.create("api-request",{_:"api-response",apiPath:".favorites/bookmarks/"+t+"/move",path:"",method:"POST",data:{target_folder_name:e.params.name},urlParams:!1}).run().then(this._onMoveSuccess.bind(this,e),this._onMoveError.bind(this))},_onMoveSuccess:function(t){var e=this;setTimeout(function(){e.__self.bFavs.draggingLink.domElem.hide(200),e.__self.bFavs.draggingLink=!1},10),this.__self.bFavs.changeCurrentFolderCount(-1),this.__self.bFavs.changeFolderCount(t,1),this.__self.bFavs.clearCurrentLinksCache(),this.__self.bFavs.clearLinksCache(t.params.name)},_onMoveError:function(){this.__self.bFavs.draggingLink.delMod("mode"),this.__self.bFavs.draggingLink=!1},_onRemoveClick:function(t){t.stopPropagation(),this.setMod("mode","removing"),BEM.create("api-request",{_:"api-response",apiPath:".favorites/folders/"+encodeURIComponent(this.params.name),path:"",method:"DELETE",urlParams:!1}).run().then(this._onRemoveSuccess.bind(this),this._onRemoveError.bind(this))},_onRemoveSuccess:function(){var t=this.__self.bPage.findBlockInside("b-favs-folder");this.domElem.hide(300),this.__self.bFavs.changeFolderCount(t,this.params.count),this.__self.bFavs.clearCurrentLinksCache(),this.__self.bFavs.clearLinksCache(t.params.name),this.__self.bFavs.currentFolder==this&&t.domElem.trigger("click")},_onRemoveError:function(t){this.delMod("mode"),this.channel("errors").trigger("error",this._getErrorData(this.domElem,BEM.I18N("b-favs-folder","cant_delete_folder"),t.message))},_getErrorData:function(t,e,i){return{node:t,content:{head:e,body:i}}}},{live:function(){this.liveBindTo("name","click",function(){this._onNameClick()}),this.liveBindTo("remove","click",function(t){this._onRemoveClick(t)}),this.liveBindTo("click",function(){this._onClick()}),this.liveBindTo("dragstart",function(t){this._onDragStart(t)}),this.liveBindTo("dragend",function(t){this._onDragEnd(t)}),this.liveBindTo("dragenter",function(t){this._onDragEnter(t)}),this.liveBindTo("dragleave",function(t){this._onDragLeave(t)}),this.liveBindTo("dragover",function(t){this._onDragOver(t)}),this.liveBindTo("drop",function(t){this._onDrop(t)})}}),BEM.DOM.decl("b-favs-new-folder",{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),this.bFavs=this.bPage.findBlockInside("b-favs")}},_onClick:function(){this.folderBlock=this.findBlockOn("b-favs-folder"),this.folderTitleElem=this.folderBlock.findElem("name"),BEM.DOM.after(this.folderTitleElem,BEMHTML.apply({block:"input",js:{autoFocus:"yes"},mods:{size:"s"},value:BEM.I18N("b-favs-new-folder","new_folder"),content:{elem:"control"}})),BEM.DOM.destruct(this.folderBlock.elem("name")),this.folderNameInput=this.findBlockInside("input"),this.folderNameInput.on("blur",this._closeInput,this),this.folderNameInput.bindTo("keypress",this._onInputKeypress.bind(this)),this.folderBlock.setMod("mode","edited"),this.folderNameInput.elem("control").focus()},_onInputKeypress:function(t){this.bFavs.bFolders.closeErrorPopup(),13===t.keyCode&&this.folderNameInput.elem("control").blur()},_closeInput:function(){var t=this.folderNameInput.val();this.setMod("mode","creating"),this._createNewFolder(t)},_createNewFolder:function(t){BEM.create("api-request",{_:"api-response",apiPath:".favorites/folders/"+encodeURIComponent(t),path:"",method:"PUT",urlParams:!1}).run().then(this._onCreateSuccess.bind(this,t),this._onCreateError.bind(this))},_onCreateSuccess:function(){this.delMod("mode"),this.bFavs.currentFolderIndex=this.bFavs.currentFolder.domElem.index(),this.bFavs.bFolders._getFolders()},_onCreateError:function(t){this.delMod("mode"),this.bFavs.bFolders.hasMod("mode","edited")&&this.channel("errors").trigger("error",this._getErrorData(this.domElem,BEM.I18N("b-favs-new-folder","cant_create_folder"),t.message))},_getErrorData:function(t,e,i){return{node:t,content:{head:e,body:i}}}},{live:function(){this.liveBindTo("click",function(t){this._onClick(t)})}}),BEM.DOM.decl("b-favs-links",{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),this.bFavs=this.bPage.findBlockInside("b-favs"),this.linksSpinner=this.findBlockInside("spinner"),this.removableDomains=[window.location.origin,"http://wiki.yandex-team.ru","https://wiki-unstable.dev.yandex-team.ru"],this.initBlock()},mode:{edited:function(){this.findElem("item").attr("draggable","true")},"":function(){this.findElem("item").attr("draggable","false")}}},initBlock:function(){this.getLinks(this.bFavs.defaultFolderName[0])},getLinks:function(t){return null!=this.bFavs.linksCache[t]?(this._showLinks(t),void 0):(this._showSpinner(),BEM.create("api-request",{_:"api-response",apiPath:".favorites/folders/"+encodeURIComponent(t),path:"",urlParams:["format=json"]}).run().then(this._onGotData.bind(this,t),this._onFailedData.bind(this)),void 0)},_onGotData:function(t,e){this.bFavs.linksCache[t]=BEMHTML.apply(this._getLinksBEMJSON(e.data)),this._hideSpinner(),this._showLinks(t)},_onFailedData:function(){this._hideSpinner()},_showLinks:function(t){null!=this.bFavs.linksCache[t]&&(BEM.DOM.update(this.elem("list"),this.bFavs.linksCache[t]),this.hasMod("mode","edited")&&this.findElem("item").attr("draggable","true"))},_showSpinner:function(){this.linksSpinner.setMod("show","yes"),this.linksSpinner.setMod("progress","yes"),this.elem("list").hide()},_hideSpinner:function(){this.linksSpinner.setMod("show","no"),this.linksSpinner.delMod("progress"),this.elem("list").show()},_getLinksBEMJSON:function(t){var e=this,i=[];return t.forEach(function(t){var n=t.url;e.removableDomains.forEach(function(t){n=n.replace(t,"")});var s={block:"b-favs-links",elem:"item",mix:[{block:"b-favs-link",js:{id:t.id}}],content:[{block:"b-favs-link",elem:"move",content:{block:"awesome-icon",mods:{icon:"ellipsis-vertical"}}},{block:"b-favs-link",elem:"title",content:{block:"b-link",url:t.url,content:t.title,title:t.title+" - "+t.url}},{block:"b-favs-link",elem:"url",content:n},{block:"b-favs-link",elem:"date",timestamp:t.page_modified_at},{block:"b-favs-link",elem:"remove",content:{block:"awesome-icon",mods:{icon:"remove"}}}]};i.push(s)}),i}}),BEM.DOM.decl("b-favs-link",{onSetMod:{js:function(){this.__self.bPage||(this.__self.bPage=this.findBlockOutside("b-page")),this.__self.bFavs||(this.__self.bFavs=this.__self.bPage.findBlockInside("b-favs"))},mode:{edited:function(){this.domElem.attr("draggable","false")},"":function(){this.__self.bFavs.bLinks.hasMod("mode","edited")&&this.domElem.attr("draggable","true")}}},_onClick:function(t){this.__self.bFavs.bLinks.hasMod("mode","edited")&&(t.preventDefault(),this.linkTitle||this.bLink||(this.linkTitle=this.findElem("title"),this.bLink=this.findBlockInside("title","b-link"),this.linkText=this.bLink.domElem.text(),BEM.DOM.append(this.linkTitle,BEMHTML.apply({block:"input",js:{autoFocus:"yes"},mods:{size:"s"},value:this.linkText,content:{elem:"control"}})),this.linkInput=this.findBlockInside("title","input"),this.linkInput.on("blur",this._closeInput,this),this.linkInput.bindTo("keypress",this._onInputKeypress.bind(this))),this.setMod("mode","edited"),this.linkInput.elem("control").focus())},_onInputKeypress:function(t){13===t.keyCode&&this.linkInput.elem("control").blur()},_closeInput:function(){var t=this.linkInput.val();this.delMod("mode"),t&&t!==this.linkText&&(this.bLink.domElem.text(t),this._renameBookmark(t))},_renameBookmark:function(t){BEM.create("api-request",{_:"api-response",apiPath:".favorites/bookmarks/"+this.params.id,path:"",method:"POST",data:{title:t},urlParams:!1}).run().then(this._onRenameSuccess.bind(this,t),this._onRenameError.bind(this))},_onRenameSuccess:function(t){this.linkText=t,this.__self.bFavs.clearCurrentLinksCache()},_onRenameError:function(t){this.bLink.domElem.text(this.linkText),this.linkInput.val(this.linkText),this.channel("errors").trigger("error",this._getErrorData(this.linkTitle,BEM.I18N("b-favs-link","cant_rename_link"),t.message))},_onRemoveClick:function(){this.setMod("mode","removing"),BEM.create("api-request",{_:"api-response",apiPath:".favorites/bookmarks/"+this.params.id,path:"",method:"DELETE",urlParams:!1}).run().then(this._onRemoveSuccess.bind(this),this._onRemoveError.bind(this))},_onRemoveSuccess:function(){var t=this,e=this.getLocation(this.findBlockInside("b-link").domElem.attr("href"));setTimeout(function(){t.domElem.hide(300)},10),this.__self.bFavs.clearCurrentLinksCache(),this.__self.bFavs.changeCurrentFolderCount(-1),location.pathname+location.hash==e.pathname+e.hash&&this.__self.bPage.findBlockInside("b-page-favorites-button").setMod("type","add")},_onRemoveError:function(t){this.delMod("mode"),this.channel("errors").trigger("error",this._getErrorData(this.linkTitle,BEM.I18N("b-favs-link","cant_delete_link"),t.message))},getLocation:function(t){var e=document.createElement("a");return e.href=t,e},_getLinkPrevID:function(){return this.domElem.prev().length&&this.domElem.prev().bem("b-favs-link").params.id||null},_onDragStart:function(t){var e=t.originalEvent.dataTransfer;return this.__self.bFavs.bLinks.hasMod("mode","edited")?(this.setMod("mode","dragging"),this.__self.bFavs.bLinks.setMod("dragging","yes"),this.__self.bFavs.bFolders.setMod("dragging","yes"),this.__self.bFavs.draggingLink=this,this.__self.bFavs.draggingLinkPrevID=this._getLinkPrevID(),e.setData("text/plain",""),e.effectAllowed="move",e.dropEffect="move",void 0):!1},_onDragEnd:function(t){var e=this.__self.bFavs.draggingLink.params.id,i=this._getLinkPrevID();t.preventDefault(),this.hasMod("mode","dragging")&&this.delMod("mode"),this.__self.bFavs.bFolders.delMod("dragging"),this.__self.bFavs.bLinks.delMod("dragging"),this.__self.bFavs.isDropped||(this.__self.bFavs.draggingLinkPrevID!=i&&this._dragBookmark(e,i),this.__self.bFavs.draggingLink=!1,this.__self.bFavs.draggingLinkPrevID=null),this.__self.bFavs.isDropped=!1},_onDragEnter:function(){return this.__self.bFavs.draggingLink!=this?!1:void 0},_onDragLeave:function(){return this.__self.bFavs.draggingLink!=this?!1:void 0},_onDragOver:function(t){var e,i;return t.preventDefault(),this.__self.bFavs.bLinks.hasMod("dragging","yes")&&this.__self.bFavs.draggingLink!=this&&(e=t.target.getBoundingClientRect(),i=(t.originalEvent.clientY-e.top)/(e.bottom-e.top)>.5,i&&!t.originalEvent.target.nextSibling&&this.__self.bFavs.bLinks.elem("list")[0].appendChild(this.__self.bFavs.draggingLink.domElem[0]),this.__self.bFavs.bLinks.elem("list")[0].insertBefore(this.__self.bFavs.draggingLink.domElem[0],i&&t.originalEvent.target.nextSibling||t.originalEvent.target)),!1},_dragBookmark:function(t,e){BEM.create("api-request",{_:"api-response",apiPath:".favorites/bookmarks/"+t+"/drag",path:"",method:"POST",data:{after:e},urlParams:!1}).run().then(this._onDragSuccess.bind(this),this._onDragError.bind(this))},_onDragSuccess:function(){this.__self.bFavs.clearCurrentLinksCache()},_onDragError:function(){},_getErrorData:function(t,e,i){return{node:t,content:{head:e,body:i}}}},{live:function(){this.liveBindTo("title","click",function(t){this._onClick(t)}),this.liveBindTo("remove","click",function(t){this._onRemoveClick(t)}),this.liveBindTo("dragstart",function(t){this._onDragStart(t)}),this.liveBindTo("dragend",function(t){this._onDragEnd(t)}),this.liveBindTo("dragenter",function(t){this._onDragEnter(t)}),this.liveBindTo("dragleave",function(t){this._onDragLeave(t)}),this.liveBindTo("dragover",function(t){this._onDragOver(t)})}}),BEM.DOM.decl("b-favs-options-button",{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),this.bFavs=this.bPage.findBlockInside("b-favs"),this.editButton=this.findBlockOn("button")},mode:{edited:function(){this.editButton.elem("text").text(BEM.I18N("b-favs-options-button","complete")),this.bFavs.currentFolder.hasMod("type","auto")||this.bFavs.bLinks.setMod("mode","edited"),this.bFavs.bFolders.setMod("mode","edited")},"":function(){this.editButton.elem("text").text(BEM.I18N("b-favs-options-button","settings")),this.bFavs.bLinks.delMod("mode"),this.bFavs.bFolders.delMod("mode")}}},_onClick:function(){this.toggleMod("mode","edited")}},{live:function(){this.liveBindTo("click",function(t){this._onClick(t)})}}),BEM.DOM.decl("m-head-search",{onSetMod:{js:function(){var t=this;this.findBlockInside("m-suggest").on("select",function(){t.domElem.submit()})}}},{}),BEM.DOM.decl({block:"m-suggest",modName:"type",modVal:"intranet-suggest"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._requestSettings={type:this.__self.REQUEST_TYPE,url:"//search.yandex-team.ru/suggest",dataType:this.__self.REQUEST_DATA_TYPE,timeout:this.__self.REQUEST_TIMEOUT}}},_getData:function(t){var e=[];return this.params.types.forEach(function(i){"object"==typeof i?(!i.symbolsToSend||i.symbolsToSend<=t.length)&&e.push(i.name.replace("staff","people")):e.push(i.replace("staff","people"))}),{text:t,s:e}},_isNotEmptyResult:function(t){var e=!1;return Object.keys(t).forEach(function(i){t[i].length&&(e=!0)}),e},_getItemsHTML:function(t){var e,i=[],n=this,s="";return Object.keys(t).forEach(function(o){var r=o.replace("people","staff");e=n._getItemTypeFromOptions(r),e.maxCount&&(t[o]=t[o].slice(0,e.maxCount)),s=n.params.inHeader||n.params.inSearchHeader||"staff"===r?"":r,i.push({block:"m-suggest-group",groupLabel:s,content:$.map(t[o],function(t){return n._getItemBEMJSON(r,t,!0)})})}),BEMHTML.apply(i)},_selectItem:function(t,e){this.__base.apply(this,arguments),e&&$('<form style="display:none" action="'+t.params.href+'"/>').appendTo("body").submit().remove()}}),BEM.DOM.decl("m-head-user",{_onClick:function(){this._popup||(this._popup=this.findBlockInside("popup")),this._popup.toggle(this.domElem)}},{live:function(){this.liveBindTo("click",function(){this._onClick()})}}),BEM.DOM.decl("m-orange",{onSetMod:{js:function(){this.params.api&&(this.__self.API_HOST=this.params.api),this.OFFSET=parseInt(this.params.offset)||this.__self.DEFAULT_OFFSET,this.NOTIFICATIONS_LIMIT=parseInt(this.params.notificationsLimit)||this.__self.DEFAULT_LIMIT,this.CLOSED_QUERY_TIME=parseInt(this.params.closedQueryTime),this.OPENED_QUERY_TIME=parseInt(this.params.openedQueryTime)||this.__self.DEFAULT_OPENED_QUERY_TIME,this.MARK_AS_READ_TIME=parseInt(this.params.markAsReadTime)||this.__self.DEFAULT_MARK_AS_READ_TIME,this.REPEAT_ON_ERROR_TIME=parseInt(this.params.repeatOnErrorTime)||this.__self.DEFAULT_REPEAT_ON_ERROR_TIME,this.REQUEST_TIMEOUT=parseInt(this.params.requestTimeout)||this.__self.DEFAULT_REQUEST_TIMEOUT,BEM.blocks["m-orange-item"].on("mark",this._onMarkNotification,this),BEM.DOM.win.on({focus:this._setActive.bind(this),blur:this._setInactive.bind(this)}),this._startQuery(this.CLOSED_QUERY_TIME)}},_setActive:function(){this.__self._regularRequestAllowed=!0},_setInactive:function(){this.__self._regularRequestAllowed=!1},_startQuery:function(t){var e=this;this._getNewCount(),this._newRequestInterval=setInterval(function(){e._getNewCount()},t||this.__self.DEFAULT_CLOSED_QUERY_TIME)},_onPopupShow:function(){},_onPopupHide:function(){var t=this;BEM.DOM.destruct(this._oranges.elem("error-controll")),BEM.DOM.destruct(this._oranges.elem("oranges-list"),!0),BEM.DOM.destruct(this._oranges.elem("old-notifications-list"),!0),BEM.DOM.destruct(this._oranges.elem("old")),BEM.DOM.destruct(this._oranges.elem("empty")),this._oranges.dropElemCache(),this._empty=!1,this._loadedOld=void 0,this._leftToLoadOld=void 0,clearInterval(this._newRequestInterval),this._startQuery(this.CLOSED_QUERY_TIME),this.getPopup()._getUnder().css({top:""}),setTimeout(function(){t.delMod("opened")},0)},_getNewCount:function(){!this._errorMode&&this.__self._regularRequestAllowed&&$.ajax({url:this.__self.getApiNotificationsString()+"/pull/state",timeout:this.REQUEST_TIMEOUT,xhrFields:{withCredentials:!0}}).then(this._onNewNotificationsRequest.bind(this),this._onNewNotificationsRequestError.bind(this))},_onNewNotificationsRequest:function(t){void 0===this._unreadNotifications&&(this._unreadNotifications=t.unreadNotificationsCount),this._acknowledgedNotifications=t.acknowledgedNotifications,t.unreadNotificationsCount?(this.setMod("new","notifications"),void 0===this._leftToLoad&&(this._leftToLoad=0),this.getPopup().hasMod("visibility","visible")&&t.unreadNotificationsCount>this._unreadNotifications&&this._prependNewNotifications(),this._unreadNotifications=t.unreadNotificationsCount):this.delMod("new"),t.pendingNotificationsCount&&(this.setMod("pending","notifications"),this._setCounter(t.pendingNotificationsCount))},_onNewNotificationsRequestError:function(){},_setCounter:function(t){this._counter=t,t=0==t?"":t,BEM.DOM.update(this.elem("counter"),t)},_onMarkNotification:function(){var t;this._loaded=this._loaded-1,this._decreaseCounter(),this._leftToLoad?(t=this.getPopup(),t.domElem.off("scroll"),this._getMoreNotifications()):0===this._counter&&!this._empty&&this._setEmptyContent()},_decreaseCounter:function(){this._setCounter(parseInt(this.elem("counter").text())-1)},_showPopup:function(){var t=this.getPopup();t._getUnder().css({top:this._parent.domElem.offset().top+this._parent.domElem.outerHeight()}),t.show(),this._posPopup(),this._oranges||(this._oranges=t.findBlockInside("m-oranges")),this._spin||(this._spin=this._oranges.findBlockInside(this._oranges.elem("spinner"),"spinner")),this._spin.setMod("progress","yes")},_posPopup:function(){var t=this.getPopup();t.domElem.css({left:"auto",margin:0,right:this.OFFSET-16,top:this._parent.domElem.offset().top+this._parent.domElem.outerHeight()+this.OFFSET,bottom:this.OFFSET})},_setContent:function(){var t=this.getPopup();return this._spin.delMod("progress"),this._oranges.dropElemCache(),this._data.notifications.length?(BEM.DOM.update(this._oranges.elem("oranges-list"),BEMHTML.apply(this._getOrangesBEMJSON())),t.domElem.on("scroll",this._onNewNotificationsScroll.bind(this)),clearInterval(this._newRequestInterval),this._currentUnread.ids.length?this._startMarkAsRead():this._startQuery(this.OPENED_QUERY_TIME),void 0):(this._setEmptyContent(),void 0)},_onNewNotificationsScroll:function(){var t=this.getPopup();t.domElem.scrollTop()+t.domElem.innerHeight()>=t.domElem[0].scrollHeight&&(t.domElem.off("scroll"),this._getMoreNotifications())},_startMarkAsRead:function(t){var e=this;setTimeout(function(){BEM.blocks["mi-orange-token"].getToken(t).then(e._markAsRead.bind(e)).then(e._onMarkAsRead.bind(e),e._onMarkAsReadfail.bind(e)).then(e._startQuery.bind(e,e.OPENED_QUERY_TIME))},t?0:this.MARK_AS_READ_TIME)},_getLoadOldBtnBEMJSON:function(){return{block:"button",mods:{size:"s"},content:BEM.I18N("m-orange","old_messages")}},_markAsRead:function(t){return $.ajax({url:this.__self.getApiNotificationsString()+"/response/receive",type:"PUT",beforeSend:function(e){e.setRequestHeader("X-CSRFToken",t)},timeout:this.REQUEST_TIMEOUT,contentType:"application/json",dataType:"json",data:JSON.stringify(this._currentUnread),xhrFields:{withCredentials:!0}})},_onMarkAsRead:function(){this._unreadNotifications=this._unreadNotifications-this._currentUnread.ids.length,this._unreadNotifications<0&&(this._unreadNotifications=0),this._currentUnread.ids=[],this._oranges.findBlocksInside({block:"m-orange-item",modName:"status",modVal:"unread"}).forEach(function(t){t.delMod("status")})},_onMarkAsReadfail:function(t){var e=this,i=!1;t=t.responseText?JSON.parse(t.responseText):t,403==t.statusCode&&"token error"===t.errorMessages[0]&&(i=!0),setTimeout(function(){e._startMarkAsRead(i)},i?0:this.REPEAT_ON_ERROR_TIME)},_onClick:function(){this.getPopup();this._parent||(this._parent=this.findBlockOutside(this.params.parentOffset)),this.hasMod("opened","yes")||(this.setMod("opened","yes"),this._showPopup(),this._getDataAndSubscribeCallbacks())},_getDataAndSubscribeCallbacks:function(){this._getData().then(this._onGotData.bind(this),this._onGotDataError.bind(this)).then(this._setContent.bind(this))},_getData:function(){return $.ajax({url:this.__self.getApiNotificationsString()+"/pull/all/page/",timeout:this.REQUEST_TIMEOUT,data:{skip:0,limit:this.NOTIFICATIONS_LIMIT},xhrFields:{withCredentials:!0}})},_onGotData:function(t){this._gotDataError=!1,this._data=t,this._loaded=this._data.notifications.length,this._leftToLoad=this._data.totalNotifications-this._loaded,this._setCounter(this._data.totalNotifications),this._lastLoad=this._getUTCString(new Date)},_getUTCString:function(t){var e=t.toISOString(),i=Math.abs(~e.search(/\./));return e.substr(0,i-1)+"Z"},_onGotDataError:function(){var t=this;this._gotDataError?this._onGotDataErrorControll():setTimeout(function(){t._gotDataError=!0,t._getDataAndSubscribeCallbacks()},this.REPEAT_ON_ERROR_TIME)},_onGotDataErrorControll:function(){var t={title:BEM.I18N("m-orange","load_error"),button:BEM.I18N("m-orange","repeat_request")};this._setErrorButton(t,"append"),this._oranges.findBlockInside(this._oranges.elem("error-controll"),"button").on("click",{type:"getData"},this._onErrorButtonClick,this)},_onErrorButtonClick:function(t){switch(BEM.DOM.destruct(this._oranges.elem("error-controll")),this._oranges.dropElemCache(),this._errorMode=!1,t.data.type){case"getData":this._spin.setMod("progress","yes"),this._gotDataError=!1,this._getDataAndSubscribeCallbacks();break;case"prependNewNotifications":this._prependNewNotifications();break;case"moreNotifications":this._getMoreNotifications()}},_setErrorButton:function(t,e){this._errorMode=!0,this._spin.delMod("progress"),BEM.DOM[e](this._oranges.domElem,BEMHTML.apply({block:this._oranges.__self.getName(),elem:"error-controll",content:[{elem:"error-controll-title",content:t.title},t.button&&{block:"button",mods:{size:"s"},content:t.button}]}))},_prependNewNotifications:function(){this._getUnreadData().then(this._setNewContent.bind(this),this._getUnreadDataFail.bind(this))},_getUnreadData:function(){return clearInterval(this._newRequestInterval),$.ajax({url:this.__self.getApiNotificationsString()+"/pull/all/interval/",timeout:this.REQUEST_TIMEOUT,data:{from:this._lastLoad,to:this._getUTCString(new Date)},xhrFields:{withCredentials:!0}})},_getUnreadDataFail:function(){var t={title:BEM.I18N("m-orange","load_error"),button:BEM.I18N("m-orange","repeat_request")};this._setErrorButton(t,"prepend"),this._oranges.findBlockInside(this._oranges.elem("error-controll"),"button").on("click",{type:"prependNewNotifications"},this._onErrorButtonClick,this)},_setNewContent:function(t){var e=this;this._data=t,this._loaded=this._loaded+this._data.notifications.length,BEM.DOM.destruct(this._oranges.elem("error-controll")),BEM.DOM.destruct(this._oranges.elem("old")),BEM.DOM.destruct(this._oranges.elem("empty")),BEM.DOM.destruct(this._oranges.elem("old-notifications-list"),!0),this._empty=!1,this._newContentBEMJSON=this._getOrangesBEMJSON(),BEM.DOM.prepend(this._oranges.domElem,BEMHTML.apply({block:this._oranges.__self.getName(),elem:"list-update",content:this._newContentBEMJSON})),this._lastLoad=this._getUTCString(new Date),this._oranges.dropElemCache(),setTimeout(function(){e.bindTo(e._oranges.elem("list-update"),"transitionend",e._onNewNotificationsShow),e._oranges.setMod(e._oranges.elem("list-update"),"show","notifications"),e._startMarkAsRead()},0)},_setEmptyContent:function(){clearInterval(this._newRequestInterval),BEM.DOM.destruct(this._oranges.elem("empty")),BEM.DOM.destruct(this._oranges.elem("old")),this._oranges.dropElemCache(),this._acknowledgedNotifications?(BEM.DOM.append(this._oranges.domElem,BEMHTML.apply([{block:this._oranges.__self.getName(),elem:"empty",content:[{elem:"empty-title",content:BEM.I18N("m-orange","no_new_messages")}]},{block:this._oranges.__self.getName(),elem:"old",content:this._getLoadOldBtnBEMJSON()}])),this._oldButton=this._oranges.findBlockInside(this._oranges.elem("old"),"button"),this._oldButton.on("click",this._onOldButtonClick,this)):BEM.DOM.append(this._oranges.domElem,BEMHTML.apply({block:this._oranges.__self.getName(),elem:"empty",elemMods:{acknowledged:"no"},content:[{elem:"empty-title",content:BEM.I18N("m-orange","center")},{elem:"empty-body",content:BEM.I18N("m-orange","we_will")}]})),this._empty=!0,this._startQuery(1e4)},_onOldButtonClick:function(){void 0===this._loadedOld&&(this._loadedOld=0),void 0===this._leftToLoadOld&&(this._leftToLoadOld=0),BEM.DOM.destruct(this._oranges.elem("empty"),!0),BEM.DOM.destruct(this._oranges.elem("error-controll")),this._spin.setMod("progress","yes"),$.ajax({url:this.__self.getApiNotificationsString()+"/pull/all/page/",timeout:this.REQUEST_TIMEOUT,data:{filterType:"not_pending",skip:this._loadedOld,limit:this.NOTIFICATIONS_LIMIT},xhrFields:{withCredentials:!0}}).then(this._onOldNotifications.bind(this),this._onOldNotificationsFail.bind(this))},_onOldNotificationsFail:function(){var t={title:BEM.I18N("m-orange","load_error"),button:BEM.I18N("m-orange","repeat_request")};this._setErrorButton(t,"prepend"),this._oranges.dropElemCache()},_onOldNotifications:function(t){this._oldData=t,this._loadedOld=this._loadedOld+this._oldData.notifications.length,this._leftToLoadOld=this._oldData.totalNotifications-this._loadedOld,this._spin.delMod("progress"),this._setOldContent(),this._leftToLoadOld<=0&&this._oranges.setMod(this._oranges.elem("old"),"state","hidden")},_setOldContent:function(){var t=this,e=[];this._oldData.notifications.forEach(function(i){e.push(t._getOldItemBEMJSON(i))}),BEM.DOM.destruct(this._oranges.elem("empty")),BEM.DOM.append(this._oranges.elem("old-notifications-list"),BEMHTML.apply(e))},_getOldItemBEMJSON:function(t){var e={block:"m-orange-item",mods:{old:"yes"},content:[this._getOrangesTitleBEMJSON(t),this._getOrangesBodyBEMJSON(t)]};switch(t.answer){case 2:e.mods.comment="accept";break;case 3:e.mods.comment="decline"}return e},_onNewNotificationsShow:function(){this.unbindFrom(this._oranges.elem("list-update"),"transitionend"),BEM.DOM.destruct(this._oranges.elem("list-update")),BEM.DOM.prepend(this._oranges.elem("oranges-list"),BEMHTML.apply(this._newContentBEMJSON))},_getOrangesBEMJSON:function(){var t=this,e=[];return this._data.notifications.forEach(function(i){e.push(t._getOrangeItemBEMJSON(i))}),e},_getOrangeItemBEMJSON:function(t){var e={block:"m-orange-item",mods:{old:"no"},js:{id:t.id},content:[this._getOrangesTitleBEMJSON(t),this._getOrangesBodyBEMJSON(t)]};return this._currentUnread||(this._currentUnread={ids:[]}),t.received||(!this.hasMod("new")&&this.setMod("new","notifications"),this._currentUnread.ids.push(t.id),e.mods.status="unread"),2==t.notificationType?(e.mods.type="action",t.commentRequired&&(e.mods.need="comment")):e.mods.type="notification",e},_getOrangesBodyBEMJSON:function(t){var e=this,i={elem:"body",content:t.description.body?t.description.body.map(function(t){return t.login?e._getUserBEMJSON(t):$.escapifyHTML(t.text)}):[]};return 2==t.notificationType&&i.content.push(this._getActionsBEMSON(t)),i},_wrapWithLinkBEMJSON:function(t,e){return{block:"link",url:e,content:$.escapifyHTML(t)}},_getUserBEMJSON:function(t){return{block:"m-username",mix:[{block:"mi-staff-card",js:{user:t.login}}],url:"//staff.yandex-team.ru/"+t.login,content:t.text}},_getOrangesTitleBEMJSON:function(t){var e=this,i={elem:"title",content:t.description.header.map(function(i){var n;return n=t.description.url?i.login?e._getUserBEMJSON(i):e._wrapWithLinkBEMJSON(i.text,t.description.url):i.login?e._getUserBEMJSON(i):$.escapifyHTML(i.text)})};return 1==t.notificationType&&1==t.answer&&i.content.push({elem:"mark",content:"×"}),i},_getActionsBEMSON:function(t){return{block:"m-orange-actions",mix:t.answer&&1==t.answer?[{block:"m-orange-item",elem:"actions"}]:!1,answer:t.answer?t.answer:!1,comment:t.commentRequired?!0:!1,userComment:t.userComment?t.userComment:!1}},_getMoreNotifications:function(){this._leftToLoad&&(this._spin.setMod("progress","yes"),$.ajax({url:this.__self.getApiNotificationsString()+"/pull/all/page/",timeout:this.REQUEST_TIMEOUT,data:{skip:this._loaded,limit:this.NOTIFICATIONS_LIMIT},xhrFields:{withCredentials:!0}}).then(this._onMoreNotifications.bind(this),this._onMoreNotificationsFail.bind(this)))},_onMoreNotificationsFail:function(){var t={title:BEM.I18N("m-orange","load_error"),button:BEM.I18N("m-orange","repeat_request")};this._setErrorButton(t,"append"),this._oranges.findBlockInside(this._oranges.elem("error-controll"),"button").on("click",{type:"moreNotifications"},this._onErrorButtonClick,this)},_onMoreNotifications:function(t){var e=this.getPopup();this._spin.delMod("progress"),this._loaded=this._loaded+t.notifications.length,this._leftToLoad=t.totalNotifications-this._loaded,this._leftToLoad<=0&&(this._leftToLoad=0),this._data=t,BEM.DOM.append(this._oranges.elem("oranges-list"),BEMHTML.apply(this._getOrangesBEMJSON())),this._startMarkAsRead(),e.domElem.on("scroll",this._onNewNotificationsScroll.bind(this))},getPopup:function(){var t;return this._popup||(t=BEMHTML.apply({block:"popup",mods:{type:"modal",position:"fixed",orange:"yes"},underMods:{type:"paranja",orange:"yes"},content:{elem:"content",content:[{block:"m-oranges",content:[{elem:"oranges-list"},{elem:"old-notifications-list"},{elem:"spinner",content:{block:"spinner",mods:{size:"xl"}}}]}]}}),BEM.DOM.append(this.domElem,t),this._popup=this.findBlockInside("popup"),this._popup.on("show",this._onPopupShow,this),this._popup.on("hide",this._onPopupHide,this)),this._popup
}},{live:function(){return this.liveBindTo("leftclick",function(t){this._onClick(t)}),!1},DEFAULT_OFFSET:17,DEFAULT_LIMIT:50,DEFAULT_CLOSED_QUERY_TIME:6e4,DEFAULT_OPENED_QUERY_TIME:1e4,DEFAULT_MARK_AS_READ_TIME:3e3,DEFAULT_REPEAT_ON_ERROR_TIME:3e3,DEFAULT_REQUEST_TIMEOUT:4e3,API_HOST:"https://orange.yandex-team.ru",API_NOTIFICATIONS:"/notifications",API_PREFERENVES:"/preferences",_regularRequestAllowed:!0,getApiNotificationsString:function(){return this.API_HOST+this.API_NOTIFICATIONS},getApiPreferencesString:function(){return this.API_HOST+this.API_PREFERENVES}}),function(t){t.escapifyHTML=function(e){return e?t("<div/>").text(e).html():"$$_undefined_escapifyHTML()_$$"},t.unescapifyHTML=function(e){return e?t("<div/>").html(e).text():"$$_undefined_unescapifyHTML()_$$"}}(jQuery),BEM.DOM.decl({block:"m-orange-item"},{onSetMod:{js:function(){this.hasMod("need","comment")&&keymaster("command+enter, ctrl+enter",this._thisOnMetaReturn.bind(this))}},destruct:function(){keymaster.unbind("command+enter, ctrl+enter"),this.__base.apply(this,arguments)},_onClick:function(t){var e=t.target;this.hasMod("type","action")?(this._accept||(this._accept=this.findBlockInside(this.elem("actions"),{block:"button",modName:"action",modVal:"accept"})),this._decline||(this._decline=this.findBlockInside(this.elem("actions"),{block:"button",modName:"action",modVal:"decline"})),e===this._accept.domElem[0]&&(this.hasMod("need","comment")?this._showComment("accept"):this._onAccept()),e===this._decline.domElem[0]&&(this.hasMod("need","comment")?this._showComment("decline"):this._onDecline())):(this._mark=this.elem("mark"),e===this._mark[0]&&this._onMark())},_thisOnMetaReturn:function(){this.hasMod("comment")&&!this._submitCommentButton.hasMod("disabled","yes")&&(this.hasMod("comment","accept")?this._onAccept():this._onDecline())},_showComment:function(t){this["_"+t].setMod("disabled","yes").delMod("focused"),this.setMod("comment",t).setMod("show","comment"),this._submitCommentButton=this.findBlockInside(this.elem("comment"),"button"),this._submitCommentButton.on("click",this._onCommentSubmit,this),this._textarea=this.findBlockInside(this.elem("comment"),"input"),this._textarea.setMod("focused","yes").on("change",this._onCommentInputChange,this)},_onCommentInputChange:function(){this._textarea.val()?this._submitCommentButton.delMod("disabled"):this._submitCommentButton.setMod("disabled","yes")},_onMark:function(t){var e=this._ajaxObj={type:"PUT",timeout:BEM.blocks["m-orange"].DEFAULT_REQUEST_TIMEOUT,contentType:"application/json",dataType:"json",xhrFields:{withCredentials:!0}};BEM.DOM.destruct(this.elem("error")),this.hasMod("type","notification")?e.url=BEM.blocks["m-orange"].getApiNotificationsString()+"/response/acknowledgeOne?id="+this.params.id:(e.url=BEM.blocks["m-orange"].getApiNotificationsString()+"/response/answerOne?id="+this.params.id,e.data={accepted:t},this.hasMod("need","comment")&&(e.data.comment=$.escapifyHTML(this._textarea.val())),e.data=JSON.stringify(e.data)),this._runMark()},_runMark:function(t){var e=this;BEM.blocks["mi-orange-token"].getToken(t).then(function(t){e._ajaxObj.beforeSend=function(e){e.setRequestHeader("X-CSRFToken",t)},$.ajax(e._ajaxObj).then(e._onMarkSent.bind(e),e._onMarkSentError.bind(e))})},_onMarkSent:function(){this.domElem.height(this.domElem.height()),this.bindTo(this.domElem,"animationend webkitAnimationEnd oAnimationEnd",this._onDeleteAnimationEnd),this.setMod("state","hiding-1")},_onMarkSentError:function(t){t=t.responseText?JSON.parse(t.responseText):t,403==t.statusCode&&"token error"===t.errorMessages[0]?this._runMark(!0):409==t.statusCode&&"Already answered"===t.errorMessages[0]?this._appendError(BEM.I18N("m-orange-item","already_answered"),"warning"):this._appendError(BEM.I18N("m-orange-item","error"))},_appendError:function(t,e){e=e||"error",BEM.DOM.append(this.domElem,BEMHTML.apply({block:this.__self.getName(),elem:"error",elemMods:{type:e},content:t})),this.dropElemCache()},_onDeleteAnimationEnd:function(){this.setMod("state","hiding-2"),this.unbindFrom(this.domElem,"animationend webkitAnimationEnd oAnimationEnd"),this.trigger("mark"),BEM.DOM.destruct(this.domElem)},_onDecline:function(){this._onMark(!1)},_onAccept:function(){this._onMark(!0)},_onCommentSubmit:function(){this.hasMod("comment","accept")?this._onAccept():this._onDecline()}},{live:function(){this.liveBindTo("click",function(t){this.hasMod("old","yes")||this._onClick(t)})}}),BEM.blocks["mi-orange-token"]={token:void 0,getToken:function(t){var e,i=this;return t||void 0===this.token||"rejected"===this.token.state()?(e=$.Deferred(),$.ajax({url:BEM.blocks["m-orange"].API_HOST+"/system/sk",timeout:5e3,xhrFields:{withCredentials:!0}}).then(function(t){return i.token=e.resolve(t.sk),i.token},function(t){return i.token=e.reject(t),i.token}),e):this.token}},BEM.DOM.decl({block:"m-head",modName:"type",modVal:"wiki"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._newPageButton=this.findBlockInside({block:"button",modName:"type",modVal:"new-page"}),this._bPage=this.findBlockOutside("b-page"),this._bHead=this._bPage.findBlockInside("b-head"),this._newPageButton.on("click",this._onClick,this)}},_onClick:function(){var t=this._bHead.params.error?"_404":"cluster";this._widget||this._createWidget(),this._widget.open(t)},_createWidget:function(){BEM.DOM.append(this._bPage.domElem,BEMHTML.apply({block:"b-widget",mods:{type:"new-page"}})),this._widget=this._bPage.findBlockInside({block:"b-widget",modName:"type",modVal:"new-page"})}}),BEM.DOM.decl("b-comments-link",{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),this.bActions=this.findBlockOutside("b-page-actions"),this.bComments=this.bActions.findBlockInside("b-comments"),this.bSpinner=this.findBlockInside("b-spin"),this.bindTo("click",this._triggerClick),this.on("click",{changeHash:!0},this._createCommentsList)}},_triggerClick:function(t){t.preventDefault(),this.trigger("click"),this.bPage._pushState(".comments")},_getCommentsData:function(){this.params.count&&!this.ajaxData&&BEM.create("api-request",{_:"api-response",apiPath:".comments",urlParams:["format=json"],path:WikiHistory._getCorrectPath()}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this))},_hideShowList:function(){this.bActions.hasMod("show","comments")?(window.location.hash="",this.bActions.delMod("show")):(this.changeHash&&(window.location.hash="#comments"),this.bActions.delMod("show"),this.bActions.setMod("show","comments"))},_createCommentsList:function(t){this.changeHash=t.data.changeHash||!1,this.bSpinner&&(this.bSpinner.setMod("progress","yes"),this.bSpinner.domElem.show()),this._getCommentsData(),this._hideShowList()},_increaseCommentsCount:function(){var t=this.findElem("number");t.length?t.html(parseInt(t.html())+1):this.domElem.html(BEMHTML.apply([BEM.I18N("b-comments-link","comments_amount")+"(",{block:"b-comments-link",elem:"number",content:1},")"]))},_decreaseCommentsCount:function(){var t=this.findElem("number").html(),e=parseInt(t)-1;0!==e?this.findElem("number").html(e):this.domElem.html(BEM.I18N("b-comments-link","no_comments"))},_commentStatus:!1,_isAnyComments:function(t){var e=this;return t.comments.forEach(function(i){i.status?e._commentStatus=!0:t.comments.length&&e._isAnyComments(i)}),this._commentStatus},_createCommentsBEMJSON:function(t){var e=[],i=this,n=[],s=null;return t.forEach(function(t){i._commentStatus=!1,t.status?(n=[{block:"m-userpic",size:25,mix:[{block:"mi-staff-card",js:{user:t.user.login}}],login:t.user.login,url:"//staff.yandex-team.ru/"+t.user.login},{block:"b-user",content:t.user.first_name+" "+t.user.last_name+", "},{elem:"last-changes",content:{block:"m-date",attrs:{id:"comments-"+t.id},mods:{type:"anchor"},timestamp:t.created_at,url:"comments-"+t.id,"short":!0}},function(){return t.user.login===i.params.user.login?{block:"b-comment-delete",js:{commentId:t.id,user:t.user.login}}:void 0}(),{elem:"text",content:t.body},{block:"b-comment-answer",js:{id:t.id},id:t.id,user:i.params.user.login}],s=[{block:"b-comment",content:n}],t.comments&&t.comments.length&&s.push({block:"b-comments",elem:"list",content:i._createCommentsBEMJSON(t.comments)}),e.push({block:"b-comments",elem:"comment",content:s})):i._isAnyComments(t)&&e.push({block:"b-comments",elem:"comment",content:[{block:"b-comment",content:BEM.I18N("b-comments-link","comment_removed")},{block:"b-comments",elem:"list",content:i._createCommentsBEMJSON(t.comments)}]})}),e},_createCommentsHTML:function(){var t=this;return BEMHTML.apply(t._createCommentsBEMJSON(this.ajaxData.data.comments))},_onGotData:function(t){var e;this.ajaxData=t,e=this._createCommentsHTML(),this.bSpinner=BEM.DOM.destruct(this.bSpinner.domElem),BEM.DOM.append(this.bComments.elem("list"),e),this.channel("comments").trigger("loaded")},_onFailedData:function(t){console.log(t.stack),console.log(t.message)},onURL:function(){this._createCommentsList({data:{changeHash:!1}})}},{}),BEM.DOM.decl("b-files",{onSetMod:{js:function(){this.bActions=this.findBlockOutside("b-page-actions"),this.bAttachment=this.bActions.findBlockInside("b-files-data"),this._showFilesOnLoad(),this.bindTo("click",function(t){t.preventDefault(),this.params.count&&this._hideShowList()})}},_showList:function(){this.bActions.setMod("show","files")},_hideList:function(){this.bActions.delMod("show")},_showFilesOnLoad:function(){var t=window.location.hash;t&&"#files"===t&&this._showList()},_hideShowList:function(){this.bActions.hasMod("show","files")?(window.location.hash="",this._hideList()):(window.location.hash="#files",this.bActions.hasMod("show")&&this.bActions.delMod("show"),this._showList())}},{}),BEM.DOM.decl("b-comment-answer",{onSetMod:{js:function(){this.bPage=this.findBlockOutside("b-page"),this.bindTo(this.elem("button"),"click",this._showHideAnswerBody)}},_showHideAnswerBody:function(){this.__self._currentAnswer&&this.__self._currentAnswer!==this&&(this.__self._currentAnswer.delMod("open"),$(this.__self._currentAnswer._formButton.elem("simple")).html(this._getButtonValue(this.__self._currentAnswer))),this._toggleList()},_toggleList:function(){var t=null;this._formButton||(this._formButton=this.findBlockInside("head","b-form-button")),this.toggleMod("open","yes"),this.hasMod("open","yes")?(this.__self._appendAnswerCommentsBody(this),t=$(this.__self._answerTextarea.elem("input")),this._formButton.elem("simple").html(BEM.I18N("b-comment-answer","close")),t.focus(),t.val("")):this._formButton.elem("simple").html(this._getButtonValue(this))},_getButtonValue:function(t){return 0===t.params.id?BEM.I18N("b-comment-answer","comment_text"):BEM.I18N("b-comment-answer","comment_reply")},_onGetData:function(t){var e=this.__self._currentAnswer.findBlockOutside("b-comment"),i=null,n=null;i=e?e.domElem.next():this.__self._currentAnswer.domElem.next(),i.length?BEM.DOM.append(i,this._newCommentHTML(t)):(n=BEMHTML.apply({block:"b-comments",elem:"list",content:this._newCommentHTML(t)}),BEM.DOM.after(e.domElem,n)),this.__self.bCommentLink||(this.__self.bCommentLink=this.findBlockOutside("b-page-actions").findBlockInside("b-comments-link")),this.__self.bCommentLink._increaseCommentsCount(),this.findBlockOutside("b-comments").findBlockInside({block:"b-comment-answer",modName:"open",modVal:"yes"}).delMod("open"),this._formButton.elem("simple").html(this._getButtonValue(this))},_onDataError:function(t){console.log(t)},_newCommentHTML:function(t){return BEMHTML.apply({block:"b-comments",elem:"comment",content:{block:"b-comment",content:[{block:"m-userpic",size:25,mix:[{block:"mi-staff-card",js:{user:t.user.login}}],login:t.user.login,url:"//staff.yandex-team.ru/"+t.user.login},{block:"b-user",content:t.user.first_name+" "+t.user.last_name+", "},{elem:"last-changes",content:{block:"m-date",attrs:{id:"comments-"+t.data.id},mods:{type:"anchor"},timestamp:t.data.created_at,url:"comments-"+t.data.id,"short":!0}},{block:"b-comment-delete",js:{commentId:t.data.id,user:t.data.user.login}},{elem:"text",content:t.data.body},{block:"b-comment-answer",js:{id:t.data.id},id:t.data.id,user:t.data.user.login,own:!0}]}})},_answerButtonHandler:function(){var t={body:this.__self._answerTextarea.val()};0!==this.__self._currentAnswer.params.id&&(t.parent_id=this.__self._currentAnswer.params.id),BEM.create("api-request",{_:"api-response",apiPath:".comments",method:"POST",data:t,urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(this._onGetData.bind(this),this._onDataError.bind(this))}},{_commentSendHandler:function(){var t=this;this.__self._answerSendButton.on("click",function(){t._answerButtonHandler(this)})},_appendAnswerCommentsBody:function(t){this._currentAnswer=t,this._answerBodyElement?BEM.DOM.append(t.domElem,this._answerBodyElement):(BEM.DOM.append(t.domElem,this._getAnswerCommentsHTML()),this._answerBodyElement=t.elem("body"),this._answerSendButton=t.findBlockInside("body","b-form-button"),this._answerTextarea=t.findBlockInside("body","b-form-input"),this._commentSendHandler.bind(t)())},_getAnswerCommentsHTML:function(){return this._answerHTML?this._answerHTML:this._answerHTML=BEMHTML.apply({block:this.getName(),elem:"body",content:[{block:"b-form-input",mods:{type:"textarea",theme:"grey",size:"m"},content:{elem:"input"}},{block:"b-form-button",mods:{theme:"grey-l",size:"l"},type:"button",content:BEM.I18N("b-comment-answer","comment_send")}]})}}),BEM.DOM.decl("b-comment-delete",{_onClick:function(){this._commentRemoveRequest()},_commentRemoveRequest:function(){BEM.create("api-request",{_:"api-response",apiPath:".comments/"+this.params.commentId,method:"PUT",data:{status:!1},urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(this._onGetData.bind(this),this._onError.bind(this))},_onGetData:function(){var t,e=this,i=this.findBlockOutside("b-comment");this.hasRestoreBlock||(t=BEMHTML.apply({block:"b-comments",elem:"restore",content:[BEM.I18N("b-comment-delete","comment_removed"),{block:"b-comment-restore",js:{commentId:e.params.commentId}}]}),this.hasRestoreBlock=!0),i.setMod("hide","yes"),BEM.DOM.append(i.domElem,t),this.__self._commentsLink._decreaseCommentsCount()},_onError:function(t){console.log(t)}},{live:function(){var t=this;this.liveBindTo("click",function(){t._commentsNumber||(t._commentsLink=this.findBlockOutside("b-page-actions").findBlockInside("b-comments-link"),t._commentsNumber=t._commentsLink.elem("number"),t._bPage=this.findBlockOutside("b-page")),this._onClick()})},_commentsLink:null,_commentsNumber:null,_bPage:null}),BEM.DOM.decl("b-comment-restore",{_onClick:function(){this._restoreRequest()},_restoreRequest:function(){BEM.create("api-request",{_:"api-response",apiPath:".comments/"+this.params.commentId,method:"PUT",data:{status:!0},urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(this._onGetData.bind(this),this._onError.bind(this))},_onGetData:function(){this._showRemovedComment()},_onError:function(t){console.log(t)},_showRemovedComment:function(){this.domElem.parent();this.__self.bCommentLink||(this.__self.bCommentLink=this.findBlockOutside("b-page-actions").findBlockInside("b-comments-link")),this.__self.bCommentLink._increaseCommentsCount(),this.findBlockOutside("b-comment").delMod("hide")}},{live:function(){var t=this;this.liveBindTo("click",function(){t._commentsNumber||(t._commentsLink=this.findBlockOutside("b-page-actions").findBlockInside("b-comments-link"),t._commentsNumber=t._commentsLink.elem("number"),t._bPage=this.findBlockOutside("b-page")),this._onClick()})},_commentsLink:null,_commentsNumber:null,_bPage:null}),BEM.HTML.decl({name:"b-form-button",modName:"type",modVal:"simple"},{onBlock:function(t){t.tag(t.param("url")?"a":"span").attrs({href:t.param("url"),target:t.param("target")}).mods({size:t.mod("size")||"s",theme:t.mod("theme")||t.mod("type")+"-grey"}).content({tag:"span",elem:"simple",content:t.content()},!0).afterContent(t.param("type")?{elem:"input",attrs:{value:t.param("value")||"",type:t.param("type"),name:t.param("name"),disabled:t.mod("disabled")&&"disabled"}}:{elem:"click"}).js(!0).stop()}}),function(t,e){function i(e,i){var s=e.nodeName.toLowerCase();if("area"===s){var o,r=e.parentNode,a=r.name;return e.href&&a&&"map"===r.nodeName.toLowerCase()?(o=t("img[usemap=#"+a+"]")[0],!!o&&n(o)):!1}return(/input|select|textarea|button|object/.test(s)?!e.disabled:"a"==s?e.href||i:i)&&n(e)}function n(e){return!t(e).parents().andSelf().filter(function(){return"hidden"===t.curCSS(this,"visibility")||t.expr.filters.hidden(this)}).length}t.ui=t.ui||{},t.ui.version||(t.extend(t.ui,{version:"@VERSION",keyCode:{ALT:18,BACKSPACE:8,CAPS_LOCK:20,COMMA:188,COMMAND:91,COMMAND_LEFT:91,COMMAND_RIGHT:93,CONTROL:17,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,INSERT:45,LEFT:37,MENU:93,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SHIFT:16,SPACE:32,TAB:9,UP:38,WINDOWS:91}}),t.fn.extend({propAttr:t.fn.prop||t.fn.attr,_focus:t.fn.focus,focus:function(e,i){return"number"==typeof e?this.each(function(){var n=this;setTimeout(function(){t(n).focus(),i&&i.call(n)},e)}):this._focus.apply(this,arguments)},scrollParent:function(){var e;return e=t.browser.msie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(t.curCSS(this,"position",1))&&/(auto|scroll)/.test(t.curCSS(this,"overflow",1)+t.curCSS(this,"overflow-y",1)+t.curCSS(this,"overflow-x",1))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(t.curCSS(this,"overflow",1)+t.curCSS(this,"overflow-y",1)+t.curCSS(this,"overflow-x",1))}).eq(0),/fixed/.test(this.css("position"))||!e.length?t(document):e},zIndex:function(i){if(i!==e)return this.css("zIndex",i);if(this.length)for(var n,s,o=t(this[0]);o.length&&o[0]!==document;){if(n=o.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(s=parseInt(o.css("zIndex"),10),!isNaN(s)&&0!==s))return s;o=o.parent()}return 0},disableSelection:function(){return this.bind((t.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(t){t.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),t.each(["Width","Height"],function(i,n){function s(e,i,n,s){return t.each(o,function(){i-=parseFloat(t.curCSS(e,"padding"+this,!0))||0,n&&(i-=parseFloat(t.curCSS(e,"border"+this+"Width",!0))||0),s&&(i-=parseFloat(t.curCSS(e,"margin"+this,!0))||0)}),i}var o="Width"===n?["Left","Right"]:["Top","Bottom"],r=n.toLowerCase(),a={innerWidth:t.fn.innerWidth,innerHeight:t.fn.innerHeight,outerWidth:t.fn.outerWidth,outerHeight:t.fn.outerHeight};t.fn["inner"+n]=function(i){return i===e?a["inner"+n].call(this):this.each(function(){t(this).css(r,s(this,i)+"px")})},t.fn["outer"+n]=function(e,i){return"number"!=typeof e?a["outer"+n].call(this,e):this.each(function(){t(this).css(r,s(this,e,!0,i)+"px")})}}),t.extend(t.expr[":"],{data:function(e,i,n){return!!t.data(e,n[3])},focusable:function(e){return i(e,!isNaN(t.attr(e,"tabindex")))},tabbable:function(e){var n=t.attr(e,"tabindex"),s=isNaN(n);return(s||n>=0)&&i(e,!s)}}),t(function(){var e=document.body,i=e.appendChild(i=document.createElement("div"));t.extend(i.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),t.support.minHeight=100===i.offsetHeight,t.support.selectstart="onselectstart"in i,e.removeChild(i).style.display="none"}),t.extend(t.ui,{plugin:{add:function(e,i,n){var s=t.ui[e].prototype;for(var o in n)s.plugins[o]=s.plugins[o]||[],s.plugins[o].push([i,n[o]])},call:function(t,e,i){var n=t.plugins[e];if(n&&t.element[0].parentNode)for(var s=0;s<n.length;s++)t.options[n[s][0]]&&n[s][1].apply(t.element,i)}},contains:function(t,e){return document.compareDocumentPosition?16&t.compareDocumentPosition(e):t!==e&&t.contains(e)},hasScroll:function(e,i){if("hidden"===t(e).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",s=!1;return e[n]>0?!0:(e[n]=1,s=e[n]>0,e[n]=0,s)},isOverAxis:function(t,e,i){return t>e&&e+i>t},isOver:function(e,i,n,s,o,r){return t.ui.isOverAxis(e,n,o)&&t.ui.isOverAxis(i,s,r)}}))}(jQuery),function(t,e){if(t.cleanData){var i=t.cleanData;t.cleanData=function(e){for(var n,s=0;null!=(n=e[s]);s++)try{t(n).triggerHandler("remove")}catch(o){}i(e)}}else{var n=t.fn.remove;t.fn.remove=function(e,i){return this.each(function(){return i||(!e||t.filter(e,[this]).length)&&t("*",this).add([this]).each(function(){try{t(this).triggerHandler("remove")}catch(e){}}),n.call(t(this),e,i)})}}t.widget=function(e,i,n){var s,o=e.split(".")[0];e=e.split(".")[1],s=o+"-"+e,n||(n=i,i=t.Widget),t.expr[":"][s]=function(i){return!!t.data(i,e)},t[o]=t[o]||{},t[o][e]=function(t,e){arguments.length&&this._createWidget(t,e)};var r=new i;r.options=t.extend(!0,{},r.options),t[o][e].prototype=t.extend(!0,r,{namespace:o,widgetName:e,widgetEventPrefix:t[o][e].prototype.widgetEventPrefix||e,widgetBaseClass:s},n),t.widget.bridge(e,t[o][e])},t.widget.bridge=function(i,n){t.fn[i]=function(s){var o="string"==typeof s,r=Array.prototype.slice.call(arguments,1),a=this;return s=!o&&r.length?t.extend.apply(null,[!0,s].concat(r)):s,o&&"_"===s.charAt(0)?a:(o?this.each(function(){var n=t.data(this,i),o=n&&t.isFunction(n[s])?n[s].apply(n,r):n;return o!==n&&o!==e?(a=o,!1):void 0}):this.each(function(){var e=t.data(this,i);e?e.option(s||{})._init():t.data(this,i,new n(s,this))}),a)}},t.Widget=function(t,e){arguments.length&&this._createWidget(t,e)},t.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",options:{disabled:!1},_createWidget:function(e,i){t.data(i,this.widgetName,this),this.element=t(i),this.options=t.extend(!0,{},this.options,this._getCreateOptions(),e);var n=this;this.element.bind("remove."+this.widgetName,function(){n.destroy()}),this._create(),this._trigger("create"),this._init()},_getCreateOptions:function(){return t.metadata&&t.metadata.get(this.element[0])[this.widgetName]},_create:function(){},_init:function(){},destroy:function(){this.element.unbind("."+this.widgetName).removeData(this.widgetName),this.widget().unbind("."+this.widgetName).removeAttr("aria-disabled").removeClass(this.widgetBaseClass+"-disabled ui-state-disabled")},widget:function(){return this.element},option:function(i,n){var s=i;if(0===arguments.length)return t.extend({},this.options);if("string"==typeof i){if(n===e)return this.options[i];s={},s[i]=n}return this._setOptions(s),this},_setOptions:function(e){var i=this;return t.each(e,function(t,e){i._setOption(t,e)}),this},_setOption:function(t,e){return this.options[t]=e,"disabled"===t&&this.widget()[e?"addClass":"removeClass"](this.widgetBaseClass+"-disabled ui-state-disabled").attr("aria-disabled",e),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_trigger:function(e,i,n){var s,o,r=this.options[e];if(n=n||{},i=t.Event(i),i.type=(e===this.widgetEventPrefix?e:this.widgetEventPrefix+e).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(s in o)s in i||(i[s]=o[s]);return this.element.trigger(i,n),!(t.isFunction(r)&&r.call(this.element[0],i,n)===!1||i.isDefaultPrevented())}}}(jQuery),function(t){var e=!1;t(document).mouseup(function(){e=!1}),t.widget("ui.mouse",{options:{cancel:":input,option",distance:1,delay:0},_mouseInit:function(){var e=this;this.element.bind("mousedown."+this.widgetName,function(t){return e._mouseDown(t)}).bind("click."+this.widgetName,function(i){return!0===t.data(i.target,e.widgetName+".preventClickEvent")?(t.removeData(i.target,e.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName)},_mouseDown:function(i){if(!e){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,s=1==i.which,o="string"==typeof this.options.cancel&&i.target.nodeName?t(i.target).closest(this.options.cancel).length:!1;return s&&!o&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===t.data(i.target,this.widgetName+".preventClickEvent")&&t.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(t){return n._mouseMove(t)},this._mouseUpDelegate=function(t){return n._mouseUp(t)},t(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),e=!0,!0)):!0}},_mouseMove:function(e){return!t.browser.msie||document.documentMode>=9||e.button?this._mouseStarted?(this._mouseDrag(e),e.preventDefault()):(this._mouseDistanceMet(e)&&this._mouseDelayMet(e)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,e)!==!1,this._mouseStarted?this._mouseDrag(e):this._mouseUp(e)),!this._mouseStarted):this._mouseUp(e)},_mouseUp:function(e){return t(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,e.target==this._mouseDownEvent.target&&t.data(e.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(e)),!1},_mouseDistanceMet:function(t){return Math.max(Math.abs(this._mouseDownEvent.pageX-t.pageX),Math.abs(this._mouseDownEvent.pageY-t.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(t){t.widget("ui.draggable",t.ui.mouse,{widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"!=this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},destroy:function(){return this.element.data("draggable")?(this.element.removeData("draggable").unbind(".draggable").removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy(),this):void 0},_mouseCapture:function(e){var i=this.options;return this.helper||i.disabled||t(e.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(e),this.handle?(i.iframeFix&&t(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){t('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(t(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(e){var i=this.options;return this.helper=this._createHelper(e),this._cacheHelperProportions(),t.ui.ddmanager&&(t.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),i.containment&&this._setContainment(),this._trigger("start",e)===!1?(this._clear(),!1):(this._cacheHelperProportions(),t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.helper.addClass("ui-draggable-dragging"),this._mouseDrag(e,!0),t.ui.ddmanager&&t.ui.ddmanager.dragStart(this,e),!0)},_mouseDrag:function(e,i){if(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(this._trigger("drag",e,n)===!1)return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),!1},_mouseStop:function(e){var i=!1;if(t.ui.ddmanager&&!this.options.dropBehaviour&&(i=t.ui.ddmanager.drop(this,e)),this.dropped&&(i=this.dropped,this.dropped=!1),!(this.element[0]&&this.element[0].parentNode||"original"!=this.options.helper))return!1;if("invalid"==this.options.revert&&!i||"valid"==this.options.revert&&i||this.options.revert===!0||t.isFunction(this.options.revert)&&this.options.revert.call(this.element,i)){var n=this;t(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){n._trigger("stop",e)!==!1&&n._clear()})}else this._trigger("stop",e)!==!1&&this._clear();return!1},_mouseUp:function(e){return this.options.iframeFix===!0&&t("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),t.ui.ddmanager&&t.ui.ddmanager.dragStop(this,e),t.ui.mouse.prototype._mouseUp.call(this,e)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(e){var i=this.options.handle&&t(this.options.handle,this.element).length?!1:!0;return t(this.options.handle,this.element).find("*").andSelf().each(function(){this==e.target&&(i=!0)}),i},_createHelper:function(e){var i=this.options,n=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e])):"clone"==i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"==i.appendTo?this.element[0].parentNode:i.appendTo),n[0]==this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&t.browser.msie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var t=this.element.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e=this.options;if("parent"==e.containment&&(e.containment=this.helper[0].parentNode),("document"==e.containment||"window"==e.containment)&&(this.containment=["document"==e.containment?0:t(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"==e.containment?0:t(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"==e.containment?0:t(window).scrollLeft())+t("document"==e.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==e.containment?0:t(window).scrollTop())+(t("document"==e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(e.containment)||e.containment.constructor==Array)e.containment.constructor==Array&&(this.containment=e.containment);
else{var i=t(e.containment),n=i[0];if(!n)return;var s=(i.offset(),"hidden"!=t(n).css("overflow"));this.containment=[(parseInt(t(n).css("borderLeftWidth"),10)||0)+(parseInt(t(n).css("paddingLeft"),10)||0),(parseInt(t(n).css("borderTopWidth"),10)||0)+(parseInt(t(n).css("paddingTop"),10)||0),(s?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(t(n).css("borderLeftWidth"),10)||0)-(parseInt(t(n).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(s?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(t(n).css("borderTopWidth"),10)||0)-(parseInt(t(n).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i}},_convertPositionTo:function(e,i){i||(i=this.position);var n="absolute"==e?1:-1,s=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),o=/(html|body)/i.test(s[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-(t.browser.safari&&t.browser.version<526&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():o?0:s.scrollTop())*n),left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-(t.browser.safari&&t.browser.version<526&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*n)}},_generatePosition:function(e){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(n[0].tagName),o=e.pageX,r=e.pageY;if(this.originalPosition){var a;if(this.containment){if(this.relative_container){var l=this.relative_container.offset();a=[this.containment[0]+l.left,this.containment[1]+l.top,this.containment[2]+l.left,this.containment[3]+l.top]}else a=this.containment;e.pageX-this.offset.click.left<a[0]&&(o=a[0]+this.offset.click.left),e.pageY-this.offset.click.top<a[1]&&(r=a[1]+this.offset.click.top),e.pageX-this.offset.click.left>a[2]&&(o=a[2]+this.offset.click.left),e.pageY-this.offset.click.top>a[3]&&(r=a[3]+this.offset.click.top)}if(i.grid){var c=i.grid[1]?this.originalPageY+Math.round((r-this.originalPageY)/i.grid[1])*i.grid[1]:this.originalPageY;r=a?c-this.offset.click.top<a[1]||c-this.offset.click.top>a[3]?c-this.offset.click.top<a[1]?c+i.grid[1]:c-i.grid[1]:c:c;var d=i.grid[0]?this.originalPageX+Math.round((o-this.originalPageX)/i.grid[0])*i.grid[0]:this.originalPageX;o=a?d-this.offset.click.left<a[0]||d-this.offset.click.left>a[2]?d-this.offset.click.left<a[0]?d+i.grid[0]:d-i.grid[0]:d:d}}return{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(t.browser.safari&&t.browser.version<526&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():s?0:n.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(t.browser.safari&&t.browser.version<526&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():s?0:n.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]==this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(e,i,n){return n=n||this._uiHash(),t.ui.plugin.call(this,e,[i,n]),"drag"==e&&(this.positionAbs=this._convertPositionTo("absolute")),t.Widget.prototype._trigger.call(this,e,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),t.extend(t.ui.draggable,{version:"@VERSION"}),t.ui.plugin.add("draggable","connectToSortable",{start:function(e,i){var n=t(this).data("draggable"),s=n.options,o=t.extend({},i,{item:n.element});n.sortables=[],t(s.connectToSortable).each(function(){var i=t.data(this,"sortable");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",e,o))})},stop:function(e,i){var n=t(this).data("draggable"),s=t.extend({},i,{item:n.element});t.each(n.sortables,function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(e),this.instance.options.helper=this.instance.options._helper,"original"==n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",e,s))})},drag:function(e,i){var n=t(this).data("draggable"),s=this;t.each(n.sortables,function(){this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=t(s).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},e.target=this.instance.currentItem[0],this.instance._mouseCapture(e,!0),this.instance._mouseStart(e,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",e),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(e)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",e,this.instance._uiHash(this.instance)),this.instance._mouseStop(e,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",e),n.dropped=!1)})}}),t.ui.plugin.add("draggable","cursor",{start:function(){var e=t("body"),i=t(this).data("draggable").options;e.css("cursor")&&(i._cursor=e.css("cursor")),e.css("cursor",i.cursor)},stop:function(){var e=t(this).data("draggable").options;e._cursor&&t("body").css("cursor",e._cursor)}}),t.ui.plugin.add("draggable","opacity",{start:function(e,i){var n=t(i.helper),s=t(this).data("draggable").options;n.css("opacity")&&(s._opacity=n.css("opacity")),n.css("opacity",s.opacity)},stop:function(e,i){var n=t(this).data("draggable").options;n._opacity&&t(i.helper).css("opacity",n._opacity)}}),t.ui.plugin.add("draggable","scroll",{start:function(){var e=t(this).data("draggable");e.scrollParent[0]!=document&&"HTML"!=e.scrollParent[0].tagName&&(e.overflowOffset=e.scrollParent.offset())},drag:function(e){var i=t(this).data("draggable"),n=i.options,s=!1;i.scrollParent[0]!=document&&"HTML"!=i.scrollParent[0].tagName?(n.axis&&"x"==n.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-e.pageY<n.scrollSensitivity?i.scrollParent[0].scrollTop=s=i.scrollParent[0].scrollTop+n.scrollSpeed:e.pageY-i.overflowOffset.top<n.scrollSensitivity&&(i.scrollParent[0].scrollTop=s=i.scrollParent[0].scrollTop-n.scrollSpeed)),n.axis&&"y"==n.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-e.pageX<n.scrollSensitivity?i.scrollParent[0].scrollLeft=s=i.scrollParent[0].scrollLeft+n.scrollSpeed:e.pageX-i.overflowOffset.left<n.scrollSensitivity&&(i.scrollParent[0].scrollLeft=s=i.scrollParent[0].scrollLeft-n.scrollSpeed))):(n.axis&&"x"==n.axis||(e.pageY-t(document).scrollTop()<n.scrollSensitivity?s=t(document).scrollTop(t(document).scrollTop()-n.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<n.scrollSensitivity&&(s=t(document).scrollTop(t(document).scrollTop()+n.scrollSpeed))),n.axis&&"y"==n.axis||(e.pageX-t(document).scrollLeft()<n.scrollSensitivity?s=t(document).scrollLeft(t(document).scrollLeft()-n.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<n.scrollSensitivity&&(s=t(document).scrollLeft(t(document).scrollLeft()+n.scrollSpeed)))),s!==!1&&t.ui.ddmanager&&!n.dropBehaviour&&t.ui.ddmanager.prepareOffsets(i,e)}}),t.ui.plugin.add("draggable","snap",{start:function(){var e=t(this).data("draggable"),i=e.options;e.snapElements=[],t(i.snap.constructor!=String?i.snap.items||":data(draggable)":i.snap).each(function(){var i=t(this),n=i.offset();this!=e.element[0]&&e.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:n.top,left:n.left})})},drag:function(e,i){for(var n=t(this).data("draggable"),s=n.options,o=s.snapTolerance,r=i.offset.left,a=r+n.helperProportions.width,l=i.offset.top,c=l+n.helperProportions.height,d=n.snapElements.length-1;d>=0;d--){var u=n.snapElements[d].left,h=u+n.snapElements[d].width,p=n.snapElements[d].top,m=p+n.snapElements[d].height;if(r>u-o&&h+o>r&&l>p-o&&m+o>l||r>u-o&&h+o>r&&c>p-o&&m+o>c||a>u-o&&h+o>a&&l>p-o&&m+o>l||a>u-o&&h+o>a&&c>p-o&&m+o>c){if("inner"!=s.snapMode){var f=Math.abs(p-c)<=o,_=Math.abs(m-l)<=o,g=Math.abs(u-a)<=o,b=Math.abs(h-r)<=o;f&&(i.position.top=n._convertPositionTo("relative",{top:p-n.helperProportions.height,left:0}).top-n.margins.top),_&&(i.position.top=n._convertPositionTo("relative",{top:m,left:0}).top-n.margins.top),g&&(i.position.left=n._convertPositionTo("relative",{top:0,left:u-n.helperProportions.width}).left-n.margins.left),b&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h}).left-n.margins.left)}var k=f||_||g||b;if("outer"!=s.snapMode){var f=Math.abs(p-l)<=o,_=Math.abs(m-c)<=o,g=Math.abs(u-r)<=o,b=Math.abs(h-a)<=o;f&&(i.position.top=n._convertPositionTo("relative",{top:p,left:0}).top-n.margins.top),_&&(i.position.top=n._convertPositionTo("relative",{top:m-n.helperProportions.height,left:0}).top-n.margins.top),g&&(i.position.left=n._convertPositionTo("relative",{top:0,left:u}).left-n.margins.left),b&&(i.position.left=n._convertPositionTo("relative",{top:0,left:h-n.helperProportions.width}).left-n.margins.left)}!n.snapElements[d].snapping&&(f||_||g||b||k)&&n.options.snap.snap&&n.options.snap.snap.call(n.element,e,t.extend(n._uiHash(),{snapItem:n.snapElements[d].item})),n.snapElements[d].snapping=f||_||g||b||k}else n.snapElements[d].snapping&&n.options.snap.release&&n.options.snap.release.call(n.element,e,t.extend(n._uiHash(),{snapItem:n.snapElements[d].item})),n.snapElements[d].snapping=!1}}}),t.ui.plugin.add("draggable","stack",{start:function(){var e=t(this).data("draggable").options,i=t.makeArray(t(e.stack)).sort(function(e,i){return(parseInt(t(e).css("zIndex"),10)||0)-(parseInt(t(i).css("zIndex"),10)||0)});if(i.length){var n=parseInt(i[0].style.zIndex)||0;t(i).each(function(t){this.style.zIndex=n+t}),this[0].style.zIndex=n+i.length}}}),t.ui.plugin.add("draggable","zIndex",{start:function(e,i){var n=t(i.helper),s=t(this).data("draggable").options;n.css("zIndex")&&(s._zIndex=n.css("zIndex")),n.css("zIndex",s.zIndex)},stop:function(e,i){var n=t(this).data("draggable").options;n._zIndex&&t(i.helper).css("zIndex",n._zIndex)}})}(jQuery),function(t){t.widget("ui.sortable",t.ui.mouse,{widgetEventPrefix:"sort",options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var t=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===t.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit()},destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var t=this.items.length-1;t>=0;t--)this.items[t].item.removeData(this.widgetName+"-item");return this},_setOption:function(e,i){"disabled"===e?(this.options[e]=i,this.widget()[i?"addClass":"removeClass"]("ui-sortable-disabled")):t.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(e,i){var n=this;if(this.reverting)return!1;if(this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(e);{var s=null,o=this;t(e.target).parents().each(function(){return t.data(this,n.widgetName+"-item")==o?(s=t(this),!1):void 0})}if(t.data(e.target,n.widgetName+"-item")==o&&(s=t(e.target)),!s)return!1;if(this.options.handle&&!i){var r=!1;if(t(this.options.handle,s).find("*").andSelf().each(function(){this==e.target&&(r=!0)}),!r)return!1}return this.currentItem=s,this._removeCurrentsFromItems(),!0},_mouseStart:function(e,i,n){var s=this.options,o=this;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(e),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),t.extend(this.offset,{click:{left:e.pageX-this.offset.left,top:e.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this._generatePosition(e),this.originalPageX=e.pageX,this.originalPageY=e.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&(t("body").css("cursor")&&(this._storedCursor=t("body").css("cursor")),t("body").css("cursor",s.cursor)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",e,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(var r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",e,o._uiHash(this));return t.ui.ddmanager&&(t.ui.ddmanager.current=this),t.ui.ddmanager&&!s.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(e),!0},_mouseDrag:function(e){if(this.position=this._generatePosition(e),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var i=this.options,n=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-e.pageY<i.scrollSensitivity?this.scrollParent[0].scrollTop=n=this.scrollParent[0].scrollTop+i.scrollSpeed:e.pageY-this.overflowOffset.top<i.scrollSensitivity&&(this.scrollParent[0].scrollTop=n=this.scrollParent[0].scrollTop-i.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-e.pageX<i.scrollSensitivity?this.scrollParent[0].scrollLeft=n=this.scrollParent[0].scrollLeft+i.scrollSpeed:e.pageX-this.overflowOffset.left<i.scrollSensitivity&&(this.scrollParent[0].scrollLeft=n=this.scrollParent[0].scrollLeft-i.scrollSpeed)):(e.pageY-t(document).scrollTop()<i.scrollSensitivity?n=t(document).scrollTop(t(document).scrollTop()-i.scrollSpeed):t(window).height()-(e.pageY-t(document).scrollTop())<i.scrollSensitivity&&(n=t(document).scrollTop(t(document).scrollTop()+i.scrollSpeed)),e.pageX-t(document).scrollLeft()<i.scrollSensitivity?n=t(document).scrollLeft(t(document).scrollLeft()-i.scrollSpeed):t(window).width()-(e.pageX-t(document).scrollLeft())<i.scrollSensitivity&&(n=t(document).scrollLeft(t(document).scrollLeft()+i.scrollSpeed))),n!==!1&&t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(this,e)}this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(var s=this.items.length-1;s>=0;s--){var o=this.items[s],r=o.item[0],a=this._intersectsWithPointer(o);if(a&&r!=this.currentItem[0]&&this.placeholder[1==a?"next":"prev"]()[0]!=r&&!t.ui.contains(this.placeholder[0],r)&&("semi-dynamic"==this.options.type?!t.ui.contains(this.element[0],r):!0)){if(this.direction=1==a?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(o))break;this._rearrange(e,o),this._trigger("change",e,this._uiHash());break}}return this._contactContainers(e),t.ui.ddmanager&&t.ui.ddmanager.drag(this,e),this._trigger("sort",e,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(e,i){if(e){if(t.ui.ddmanager&&!this.options.dropBehaviour&&t.ui.ddmanager.drop(this,e),this.options.revert){var n=this,s=n.placeholder.offset();n.reverting=!0,t(this.helper).animate({left:s.left-this.offset.parent.left-n.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:s.top-this.offset.parent.top-n.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){n._clear(e)})}else this._clear(e,i);return!1}},cancel:function(){var e=this;if(this.dragging){this._mouseUp({target:null}),"original"==this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("deactivate",null,e._uiHash(this)),this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",null,e._uiHash(this)),this.containers[i].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!=this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),t.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?t(this.domPosition.prev).after(this.currentItem):t(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},t(i).each(function(){var i=(t(e.item||this).attr(e.attribute||"id")||"").match(e.expression||/(.+)[-=_](.+)/);i&&n.push((e.key||i[1]+"[]")+"="+(e.key&&e.expression?i[1]:i[2]))}),!n.length&&e.key&&n.push(e.key+"="),n.join("&")},toArray:function(e){var i=this._getItemsAsjQuery(e&&e.connected),n=[];return e=e||{},i.each(function(){n.push(t(e.item||this).attr(e.attribute||"id")||"")}),n},_intersectsWith:function(t){var e=this.positionAbs.left,i=e+this.helperProportions.width,n=this.positionAbs.top,s=n+this.helperProportions.height,o=t.left,r=o+t.width,a=t.top,l=a+t.height,c=this.offset.click.top,d=this.offset.click.left,u=n+c>a&&l>n+c&&e+d>o&&r>e+d;return"pointer"==this.options.tolerance||this.options.forcePointerForContainers||"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>t[this.floating?"width":"height"]?u:o<e+this.helperProportions.width/2&&i-this.helperProportions.width/2<r&&a<n+this.helperProportions.height/2&&s-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var i=t.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),n=t.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=i&&n,o=this._getDragVerticalDirection(),r=this._getDragHorizontalDirection();return s?this.floating?r&&"right"==r||"down"==o?2:1:o&&("down"==o?2:1):!1},_intersectsWithSides:function(e){var i=t.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),n=t.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"==o&&n||"left"==o&&!n:s&&("down"==s&&i||"up"==s&&!i)},_getDragVerticalDirection:function(){var t=this.positionAbs.top-this.lastPositionAbs.top;return 0!=t&&(t>0?"down":"up")},_getDragHorizontalDirection:function(){var t=this.positionAbs.left-this.lastPositionAbs.left;return 0!=t&&(t>0?"right":"left")},refresh:function(t){return this._refreshItems(t),this.refreshPositions(),this},_connectWith:function(){var t=this.options;return t.connectWith.constructor==String?[t.connectWith]:t.connectWith},_getItemsAsjQuery:function(e){var i=[],n=[],s=this._connectWith();if(s&&e)for(var o=s.length-1;o>=0;o--)for(var r=t(s[o]),a=r.length-1;a>=0;a--){var l=t.data(r[a],this.widgetName);l&&l!=this&&!l.options.disabled&&n.push([t.isFunction(l.options.items)?l.options.items.call(l.element):t(l.options.items,l.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),l])}n.push([t.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):t(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var o=n.length-1;o>=0;o--)n[o][0].each(function(){i.push(this)});return t(i)},_removeCurrentsFromItems:function(){for(var t=this.currentItem.find(":data("+this.widgetName+"-item)"),e=0;e<this.items.length;e++)for(var i=0;i<t.length;i++)t[i]==this.items[e].item[0]&&this.items.splice(e,1)},_refreshItems:function(e){this.items=[],this.containers=[this];var i=this.items,n=[[t.isFunction(this.options.items)?this.options.items.call(this.element[0],e,{item:this.currentItem}):t(this.options.items,this.element),this]],s=this._connectWith();if(s)for(var o=s.length-1;o>=0;o--)for(var r=t(s[o]),a=r.length-1;a>=0;a--){var l=t.data(r[a],this.widgetName);l&&l!=this&&!l.options.disabled&&(n.push([t.isFunction(l.options.items)?l.options.items.call(l.element[0],e,{item:this.currentItem}):t(l.options.items,l.element),l]),this.containers.push(l))}for(var o=n.length-1;o>=0;o--)for(var c=n[o][1],d=n[o][0],a=0,u=d.length;u>a;a++){var h=t(d[a]);h.data(this.widgetName+"-item",c),i.push({item:h,instance:c,width:0,height:0,left:0,top:0})}},refreshPositions:function(e){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var i=this.items.length-1;i>=0;i--){var n=this.items[i];if(n.instance==this.currentContainer||!this.currentContainer||n.item[0]==this.currentItem[0]){var s=this.options.toleranceElement?t(this.options.toleranceElement,n.item):n.item;e||(n.width=s.outerWidth(),n.height=s.outerHeight());var o=s.offset();n.left=o.left,n.top=o.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var i=this.containers.length-1;i>=0;i--){var o=this.containers[i].element.offset();this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}return this},_createPlaceholder:function(e){var i=e||this,n=i.options;if(!n.placeholder||n.placeholder.constructor==String){var s=n.placeholder;n.placeholder={element:function(){var e=t(document.createElement(i.currentItem[0].nodeName)).addClass(s||i.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return s||(e.style.visibility="hidden"),e},update:function(t,e){(!s||n.forcePlaceholderSize)&&(e.height()||e.height(i.currentItem.innerHeight()-parseInt(i.currentItem.css("paddingTop")||0,10)-parseInt(i.currentItem.css("paddingBottom")||0,10)),e.width()||e.width(i.currentItem.innerWidth()-parseInt(i.currentItem.css("paddingLeft")||0,10)-parseInt(i.currentItem.css("paddingRight")||0,10)))}}}i.placeholder=t(n.placeholder.element.call(i.element,i.currentItem)),i.currentItem.after(i.placeholder),n.placeholder.update(i,i.placeholder)},_contactContainers:function(e){for(var i=null,n=null,s=this.containers.length-1;s>=0;s--)if(!t.ui.contains(this.currentItem[0],this.containers[s].element[0]))if(this._intersectsWith(this.containers[s].containerCache)){if(i&&t.ui.contains(this.containers[s].element[0],i.element[0]))continue;i=this.containers[s],n=s}else this.containers[s].containerCache.over&&(this.containers[s]._trigger("out",e,this._uiHash(this)),this.containers[s].containerCache.over=0);if(i)if(1===this.containers.length)this.containers[n]._trigger("over",e,this._uiHash(this)),this.containers[n].containerCache.over=1;else if(this.currentContainer!=this.containers[n]){for(var o=1e4,r=null,a=this.positionAbs[this.containers[n].floating?"left":"top"],l=this.items.length-1;l>=0;l--)if(t.ui.contains(this.containers[n].element[0],this.items[l].item[0])){var c=this.items[l][this.containers[n].floating?"left":"top"];Math.abs(c-a)<o&&(o=Math.abs(c-a),r=this.items[l])}if(!r&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[n],r?this._rearrange(e,r,null,!0):this._rearrange(e,null,this.containers[n].element,!0),this._trigger("change",e,this._uiHash()),this.containers[n]._trigger("change",e,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[n]._trigger("over",e,this._uiHash(this)),this.containers[n].containerCache.over=1}},_createHelper:function(e){var i=this.options,n=t.isFunction(i.helper)?t(i.helper.apply(this.element[0],[e,this.currentItem])):"clone"==i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||t("parent"!=i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(""==n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(""==n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(e){"string"==typeof e&&(e=e.split(" ")),t.isArray(e)&&(e={left:+e[0],top:+e[1]||0}),"left"in e&&(this.offset.click.left=e.left+this.margins.left),"right"in e&&(this.offset.click.left=this.helperProportions.width-e.right+this.margins.left),"top"in e&&(this.offset.click.top=e.top+this.margins.top),"bottom"in e&&(this.offset.click.top=this.helperProportions.height-e.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var e=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])&&(e.left+=this.scrollParent.scrollLeft(),e.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&t.browser.msie)&&(e={top:0,left:0}),{top:e.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:e.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var t=this.currentItem.position();return{top:t.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:t.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var e=this.options;if("parent"==e.containment&&(e.containment=this.helper[0].parentNode),("document"==e.containment||"window"==e.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,t("document"==e.containment?document:window).width()-this.helperProportions.width-this.margins.left,(t("document"==e.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(e.containment)){var i=t(e.containment)[0],n=t(e.containment).offset(),s="hidden"!=t(i).css("overflow");this.containment=[n.left+(parseInt(t(i).css("borderLeftWidth"),10)||0)+(parseInt(t(i).css("paddingLeft"),10)||0)-this.margins.left,n.top+(parseInt(t(i).css("borderTopWidth"),10)||0)+(parseInt(t(i).css("paddingTop"),10)||0)-this.margins.top,n.left+(s?Math.max(i.scrollWidth,i.offsetWidth):i.offsetWidth)-(parseInt(t(i).css("borderLeftWidth"),10)||0)-(parseInt(t(i).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,n.top+(s?Math.max(i.scrollHeight,i.offsetHeight):i.offsetHeight)-(parseInt(t(i).css("borderTopWidth"),10)||0)-(parseInt(t(i).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(e,i){i||(i=this.position);var n="absolute"==e?1:-1,s=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),o=/(html|body)/i.test(s[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-(t.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollTop():o?0:s.scrollTop())*n),left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-(t.browser.safari&&"fixed"==this.cssPosition?0:("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():o?0:s.scrollLeft())*n)}},_generatePosition:function(e){var i=this.options,n="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&t.ui.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,s=/(html|body)/i.test(n[0].tagName);"relative"!=this.cssPosition||this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset());var o=e.pageX,r=e.pageY;if(this.originalPosition&&(this.containment&&(e.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),e.pageY-this.offset.click.top<this.containment[1]&&(r=this.containment[1]+this.offset.click.top),e.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),e.pageY-this.offset.click.top>this.containment[3]&&(r=this.containment[3]+this.offset.click.top)),i.grid)){var a=this.originalPageY+Math.round((r-this.originalPageY)/i.grid[1])*i.grid[1];r=this.containment?a-this.offset.click.top<this.containment[1]||a-this.offset.click.top>this.containment[3]?a-this.offset.click.top<this.containment[1]?a+i.grid[1]:a-i.grid[1]:a:a;var l=this.originalPageX+Math.round((o-this.originalPageX)/i.grid[0])*i.grid[0];o=this.containment?l-this.offset.click.left<this.containment[0]||l-this.offset.click.left>this.containment[2]?l-this.offset.click.left<this.containment[0]?l+i.grid[0]:l-i.grid[0]:l:l}return{top:r-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(t.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollTop():s?0:n.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(t.browser.safari&&"fixed"==this.cssPosition?0:"fixed"==this.cssPosition?-this.scrollParent.scrollLeft():s?0:n.scrollLeft())}},_rearrange:function(t,e,i,n){i?i[0].appendChild(this.placeholder[0]):e.item[0].parentNode.insertBefore(this.placeholder[0],"down"==this.direction?e.item[0]:e.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var s=this,o=this.counter;window.setTimeout(function(){o==s.counter&&s.refreshPositions(!n)},0)},_clear:function(e,i){this.reverting=!1;
var n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(var s in this._storedCSS)("auto"==this._storedCSS[s]||"static"==this._storedCSS[s])&&(this._storedCSS[s]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();if(this.fromOutside&&!i&&n.push(function(t){this._trigger("receive",t,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev==this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent==this.currentItem.parent()[0]||i||n.push(function(t){this._trigger("update",t,this._uiHash())}),!t.ui.contains(this.element[0],this.currentItem[0])){i||n.push(function(t){this._trigger("remove",t,this._uiHash())});for(var s=this.containers.length-1;s>=0;s--)t.ui.contains(this.containers[s].element[0],this.currentItem[0])&&!i&&(n.push(function(t){return function(e){t._trigger("receive",e,this._uiHash(this))}}.call(this,this.containers[s])),n.push(function(t){return function(e){t._trigger("update",e,this._uiHash(this))}}.call(this,this.containers[s])))}for(var s=this.containers.length-1;s>=0;s--)i||n.push(function(t){return function(e){t._trigger("deactivate",e,this._uiHash(this))}}.call(this,this.containers[s])),this.containers[s].containerCache.over&&(n.push(function(t){return function(e){t._trigger("out",e,this._uiHash(this))}}.call(this,this.containers[s])),this.containers[s].containerCache.over=0);if(this._storedCursor&&t("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!i){this._trigger("beforeStop",e,this._uiHash());for(var s=0;s<n.length;s++)n[s].call(this,e);this._trigger("stop",e,this._uiHash())}return!1}if(i||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!i){for(var s=0;s<n.length;s++)n[s].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){t.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(e){var i=e||this;return{helper:i.helper,placeholder:i.placeholder||t([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:e?e.element:null}}}),t.extend(t.ui.sortable,{version:"@VERSION"})}(jQuery),function(t){t.ui=t.ui||{};var e=/left|center|right/,i=/top|center|bottom/,n="center",s={},o=t.fn.position,r=t.fn.offset;t.fn.position=function(r){if(!r||!r.of)return o.apply(this,arguments);r=t.extend({},r);var a,l,c,d=t(r.of),u=d[0],h=(r.collision||"flip").split(" "),p=r.offset?r.offset.split(" "):[0,0];return 9===u.nodeType?(a=d.width(),l=d.height(),c={top:0,left:0}):u.setTimeout?(a=d.width(),l=d.height(),c={top:d.scrollTop(),left:d.scrollLeft()}):u.preventDefault?(r.at="left top",a=l=0,c={top:r.of.pageY,left:r.of.pageX}):(a=d.outerWidth(),l=d.outerHeight(),c=d.offset()),t.each(["my","at"],function(){var t=(r[this]||"").split(" ");1===t.length&&(t=e.test(t[0])?t.concat([n]):i.test(t[0])?[n].concat(t):[n,n]),t[0]=e.test(t[0])?t[0]:n,t[1]=i.test(t[1])?t[1]:n,r[this]=t}),1===h.length&&(h[1]=h[0]),p[0]=parseInt(p[0],10)||0,1===p.length&&(p[1]=p[0]),p[1]=parseInt(p[1],10)||0,"right"===r.at[0]?c.left+=a:r.at[0]===n&&(c.left+=a/2),"bottom"===r.at[1]?c.top+=l:r.at[1]===n&&(c.top+=l/2),c.left+=p[0],c.top+=p[1],this.each(function(){var e,i=t(this),o=i.outerWidth(),d=i.outerHeight(),u=parseInt(t.curCSS(this,"marginLeft",!0))||0,m=parseInt(t.curCSS(this,"marginTop",!0))||0,f=o+u+(parseInt(t.curCSS(this,"marginRight",!0))||0),_=d+m+(parseInt(t.curCSS(this,"marginBottom",!0))||0),g=t.extend({},c);"right"===r.my[0]?g.left-=o:r.my[0]===n&&(g.left-=o/2),"bottom"===r.my[1]?g.top-=d:r.my[1]===n&&(g.top-=d/2),s.fractions||(g.left=Math.round(g.left),g.top=Math.round(g.top)),e={left:g.left-u,top:g.top-m},t.each(["left","top"],function(i,n){t.ui.position[h[i]]&&t.ui.position[h[i]][n](g,{targetWidth:a,targetHeight:l,elemWidth:o,elemHeight:d,collisionPosition:e,collisionWidth:f,collisionHeight:_,offset:p,my:r.my,at:r.at})}),t.fn.bgiframe&&i.bgiframe(),i.offset(t.extend(g,{using:r.using}))})},t.ui.position={fit:{left:function(e,i){var n=t(window),s=i.collisionPosition.left+i.collisionWidth-n.width()-n.scrollLeft();e.left=s>0?e.left-s:Math.max(e.left-i.collisionPosition.left,e.left)},top:function(e,i){var n=t(window),s=i.collisionPosition.top+i.collisionHeight-n.height()-n.scrollTop();e.top=s>0?e.top-s:Math.max(e.top-i.collisionPosition.top,e.top)}},flip:{left:function(e,i){if(i.at[0]!==n){var s=t(window),o=i.collisionPosition.left+i.collisionWidth-s.width()-s.scrollLeft(),r="left"===i.my[0]?-i.elemWidth:"right"===i.my[0]?i.elemWidth:0,a="left"===i.at[0]?i.targetWidth:-i.targetWidth,l=-2*i.offset[0];e.left+=i.collisionPosition.left<0?r+a+l:o>0?r+a+l:0}},top:function(e,i){if(i.at[1]!==n){var s=t(window),o=i.collisionPosition.top+i.collisionHeight-s.height()-s.scrollTop(),r="top"===i.my[1]?-i.elemHeight:"bottom"===i.my[1]?i.elemHeight:0,a="top"===i.at[1]?i.targetHeight:-i.targetHeight,l=-2*i.offset[1];e.top+=i.collisionPosition.top<0?r+a+l:o>0?r+a+l:0}}}},t.offset.setOffset||(t.offset.setOffset=function(e,i){/static/.test(t.curCSS(e,"position"))&&(e.style.position="relative");var n=t(e),s=n.offset(),o=parseInt(t.curCSS(e,"top",!0),10)||0,r=parseInt(t.curCSS(e,"left",!0),10)||0,a={top:i.top-s.top+o,left:i.left-s.left+r};"using"in i?i.using.call(e,a):n.css(a)},t.fn.offset=function(e){var i=this[0];return i&&i.ownerDocument?e?this.each(function(){t.offset.setOffset(this,e)}):r.call(this):null}),function(){var e,i,n,o,r,a=document.getElementsByTagName("body")[0],l=document.createElement("div");e=document.createElement(a?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},a&&jQuery.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"});for(var c in n)e.style[c]=n[c];e.appendChild(l),i=a||document.documentElement,i.insertBefore(e,i.firstChild),l.style.cssText="position: absolute; left: 10.7432222px; top: 10.432325px; height: 30px; width: 201px;",o=t(l).offset(function(t,e){return e}).offset(),e.innerHTML="",i.removeChild(e),r=o.top+o.left+(a?2e3:0),s.fractions=r>21&&22>r}()}(jQuery),function(t){t.fn.autogrow=function(){return this.filter("textarea").each(function(){var e=t(this),i=e.height(),n=(e.css("lineHeight"),t("<div></div>").css({position:"absolute",top:-1e4,left:-1e4,width:t(this).width()-parseInt(e.css("paddingLeft"))-parseInt(e.css("paddingRight")),fontSize:e.css("fontSize"),fontFamily:e.css("fontFamily"),lineHeight:e.css("lineHeight"),resize:"none"}).appendTo(document.body)),s=function(){var e=function(t,e){for(var i=0,n="";e>i;i++)n+=t;return n},s=this.value.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/&/g,"&amp;").replace(/\n$/,"<br/>&nbsp;").replace(/\n/g,"<br/>").replace(/ {2,}/g,function(t){return e("&nbsp;",t.length-1)+" "});n.html(s),t(this).css("height",Math.max(n.height(),i))};t(this).change(s).keyup(s).keydown(s),s.apply(this)}),this}}(jQuery),function($,undefined){function Datepicker(){this.debug=!1,this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},$.extend(this._defaults,this.regional[""]),this.dpDiv=bindHover($('<div id="'+this._mainDivId+'" class="ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>'))}function bindHover(t){var e="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.bind("mouseout",function(t){var i=$(t.target).closest(e);i.length&&i.removeClass("ui-state-hover ui-datepicker-prev-hover ui-datepicker-next-hover")}).bind("mouseover",function(i){var n=$(i.target).closest(e);!$.datepicker._isDisabledDatepicker(instActive.inline?t.parent()[0]:instActive.input[0])&&n.length&&(n.parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),n.addClass("ui-state-hover"),n.hasClass("ui-datepicker-prev")&&n.addClass("ui-datepicker-prev-hover"),n.hasClass("ui-datepicker-next")&&n.addClass("ui-datepicker-next-hover"))})}function extendRemove(t,e){$.extend(t,e);for(var i in e)(null==e[i]||e[i]==undefined)&&(t[i]=e[i]);return t}function isArray(t){return t&&($.browser.safari&&"object"==typeof t&&t.length||t.constructor&&t.constructor.toString().match(/\Array\(\)/))}$.extend($.ui,{datepicker:{version:"@VERSION"}});var PROP_NAME="datepicker",dpuuid=(new Date).getTime(),instActive;$.extend(Datepicker.prototype,{markerClassName:"hasDatepicker",maxRows:4,log:function(){this.debug&&console.log.apply("",arguments)},_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(t){return extendRemove(this._defaults,t||{}),this},_attachDatepicker:function(target,settings){var inlineSettings=null;for(var attrName in this._defaults){var attrValue=target.getAttribute("date:"+attrName);if(attrValue){inlineSettings=inlineSettings||{};try{inlineSettings[attrName]=eval(attrValue)}catch(err){inlineSettings[attrName]=attrValue}}}var nodeName=target.nodeName.toLowerCase(),inline="div"==nodeName||"span"==nodeName;target.id||(this.uuid+=1,target.id="dp"+this.uuid);var inst=this._newInst($(target),inline);inst.settings=$.extend({},settings||{},inlineSettings||{}),"input"==nodeName?this._connectDatepicker(target,inst):inline&&this._inlineDatepicker(target,inst)},_newInst:function(t,e){var i=t[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1");return{id:i,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:e,dpDiv:e?bindHover($('<div class="'+this._inlineClass+' ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')):this.dpDiv}},_connectDatepicker:function(t,e){var i=$(t);e.append=$([]),e.trigger=$([]),i.hasClass(this.markerClassName)||(this._attachments(i,e),i.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp).bind("setData.datepicker",function(t,i,n){e.settings[i]=n}).bind("getData.datepicker",function(t,i){return this._get(e,i)}),this._autoSize(e),$.data(t,PROP_NAME,e),e.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,e){var i=this._get(e,"appendText"),n=this._get(e,"isRTL");e.append&&e.append.remove(),i&&(e.append=$('<span class="'+this._appendClass+'">'+i+"</span>"),t[n?"before":"after"](e.append)),t.unbind("focus",this._showDatepicker),e.trigger&&e.trigger.remove();var s=this._get(e,"showOn");if(("focus"==s||"both"==s)&&t.focus(this._showDatepicker),"button"==s||"both"==s){var o=this._get(e,"buttonText"),r=this._get(e,"buttonImage");e.trigger=$(this._get(e,"buttonImageOnly")?$("<img/>").addClass(this._triggerClass).attr({src:r,alt:o,title:o}):$('<button type="button"></button>').addClass(this._triggerClass).html(""==r?o:$("<img/>").attr({src:r,alt:o,title:o}))),t[n?"before":"after"](e.trigger),e.trigger.click(function(){return $.datepicker._datepickerShowing&&$.datepicker._lastInput==t[0]?$.datepicker._hideDatepicker():$.datepicker._showDatepicker(t[0]),!1})}},_autoSize:function(t){if(this._get(t,"autoSize")&&!t.inline){var e=new Date(2009,11,20),i=this._get(t,"dateFormat");if(i.match(/[DM]/)){var n=function(t){for(var e=0,i=0,n=0;n<t.length;n++)t[n].length>e&&(e=t[n].length,i=n);return i};e.setMonth(n(this._get(t,i.match(/MM/)?"monthNames":"monthNamesShort"))),e.setDate(n(this._get(t,i.match(/DD/)?"dayNames":"dayNamesShort"))+20-e.getDay())}t.input.attr("size",this._formatDate(t,e).length)}},_inlineDatepicker:function(t,e){var i=$(t);i.hasClass(this.markerClassName)||(i.addClass(this.markerClassName).append(e.dpDiv).bind("setData.datepicker",function(t,i,n){e.settings[i]=n}).bind("getData.datepicker",function(t,i){return this._get(e,i)}),$.data(t,PROP_NAME,e),this._setDate(e,this._getDefaultDate(e),!0),this._updateDatepicker(e),this._updateAlternate(e),e.settings.disabled&&this._disableDatepicker(t),e.dpDiv.css("display","block"))},_dialogDatepicker:function(t,e,i,n,s){var o=this._dialogInst;if(!o){this.uuid+=1;var r="dp"+this.uuid;this._dialogInput=$('<input type="text" id="'+r+'" style="position: absolute; top: -100px; width: 0px; z-index: -10;"/>'),this._dialogInput.keydown(this._doKeyDown),$("body").append(this._dialogInput),o=this._dialogInst=this._newInst(this._dialogInput,!1),o.settings={},$.data(this._dialogInput[0],PROP_NAME,o)}if(extendRemove(o.settings,n||{}),e=e&&e.constructor==Date?this._formatDate(o,e):e,this._dialogInput.val(e),this._pos=s?s.length?s:[s.pageX,s.pageY]:null,!this._pos){var a=document.documentElement.clientWidth,l=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop;this._pos=[a/2-100+c,l/2-150+d]}return this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),o.settings.onSelect=i,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),$.blockUI&&$.blockUI(this.dpDiv),$.data(this._dialogInput[0],PROP_NAME,o),this},_destroyDatepicker:function(t){var e=$(t),i=$.data(t,PROP_NAME);if(e.hasClass(this.markerClassName)){var n=t.nodeName.toLowerCase();$.removeData(t,PROP_NAME),"input"==n?(i.append.remove(),i.trigger.remove(),e.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"==n||"span"==n)&&e.removeClass(this.markerClassName).empty()}},_enableDatepicker:function(t){var e=$(t),i=$.data(t,PROP_NAME);if(e.hasClass(this.markerClassName)){var n=t.nodeName.toLowerCase();if("input"==n)t.disabled=!1,i.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""});else if("div"==n||"span"==n){var s=e.children("."+this._inlineClass);s.children().removeClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").removeAttr("disabled")}this._disabledInputs=$.map(this._disabledInputs,function(e){return e==t?null:e})}},_disableDatepicker:function(t){var e=$(t),i=$.data(t,PROP_NAME);if(e.hasClass(this.markerClassName)){var n=t.nodeName.toLowerCase();if("input"==n)t.disabled=!0,i.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"});else if("div"==n||"span"==n){var s=e.children("."+this._inlineClass);s.children().addClass("ui-state-disabled"),s.find("select.ui-datepicker-month, select.ui-datepicker-year").attr("disabled","disabled")}this._disabledInputs=$.map(this._disabledInputs,function(e){return e==t?null:e}),this._disabledInputs[this._disabledInputs.length]=t}},_isDisabledDatepicker:function(t){if(!t)return!1;for(var e=0;e<this._disabledInputs.length;e++)if(this._disabledInputs[e]==t)return!0;return!1},_getInst:function(t){try{return $.data(t,PROP_NAME)}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,e,i){var n=this._getInst(t);if(2==arguments.length&&"string"==typeof e)return"defaults"==e?$.extend({},$.datepicker._defaults):n?"all"==e?$.extend({},n.settings):this._get(n,e):null;var s=e||{};if("string"==typeof e&&(s={},s[e]=i),n){this._curInst==n&&this._hideDatepicker();var o=this._getDateDatepicker(t,!0),r=this._getMinMaxDate(n,"min"),a=this._getMinMaxDate(n,"max");extendRemove(n.settings,s),null!==r&&s.dateFormat!==undefined&&s.minDate===undefined&&(n.settings.minDate=this._formatDate(n,r)),null!==a&&s.dateFormat!==undefined&&s.maxDate===undefined&&(n.settings.maxDate=this._formatDate(n,a)),this._attachments($(t),n),this._autoSize(n),this._setDate(n,o),this._updateAlternate(n),this._updateDatepicker(n)}},_changeDatepicker:function(t,e,i){this._optionDatepicker(t,e,i)},_refreshDatepicker:function(t){var e=this._getInst(t);e&&this._updateDatepicker(e)},_setDateDatepicker:function(t,e){var i=this._getInst(t);i&&(this._setDate(i,e),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(t,e){var i=this._getInst(t);return i&&!i.inline&&this._setDateFromField(i,e),i?this._getDate(i):null},_doKeyDown:function(t){var e=$.datepicker._getInst(t.target),i=!0,n=e.dpDiv.is(".ui-datepicker-rtl");if(e._keyEvent=!0,$.datepicker._datepickerShowing)switch(t.keyCode){case 9:$.datepicker._hideDatepicker(),i=!1;break;case 13:var s=$("td."+$.datepicker._dayOverClass+":not(."+$.datepicker._currentClass+")",e.dpDiv);s[0]&&$.datepicker._selectDay(t.target,e.selectedMonth,e.selectedYear,s[0]);var o=$.datepicker._get(e,"onSelect");if(o){var r=$.datepicker._formatDate(e);o.apply(e.input?e.input[0]:null,[r,e])}else $.datepicker._hideDatepicker();return!1;case 27:$.datepicker._hideDatepicker();break;case 33:$.datepicker._adjustDate(t.target,t.ctrlKey?-$.datepicker._get(e,"stepBigMonths"):-$.datepicker._get(e,"stepMonths"),"M");break;case 34:$.datepicker._adjustDate(t.target,t.ctrlKey?+$.datepicker._get(e,"stepBigMonths"):+$.datepicker._get(e,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&$.datepicker._clearDate(t.target),i=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&$.datepicker._gotoToday(t.target),i=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&$.datepicker._adjustDate(t.target,n?1:-1,"D"),i=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&$.datepicker._adjustDate(t.target,t.ctrlKey?-$.datepicker._get(e,"stepBigMonths"):-$.datepicker._get(e,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&$.datepicker._adjustDate(t.target,-7,"D"),i=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&$.datepicker._adjustDate(t.target,n?-1:1,"D"),i=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&$.datepicker._adjustDate(t.target,t.ctrlKey?+$.datepicker._get(e,"stepBigMonths"):+$.datepicker._get(e,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&$.datepicker._adjustDate(t.target,7,"D"),i=t.ctrlKey||t.metaKey;break;default:i=!1}else 36==t.keyCode&&t.ctrlKey?$.datepicker._showDatepicker(this):i=!1;i&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var e=$.datepicker._getInst(t.target);if($.datepicker._get(e,"constrainInput")){var i=$.datepicker._possibleChars($.datepicker._get(e,"dateFormat")),n=String.fromCharCode(t.charCode==undefined?t.keyCode:t.charCode);return t.ctrlKey||t.metaKey||" ">n||!i||i.indexOf(n)>-1}},_doKeyUp:function(t){var e=$.datepicker._getInst(t.target);if(e.input.val()!=e.lastVal)try{var i=$.datepicker.parseDate($.datepicker._get(e,"dateFormat"),e.input?e.input.val():null,$.datepicker._getFormatConfig(e));i&&($.datepicker._setDateFromField(e),$.datepicker._updateAlternate(e),$.datepicker._updateDatepicker(e))}catch(t){$.datepicker.log(t)}return!0},_showDatepicker:function(t){if(t=t.target||t,"input"!=t.nodeName.toLowerCase()&&(t=$("input",t.parentNode)[0]),!$.datepicker._isDisabledDatepicker(t)&&$.datepicker._lastInput!=t){var e=$.datepicker._getInst(t);$.datepicker._curInst&&$.datepicker._curInst!=e&&($.datepicker._curInst.dpDiv.stop(!0,!0),e&&$.datepicker._datepickerShowing&&$.datepicker._hideDatepicker($.datepicker._curInst.input[0]));var i=$.datepicker._get(e,"beforeShow"),n=i?i.apply(t,[t,e]):{};if(n!==!1){extendRemove(e.settings,n),e.lastVal=null,$.datepicker._lastInput=t,$.datepicker._setDateFromField(e),$.datepicker._inDialog&&(t.value=""),$.datepicker._pos||($.datepicker._pos=$.datepicker._findPos(t),$.datepicker._pos[1]+=t.offsetHeight);var s=!1;$(t).parents().each(function(){return s|="fixed"==$(this).css("position"),!s}),s&&$.browser.opera&&($.datepicker._pos[0]-=document.documentElement.scrollLeft,$.datepicker._pos[1]-=document.documentElement.scrollTop);var o={left:$.datepicker._pos[0],top:$.datepicker._pos[1]};if($.datepicker._pos=null,e.dpDiv.empty(),e.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),$.datepicker._updateDatepicker(e),o=$.datepicker._checkOffset(e,o,s),e.dpDiv.css({position:$.datepicker._inDialog&&$.blockUI?"static":s?"fixed":"absolute",display:"none",left:o.left+"px",top:o.top+"px"}),!e.inline){var r=$.datepicker._get(e,"showAnim"),a=$.datepicker._get(e,"duration"),l=function(){var t=e.dpDiv.find("iframe.ui-datepicker-cover");if(t.length){var i=$.datepicker._getBorders(e.dpDiv);t.css({left:-i[0],top:-i[1],width:e.dpDiv.outerWidth(),height:e.dpDiv.outerHeight()})}};e.dpDiv.zIndex($(t).zIndex()+1),$.datepicker._datepickerShowing=!0,$.effects&&$.effects[r]?e.dpDiv.show(r,$.datepicker._get(e,"showOptions"),a,l):e.dpDiv[r||"show"](r?a:null,l),r&&a||l(),e.input.is(":visible")&&!e.input.is(":disabled")&&e.input.focus(),$.datepicker._curInst=e}}}},_updateDatepicker:function(t){var e=this;e.maxRows=4;var i=$.datepicker._getBorders(t.dpDiv);instActive=t,t.dpDiv.empty().append(this._generateHTML(t));var n=t.dpDiv.find("iframe.ui-datepicker-cover");n.length&&n.css({left:-i[0],top:-i[1],width:t.dpDiv.outerWidth(),height:t.dpDiv.outerHeight()}),t.dpDiv.find("."+this._dayOverClass+" a").mouseover();var s=this._getNumberOfMonths(t),o=s[1],r=17;if(t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),o>1&&t.dpDiv.addClass("ui-datepicker-multi-"+o).css("width",r*o+"em"),t.dpDiv[(1!=s[0]||1!=s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t==$.datepicker._curInst&&$.datepicker._datepickerShowing&&t.input&&t.input.is(":visible")&&!t.input.is(":disabled")&&t.input[0]!=document.activeElement&&t.input.focus(),t.yearshtml){var a=t.yearshtml;setTimeout(function(){a===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),a=t.yearshtml=null},0)}},_getBorders:function(t){var e=function(t){return{thin:1,medium:2,thick:3}[t]||t};return[parseFloat(e(t.css("border-left-width"))),parseFloat(e(t.css("border-top-width")))]},_checkOffset:function(t,e,i){var n=t.dpDiv.outerWidth(),s=t.dpDiv.outerHeight(),o=t.input?t.input.outerWidth():0,r=t.input?t.input.outerHeight():0,a=document.documentElement.clientWidth+$(document).scrollLeft(),l=document.documentElement.clientHeight+$(document).scrollTop();return e.left-=this._get(t,"isRTL")?n-o:0,e.left-=i&&e.left==t.input.offset().left?$(document).scrollLeft():0,e.top-=i&&e.top==t.input.offset().top+r?$(document).scrollTop():0,e.left-=Math.min(e.left,e.left+n>a&&a>n?Math.abs(e.left+n-a):0),e.top-=Math.min(e.top,e.top+s>l&&l>s?Math.abs(s+r):0),e},_findPos:function(t){for(var e=this._getInst(t),i=this._get(e,"isRTL");t&&("hidden"==t.type||1!=t.nodeType||$.expr.filters.hidden(t));)t=t[i?"previousSibling":"nextSibling"];var n=$(t).offset();return[n.left,n.top]},_hideDatepicker:function(t){var e=this._curInst;if(e&&(!t||e==$.data(t,PROP_NAME))&&this._datepickerShowing){var i=this._get(e,"showAnim"),n=this._get(e,"duration"),s=this,o=function(){$.datepicker._tidyDialog(e),s._curInst=null};$.effects&&$.effects[i]?e.dpDiv.hide(i,$.datepicker._get(e,"showOptions"),n,o):e.dpDiv["slideDown"==i?"slideUp":"fadeIn"==i?"fadeOut":"hide"](i?n:null,o),i||o(),this._datepickerShowing=!1;var r=this._get(e,"onClose");r&&r.apply(e.input?e.input[0]:null,[e.input?e.input.val():"",e]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),$.blockUI&&($.unblockUI(),$("body").append(this.dpDiv))),this._inDialog=!1}},_tidyDialog:function(t){t.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if($.datepicker._curInst){var e=$(t.target),i=$.datepicker._getInst(e[0]);(e[0].id!=$.datepicker._mainDivId&&0==e.parents("#"+$.datepicker._mainDivId).length&&!e.hasClass($.datepicker.markerClassName)&&!e.hasClass($.datepicker._triggerClass)&&$.datepicker._datepickerShowing&&(!$.datepicker._inDialog||!$.blockUI)||e.hasClass($.datepicker.markerClassName)&&$.datepicker._curInst!=i)&&$.datepicker._hideDatepicker()}},_adjustDate:function(t,e,i){var n=$(t),s=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(s,e+("M"==i?this._get(s,"showCurrentAtPos"):0),i),this._updateDatepicker(s))},_gotoToday:function(t){var e=$(t),i=this._getInst(e[0]);if(this._get(i,"gotoCurrent")&&i.currentDay)i.selectedDay=i.currentDay,i.drawMonth=i.selectedMonth=i.currentMonth,i.drawYear=i.selectedYear=i.currentYear;else{var n=new Date;i.selectedDay=n.getDate(),i.drawMonth=i.selectedMonth=n.getMonth(),i.drawYear=i.selectedYear=n.getFullYear()}this._notifyChange(i),this._adjustDate(e)},_selectMonthYear:function(t,e,i){var n=$(t),s=this._getInst(n[0]);s["selected"+("M"==i?"Month":"Year")]=s["draw"+("M"==i?"Month":"Year")]=parseInt(e.options[e.selectedIndex].value,10),this._notifyChange(s),this._adjustDate(n)},_selectDay:function(t,e,i,n){var s=$(t);if(!$(n).hasClass(this._unselectableClass)&&!this._isDisabledDatepicker(s[0])){var o=this._getInst(s[0]);o.selectedDay=o.currentDay=$("a",n).html(),o.selectedMonth=o.currentMonth=e,o.selectedYear=o.currentYear=i,this._selectDate(t,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear))}},_clearDate:function(t){{var e=$(t);this._getInst(e[0])}this._selectDate(e,"")},_selectDate:function(t,e){var i=$(t),n=this._getInst(i[0]);e=null!=e?e:this._formatDate(n),n.input&&n.input.val(e),this._updateAlternate(n);var s=this._get(n,"onSelect");s?s.apply(n.input?n.input[0]:null,[e,n]):n.input&&n.input.trigger("change"),n.inline?this._updateDatepicker(n):(this._hideDatepicker(),this._lastInput=n.input[0],"object"!=typeof n.input[0]&&n.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var e=this._get(t,"altField");if(e){var i=this._get(t,"altFormat")||this._get(t,"dateFormat"),n=this._getDate(t),s=this.formatDate(i,n,this._getFormatConfig(t));$(e).each(function(){$(this).val(s)})}},noWeekends:function(t){var e=t.getDay();return[e>0&&6>e,""]},iso8601Week:function(t){var e=new Date(t.getTime());e.setDate(e.getDate()+4-(e.getDay()||7));var i=e.getTime();return e.setMonth(0),e.setDate(1),Math.floor(Math.round((i-e)/864e5)/7)+1},parseDate:function(t,e,i){if(null==t||null==e)throw"Invalid arguments";if(e="object"==typeof e?e.toString():e+"",""==e)return null;var n=(i?i.shortYearCutoff:null)||this._defaults.shortYearCutoff;n="string"!=typeof n?n:(new Date).getFullYear()%100+parseInt(n,10);for(var s=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,r=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,a=(i?i.monthNames:null)||this._defaults.monthNames,l=-1,c=-1,d=-1,u=-1,h=!1,p=function(e){var i=b+1<t.length&&t.charAt(b+1)==e;return i&&b++,i},m=function(t){var i=p(t),n="@"==t?14:"!"==t?20:"y"==t&&i?4:"o"==t?3:2,s=new RegExp("^\\d{1,"+n+"}"),o=e.substring(g).match(s);if(!o)throw"Missing number at position "+g;return g+=o[0].length,parseInt(o[0],10)},f=function(t,i,n){var s=$.map(p(t)?n:i,function(t,e){return[[e,t]]}).sort(function(t,e){return-(t[1].length-e[1].length)}),o=-1;if($.each(s,function(t,i){var n=i[1];return e.substr(g,n.length).toLowerCase()==n.toLowerCase()?(o=i[0],g+=n.length,!1):void 0}),-1!=o)return o+1;throw"Unknown name at position "+g},_=function(){if(e.charAt(g)!=t.charAt(b))throw"Unexpected literal at position "+g;g++},g=0,b=0;b<t.length;b++)if(h)"'"!=t.charAt(b)||p("'")?_():h=!1;else switch(t.charAt(b)){case"d":d=m("d");break;case"D":f("D",s,o);break;case"o":u=m("o");break;case"m":c=m("m");break;case"M":c=f("M",r,a);break;case"y":l=m("y");break;case"@":var k=new Date(m("@"));l=k.getFullYear(),c=k.getMonth()+1,d=k.getDate();break;case"!":var k=new Date((m("!")-this._ticksTo1970)/1e4);l=k.getFullYear(),c=k.getMonth()+1,d=k.getDate();break;case"'":p("'")?_():h=!0;break;default:_()}if(g<e.length)throw"Extra/unparsed characters found in date: "+e.substring(g);if(-1==l?l=(new Date).getFullYear():100>l&&(l+=(new Date).getFullYear()-(new Date).getFullYear()%100+(n>=l?0:-100)),u>-1)for(c=1,d=u;;){var v=this._getDaysInMonth(l,c-1);if(v>=d)break;c++,d-=v}var k=this._daylightSavingAdjust(new Date(l,c-1,d));if(k.getFullYear()!=l||k.getMonth()+1!=c||k.getDate()!=d)throw"Invalid date";return k},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(t,e,i){if(!e)return"";var n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,s=(i?i.dayNames:null)||this._defaults.dayNames,o=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,a=function(e){var i=h+1<t.length&&t.charAt(h+1)==e;return i&&h++,i},l=function(t,e,i){var n=""+e;if(a(t))for(;n.length<i;)n="0"+n;return n},c=function(t,e,i,n){return a(t)?n[e]:i[e]},d="",u=!1;if(e)for(var h=0;h<t.length;h++)if(u)"'"!=t.charAt(h)||a("'")?d+=t.charAt(h):u=!1;else switch(t.charAt(h)){case"d":d+=l("d",e.getDate(),2);break;case"D":d+=c("D",e.getDay(),n,s);break;case"o":d+=l("o",Math.round((new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime()-new Date(e.getFullYear(),0,0).getTime())/864e5),3);break;case"m":d+=l("m",e.getMonth()+1,2);break;case"M":d+=c("M",e.getMonth(),o,r);break;case"y":d+=a("y")?e.getFullYear():(e.getYear()%100<10?"0":"")+e.getYear()%100;break;case"@":d+=e.getTime();break;case"!":d+=1e4*e.getTime()+this._ticksTo1970;break;case"'":a("'")?d+="'":u=!0;break;default:d+=t.charAt(h)}return d},_possibleChars:function(t){for(var e="",i=!1,n=function(e){var i=s+1<t.length&&t.charAt(s+1)==e;return i&&s++,i},s=0;s<t.length;s++)if(i)"'"!=t.charAt(s)||n("'")?e+=t.charAt(s):i=!1;else switch(t.charAt(s)){case"d":case"m":case"y":case"@":e+="0123456789";break;case"D":case"M":return null;case"'":n("'")?e+="'":i=!0;break;default:e+=t.charAt(s)}return e},_get:function(t,e){return t.settings[e]!==undefined?t.settings[e]:this._defaults[e]},_setDateFromField:function(t,e){if(t.input.val()!=t.lastVal){var i,n,s=this._get(t,"dateFormat"),o=t.lastVal=t.input?t.input.val():null;i=n=this._getDefaultDate(t);var r=this._getFormatConfig(t);try{i=this.parseDate(s,o,r)||n}catch(a){this.log(a),o=e?"":o}t.selectedDay=i.getDate(),t.drawMonth=t.selectedMonth=i.getMonth(),t.drawYear=t.selectedYear=i.getFullYear(),t.currentDay=o?i.getDate():0,t.currentMonth=o?i.getMonth():0,t.currentYear=o?i.getFullYear():0,this._adjustInstDate(t)
}},_getDefaultDate:function(t){return this._restrictMinMax(t,this._determineDate(t,this._get(t,"defaultDate"),new Date))},_determineDate:function(t,e,i){var n=function(t){var e=new Date;return e.setDate(e.getDate()+t),e},s=function(e){try{return $.datepicker.parseDate($.datepicker._get(t,"dateFormat"),e,$.datepicker._getFormatConfig(t))}catch(i){}for(var n=(e.toLowerCase().match(/^c/)?$.datepicker._getDate(t):null)||new Date,s=n.getFullYear(),o=n.getMonth(),r=n.getDate(),a=/([+-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=a.exec(e);l;){switch(l[2]||"d"){case"d":case"D":r+=parseInt(l[1],10);break;case"w":case"W":r+=7*parseInt(l[1],10);break;case"m":case"M":o+=parseInt(l[1],10),r=Math.min(r,$.datepicker._getDaysInMonth(s,o));break;case"y":case"Y":s+=parseInt(l[1],10),r=Math.min(r,$.datepicker._getDaysInMonth(s,o))}l=a.exec(e)}return new Date(s,o,r)},o=null==e||""===e?i:"string"==typeof e?s(e):"number"==typeof e?isNaN(e)?i:n(e):new Date(e.getTime());return o=o&&"Invalid Date"==o.toString()?i:o,o&&(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(t){return t?(t.setHours(t.getHours()>12?t.getHours()+2:0),t):null},_setDate:function(t,e,i){var n=!e,s=t.selectedMonth,o=t.selectedYear,r=this._restrictMinMax(t,this._determineDate(t,e,new Date));t.selectedDay=t.currentDay=r.getDate(),t.drawMonth=t.selectedMonth=t.currentMonth=r.getMonth(),t.drawYear=t.selectedYear=t.currentYear=r.getFullYear(),s==t.selectedMonth&&o==t.selectedYear||i||this._notifyChange(t),this._adjustInstDate(t),t.input&&t.input.val(n?"":this._formatDate(t))},_getDate:function(t){var e=!t.currentYear||t.input&&""==t.input.val()?null:this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return e},_generateHTML:function(t){var e=new Date;e=this._daylightSavingAdjust(new Date(e.getFullYear(),e.getMonth(),e.getDate()));var i=this._get(t,"isRTL"),n=this._get(t,"showButtonPanel"),s=this._get(t,"hideIfNoPrevNext"),o=this._get(t,"navigationAsDateFormat"),r=this._getNumberOfMonths(t),a=this._get(t,"showCurrentAtPos"),l=this._get(t,"stepMonths"),c=1!=r[0]||1!=r[1],d=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),u=this._getMinMaxDate(t,"min"),h=this._getMinMaxDate(t,"max"),p=t.drawMonth-a,m=t.drawYear;if(0>p&&(p+=12,m--),h){var f=this._daylightSavingAdjust(new Date(h.getFullYear(),h.getMonth()-r[0]*r[1]+1,h.getDate()));for(f=u&&u>f?u:f;this._daylightSavingAdjust(new Date(m,p,1))>f;)p--,0>p&&(p=11,m--)}t.drawMonth=p,t.drawYear=m;var _=this._get(t,"prevText");_=o?this.formatDate(_,this._daylightSavingAdjust(new Date(m,p-l,1)),this._getFormatConfig(t)):_;var g=this._canAdjustMonth(t,-1,m,p)?'<a class="ui-datepicker-prev ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._adjustDate('#"+t.id+"', -"+l+", 'M');\" title=\""+_+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"e":"w")+'">'+_+"</span></a>":s?"":'<a class="ui-datepicker-prev ui-corner-all ui-state-disabled" title="'+_+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"e":"w")+'">'+_+"</span></a>",b=this._get(t,"nextText");b=o?this.formatDate(b,this._daylightSavingAdjust(new Date(m,p+l,1)),this._getFormatConfig(t)):b;var k=this._canAdjustMonth(t,1,m,p)?'<a class="ui-datepicker-next ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._adjustDate('#"+t.id+"', +"+l+", 'M');\" title=\""+b+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"w":"e")+'">'+b+"</span></a>":s?"":'<a class="ui-datepicker-next ui-corner-all ui-state-disabled" title="'+b+'"><span class="ui-icon ui-icon-circle-triangle-'+(i?"w":"e")+'">'+b+"</span></a>",v=this._get(t,"currentText"),y=this._get(t,"gotoCurrent")&&t.currentDay?d:e;v=o?this.formatDate(v,y,this._getFormatConfig(t)):v;var M=t.inline?"":'<button type="button" class="ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all" onclick="DP_jQuery_'+dpuuid+'.datepicker._hideDatepicker();">'+this._get(t,"closeText")+"</button>",w=n?'<div class="ui-datepicker-buttonpane ui-widget-content">'+(i?M:"")+(this._isInRange(t,y)?'<button type="button" class="ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all" onclick="DP_jQuery_'+dpuuid+".datepicker._gotoToday('#"+t.id+"');\">"+v+"</button>":"")+(i?"":M)+"</div>":"",x=parseInt(this._get(t,"firstDay"),10);x=isNaN(x)?0:x;for(var E=this._get(t,"showWeek"),B=this._get(t,"dayNames"),I=(this._get(t,"dayNamesShort"),this._get(t,"dayNamesMin")),S=this._get(t,"monthNames"),D=this._get(t,"monthNamesShort"),N=this._get(t,"beforeShowDay"),T=this._get(t,"showOtherMonths"),C=this._get(t,"selectOtherMonths"),O=(this._get(t,"calculateWeek")||this.iso8601Week,this._getDefaultDate(t)),P="",j=0;j<r[0];j++){var L="";this.maxRows=4;for(var A=0;A<r[1];A++){var F=this._daylightSavingAdjust(new Date(m,p,t.selectedDay)),H=" ui-corner-all",z="";if(c){if(z+='<div class="ui-datepicker-group',r[1]>1)switch(A){case 0:z+=" ui-datepicker-group-first",H=" ui-corner-"+(i?"right":"left");break;case r[1]-1:z+=" ui-datepicker-group-last",H=" ui-corner-"+(i?"left":"right");break;default:z+=" ui-datepicker-group-middle",H=""}z+='">'}z+='<div class="ui-datepicker-header ui-widget-header ui-helper-clearfix'+H+'">'+(/all|left/.test(H)&&0==j?i?k:g:"")+(/all|right/.test(H)&&0==j?i?g:k:"")+this._generateMonthYearHeader(t,p,m,u,h,j>0||A>0,S,D)+'</div><table class="ui-datepicker-calendar"><thead><tr>';for(var R=E?'<th class="ui-datepicker-week-col">'+this._get(t,"weekHeader")+"</th>":"",q=0;7>q;q++){var U=(q+x)%7;R+="<th"+((q+x+6)%7>=5?' class="ui-datepicker-week-end"':"")+'><span title="'+B[U]+'">'+I[U]+"</span></th>"}z+=R+"</tr></thead><tbody>";var W=this._getDaysInMonth(m,p);m==t.selectedYear&&p==t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,W));var V=(this._getFirstDayOfMonth(m,p)-x+7)%7,G=Math.ceil((V+W)/7),J=c?this.maxRows>G?this.maxRows:G:G;this.maxRows=J;for(var K=this._daylightSavingAdjust(new Date(m,p,1-V)),Y=0;J>Y;Y++){z+="<tr>";for(var Q=E?'<td class="ui-datepicker-week-col">'+this._get(t,"calculateWeek")(K)+"</td>":"",q=0;7>q;q++){var Z=N?N.apply(t.input?t.input[0]:null,[K]):[!0,""],X=K.getMonth()!=p,te=X&&!C||!Z[0]||u&&u>K||h&&K>h;Q+='<td class="'+((q+x+6)%7>=5?" ui-datepicker-week-end":"")+(X?" ui-datepicker-other-month":"")+(K.getTime()==F.getTime()&&p==t.selectedMonth&&t._keyEvent||O.getTime()==K.getTime()&&O.getTime()==F.getTime()?" "+this._dayOverClass:"")+(te?" "+this._unselectableClass+" ui-state-disabled":"")+(X&&!T?"":" "+Z[1]+(K.getTime()==d.getTime()?" "+this._currentClass:"")+(K.getTime()==e.getTime()?" ui-datepicker-today":""))+'"'+(X&&!T||!Z[2]?"":' title="'+Z[2]+'"')+(te?"":' onclick="DP_jQuery_'+dpuuid+".datepicker._selectDay('#"+t.id+"',"+K.getMonth()+","+K.getFullYear()+', this);return false;"')+">"+(X&&!T?"&#xa0;":te?'<span class="ui-state-default">'+K.getDate()+"</span>":'<a class="ui-state-default'+(K.getTime()==e.getTime()?" ui-state-highlight":"")+(K.getTime()==d.getTime()?" ui-state-active":"")+(X?" ui-priority-secondary":"")+'" href="#">'+K.getDate()+"</a>")+"</td>",K.setDate(K.getDate()+1),K=this._daylightSavingAdjust(K)}z+=Q+"</tr>"}p++,p>11&&(p=0,m++),z+="</tbody></table>"+(c?"</div>"+(r[0]>0&&A==r[1]-1?'<div class="ui-datepicker-row-break"></div>':""):""),L+=z}P+=L}return P+=w+($.browser.msie&&parseInt($.browser.version,10)<7&&!t.inline?'<iframe src="javascript:false;" class="ui-datepicker-cover" frameborder="0"></iframe>':""),t._keyEvent=!1,P},_generateMonthYearHeader:function(t,e,i,n,s,o,r,a){var l=this._get(t,"changeMonth"),c=this._get(t,"changeYear"),d=this._get(t,"showMonthAfterYear"),u='<div class="ui-datepicker-title">',h="";if(o||!l)h+='<span class="ui-datepicker-month">'+r[e]+"</span>";else{var p=n&&n.getFullYear()==i,m=s&&s.getFullYear()==i;h+='<select class="ui-datepicker-month" onchange="DP_jQuery_'+dpuuid+".datepicker._selectMonthYear('#"+t.id+"', this, 'M');\" >";for(var f=0;12>f;f++)(!p||f>=n.getMonth())&&(!m||f<=s.getMonth())&&(h+='<option value="'+f+'"'+(f==e?' selected="selected"':"")+">"+a[f]+"</option>");h+="</select>"}if(d||(u+=h+(!o&&l&&c?"":"&#xa0;")),!t.yearshtml)if(t.yearshtml="",o||!c)u+='<span class="ui-datepicker-year">'+i+"</span>";else{var _=this._get(t,"yearRange").split(":"),g=(new Date).getFullYear(),b=function(t){var e=t.match(/c[+-].*/)?i+parseInt(t.substring(1),10):t.match(/[+-].*/)?g+parseInt(t,10):parseInt(t,10);return isNaN(e)?g:e},k=b(_[0]),v=Math.max(k,b(_[1]||""));for(k=n?Math.max(k,n.getFullYear()):k,v=s?Math.min(v,s.getFullYear()):v,t.yearshtml+='<select class="ui-datepicker-year" onchange="DP_jQuery_'+dpuuid+".datepicker._selectMonthYear('#"+t.id+"', this, 'Y');\" >";v>=k;k++)t.yearshtml+='<option value="'+k+'"'+(k==i?' selected="selected"':"")+">"+k+"</option>";t.yearshtml+="</select>",u+=t.yearshtml,t.yearshtml=null}return u+=this._get(t,"yearSuffix"),d&&(u+=(!o&&l&&c?"":"&#xa0;")+h),u+="</div>"},_adjustInstDate:function(t,e,i){var n=t.drawYear+("Y"==i?e:0),s=t.drawMonth+("M"==i?e:0),o=Math.min(t.selectedDay,this._getDaysInMonth(n,s))+("D"==i?e:0),r=this._restrictMinMax(t,this._daylightSavingAdjust(new Date(n,s,o)));t.selectedDay=r.getDate(),t.drawMonth=t.selectedMonth=r.getMonth(),t.drawYear=t.selectedYear=r.getFullYear(),("M"==i||"Y"==i)&&this._notifyChange(t)},_restrictMinMax:function(t,e){var i=this._getMinMaxDate(t,"min"),n=this._getMinMaxDate(t,"max"),s=i&&i>e?i:e;return s=n&&s>n?n:s},_notifyChange:function(t){var e=this._get(t,"onChangeMonthYear");e&&e.apply(t.input?t.input[0]:null,[t.selectedYear,t.selectedMonth+1,t])},_getNumberOfMonths:function(t){var e=this._get(t,"numberOfMonths");return null==e?[1,1]:"number"==typeof e?[1,e]:e},_getMinMaxDate:function(t,e){return this._determineDate(t,this._get(t,e+"Date"),null)},_getDaysInMonth:function(t,e){return 32-this._daylightSavingAdjust(new Date(t,e,32)).getDate()},_getFirstDayOfMonth:function(t,e){return new Date(t,e,1).getDay()},_canAdjustMonth:function(t,e,i,n){var s=this._getNumberOfMonths(t),o=this._daylightSavingAdjust(new Date(i,n+(0>e?e:s[0]*s[1]),1));return 0>e&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(t,o)},_isInRange:function(t,e){var i=this._getMinMaxDate(t,"min"),n=this._getMinMaxDate(t,"max");return(!i||e.getTime()>=i.getTime())&&(!n||e.getTime()<=n.getTime())},_getFormatConfig:function(t){var e=this._get(t,"shortYearCutoff");return e="string"!=typeof e?e:(new Date).getFullYear()%100+parseInt(e,10),{shortYearCutoff:e,dayNamesShort:this._get(t,"dayNamesShort"),dayNames:this._get(t,"dayNames"),monthNamesShort:this._get(t,"monthNamesShort"),monthNames:this._get(t,"monthNames")}},_formatDate:function(t,e,i,n){e||(t.currentDay=t.selectedDay,t.currentMonth=t.selectedMonth,t.currentYear=t.selectedYear);var s=e?"object"==typeof e?e:this._daylightSavingAdjust(new Date(n,i,e)):this._daylightSavingAdjust(new Date(t.currentYear,t.currentMonth,t.currentDay));return this.formatDate(this._get(t,"dateFormat"),s,this._getFormatConfig(t))}}),$.fn.datepicker=function(t){if(!this.length)return this;$.datepicker.initialized||($(document).mousedown($.datepicker._checkExternalClick).find("body").append($.datepicker.dpDiv),$.datepicker.initialized=!0);var e=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!=t&&"getDate"!=t&&"widget"!=t?"option"==t&&2==arguments.length&&"string"==typeof arguments[1]?$.datepicker["_"+t+"Datepicker"].apply($.datepicker,[this[0]].concat(e)):this.each(function(){"string"==typeof t?$.datepicker["_"+t+"Datepicker"].apply($.datepicker,[this].concat(e)):$.datepicker._attachDatepicker(this,t)}):$.datepicker["_"+t+"Datepicker"].apply($.datepicker,[this[0]].concat(e))},$.datepicker=new Datepicker,$.datepicker.initialized=!1,$.datepicker.uuid=(new Date).getTime(),$.datepicker.version="@VERSION",window["DP_jQuery_"+dpuuid]=$}(jQuery),function(t,e){t(function(){t.datepicker.regional.ru={closeText:"Закрыть",prevText:"&#x3c;Пред",nextText:"След&#x3e;",currentText:"Сегодня",monthNames:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthNamesShort:["Янв","Фев","Мар","Апр","Май","Июн","Июл","Авг","Сен","Окт","Ноя","Дек"],dayNames:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],dayNamesShort:["вск","пнд","втр","срд","чтв","птн","сбт"],dayNamesMin:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],weekHeader:"Не",dateFormat:"dd.mm.yy",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},t.datepicker.setDefaults({changeMonth:!0,changeYear:!0,prevText:"&larr;",nextText:"&rarr;",yearRange:"c-10:c+10",showAnim:"",firstDay:1}),t.datepicker.setDefaults(t.datepicker.regional[e.params.locale])})}(jQuery,Lego),BEM.DOM.decl({block:"link",modName:"tree",modVal:"more"},{onSetMod:{js:function(){var t=this;this.__self._treeActionBlock||(this.__self._treeActionBlock=this.findBlockOutside("b-tree-action")),this.__self._spinner||(this.__self._spinner=this.__self._treeActionBlock.findBlockInside("spin")),this.on("click",function(){t._showLoader(),BEM.create("api-request",{_:"api-response",apiPath:".tree",urlParams:["for="+t.params.url+"&depth=0&width=100&show_redirects="+t.__self._treeActionBlock.params.show_redirects+"&show_grids="+t.__self._treeActionBlock.params.show_grids+"&show_files="+t.__self._treeActionBlock.params.show_files+"&show_titles="+t.__self._treeActionBlock.params.show_titles+"&subtree=1"],path:WikiHistory._getCorrectPath()}).run().then(t._onGotData.bind(t),t._onFailedData.bind(t))}),this.__base.apply(this,arguments)}},_onGotData:function(t){this._hideLoader(),BEM.DOM.before(this.domElem,BEMHTML.apply(t.data)),BEM.blocks["i-explainer"].explainLinks(this.__self._treeActionBlock),this.destruct()},_showLoader:function(){BEM.DOM.after(this.domElem,this.__self._spinner.domElem),this.__self._treeActionBlock.setMod("spinner","show"),this.__self._spinner.setMod("progress","yes"),this.__self._spinner.setMod("theme","gray-16")},_hideLoader:function(){BEM.DOM.append(this.__self._treeActionBlock.elem("wrapper"),this.__self._spinner.domElem),this.__self._treeActionBlock.delMod("spinner"),this.__self._spinner.delMod("progress"),this.__self._spinner.setMod("theme","gray-32")},_onFailedData:function(t){this.channel("errors").trigger("error",{node:this,content:{head:BEM.I18N("link","cant_load_subpages"),body:t.message}})},destruct:function(){this.un("click"),this.__base.apply(this,arguments)}}),BEM.DOM.decl("b-tree-action",{onSetMod:{js:function(){var t=this,e=this.findBlockOutside("b-tree-action");this._actionBlock=this.findBlockOutside("b-action"),this._subCommentsShowButton=this.findBlockInside({block:"button",modName:"type",modVal:"show-sub"}),this._createLoader(),this._subCommentsShowButton&&this._subCommentsShowButton.on("click",function(){t._showLoader(),BEM.create("api-request",{_:"api-response",apiPath:".tree",urlParams:["for="+(t.params.for||t.params.page||"")+"&depth=0&width=100&show_redirects="+e.params.show_redirects+"&show_grids="+e.params.show_grids+"&show_files="+e.params.show_files+"&show_titles="+e.params.show_titles+"&subtree=0"],path:WikiHistory._getCorrectPath()}).run().then(t._onGotData.bind(t),t._onFailedData.bind(t))})}},_createLoader:function(){BEM.DOM.append(this.elem("wrapper"),BEMHTML.apply({block:"spin"})),this._spinner=this.findBlockInside("wrapper","spin")},_showLoader:function(){this.setMod("spinner","show"),this._spinner.setMod("progress","yes")},_hideLoader:function(){this.delMod("spinner"),this._spinner.delMod("progress")},_onGotData:function(t){this._hideLoader(),BEM.DOM.replace(this.elem("wrapper"),BEMHTML.apply(t.data)),BEM.blocks["i-explainer"].explainLinks(this)},_onFailedData:function(t){this.channel("errors").trigger("error",{node:this,content:{head:BEM.I18N("b-tree-action","cant_open_subpages"),body:t.message}})}}),BEM.DOM.decl("b-popup-select",{onSetMod:{js:function(){var t=this.findBlockInside("dropdown");this.__buttonText=this.findBlockInside("button").elem("text"),t&&t.on("show hide",this._onDropdownShowHide,this),this.bindTo(this.elem("item"),"click",this._onPopupClick)}},_onPopupClick:function(t){var e,i=$(t.target).bem("awesome-icon"),n=i.getMod("icon");this.popup||(this.popup=this.findBlockOn(this.elem("item"),"popup")),this.prevAccess&&this.prevAccess.delMod("icon"),this.popup.findBlocksInside("b-popup-select-item").forEach(function(t){(e=t.findBlockInside({block:"awesome-icon",modName:"icon",modVal:"ok"}))&&e.delMod("icon")}),this.__buttonText.html(i.params.title),i.findBlockInside({block:"awesome-icon",modName:"type",modVal:"status"}).setMod("icon","ok"),this.prevAccess=i.findBlockInside({block:"awesome-icon",modName:"type",modVal:"status"}),this.prevAccess=i.findBlockInside({block:"awesome-icon",modName:"type",modVal:"status"}),this.popup.hide(),this.trigger("change",n)},_onDropdownShowHide:function(){this.toggleMod("state","open")}}),jQuery.fn.snicked=function(t){var e=this.snickedCore(),i={},n=[];return t&&(i=t.autocomplete,n=t.indentation),function(){var t={rule:null},n={next:function(e,i){var n=t.rule.points.shift(),s=e.val().length;return t.rule.offset+=s-t.rule.length,t.rule.length=s,i.start=n+t.rule.offset,i.end=i.start,e.setSelection(i),0==t.rule.points.length?(t.rule=null,!0):!0},start:function(e,i,s,o,r){var a,l,c,d,u,h=r.snippet,p=null,m=e.getIndentation(),f=h.split("\n"),_=s.match(r.before).concat(o.match(r.after));for(r.increment&&(a=parseInt(_[r.increment]),_[r.increment]=_[r.increment].replace(a,a+1)),r.orderedListLevelDown&&(l=_[1].length,c=("\n"+s).match(new RegExp("([^ ] {0,"+l+"})([\\w]+\\.|\\*) +.+\\n( {"+(l+2)+",}((\\*)|([\\w]+\\.)) *.*\\n*)+$")),c&&(a=parseInt(c[2]),a?(d=parseInt(_[2])||_[2],u="unnumbered"===r.orderedListLevelDown?a+1+".":a+1,_[2]=_[2].replace(d,u)):a||(_[2]=c[2]))),e.setBefore(i,s.replace(r.before,"")),e.setAfter(i,o.replace(r.after,"")),s=e.getBefore(i),o=e.getAfter(i),f=jQuery(f).map(function(t,e){return t?m+e:e}),h=f.get().join("\n"),t.rule={length:0,offset:0,selection:i,points:[]};p=h.match(/\{#([0-9]+)\}/);){var g=parseInt(p[1]);h=_[g]?h.replace(p[0],_[g]):h.replace(p[0],"")}for(;p=h.match(/\{\$[0-9]+\}/);)t.rule.points.push(h.indexOf(p[0])+s.length),h=h.replace(p[0],"");return t.rule.points.length?(e.insertBefore(i,h),t.rule.length=e.val().length,t.rule.position=s.length,n.next(e,i),!0):(s+=h,t.rule=null,e.setBefore(i,s),!0)}};e.addKeyHandler(function(e,s){var o=e.getSelection(),r=e.getBefore(o);if(!t.rule&&i.keys[s]){var a=i.keys[s],l=e.getAfter(o),c=!1;return jQuery(i.rules).each(function(t,i){return i.key!=a?!0:(i.before||(i.before=/$/),i.after||(i.after=/^/),i.before.test(r)&&i.after.test(l)?(c=n.start(e,o,r,l,i),!1):!0)}),c}return!1})}(),e},jQuery.fn.snickedCore=function(){var t=this;return t=t.map(function(){var t=jQuery(this);return t.getIndentation=function(){return t.selection.getPrecedingText().match(/(\t*).*$/).pop()},t.getSelection=function(){var e=t.get(0);return{start:e.selectionStart,end:e.selectionEnd}},t.setSelection=function(e){var i=t.get(0);i.selectionStart=e.start,i.selectionEnd=e.end},t.getAfter=function(e){t.get(0);return t.val().slice(e.end)},t.insertAfter=function(e,i){var n=t.getAfter(e);t.setAfter(e,i+n)},t.setAfter=function(e,i){var n=t.val().slice(0,e.end);t.val(n+i),t.setSelection(e)},t.getBefore=function(e){return t.val().slice(0,e.start)},t.insertBefore=function(e,i){var n=t.getBefore(e);t.setBefore(e,n+i)},t.setBefore=function(e,i){var n=t.val().slice(0,e.start),s=t.val().slice(e.start),o=n.length-i.length;e.start-=o,e.end-=o,t.val(i+s),t.setSelection(e)},t.selection={},t.selection.getRange=function(){var e=t.get(0);return{start:e.selectionStart,end:e.selectionEnd}},t.selection.setRange=function(e,i){var n=t.get(0);(!i||e>i)&&(i=e),n.selectionStart=e,n.selectionEnd=i},t.selection.getText=function(){var e=t.get(0);return t.val().slice(e.selectionStart,e.selectionEnd)},t.selection.setText=function(e){var i=t.selection.getPrecedingText(),n=t.selection.getFollowingText();t.val(i+e+n),t.selection.setRange(i.length,i.length+e.length)},t.selection.prependText=function(e){t.selection.setText(e+t.selection.getText())},t.selection.appendText=function(e){t.selection.setText(t.selection.getText()+e)},t.selection.getFollowingText=function(){var e=t.get(0);return t.val().slice(e.selectionEnd)},t.selection.setFollowingText=function(e){var i=t.selection.getRange(),n=t.val().slice(0,i.end);t.val(n+e),t.selection.setRange(i.start,i.end)},t.selection.getPrecedingText=function(){return t.val().slice(0,t.get(0).selectionStart)},t.selection.setPrecedingText=function(e){var i=t.selection.getRange(),n=t.val().slice(0,i.start),s=t.val().slice(i.end),o=n.length-e.length;t.val(e+s),t.selection.setRange(i.start-o,i.end-o)},t.selection.insertTextBefore=function(e){var i=t.selection.getPrecedingText();t.selection.setPrecedingText(i+e)},t.selection.insertTextAfter=function(e){var i=t.selection.getFollowingText();t.selection.setFollowingText(e+i)},t.changeHandlers=[],t.addChangeHandler=function(e){t.changeHandlers.push(e)},t.bind("change",function(e){var i=!1;return jQuery(t.changeHandlers).each(function(){return this(t,e)?(i=!0,!1):!0}),!i}),t.keyHandlers=[],t.addKeyHandler=function(e){t.keyHandlers.push(e)},t.bind("keypress",function(e){var i=e.keyCode|e.charCode|e.which,n=!1;return jQuery(t.keyHandlers).each(function(){return this(t,i,e)?(n=!0,!1):!0}),!n}),t.selectHandlers=[],t.addSelectHandler=function(e){t.selectHandlers.push(e)},t.bind("select",function(e){var i=!1;return jQuery(t.selectHandlers).each(function(){return this(t,e)?(i=!0,!1):!0}),!i}),t}),t.addChangeHandler=function(e){t.each(function(){this.addChangeHandler(e)})},t.addKeyHandler=function(e){t.each(function(){this.addKeyHandler(e)})},t.addSelectHandler=function(e){t.each(function(){this.addSelectHandler(e)})},t},jQuery.fn.snickedWackowiki=function(){jQuery(this).snicked({autocomplete:{keys:{9:"tab",13:"enter",32:"space",16:"star"},rules:[{key:"tab",before:/(\*\*)\s*$/,snippet:"{#1}{$0}{#1} {$1}"},{key:"tab",before:/(\/\/)\s*$/,snippet:"{#1}{$0}{#1} {$1}"},{key:"tab",before:/(__)\s*$/,snippet:"{#1}{$0}{#1} {$1}"},{key:"tab",before:/(##)\s*$/,snippet:"{#1}{$0}{#1} {$1}"},{key:"tab",before:/(\+\+)\s*$/,snippet:"{#1}{$0}{#1} {$1}"},{key:"tab",before:/(\-\-)\s*$/,snippet:"{#1}{$0}{#1} {$1}"},{key:"tab",before:/(\!\!)\s*$/,snippet:"{#1}({$0}){$1}{#1} {$2}"},{key:"tab",before:/(%%)\s*$/,snippet:"{#1}({$0}){$1}{#1} {$2}"},{key:"tab",before:/(\(\?)\s*$/,snippet:"(?{$0}=={$1}?) {$2}"},{key:"tab",before:/<{\s*$/,snippet:"\n<{ {$0}\n>} {$1}"},{key:"tab",before:/<#\s*$/,snippet:"<# {$0} #> {$1}"},{key:"tab",before:/\^\^\s*$/,snippet:"^^{$0}^^ {$1}"},{key:"tab",before:/""""vv\s*$/,snippet:'""""vv{$0}vv"""" {$1}'},{key:"tab",before:/vv\s*$/,snippet:"vv{$0}vv {$1}"},{key:"tab",before:/\*$/,snippet:"{#1}\n  * {$0}"},{key:"tab",before:/( {2,}\*.*?)\s*$/,snippet:"  {#1} {$0}"},{key:"enter",orderedListLevelDown:"unnumbered",before:/ {2}( {2,})(\*)\s*$/,snippet:"{#1}{#2} {$0}"},{key:"enter",before:/ {2}\*\s*$/,snippet:"{$0}"},{key:"enter",before:/( {2,})\*.*$/,snippet:"{#0}\n{#1}* {$0}"},{key:"tab",before:/(\D*)([0-9]+)$/,snippet:"{#1}\n  {#2}. {$0}"},{key:"tab",before:/( {2,}[\w]+\..*?)\s*$/,snippet:"  {#1} {$0}"},{key:"enter",orderedListLevelDown:"numbered",before:/ {2}( {2,})([\w]+\.)\s*$/,snippet:"{#1}{#2} {$0}"},{key:"enter",before:/ {2}[\w]+\.\s*$/,snippet:"{$0}"},{key:"enter",before:/(?:^|\n)( {2,})([\w]+\.).*$/,snippet:"{#0}\n{#1}{#2} {$0}",increment:2},{key:"tab",before:/( {2,}.*?)\s*$/,snippet:"  {#1}{$0}"},{key:"enter",before:/ {2}( {2,})$/,snippet:"{#1}{$0}"},{key:"enter",before:/ {2}$/,snippet:"{$0}"},{key:"enter",before:/(?:^|\n)( {2,}).*$/,snippet:"{#0}\n{#1}{$0}"}]}})},function(t){t.fn.splendid=function(i){var n=t.extend({},t.fn.splendid.defaults,i),r=c(n,{mods:{editor:"yes"},elemForContent:"data"}),d=c(n,{mods:{behaviour:"scrollable"},speller:!0}),u=c(n,{js:{directions:"bottom-right"}});return this.each(function(){var i={element:t(this),interactions:null,selection:{start:0,end:0,length:0},container:null,value:null};i.interactions=new t.fn.splendid.interactions(i.element),i.element.on("focusout",function(){i.selection=i.interactions.getSelection()}),t.each(n.buttons,function(){var c=this.params,h="",p="",m=function(m){if(m.preventDefault(),"keydown"!==m.type||i.element.is(":focus")){var f,_,g,b,k,v,y,M=n.buttons,w=[];if(i.selection=i.interactions.getSelection(),i.value=i.element.val(),n.editor&&(n.editor._oldState={text:i.value,selectionStart:i.selection.start,selectionEnd:i.selection.end}),Object.keys(M).forEach(function(t){M[t].params.wrap&&"none"===M[t].params.wrap&&w.push(M[t].params.before)}),f=c.before,_=c.after,g=i,b=g.value,k=g.selection,v=k.noneSelected,y=k.multiline,"selection"in c&&(h||(h=c.placeholder),c.placeholder=p?p:h,v||(b=l(k.start,k.end,b),b=a(c.placeholder,k.start,b),k.newStart=k.start,k.end=k.newEnd=k.start+c.placeholder.length)),"replace"in c&&(i.value=[b.slice(0,k.start),b.slice(k.end),c.replace].join("")),"toggle"in c){var x,E;if(x=o(k.currentLine.text,c.before),E=o(k.currentLine.text,c.toggle),x||E)if(!x&&E)if(y){var B;Object.keys(y).forEach(function(t,e){var i=y[t].text.indexOf(c.toggle),n=(c.toggle.length-c.before.length)*e;0===e&&(n=0),b=l(k.currentLine.start+y[t].start+i-n,k.currentLine.start+y[t].start+i+c.toggle.length-n,b),b=a(c.before,k.currentLine.start+y[t].start+i-n,b),B=k.currentLine.start+y[t].start+i-n+y[t].text.length-(c.toggle.length-c.before.length)}),k.newStart=k.currentLine.start+c.before.length,k.newEnd=B}else v?(b=e(b,v.start,c.before),k.newStart=v.start+c.before.length,k.newEnd=v.end+1):(b=l(k.currentLine.start,k.currentLine.start+c.toggle.length,b),b=a(c.before,k.currentLine.start,b),k.newStart=k.currentLine.start,k.newEnd=k.currentLine.end);else x&&!E&&(y?(k.newStart=k.currentLine.start+c.before.length,k.newEnd=k.currentLine.start+y[Object.keys(y).length].end+2):(k.newStart=k.currentLine.start+c.before.length,k.newEnd=k.currentLine.end+1));else"before"in c&&(v?(b=a(f,v.start,b),k.newStart=v.start+f.length,k.newEnd=v.end+f.length+1):y?(Object.keys(y).forEach(function(t,e){var i=0;!e&&y[t].rangeDiff>1&&(i=y[t].rangeDiff),b=a(f,k.currentLine.start+y[t].start+e*c.before.length+i,b),k.newEnd=k.end+(e+1)*c.before.length}),k.newStart=k.start+f.length):(b=a(f,k.currentLine.start,b),k.newStart=k.currentLine.start+f.length,k.newEnd=k.currentLine.end+f.length+1)),"placeholder"in c&&k.isEmptyLine&&(b=a(c.placeholder,k.start+f.length,b),k.newStart=k.start+f.length,k.newEnd=k.newStart+c.placeholder.length)}else{if("before"in c)if(v)"block"===c.type?(b=a(f,k.currentLine.start,b),k.newStart=k.currentLine.start+f.length):(b=a(f,k.start,b),k.newStart=v.start,k.newEnd=v.end+f.length+1);else if(y){var I=!1;Object.keys(y).forEach(function(t){w.forEach(function(e){var i,n=s(e,y[t].text);if(n&&(e=n[0]),i=y[t].text.indexOf(e),-1!==i){var o=f.length;t>=1&&(o=t*f.length+e.length-f.length),b=a(f,k.currentLine.start+y[t].start+i+o,b),I=!0}})}),I||(b=a(f,k.start,b),k.newStart=k.start+f.length,k.newEnd=k.end+f.length)}else{var S=!1;w.forEach(function(t){var e,i=s(t,k.text);if(i&&(t=i[0]),e=k.text.indexOf(t),-1!==e&&(S=!0,b=a(f,k.currentLine.start+e+t.length,b),k.newStart=k.currentLine.start+t.length+f.length,k.newEnd=k.currentLine.end+f.length+1),!S){var n=s(t,k.currentLine.text);n&&k.start<=k.currentLine.start+n[0].length-1&&(S=!0,b=a(f,k.currentLine.start+n[0].length,b))}}),S||(c.type&&"block"===c.type?(b=a(f,k.currentLine.start,b),k.newStart=k.currentLine.start+f.length,k.newEnd=k.currentLine.end+f.length):(b=a(f,k.start,b),k.newStart=k.start+f.length,k.newEnd=k.end+f.length))}"placeholder"in c&&v&&("block"!==c.type||"block"===c.type&&k.isEmptyLine)&&(b=a(c.placeholder,k.start+f.length,b),k.newStart=k.start+f.length,k.newEnd=k.newStart+c.placeholder.length)}if("after"in c)if(v){var D=0,N=c.placeholder?c.placeholder.length:0;k.start!==k.currentLine.end&&(D=1),"block"!==c.type?(b=a(_,k.start+f.length+N,b),k.newEnd=k.start+f.length+N):"block"===c.type&&k.isEmptyLine?(b=a(_,k.currentLine.end+f.length+N,b),k.newEnd=k.currentLine.end+f.length+N):(b=a(_,k.currentLine.end+f.length+D,b),k.newEnd=k.currentLine.end+f.length+D)}else if(y&&Object.keys(y).length>1){var I=!1;Object.keys(y).forEach(function(t){w.forEach(function(e){var i,n=s(e,k.text);if(n&&(e=n[0]),i=k.text.indexOf(e),-1!==i){var o=f.length+1;t==Object.keys(y).length?o=t*(f.length+_.length):t>1&&(o=t*(f.length+_.length)-1),b=a(_,k.currentLine.start+y[t].end+o,b),I=!0}})}),I||(b=a(_,k.newEnd,b))}else{var I=!1;w.forEach(function(t){if(!I){var e=s(t,k.currentLine.text);e&&k.start<=k.currentLine.start+e[0].length-1&&(I=!0,b=a(c.after,k.currentLine.end+(f?f.length:0)+1,b))}}),I||("\n"===b[k.newEnd-1]?(b=a(c.after,k.newEnd-1,b),k.newEnd-=1):"\n"===b[k.newEnd]&&"\n"===b[k.newEnd-1]?(b=a(c.after,k.newEnd-1,b),k.newEnd-=1):"block"===c.type?(b=a(c.after,k.currentLine.end+f.length+1,b),k.newEnd=k.currentLine.end+f.length+1):(b=a(c.after,k.end+f.length,b),k.newEnd=k.end+f.length))}if("add"in c){var T=c.add,C=T.length,O=k.currentLine.start,P=k.currentLine.end;if(y){var j=Object.keys(y),L=j.length;j.forEach(function(t,e){b=a(T,O+y[t].start+C*e,b)}),k.newStart=O+y[1].start,k.newEnd=O+y[L].end+L*C+2}else b=a(T,O,b),k.newStart=O,k.newEnd=P+C+1}if("del"in c){var A=c.del,F=A.length,O=k.currentLine.start,P=k.currentLine.end,$=0;if(y){var j=Object.keys(y),L=j.length;j.forEach(function(t){y[t].text.slice(0,F)===c.del&&(b=l(O+y[t].start-$*F,O+y[t].start-$*F+F,b),$++)}),k.newStart=O,k.newEnd=O+y[L].end-$*F+2}else b.slice(0,F)===c.del?(b=l(O,O+F,b),k.newEnd=P-F+1):k.newEnd=P+1,k.newStart=O}if("popup"in c){var H,z,R=c.popup.type||"";resultPopup="spell"===R?d:"other"===R?u:r,z=BEMHTML.apply({block:"m-editor-popup",js:{selection:t.extend(i.selection,{text:p})},mods:{editor:c.notEditor?"":"yes",type:R},data:c.data}),resultPopup.setContent(z),H=resultPopup.show(t(m.currentTarget)),"other"===R&&(i.element.splendid({buttons:H.findBlocksInside("button"),editor:n.editor}),i.interactions.setSelection(i.selection.start,i.selection.end)),H.on("onadd",function(t,e){k.length&&(b=l(k.start,k.end,b)),b=a(e,k.start,b),g.element.val(b),i.interactions.setSelection(k.start,k.start+e.length),resultPopup.hide()}),speller=H.findBlockInside("m-speller"),speller&&speller.on("change",function(t,e){g.element.val(e)})&&speller.on("cancel",function(){H.hide()})&&speller.check(g.element.val())}c.popup||(i.element.focus(),g.element.val(b),i.interactions.setSelection(i.selection.newStart,i.selection.newEnd))}};c.hotkey&&keymaster(c.hotkey.toLowerCase(),m),this.bindTo("mousedown",function(){var t=document.activeElement,e=t.selectionStart,i=t.selectionEnd,s=n.popupIsShown?n.prevSelection:"";p=t.value&&t.value.substring(e,i)?t.value.substring(e,i):s,n.prevSelection=p}),this.bindTo("click",m)})})},t.fn.splendid.interactions=function(t){this.splendid=t},t.fn.splendid.interactions.prototype.getPosition=function(){},t.fn.splendid.interactions.prototype.getSelection=function(){var t,e,n;if(selection={start:0,end:0,length:0,text:null,multiline:!1,multilineFullText:null,isEmptyLine:!1,noneSelected:!1,currentLine:!1},"number"==typeof this.splendid.get(0).selectionStart&&"number"==typeof this.splendid.get(0).selectionEnd)selection.start=this.splendid.get(0).selectionStart,selection.end=this.splendid.get(0).selectionEnd,selection.length=selection.end-selection.start;else{var s={range:document.selection.createRange(),normalized:this.splendid.val().replace(/\r\n/g,"\n"),selection:this.splendid.get(0).createTextRange(),endRange:this.splendid.get(0).createTextRange()};s.selection.moveToBookmark(s.range.getBookmark()),s.endRange.collapse(!1),s.selection.compareEndPoints("StartToEnd",s.endRange)>-1?(selection.start=selection.end=this.splendid.val().length,selection.length=selection.end-selection.start):(selection.start=-s.selection.moveStart("character",-this.splendid.val().length),s.selection.compareEndPoints("EndToEnd",s.endRange)>-1?selection.end=this.splendid.val().length:(selection.end=-s.selection.moveEnd("character",-this.splendid.val().length),selection.end+=s.normalized.slice(0,selection.end).split("\n").length-1),selection.length=selection.end-selection.start)
}return selection.currentLine=i(selection.start,this.splendid.val()),selection.currentLine.text=this.splendid.val().slice(selection.currentLine.start,selection.currentLine.end+1),void 0!==selection.start&&void 0!==selection.end&&selection.start===selection.end&&(stringRange=i(selection.start,this.splendid.val()),stringRange.start===stringRange.end&&(selection.isEmptyLine=!0),selection.noneSelected=stringRange),selection.text=this.splendid.val().slice(selection.start,selection.end),t=this.splendid.val().slice(0,selection.start),e=t.lastIndexOf("\n"),selection.text.match(/\n/g)&&(selection.multilineFullText=this.splendid.val().slice(e+1,selection.end),n=r(selection.multilineFullText,selection),n&&Object.keys(n).length>1&&(selection.multiline=r(selection.multilineFullText))),selection},t.fn.splendid.interactions.prototype.setSelection=function(t,e){if("number"==typeof this.splendid.get(0).selectionStart&&"number"==typeof this.splendid.get(0).selectionEnd)this.splendid.get(0).selectionStart=t,this.splendid.get(0).selectionEnd=e;else{var i={range:this.splendid.get(0).createTextRange()};i.range.collapse(!0),i.range.moveStart("character",t),i.range.moveEnd("character",e-t),i.range.select()}};var e=function(t,e,i){return t.substr(0,e)+i+t.substr(e+i.length)},i=function(t,e){var i,n,s=!0;for(moveLeft=t,moveRight=t,text=e,textLength=text.length,stoper=0;s;)void 0!==i&&void 0!==n&&(s=!1),void 0===i&&(moveLeft-=1,"\n"===text[moveLeft]?i=moveLeft+1:0>=moveLeft&&(i=0)),void 0===n&&(text[moveRight]&&"\n"!==text[moveRight]?(moveRight+=1,"\n"===text[moveRight]?n=moveRight-1:moveRight===textLength-1&&(n=moveRight)):n=moveRight),stoper>999999&&(s=!1,console.log('Some error "getCurrentStringByCursorPosition" function.')),stoper++;return{start:i,end:n}},n=function(t){return t.replace(/\d+/,"\\d+").replace(/\s/,"\\s").replace(/\*/,"\\*").replace(/\./,"\\.")},s=function(t,e){return new RegExp(n(t)).exec(e)},o=function(t,e){return-1!==t.indexOf(e)?!0:!1},r=function(t){var e=1,i={},n="";return tempStart=0,tempEnd=0,lettersArray=t.split(""),tempRange=null,lettersArray.forEach(function(s,o){if(null===tempRange&&"\n"===s){for(var r=0;"\n"===lettersArray[o+r];)r++;tempRange=r}n+=s,n.replace(/\n/g,"")&&("\n"===s||o===t.length-1)&&(tempEnd=o,i[e]={rangeDiff:tempRange,text:n.replace(/\n/gi,""),start:tempStart?tempStart+1:tempStart,end:tempEnd-1},n="",e++,tempStart=o)}),Object.keys(i).length?i:!1},a=function(t,e,i){return i.slice(0,e).concat(t,i.slice(e))},l=function(t,e,i){return i.slice(0,t)+i.slice(e)},c=function(e,i){if(!n)var n=t(BEMHTML.apply({block:"popup",mods:i.mods,js:i.js,content:[{elem:"tail"},{elem:"content",attrs:i&&i.speller?{style:"padding: 0"}:{},content:{}}]})).bem("popup");return n.on("hide",function(){e.popupIsShown=!1}),{setContent:function(t){BEM.DOM.update(n.elem(i.elemForContent||"content"),t)},show:function(t){return n.domElem.find("input,textarea").eq(0).focus(),n.show(t)},hide:function(){return n.un("onadd").hide()},popup:function(){return n}}};t.fn.splendid.defaults={container:'<ul class="splendid-container">',buttons:'<li class="splendid-button">',maps:{},generate:!1}}(jQuery),BEM.DOM.decl({block:"popup",modName:"editor",modVal:"yes"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._addButton=this.findBlockInside({block:"button",modName:"action",modVal:"add"}),this._cancelButton=this.findBlockInside({block:"button",modName:"action",modVal:"cancel"}),this._onAdd(),this._onCancel()}},_onAdd:function(){this._addButton.on("click",function(){outputString=this.findBlockInside("m-editor-popup").getText(),this.trigger("onadd",outputString)},this)},_onCancel:function(){this._cancelButton.on("click",function(){this.hide()},this)}}),BEM.DOM.decl({block:"popup",modName:"behaviour",modVal:"scrollable"},{getDefaultParams:function(){var t=this.__base();return t.top=20,t}}),BEM.DOM.decl({block:"popup",modName:"wrapped",modVal:"yes"},{onSetMod:{visibility:{visible:function(){this.__base(),this._wrap()},"":function(){this.__base(),this._unwrap()}},wrapped:{"":function(){this._unwrap()}}},_wrap:function(){this._wrapper||(this._wrapper=this.elem("wrapper").detach()),this._wrapper&&this.domElem.wrap(this._wrapper)},_unwrap:function(){this._wrapper&&this.domElem.unwrap()},destruct:function(){this._unwrap(),this.__base()}}),function(){var t={};BEM.DOM.decl({block:"popup",modName:"body-scroll",modVal:"no"},{onSetMod:{visibility:function(){return this.afterCurrentEvent(function(){this.domElem&&this.hasMod("visibility","visible")?t[this.params.uniqId]=!0:delete t[this.params.uniqId],this._manageScopeOverflow()}),this.__base()}},destruct:function(){var e=this.params.uniqId;t[e]&&(delete t[e],this._manageScopeOverflow()),this.__base.apply(this,arguments)},_enableScroll:function(){return this._scope.css({overflow:""}),this},_disableScroll:function(){return this._scope.css({overflow:"hidden"}),this},_manageScopeOverflow:function(){var e=Object.keys(t).length;0===e?this._enableScroll():1===e&&this._disableScroll()}})}(),BEM.DOM.decl({block:"m-editor-popup"},{processParams:function(){return""},getText:function(){var t,e,i={},n=this.findBlocksInside("input").concat(this.findBlocksInside("select"));return n.forEach(function(n){t=n.findElem("control").val(),e=n.findElem("control").attr("name"),t&&(i[e]=t)}),this.processParams(i)}}),BEM.DOM.decl({block:"m-editor-popup",modName:"type",modVal:"link"},{processParams:function(t){var e,i="";return e=$.extend({},{pathToLink:"",linkText:""},t),i=e.pathToLink&&e.linkText?e.pathToLink+" "+e.linkText:e.pathToLink+e.linkText,i&&(i="(("+i+"))"),i}}),BEM.DOM.decl({block:"m-editor-popup",modName:"type",modVal:"picture"},{onSetMod:{js:function(){var t=this.findBlockInside({block:"input",modName:"picture",modVal:"width"}),e=this.findBlockInside({block:"input",modName:"picture",modVal:"height"});t.bindTo("input",BEM.blocks["mi-helpers"].validateNumberOnlyInput),e.bindTo("input",BEM.blocks["mi-helpers"].validateNumberOnlyInput)}},processParams:function(t){var e,i="";return e=$.extend({},{pictureWidth:0,pictureHeight:0,pictureLink:""},t),e.pictureLink&&(i=e.pictureLink,(e.pictureWidth||e.pictureHeight||!/\.jpg$|png$|gif$/.test(e.pictureLink))&&(i=e.pictureWidth+"x"+e.pictureHeight+":"+i)),i}}),BEM.DOM.decl({block:"m-editor-popup",modName:"type",modVal:"code"},{processParams:function(t){var e,i="";return e=$.extend({},{codeStyle:"",codeText:""},t),e.codeStyle&&(i="("+e.codeStyle+")"),i="%%"+i+"\n"+e.codeText+"\n%%"}}),BEM.DOM.decl({block:"m-speller"},{onSetMod:{js:function(){this._storage=this._getLocalStorage(),this._initUserOptions(),this._bindEvents()}},destruct:function(t){delete this._cashedBlocks,this._getBlockInside("select").un("change"),this._getBlockInside("button","type","ignore-once").un("click"),this._getBlockInside("button","type","replace").un("click"),this._getBlockInside("button","type","params").un("click"),this._getBlockInside("button","type","cancel").un("click"),this._getBlockInside("input","type","error").un("change"),this._getBlockInside("button","type","user-dict").un("click"),this._getBlockInside("input","role","dict").un("change"),BEM.blocks.checkbox.un(this.domElem,"change",this._onCheckBoxChange,this),this.findBlocksInside("check-button").forEach(function(t){t.un("change")}.bind(this)),this.__base(t)},_initUserOptions:function(){this._storage["yandex.useropt"]||(this._storage["yandex.useropt"]=JSON.stringify({"ignore-uppercase":!1,"ignore-digits":!1,"ignore-urls":!1,"find-repeat":!1,lang:"ru"})),this._storage["yandex.userdic"]||(this._storage["yandex.userdic"]=""),this._optionsCodes={"ignore-uppercase":1,"ignore-digits":2,"ignore-urls":4,"find-repeat":8},this._setOptionsFromStorageToUI()},_bindEvents:function(){this._getBlockInside("select").on("change",function(){var t=this._getUserOptions(),e=this._getBlockInside("select").val();t.lang=e,this._getBlockInside("select").findBlockInside("button").findElem("text").text(BEM.I18N("m-speller",e)),this._setUserOption("lang",t.lang)}.bind(this)),this._getBlockInside("button","type","ignore-once").on("click",this._goToNextError,this),this._getBlockInside("button","type","replace").on("click",this._replace,this),this._getBlockInside("button","type","cancel").on("click",this._cancel,this),this._getBlockInside("button","type","params").on("click",this._toogleAdditionalOptions,this),this._getBlockInside("input","type","error").on("change",this._inputChanged,this),this._getBlockInside("button","type","user-dict").on("click",this._showUserDict,this),this._getBlockInside("input","role","dict").on("change",this._setUserDict,this),BEM.blocks.checkbox.on(this.domElem,"change",this._onCheckBoxChange,this)},_onCheckBoxChange:function(t,e){var i=["ignore-uppercase","ignore-digits","ignore-urls","find-repeat"],n=t.block.getMod("type");i.indexOf(n)>=0&&this._setUserOption(n,e.checked)},check:function(t){t?(this._inputText=t,this._sendRequest(this._getUserOptions())):this._finish()},_sendRequest:function(t){$.get("//speller.yandex.net/services/spellservice.json/checkText",{text:this._inputText,lang:t.lang,options:this._getOptionsHash()},this._processErrors.bind(this),"json")},_processErrors:function(t){return t.length?(this.delMod("finished"),this.delMod(this.elem("flex-container","hide-in-finish","yes"),"hidden"),this._offset=0,this._errorsArray=t,this._goToNextError(0),void 0):(this._finish(),void 0)},_goToNextError:function(t){var e,i,n,s,o=this._storage["yandex.userdic"].split(" ");if(this._inputText){if(this._currentErrorIndex="number"==typeof t?t:void 0!==this._currentErrorIndex?this._currentErrorIndex+1:0,this._currentErrorIndex>this._errorsArray.length-1)return this._finish(),void 0;if(s=this._errorsArray[this._currentErrorIndex],s.needToReplace)return this._replace(),void 0;if(n=this._getRemainingErrorsCount(o),this.elem("status").html($(BEMHTML.apply([{block:"m-speller",elem:"main-text",content:BEM.I18N("m-speller","checked")+", "+BEM.I18N("m-speller","recommended")+" "},{block:"m-speller",elem:"main-text",mix:{block:"m-speller",elem:"attention"},content:n+" "+this._getCorrectonForm(n)}]))),o.indexOf(s.word)>=0)return this._goToNextError(),void 0;this._getBlockInside("input","type","error").val(s.word),e=$(BEMHTML.apply({block:"m-speller",elem:"text",before:this._inputText.slice(s.pos>90?s.pos-40:0,s.pos+this._offset),word:s.word,after:this._inputText.substr(s.pos+this._offset+s.len,this._inputText.length)})),this._getBlockInside("island","role","input-text").domElem.html(e),i=this._getBlockInside("island","role","correction-options"),BEM.DOM.update(i.domElem,""),s.s.length?(this._getBlockInside("button","type","replace").delMod("disabled"),s.s.forEach(function(t,e){4>=e&&BEM.DOM.append(i.domElem,BEMHTML.apply({block:"check-button",mods:{size:"xs",theme:"clear",checked:0===e?"yes":""},mix:[{block:"m-speller",elem:"check-button"}],content:t}))}.bind(this))):(this._getBlockInside("button","type","replace").setMod("disabled","yes"),BEM.DOM.append(i.domElem,BEMHTML.apply({block:"check-button",mods:{size:"xs",theme:"clear",role:"not-options"},mix:[{block:"m-speller",elem:"check-button"}],content:"( "+BEM.I18N("m-speller","options-not-found")+" )"}))),BEM.DOM.append(i.domElem,BEMHTML.apply({block:"check-button",mods:{size:"xs",theme:"clear",role:"add-to-dict"},mix:[{block:"m-speller",elem:"check-button"}],content:{block:"m-speller",elem:"add-to-dict"}})),this._bindEventsOnCorrectionOptions()}},_getRemainingErrorsCount:function(t){for(var e=this._errorsArray.length-this._currentErrorIndex,i=this._currentErrorIndex;i<this._errorsArray.length;i++)t.indexOf(this._errorsArray[i].word)>=0&&e--;return e},_getCorrectonForm:function(t){var e="correction",i=t%10;return 1===i?e+="1":i>1&&5>i&&(e+="2"),BEM.I18N("m-speller",e)},_bindEventsOnCorrectionOptions:function(){var t=this;this.bindTo(this.findElem("check-button"),"click",function(e){var i=this.findBlockOn(e.data.domElem,"check-button"),n=i.getMod("role");"add-to-dict"===n?t.afterCurrentEvent(t._addToLocalDictionaty,t):(this.findBlockInside({block:"island",modName:"role",modVal:"correction-options"}).findBlocksInside("check-button").forEach(function(t){t.delMod("checked")}.bind(this)),"not-options"!==n&&i.setMod("checked","yes"))})},_getBlockInside:function(t,e,i){var n,s=t+"_"+e+"_"+i;return this._cashedBlocks||(this._cashedBlocks={}),this._cashedBlocks[s]?this._cashedBlocks[s]:(n=this.findBlockInside({block:t,modName:e,modVal:i}),this._cashedBlocks[s]=n,n)},_showUserDict:function(){this._getBlockInside("userdict").delMod("hidden"),this._getBlockInside("button","type","user-dict").setMod("hidden","yes"),this._setDictionaryFromStorageToUI()},_hideUserDict:function(){this._getBlockInside("userdict").setMod("hidden","yes"),this._getBlockInside("button","type","user-dict").delMod("hidden")},_setUserDict:function(){var t=this._getBlockInside("input","role","dict").val();this._storage["yandex.userdic"]=t.replace(new RegExp(/[\n,\r]+/g)," ").replace(new RegExp(/\s+/g)," ").trim()},_inputChanged:function(){if(this._inputText&&"yes"!==this.getMod("finished")){var t=this._errorsArray[this._currentErrorIndex];this._getBlockInside("input","type","error").val()!==t.word?this._getBlockInside("button","type","replace").delMod("disabled"):this._getBlockInside("button","type","replace").setMod("disabled",t.s.length?"":"yes")}},_setUserOption:function(t,e){var i=this._getUserOptions();i[t]!==e&&(i[t]=e,this._setUserOptions(i),this._inputText&&this._sendRequest(this._getUserOptions()))},_toogleAdditionalOptions:function(){var t=this.findElem("options"),e="yes"!==this.getMod(t,"hidden");this.setMod(t,"hidden",e?"yes":""),this._getBlockInside("button","type","params").findElem("text").text(e?BEM.I18N("m-speller","params"):BEM.I18N("m-speller","hideparams")),e&&this._hideUserDict()},_setOptionsFromStorageToUI:function(){var t=this._getUserOptions();Object.keys(t).forEach(function(e){"lang"!==e&&this._getBlockInside("checkbox","type",e).setMod("checked",t[e]?"yes":"")}.bind(this)),this._getBlockInside("select").val(t.lang),this._getBlockInside("select").findBlockInside("button").findElem("text").text(BEM.I18N("m-speller",t.lang))},_setDictionaryFromStorageToUI:function(){this._getBlockInside("input","role","dict").val(this._getLocalDictionary())},_getLocalDictionary:function(){return this._storage["yandex.userdic"]},_getUserOptions:function(){return JSON.parse(this._storage["yandex.useropt"])},_getOptionsHash:function(){var t=0,e=this._getUserOptions();return Object.keys(e).forEach(function(i){e[i]===!0&&(t+=this._optionsCodes[i])}.bind(this)),t},_setUserOptions:function(t){return t?(this._storage["yandex.useropt"]=JSON.stringify(t),void 0):(this._storage["yandex.useropt"]=JSON.stringify({"ignore-uppercase":!1,"ignore-digits":!1,"ignore-urls":!1,"find-repeat":!1,lang:"ru"}),void 0)},_addToLocalDictionaty:function(){if(this._inputText){var t=this._errorsArray[this._currentErrorIndex].word;this._storage["yandex.userdic"]+=(this._storage["yandex.userdic"]?" ":"")+t,this._setDictionaryFromStorageToUI(),this._goToNextError()}},_getValueToReplace:function(t){var e,i=this._getBlockInside("input","type","error");return e=i.val()===t?this._getBlockInside("island","role","correction-options").findBlockInside({block:"check-button",modName:"checked",modVal:"yes"}).val():i.val()},_replace:function(){var t=this._errorsArray[this._currentErrorIndex],e=t.word,i=t.needToReplace||this._getValueToReplace(e);this._inputText&&(this._inputText=this._inputText.substr(0,t.pos+this._offset)+this._inputText.substr(t.pos+this._offset+t.len),this._inputText=this._inputText.slice(0,t.pos+this._offset)+i+this._inputText.slice(t.pos+this._offset),this._offset+=i.length-e.length,this.trigger("change",this._inputText),this._goToNextError())},_replaceAll:function(){var t=this._errorsArray[this._currentErrorIndex],e=this._getValueToReplace(t.word);this._inputText&&(this._errorsArray.forEach(function(i){i.word===t.word&&(i.needToReplace=e)}.bind(this)),this._replace())},_finish:function(){this.setMod("finished","yes"),this._clearUI(),this.elem("status").html($(BEMHTML.apply([{block:"m-speller",elem:"main-text",content:BEM.I18N("m-speller","checked")+",  "},{block:"m-speller",elem:"corrections-not-found"}]))),this.setMod(this.elem("flex-container","hide-in-finish","yes"),"hidden","yes"),"yes"===this.getMod(this.elem("options"),"hidden")&&this._toogleAdditionalOptions()},_cancel:function(){this.trigger("cancel")},_clearUI:function(){this._getBlockInside("input","type","error").val(""),BEM.DOM.update(this._getBlockInside("island","role","input-text").domElem,""),BEM.DOM.update(this._getBlockInside("island","role","correction-options").domElem,"")},_getLocalStorage:function(){return window.localStorage?window.localStorage:window.globalStorage[document.domain]}}),BEM.DOM.decl("m-editor",{init:function(t){var e,i,n,s=[],o=[],r=this.params.buttons||[],a=["separator","color","underline","indent","outdent","ul","ol","table","quote","h3","h2","italic","strikethrough","bold"],l=0,c=this.domElem.outerWidth()-60;if(this._buttonsContent=[],this._pageEditorButtons=t||this.findBlockOn("m-editor-buttons"),r.forEach(this._getButtonsBemjson.bind(this)),this._buttonsContent.length&&BEM.DOM.update(this._pageEditorButtons.domElem,BEMHTML.apply(this._buttonsContent)),this._textarea=this.findBlockInside({block:"input",modName:"editor",modVal:"wiki"}),this._historyStack=[],keymaster("command+z, ctrl+z",function(t){var e;t.preventDefault(),this._historyStack.length>0&&"yes"===this._textarea.getMod("focused")&&(e=this._historyStack.pop(),this._flag=!0,this._textarea.val(e.text),this._textarea.findElem("control")[0].setSelectionRange(e.selectionStart,e.selectionEnd))}.bind(this)),BEM.blocks.button.on(this._pageEditorButtons.domElem,"oldState",function(t,e){this._oldState=e}.bind(this)),this._textarea.bindTo("keydown",function(){this._oldState={text:this._textarea.val(),selectionStart:this._textarea.findElem("control")[0].selectionStart,selectionEnd:this._textarea.findElem("control")[0].selectionEnd}}.bind(this)),this._textarea.on("change",function(){if(this._flag)this._flag=!1;else{if(this._keydownTimeoutId)clearTimeout(this._keydownTimeoutId);else for(this._oldState&&this._historyStack.push(this._oldState);this._getStackLength(this._historyStack)>1e5;)this._historyStack.shift();this._keydownTimeoutId=setTimeout(function(){this._keydownTimeoutId=null}.bind(this),300)}},this),this._pageEditorButtons.domElem.children().map(function(t,e){l+=$(e).outerWidth()+10,o.push($(e).outerWidth())}),l>c&&a.length){for(i=l;i>c;)e=a.shift(),n=this._findButtonInGroups(e,r),n&&(s.unshift(e),r[n.groupIndex].splice(n.buttonIndex,1),i-=$($(this._pageEditorButtons.domElem.children()[n.groupIndex]).children()[n.buttonIndex]).outerWidth());r[r.length-1].push({type:"other",data:s}),this._buttonsContent=[],r.forEach(this._getButtonsBemjson.bind(this)),this._buttonsContent.length&&BEM.DOM.update(this._pageEditorButtons.domElem,BEMHTML.apply(this._buttonsContent))}this._textarea.elem("control").snickedWackowiki(),this._textarea.elem("control").splendid({buttons:this._pageEditorButtons.findBlocksInside("button"),editor:this})},_findButtonInGroups:function(t,e){var i=!1;return e.forEach(function(e,n){e.forEach(function(e,s){t===e&&(i={groupIndex:n,buttonIndex:s})})}),i},_getStackLength:function(t){var e=0;return t.forEach(function(t){e+=t.text.length}),e},_getButtonsBemjson:function(t){var e,i,n=[];t.forEach(function(s,o,r){e="",i="none",r.length>1?0===o?(e="left",i=!0):o==t.length-1&&(e="right",i=!0):i=!0,n.push({block:"m-editor-button",mods:{type:"object"!=typeof s?s:s.type,side:e,round:i},data:s.data})}),this._buttonsContent.push({block:"m-editor-buttons",elem:"group",content:n})},setDataToEditor:function(t){this._textarea.elem("control").val(t)},getEditorData:function(){return this._textarea.elem("control").val()}}),BEM.DOM.decl({block:"m-editor",modName:"type",modVal:"edit-page"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._bPage=this.findBlockOutside("b-page"),this._textarea=this.findBlockInside({block:"input",modName:"type",modVal:"textarea"}),this._localStorage=BEM.blocks["mi-storage"],this._textarea.on("change",this._saveToDraft,this)}},_isDraftExist:function(){if(this._saveParams){if(this._localStorage.getItem("#"+WikiHistory._getCorrectPath()+this._saveParams.section))return!0}else if(this._localStorage.getItem("#"+WikiHistory._getCorrectPath()))return!0;return!1},_saveToDraft:function(){var t=this._textarea.elem("control").val(),e=!0;if(this._editorWikiData!==t)try{this._saveParams?this._localStorage.setItem("#"+WikiHistory._getCorrectPath()+this._saveParams.section,t):(e=this._localStorage.setItem("#"+WikiHistory._getCorrectPath(),t),e||(this._storageOverdraft=!0))}catch(i){"QuotaExceededError"==i.name||"NS_ERROR_DOM_QUOTA_REACHED"==i.name?localStorage._ajaxTickets?(localStorage._ajaxTickets="",this._saveToDraft()):console.error("localStorage переполнен",i):console.error("Проблемы с localStorage",i)}},_getDraft:function(){if(this._saveParams){if(this._localStorage.getItem("#"+WikiHistory._getCorrectPath()+this._saveParams.section))return this._localStorage.getItem("#"+WikiHistory._getCorrectPath()+this._saveParams.section)}else if(this._localStorage.getItem("#"+WikiHistory._getCorrectPath()))return this._localStorage.getItem("#"+WikiHistory._getCorrectPath())},_deleteDraft:function(){this._saveParams?this._localStorage.removeItem("#"+WikiHistory._getCorrectPath()+this._saveParams.section):this._localStorage.removeItem("#"+WikiHistory._getCorrectPath())},setDataToEditor:function(t,e){this._editorWikiData=t,e&&(this._saveParams=e),this._textarea.elem("control").val(t),this._isDraftExist()&&confirm(BEM.I18N("m-editor","unsaved_changes"))&&this._textarea.elem("control").val(this._getDraft())},_close:function(){this._bPage.hasMod("editor")?this._bPage.delMod("editor"):this._bPage.hasMod("new-page")&&this._bPage.delMod("new-page"),this._bPage.setMod("revision",""),WikiHistory._removeState(),WikiHistory._clearUrl()}}),BEM.blocks["mi-storage"]=function(){var t=null;try{t=window.localStorage}catch(e){}return{setItem:function(e,i){try{return t.setItem(e,i),!0}catch(n){if(this.removeItem(e))try{return t.setItem(e,i),!0}catch(n){this._errorHandler(n)}this._errorHandler(n)}return!1},getItem:function(e){try{return t.getItem(e)}catch(i){this._errorHandler(i)}return null},clear:function(){try{return t.clear(),!0}catch(e){this._errorHandler(e)}return!1},removeItem:function(e){try{return t.removeItem(e),!0}catch(i){this._errorHandler(i)}return!1},length:function(){try{return t.length}catch(e){this._errorHandler(e)}return 0},key:function(e){try{return t.key(e)}catch(i){this._errorHandler(i)}return""},_errorHandler:function(){}}}(),BEM.blocks["mi-storage"]._errorHandler=function(t){throw Raven.captureException(t,{tags:{type:"localStorage"}}),t},BEM.DOM.decl("b-wiki-form",{_files:[],onSetMod:{js:function(){var t=this,e=[],i={block:"b-wiki-form",elem:"form",content:e};this._requiredFields=[],this._formId=this.params.attrs&&this.params.attrs.count,this._bPage=this.findBlockOutside("b-page"),this._bContent=this._bPage.findBlockInside("b-content"),this._mainDoc=this._bContent&&this._bContent.findBlockInside({block:"wiki-doc",modName:"status",modVal:"main"}),this.params.data&&this.params.data.title&&e.push({elem:"title",content:this.params.data.title}),this.params.data&&this.params.data.fields?(this.params.data.fields.forEach(function(i){t["_"+i.type+"BEMJSON"]?e.push(t["_"+i.type+"BEMJSON"](i)):console.error("Новый элемент формы. Или переименовали тип.",i.type,i)}),e.push(this._submit(this.params.data.submit)),BEM.DOM.append(this.domElem,BEMHTML.apply(i)),this._button=this.findBlockInside({block:"button",modName:"type",modVal:"form-submit"}),this._spinner=this.findBlockInside("spin"),this._button.bindTo("click",this._submitForm.bind(this)),BEM.channel("wiki-form").on("error",function(t,e){this.channel("errors").trigger("error",this._getErrorData(e.text,e.node))}.bind(this))):(this.params.data&&e.push(this._formRenderError(this.params.data)),BEM.DOM.append(this.domElem,BEMHTML.apply(i)))}},_formRenderError:function(t,e){var i,n,s,o=t.message||t.arg||t.wikiform_error_code,r=this.__self._getErrorTypes(t.wikiform_error_code)||this.__self._getErrorTypes("UNKNOWN");return"MISSING_PAGE"===t.wikiform_error_code&&(o=t.arg),s=r.replace("%s",o),n=e?s:this._escapeString(s),i=e?n:{block:"b-wiki-form-field",mods:{type:"form-error"},content:n}},_infoBEMJSON:function(t){return{block:"b-wiki-form",elem:"info",content:[{elem:"label",content:t.title},{elem:"info-text",content:t.text}]}},_stringBEMJSON:function(t){var e=this._fieldWrapper(t,[{block:"input",mods:{size:"s",assigned:"form"},mix:[{block:"b-form-field-getter"}],name:t.name,value:t.value,js:{required:t.attrs.required},content:[{elem:"control"}]}]);return this._extendFields(t,e),this._isRequired(t,e),e},_textBEMJSON:function(t){var e=this._fieldWrapper(t,[{block:"input",mods:{type:"textarea",size:"s",assigned:"form"},mix:[{block:"b-form-field-getter"}],js:{required:t.attrs.required},name:t.name,value:t.value,content:[{elem:"control"}]}]);return this._extendFields(t,e),this._isRequired(t,e),e},_selectBEMJSON:function(t){var e,i=[];return t.params.options.forEach(function(t){i.push({elem:"option",attrs:{value:t.key},content:t.value})}),i[0]&&(i[0].attrs.selected="selected"),e=t.attrs.multiple?this._fieldWrapper(t,[{block:"select-multiple",name:t.name,mods:{assigned:"form"},js:{required:t.attrs.required},mix:[{block:"b-form-field-getter"}],content:i}]):this._fieldWrapper(t,[{block:"select",name:t.name,mods:{size:"m",layout:"content",theme:"normal",assigned:"form"},js:{required:t.attrs.required},mix:[{block:"b-form-field-getter"}],content:[{block:"button",content:i[0]&&i[0].content},{elem:"control",content:i}]}]),this._extendFields(t,e),this._isRequired(t,e),e},_staffBEMJSON:function(t){var e;return t.mods={special:"suggest"},e=this._fieldWrapper(t,[{block:"m-suggest",mix:[{block:"b-form-field-getter"}],mods:{type:"multicomplete",size:"m",assigned:"form"},inputAttrs:{name:t.name,value:t.value||""},multiple:t.params.multiple,js:{required:t.attrs.required},types:[{name:"staff",maxCount:10}]}]),this._extendFields(t,e),this._isRequired(t,e),e},_groupBEMJSON:function(t){var e;return t.mods={special:"suggest"},e=this._fieldWrapper(t,[{block:"m-suggest",mix:[{block:"b-form-field-getter"}],mods:{type:"groups",size:"m",assigned:"form"},inputAttrs:{name:t.name,value:t.value||""},multiple:t.params.multiple,js:{required:t.attrs.required},types:t.params.group}]),this._extendFields(t,e),this._isRequired(t,e),e},_checkboxBEMJSON:function(t){var e=1==t.value||1==t.value?"yes":void 0,i=this._fieldWrapper(t,[{block:"checkbox",mods:{size:"m",assigned:"form",checked:e},mix:[{block:"b-form-field-getter"}],checkboxAttrs:{name:t.name},value:t.value,js:{required:t.attrs.required}}]);return this._extendFields(t,i),this._isRequired(t,i),i},_dateBEMJSON:function(t){var e=1e3*t.value,i=t.value?BEM.blocks["mi-helpers"].getHumanStringFromDate({date:new Date(e)}):"",n=this._fieldWrapper(t,[{block:"m-calendar",mods:{toggler:"input",type:"month",assigned:"form"},mix:[{block:"b-form-field-getter"}],js:{defaultText:BEM.I18N("b-wiki-form","choose_date"),required:t.attrs.required,value:i,autoclose:!0},attrs:{name:t.name},size:"m",theme:"grey"}]);return this._extendFields(t,n),this._isRequired(t,n),n},_numberBEMJSON:function(t){var e=this._fieldWrapper(t,[{block:"input",name:t.name,mods:{size:"s",type:"number",assigned:"form"},js:{required:t.attrs.required},value:t.value,mix:[{block:"b-form-field-getter"}],content:[{elem:"control"}]}]);return this._extendFields(t,e),this._isRequired(t,e),e},_fileBEMJSON:function(t){var e=this._fieldWrapper(t,[{block:"m-uploader",mods:{type:"form",assigned:"form"},js:{autoupload:"yes",url:"/.upload",dropzone:"no",holder:!0,controls:["close"],required:t.attrs.required},name:t.name}]);return this._extendFields(t,e),this._isRequired(t,e),e},_submit:function(t){return{elem:"buttons",content:[{block:"spin",js:!0,mods:{theme:"gray-16"}},{block:"button",mods:{size:"m",theme:"action",type:"form-submit"},type:"submit",content:t||BEM.I18N("b-wiki-form","send")}]}},_submitForm:function(t){t.preventDefault(),this._fields||(this._fields=this.findBlocksInside("b-wiki-form-field")),this._clearErrors(),this._validateOnRequired()&&(this._spinner.setMod("progress","yes"),this._button.setMod("disabled","yes"),BEM.create("api-request",{_:"api-response",apiPath:".form",method:"POST",data:{__formId:this._formId,fields:this._getFieldsData(),files:this._files},urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this)))},_validateOnRequired:function(){var t,e=!0;return this._requiredFields.forEach(function(i){var n=i.__self.getName();switch(n){case"select":t=i.findBlockInside("select").val();break;case"select-multiple":t=i.domElem.val()[0];break;case"m-suggest":t=i.val();break;case"m-calendar":t=i.findBlockInside("input").val();break;case"m-uploader":t=i.findBlockInside("attach").val();break;case"checkbox":t=i.isChecked();break;default:t=i.elem("control").val()}t||(i._formField||(i._formField=i.findBlockOutside("b-wiki-form-field")),i._formField.setMod("validation","error"),e=!1)}),e},_clearErrors:function(){this._unbindValidationEvents(),this._fields.forEach(function(t){t.delMod("validation")})},_getFieldsData:function(){var t,e,i,n=[];return this._blockGetters||(this._blockGetters=this.findBlocksInside("b-form-field-getter")),this._blockGetters.forEach(function(s){var o,r,a,l;(o=s.findBlockOn("input")||s.findBlockOn("b-form-input"))?(o.hasMod("type","number")&&o.val(o.val().replace(",",".")),a=o.name(),l=o.val()):(o=s.findBlockOn("m-suggest"))?o.hasMod("type","groups")?(a=o._input.name(),l=o.val()):(t=o.getData(),e=o._input.name(),i=[],t?(t.length||(t=[t]),t.forEach(function(t){i.push(t.login)}),a=e+"__login",l=i.join()):o.val()&&(a=e+"__login",l=o.val())):(o=s.findBlockOn("select-multiple"))?(a=o.domElem.attr("name"),l=o.domElem.val()):(o=s.findBlockOn("select"))?(a=o.elem("control").attr("name"),l=o.val()):(o=s.findBlockOn("checkbox"))?(a=o.elem("control").attr("name"),l=o.isChecked()):(o=s.findBlockOn("m-calendar"))&&(r=BEM.blocks["mi-helpers"].getHumanStringFromDate({date:o.getDate()}),r&&(a=o.findBlockInside("input").elem("control").attr("name"),l=r)),a&&l&&n.push({name:a,value:l})}),n},_onGotData:function(t){var e=this;this.channel("errors").trigger("errorHide"),t.data.bemjson?(this.params.data.again?t.data.bemjson.content.splice(1,0,{block:"b-wiki-form-success",content:this.params.data.success||BEM.I18N("b-wiki-form","data_successfully_send")}):t.data.bemjson.content.forEach(function(i,n){"wiki-formatter"===i.block&&i.content.forEach(function(i,s){i["wiki-attrs"]&&i["wiki-attrs"].count===e._formId&&(t.data.bemjson.content[n].content[s]={block:"b-wiki-form-success",content:t.data.bemjson.content[n].content[s].content[0]["wiki-attrs"].data.success||BEM.I18N("b-wiki-form","data_successfully_send")})})}),BEM.DOM.update(this._mainDoc.domElem,BEMHTML.apply(t.data.bemjson))):(t.data.success&&(BEM.DOM.after(this.domElem,BEMHTML.apply({block:"b-wiki-form-success",content:this.params.data.success||BEM.I18N("b-wiki-form","data_successfully_send")})),this.params.data.again||BEM.DOM.destruct(this.domElem)),this._spinner.delMod("progress"),this._button.delMod("disabled"))},_onFailedData:function(t){var e,i=this;t.meta?Object.keys(t.meta).forEach(function(n){e=i.findBlockInside({block:"b-wiki-form-field",modName:"name",modVal:n}),e&&(e.setMod("validation","error"),e.errorMessage="",t.meta[n]&&t.meta[n].forEach(function(t){e.errorMessage+=t+"."}))}):t.message=this._formRenderError(t,!0),this.channel("errors").trigger("error",this._getErrorData(t.message)),this._spinner.delMod("progress"),this._button.delMod("disabled")},_escapeString:function(t){return $("<div/>").text(t).html()},_getErrorData:function(t,e){return{node:e||this._button.domElem,content:{head:BEM.I18N("b-wiki-form","cant_save_form"),body:this._escapeString(t)}}
},_fieldWrapper:function(t,e){var i={name:t.name};return i=$.extend(i,t.mods),e.push({block:"b-wiki-form-field",elem:"error"}),{block:"b-wiki-form-field",mods:i,content:e}},_extendFields:function(t,e){t.title?this._setLabel(t,e):e.mods.label="no",t.title&&t.top&&(e.mods.position="top"),this._setComment(t,e.content)},_setLabel:function(t,e,i){t.title?(i?e.content.push({block:"b-wiki-form",elem:"label",content:t.title}):e.content.unshift({block:"b-wiki-form",elem:"label",content:t.title}),t.top&&(e.mods.position="top")):e.mods.label="no"},_isRequired:function(t,e){t.attrs.required&&(e.mods.required="yes")},_unbindValidationEvents:function(){this._formBlocks&&this._formBlocks.length&&this._formBlocks.forEach(function(t){t.un("focus")})},_setComment:function(t,e){t.text&&e&&e.push({block:"b-wiki-form",elem:"description",content:t.text})}},{_getErrorTypes:function(t){var e={UNKNOWN:BEM.I18N("b-wiki-form","unknown_error")+" %s",YAML:BEM.I18N("b-wiki-form","yaml_error")+" %s",INVALID_TARGET_ENTRY:BEM.I18N("b-wiki-form","error_in_target")+" %s",TARGET_FIELD_NOT_FOUND:BEM.I18N("b-wiki-form","missing_field_in_target")+'"%s"',MISSING_PAGE:BEM.I18N("b-wiki-form","unknown_page")+' "%s"',GENERIC:BEM.I18N("b-wiki-form","form_send_error")+" %s"};return e[t]}}),BEM.DOM.decl({block:"select",modName:"layout",modVal:"content"},{_calcPopupDimensions:function(){this.__base.apply(this,arguments),this._popupContent.css("width",this._getButton().domElem.outerWidth()-2*this.__self.FOCUS_OFFSET_HORIZ)}},{FOCUS_OFFSET_HORIZ:1}),BEM.DOM.decl({name:"m-calendar",modName:"toggler",modVal:"input"},{onSetMod:{js:function(){var t=this;this.input=this.findBlockInside({block:"input",modName:"toggler",modVal:"datepicker"}),this.__base.apply(this,arguments),this.input.bindTo("click",t._onTogglerClick.bind(this)),this.input.on("focus",this._onTogglerClick,this),this.input.bindTo(this.input.domElem,"mousedown",function(){t.input.un("focus")})}},_onDateChange:function(t,e){e?e.from?this.input.val(dateFormat(e.from)+" — "+dateFormat(e.to)):this.input.val(dateFormat(e)):this.input.val(""),this.__base.apply(this,arguments)},_onTogglerClick:function(){var t=this;this.input._isDatePickerOpened=!0,this.__base.apply(this,arguments),this.bindToDoc("keydown.close",function(e){9===e.which&&(t._datePickerPopup.hide(),t.unbindFromDoc("keydown.close"))})},_onDatePickerPopupHide:function(){this.__base.apply(this,arguments),this.input.delMod("focused"),this.input.on("focus",this._onTogglerClick,this),this.unbindFromDoc("keydown.close")}}),BEM.DOM.decl({block:"m-calendar",modName:"assigned",modVal:"form"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params.required&&this.findBlockOutside("b-wiki-form")._requiredFields.push(this.findBlockInside({block:"input",modName:"toggler",modVal:"datepicker"}))}}}),BEM.DOM.decl({block:"input",modName:"type",modVal:"number"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.bindTo("input",BEM.blocks["mi-helpers"].validateNumberOnlyInput)}}}),BEM.DOM.decl({block:"m-uploader",modName:"type",modVal:"form"},{onSetMod:{js:function(){this._form=this.findBlockOutside("b-wiki-form"),this._attach=this.findBlockInside("attach"),this.__base.apply(this,arguments),this.on({uploadsuccess:this._onFileSuccessUpload,fileready:this._onFileReady,progress:this._onFileLoadProgress},this)}},_addProgressBlock:function(t){return BEM.DOM.prepend(this.domElem,BEMHTML.apply({block:"b-file-loader",name:t.name})),this.findBlockInside("b-file-loader")},_onFileLoadProgress:function(){this._fileBlock&&(this._fileBlock.elem("wrapper").html(this._file.progress+"%"),this._fileBlock.elem("progress").css("width",this._file.progress+"%"))},_onFileSuccessUpload:function(t,e){this._alreadyLoad?this._form._files=this._form._files.map(function(t){return t.storage_id===this._fileBlockId?{name:this._attach.elem("control").prop("name"),storage_id:e.response.data.storage_id,file_name:e.name,size:e.size}:t}.bind(this)):(this._alreadyLoad=!0,this._form._files.push({name:this._attach.elem("control").prop("name"),storage_id:e.response.data.storage_id,file_name:e.name,size:e.size})),this._fileBlockId=e.response.data.storage_id},_onFileReady:function(t,e){this._fileBlock&&this._fileBlock.destruct(),this._file=this.files[e],this._fileBlock=this._addProgressBlock(this._file),this._fileBlock.on("removed",this._clearFormFiles,this),this._fileBlock.file=this._file},_clearFormFiles:function(){this._file=null,this._form._files=this._form._files.filter(function(t){var e=!1;return this._fileBlockId!==t.storage_id&&(this._alreadyLoad=!1,e=!0),e},this)}}),BEM.DOM.decl({block:"m-uploader",modName:"assigned",modVal:"form"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params.required&&this.findBlockOutside("b-wiki-form")._requiredFields.push(this)}}}),BEM.DOM.decl({name:"b-form-input",modName:"form",modVal:"yes"},{_onSelectItem:function(t){var e=t.select(!0),i="object"==typeof e?e.needUpdate:e!==!1,n="object"==typeof e&&e.needEvent;this._preventRequest=!0,i&&this.val(this._userVal=t.val(),{source:"autocomplete",itemIndex:this._curItemIndex}),this.del("_preventRequest"),(i||n)&&this.trigger("select",{item:t,byKeyboard:!0})}}),BEM.DOM.decl({block:"m-suggest",modName:"type",modVal:"groups"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this._requestSettings={type:this.__self.REQUEST_TYPE,url:"//center.yandex-team.ru/api/autocomplete/groups/",dataType:this.__self.REQUEST_DATA_TYPE,timeout:this.__self.REQUEST_TIMEOUT}}},_getData:function(t){var e,i="";return this.params.types.forEach(function(n,s){e=0===s?"":"|","object"==typeof n?(!n.symbolsToSend||n.symbolsToSend<=t.length)&&(i+=e+n.name):i+=e+n}),{q:t,type:i}},_isNotEmptyResult:function(t){return!!t.length},_getItemsHTML:function(t){var e=this;return BEMHTML.apply({block:"m-suggest-group",content:$.map(t.slice(0,e.params.maxCount),function(t){return e._getItemBEMJSON("department",t)})})},_toggleItem:function(){this.__base.apply(this,arguments),this._items[this._curItemIndex]&&this.val(this._items[this._curItemIndex],!0)},_selectItem:function(t){this.val(t,!0),this.__base.apply(this,arguments),this._items[this._curItemIndex]&&this._items[this._curItemIndex].delMod("hovered"),this._curItemIndex=-1,this._popup.hide()}}),BEM.DOM.decl({block:"m-suggest",modName:"assigned",modVal:"form"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params.required&&this.findBlockOutside("b-wiki-form")._requiredFields.push(this)}}}),BEM.DOM.decl({block:"select-multiple",modName:"assigned",modVal:"form"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.params.required&&this.findBlockOutside("b-wiki-form")._requiredFields.push(this)}}}),BEM.DOM.decl("b-page-info",{onSetMod:{js:function(){var t=this;this._bPage=this.findBlockOutside("b-page"),this._bPageUser=this._bPage.findBlockInside("b-page-user")||this._bPage.findBlockInside("b-page-official"),this._bOldPageMark=this._bPage.findBlockInside("b-old-page-mark"),this._checkButtonHolder=this._bPage.findBlockInside("b-check-button-holder"),this._checkButton=this._bPage.findBlockInside({block:"check-button",modName:"type",modVal:"sidebar"}),this.findBlockOn("mi-sticky").on("undocked",function(){t._bPage.setMod("page-info","docked"),t._bPage.hasMod("show","sidebar")||BEM.DOM.before(t._bPageUser.domElem,t._checkButton.domElem)}),this.findBlockOn("mi-sticky").on("docked",function(){t._bPage.delMod("page-info"),t._bPage.hasMod("show","sidebar")||BEM.DOM.before(t._checkButtonHolder.domElem,t._checkButton.domElem),t._bPageUser._popup&&t._bPageUser._popup.hasMod("visibility","visible")&&setTimeout(function(){t._bPageUser._showOfficialPopup()},0),t._bOldPageMark&&t._bOldPageMark._popup&&t._bOldPageMark._popup.hasMod("visibility","visible")&&setTimeout(function(){t._bOldPageMark._showPopup()},0)})}}}),BEM.DOM.decl("b-page-official",{onSetMod:{js:function(){this.bPage=BEM.blocks["i-global"].getbPage(),this._popup=this.findBlockInside("popup")}},_onClick:function(){this._popup.hasMod("visibility","visible")?this._popup.hide():this._showOfficialPopup()},_showOfficialPopup:function(){this._loaded?this._popup.show(this):BEM.create("api-request",{_:"api-response",apiPath:".officiality",path:WikiHistory._getCorrectPath(),urlParams:["format=json"]}).run().then(this._onGotData.bind(this),this._onFailedData.bind(this))},_onGotData:function(t){var e=t.data.responsible_persons,i=t.data.responsible_groups,n=BEMHTML.apply(this._getOfficialPersonsBEMJSON(e)),s=BEMHTML.apply(this._getOfficialGroupsBEMJSON(i));BEM.DOM.append(this._popup.elem("content"),n+s),this._popup.show(this),this._loaded=!0},_getOfficialPersonsBEMJSON:function(t){var e=[];return t.length&&(e.push({block:"b-page-official",elem:"user-title",content:1===t.length?BEM.I18N("b-page-official","responsible"):BEM.I18N("b-page-official","responsibles")}),t.forEach(function(t){e.push({block:"b-page-official-user",login:t.login,display:t.display,is_dismissed:t.is_dismissed})})),e},_getOfficialGroupsBEMJSON:function(t){var e=[];return t.length&&(e.push({block:"b-page-official",elem:"user-title",content:1===t.length?BEM.I18N("b-page-official","responsible_group"):BEM.I18N("b-page-official","responsible_groups")}),t.forEach(function(t){e.push({block:"b-page-official",elem:"group",content:t.url?{block:"link",url:t.url,content:t.name}:t.name})})),e},_onFailedData:function(t){console.log(t),this._popup.show(this)}},{live:function(){this.liveBindTo("click",function(t){this._onClick(t)})}}),BEM.DOM.decl("b-access-button",{onSetMod:{js:function(){this._bPage=this.findBlockOutside("b-page"),this._subscribeList=this._bPage.findBlockInside({block:"popup",modName:"action",modVal:"access"}),this._panelActions=this._bPage.findBlockInside("b-panel-actions"),this._subscribeList&&this._subscribeList.bindTo("click",this._onAccessListClick.bind(this))}},_onAccessListClick:function(t){var e=$(t.target).bem("b-popup-select-item"),i=e.getMod("type");"restricted"===i?(this._accessData={groups:[],departments:[],users:[],robots:[]},this._widget||this._createWidget(),BEM.create("api-request",{_:"api-response",apiPath:".access",method:"GET",data:!1,urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(this._onGetAccessData.bind(this),this._onGetAccessDataError.bind(this))):this._sendData({type:e.getMod("type")})},_createWidget:function(){var t=BEMHTML.apply({block:"b-widget",mods:{type:"page-access"}});BEM.DOM.append(this._bPage.domElem,t),this._widget=this._bPage.findBlockInside({block:"b-widget",modName:"type",modVal:"page-access"}),this._multiSelect=this._widget.findBlockInside({block:"b-form-input",modName:"type",modVal:"pageAccess"}),this._bSaveButton=this._widget.findBlockInside({block:"button",modName:"type",modVal:"save"}),this._bCancelButton=this._widget.findBlockInside({block:"button",modName:"type",modVal:"cancel"}),this._spinner=this._widget.findBlockInside({block:"spinner",modName:"type",modVal:"action-load"}),this._bGroupsList=this._widget.findBlockInside("b-groups-list"),this._bServiceList=this._widget.findBlockInside("b-services-list"),this._bWikiList=this._widget.findBlockInside("b-wiki-list"),this._onMultiSelectChoose(),this._widget.bindTo("content","click",this._showGroupUsers.bind(this)),this._widget.bindTo("content","click",this._removeItem.bind(this)),this._bSaveButton.on("click",this._addToRestrictedList,this),this._bCancelButton.on("click",this._closeAccessPopup,this)},_onMultiSelectChoose:function(){var t,e,i,n,s=this;this._multiSelect.on("select",function(o){if(s._selectedItem=o.target._itemData,i=s._selectedItem.type,-1===s._accessData.users.indexOf(parseInt(s._selectedItem.uid))){if("staff"===s._selectedItem._type)s._accessData.users.push(parseInt(s._selectedItem.uid)),t=BEMHTML.apply(s._userBEMJSON(s._selectedItem)),BEM.DOM.append(s._widget.elem("users-list"),t);else if("group"===s._selectedItem._type){switch(s._accessData.groups.push(parseInt(s._selectedItem.id)),e=BEMHTML.apply(s._groupBEMJSON(s._selectedItem,!1)),i){case 0:n=s._widget.findBlockInside("b-wiki-list"),s._addHeaderToDom(n,BEM.I18N("b-access-button","wiki-groups"));break;case 1:n=s._widget.findBlockInside("b-groups-list"),s._addHeaderToDom(n,BEM.I18N("b-access-button","division"));break;case 2:n=s._widget.findBlockInside("b-services-list"),s._addHeaderToDom(n,BEM.I18N("b-access-button","services"))}BEM.DOM.append(n.domElem,e)}s._multiSelect.getPopup().hide(),s._multiSelect.val("")}})},_addToRestrictedList:function(){this._accessData.type="restricted",BEM.DOM.prepend(this._widget.elem("buttons"),this._spinner.domElem),this._spinner.setMod("progress","yes"),BEM.create("api-request",{_:"api-response",apiPath:".access",method:"PUT",headers:{"Content-Type":"application/json"},data:this._accessData,urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(this._onSaveAccessData.bind(this),this._onSaveAccessDataError.bind(this))},_closeAccessPopup:function(){this._widget.hide()},_onSaveAccessData:function(){this._spinner.delMod("progress"),this._closeAccessPopup()},_removeItem:function(t){var e,i,n=$(t.target),s=n.attr("class");-1!==s.indexOf("b-acess-remove")&&(this._removeBlock=n.parent().bem("b-acess-remove"),e=parseInt(this._removeBlock.params.id),"user"===this._removeBlock.params.type?(i=this._accessData.users.indexOf(e),-1!==i&&this._accessData.users.splice(i,1)):"group"===this._removeBlock.params.type&&(i=this._accessData.groups.indexOf(e),-1!==i&&this._accessData.groups.splice(i,1)),this._accessData.type=this._accessData.users.length?"restricted":"owner","user"===this._removeBlock.params.type?this._removeBlock.domElem.closest(".b-widget__user").remove():("group"===this._removeBlock.params.type||"department"===this._removeBlock.params.type)&&this._removeBlock.domElem.closest(".b-widget__group").remove())},_showGroupUsers:function(t){var e=$(t.target).attr("class");-1!==e.indexOf("b-acess-group-link")&&(this._currentGroupLink=$(t.target).bem("b-link"),this._currentGroup=this._currentGroupLink.findBlockOutside("b-access-group"),this._currentGroupList=this._currentGroup.findBlockInside("b-acess-group-users"),this._openedGroupUsersList&&this._openedGroupUsersList.delMod("visibility"),this._currentGroupList.hasMod("filled")?this._openedGroupUsersList!==this._currentGroup?(this._currentGroup.setMod("visibility","yes"),this._openedGroupUsersList=this._currentGroup):(this._currentGroup.delMod("visibility"),this._openedGroupUsersList=null):(BEM.DOM.after(this._currentGroupLink.domElem,this._spinner.domElem),this._spinner.setMod("progress","yes"),BEM.create("api-request",{_:"api-response",apiPath:".groups/"+this._currentGroupLink.params.id,method:"GET",data:!1,urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(this._onGetGroupData.bind(this),this._onGetGroupDataError.bind(this))))},_onGetGroupData:function(t){var e=this,i=[];t.data.users.data.forEach(function(t){i.push(e._userBEMJSON(t,!1,!0))}),BEM.DOM.append(this._currentGroupList.domElem,BEMHTML.apply(i)),this._openedGroupUsersList=this._currentGroup,this._currentGroup.setMod("visibility","yes"),this._currentGroupList.setMod("filled","yes"),this._spinner.delMod("progress")},_onGetAccessData:function(t){console.log(t),this._parseAccessData(t),this._createUsersAccessList(t.data),this._widget.show()},_parseAccessData:function(t){var e=this;t.data.active.users.forEach(function(t){e._accessData.users.push(t.uid)}),t.data.active.groups.forEach(function(t){e._accessData.groups.push(t.id)})},_createUsersAccessList:function(t){var e=this,i=[];this._widget.elem("users-list").html(""),e._bGroupsList.domElem.html(""),e._bServiceList.domElem.html(""),e._bWikiList.domElem.html(""),i.push(this._userBEMJSON(t.owner,"owner")),t.active.users.forEach(function(t){i.push(e._userBEMJSON(t))}),BEM.DOM.append(this._widget.elem("users-list"),BEMHTML.apply(i)),t.active.groups.forEach(function(t){switch(t.type){case 0:e._addHeaderToDom(e._bWikiList,BEM.I18N("b-access-button","wiki-groups")),BEM.DOM.append(e._bWikiList.domElem,BEMHTML.apply(e._groupBEMJSON(t,!0)));break;case 1:e._addHeaderToDom(e._bGroupsList,BEM.I18N("b-access-button","division")),BEM.DOM.append(e._bGroupsList.domElem,BEMHTML.apply(e._groupBEMJSON(t,!0)));break;case 2:e._addHeaderToDom(e._bServiceList,BEM.I18N("b-access-button","services")),BEM.DOM.append(e._bServiceList.domElem,BEMHTML.apply(e._groupBEMJSON(t,!0)))}}),this._widget.hideSpinner()},_userBEMJSON:function(t,e,i){return{block:"b-widget",elem:"user",content:[{block:"b-user",mix:[{block:"mi-staff-card",js:{user:t.login}}],url:"http://staff.yandex-team.ru/"+t.login,content:t.first_name+" "+t.last_name},function(){return"owner"===e?{elem:"owner",content:"&nbsp;-"+BEM.I18N("b-access-button","owner")}:i?void 0:{block:"b-acess-remove",js:{id:t.uid,type:"user"},content:[{elem:"close"},{elem:"text",content:BEM.I18N("b-access-button","delete")}]}}()]}},_groupBEMJSON:function(t,e){var i;return i=e?t.name+" ("+t.users_total+")":t.name,{block:"b-widget",elem:"group",mix:{block:"b-access-group"},content:[{elem:"group-status"},{block:"b-link",mix:{block:"b-acess-group-link"},url:"#",js:{id:t.id},content:i},{block:"b-acess-remove",js:{id:t.id,type:"group"},content:[{elem:"close"},{elem:"text",content:BEM.I18N("b-access-button","delete")}]},{block:"b-acess-group-users"}]}},_setGroupHeader:function(t){return{block:"b-groups-header",content:t}},_addHeaderToDom:function(t,e){t.findBlockInside("b-groups-header")||(header=this._setGroupHeader(e),BEM.DOM.append(t.domElem,BEMHTML.apply(header)))},_sendData:function(t){BEM.create("api-request",{_:"api-response",apiPath:".access",method:"PUT",data:t,urlParams:!1,path:WikiHistory._getCorrectPath()}).run().then(this._onSaveData.bind(this),this._onSaveDataError.bind(this))},_onSaveData:function(){},_onSaveAccessDataError:function(t){this.channel("errors").trigger("error",this._getErrorData(this._bSaveButton.domElem,BEM.I18N("b-access-button","cant_save_changes"),t.message))},_onSaveDataError:function(t){this.channel("errors").trigger("error",this._getErrorData(this._bSaveButton.domElem,BEM.I18N("b-access-button","cant_save_changes"),t.message))},_onGetAccessDataError:function(t){this.channel("errors").trigger("error",this._getErrorData(this._bSaveButton.domElem,BEM.I18N("b-access-button","cant_get_data"),t.message))},_onGetGroupDataError:function(t){this.channel("errors").trigger("error",this._getErrorData(!1,BEM.I18N("b-access-button","cant_get_list"),t.message))},_getErrorData:function(t,e,i){return{node:t,content:{head:e,body:i}}}}),BEM.DOM.decl("b-page-favorites-button",{onSetMod:{js:function(){this.icon=this.findBlockInside("awesome-icon")},type:{add:function(){this.icon.setMod("icon","bookmark-empty")},"delete":function(){this.icon.setMod("icon","bookmark")}}},_onClick:function(){this.bPage=this.findBlockOutside("b-page"),this.bFavs=this.bPage.findBlockInside("b-favs"),"add"===this.getMod("type")?this._addPageToFavorites():this._deletePageFromFavorites(),this.toggleMod("type","add","delete")},_addPageToFavorites:function(){var t=this.bPage.findBlockInside("b-page-title"),e=this.bFavs.defaultFolderName[0],i=t.domElem.text(),n=window.location.origin+window.location.pathname+window.location.hash;BEM.create("api-request",{_:"api-response",apiPath:".favorites/bookmarks",method:"PUT",data:{folder_name:e,title:i,url:n},path:"",urlParams:!1}).run().then(this._onAddGotData.bind(this),this._onAddDataError.bind(this))},_onAddGotData:function(){this.bFavs.refreshFavs()},_onAddDataError:function(){this.toggleMod("type","add","delete")},_deletePageFromFavorites:function(){BEM.create("api-request",{_:"api-response",apiPath:".favorites/bookmarks",path:"",method:"POST",data:{supertag:this.params.supertag},urlParams:!1}).run().then(this._onRemoveSuccess.bind(this),this._onRemoveError.bind(this))},_onRemoveSuccess:function(){this.bFavs.refreshFavs()},_onRemoveError:function(){this.toggleMod("type","add","delete")}},{live:function(){this.liveBindTo("click",function(){this._onClick()})}}),BEM.blocks["i-access"]={onURL:function(t,e){var i=BEMHTML.apply({block:"b-widget",mods:{type:"request-access"},js:{data:t}});BEM.DOM.append(e.domElem,i)}},BEM.DOM.decl({block:"b-widget",modName:"type",modVal:"request-access"},{onSetMod:{js:function(){this.__base.apply(this,arguments),this.show()}}}),BEM.DOM.decl("b-request-access",{onSetMod:{js:function(){return this.bPage=this.findBlockOutside("b-page"),this.bWidget=this.findBlockOutside("b-widget"),this.requestID=this.bWidget.params&&this.bWidget.params.data&&this.bWidget.params.data.id,this.requestAction=this.bWidget.params&&this.bWidget.params.data&&this.bWidget.params.data.action,this.requestID?(this.accessData={},this.getData(),void 0):(this._onGetError({code:"500",message:BEM.I18N("b-request-access","no_id_for_request")}),void 0)}},getData:function(){BEM.create("api-request",{_:"api-response",apiPath:".requestaccess/"+this.requestID,path:WikiHistory._getCorrectPath(),urlParams:["format=json"]}).run().then(this._onGetSuccess.bind(this),this._onGetError.bind(this))},_onGetSuccess:function(t){var e="";switch(this.delMod("type"),this.accessData=t.data,this.accessStatus=this.accessData.status,this.accessStatus){case"pending":this.accessAction="allow_groups","allow"==this.requestAction&&"#grant_access_only_to"==location.hash?this.accessAction="allow_applicant":"deny"==this.requestAction&&(this.accessAction="deny"),BEM.DOM.update(this.elem("content"),BEMHTML.apply(this._getAccessBEMJSON()),this._onShowAccessSuccess,this);break;case"processed":e=BEM.I18N("b-request-access","request_processed"),e+=this.accessData.granted?BEM.I18N("b-request-access","access_granted"):BEM.I18N("b-request-access","access_denied"),BEM.DOM.update(this.elem("content"),e);break;case"obsolete":e=BEM.I18N("b-request-access","request_irrelevant"),BEM.DOM.update(this.elem("content"),e);break;default:e=BEM.I18N("b-request-access","wrong_status"),BEM.DOM.update(this.elem("content"),e)}BEM.DOM.update(this.elem("buttons"),BEMHTML.apply(this._getAccessButtonsBEMJSON()),this._onShowAccessButtonsSuccess,this)},_getAccessBEMJSON:function(){return[{block:"b-user",mix:[{block:"mi-staff-card",js:{user:this.accessData.applicant.login}}],url:"//staff.yandex-team.ru/"+this.accessData.applicant.login,content:this.accessData.applicant.display},BEM.I18N("b-request-access","ask_access"),{block:"b-request-access",elem:"reason",content:this.accessData.reason},{block:"b-request-access",elem:"access-action",content:{block:"radio-button",mods:{size:"m",type:"access-action"},name:"access-action",value:this.accessAction,content:[{elem:"radio",controlAttrs:{value:"allow_groups"},content:BEM.I18N("b-request-access","access_group")},{elem:"radio",controlAttrs:{value:"allow_applicant"},content:BEM.I18N("b-request-access","access_employee")},{elem:"radio",controlAttrs:{value:"deny"},content:BEM.I18N("b-request-access","reject")}]}},{block:"b-request-access",elem:"access-action-unique",content:this._getAccessActionBEMJSON()}]},_getAccessActionBEMJSON:function(){var t={};switch(this.accessAction){case"allow_groups":t=[{block:"wiki-p",content:BEM.I18N("b-request-access","give_access")+this.accessData.applicant.login+"."},{block:"wiki-p",content:BEM.I18N("b-request-access","groups_include")+this.accessData.applicant.display},{block:"allow-groups",content:[{block:"allow-groups-services",content:[{elem:"title",content:BEM.I18N("b-request-access","services")},{elem:"list",content:this._getUserGroups(this.accessData.applicant_services)}]},{block:"allow-groups-departments",content:[{elem:"title",content:BEM.I18N("b-request-access","division")},{elem:"list",content:this._getUserGroups(this.accessData.applicant_departments)}]}]},{block:"b-form-input",mods:{size:"l",theme:"grey","has-clear":"yes"},name:"group",multicomplete:{types:"group",limit:5,group_fields:"type"},content:[{elem:"hint",content:BEM.I18N("b-request-access","another_group")},{elem:"input",clear:{elem:"clear"}}]},{block:"b-request-access",elem:"groups-list"}];break;case"allow_applicant":t=[{block:"wiki-p",content:BEM.I18N("b-request-access","access_will_take")+this.accessData.applicant.display+BEM.I18N("b-request-access","use_this")}];break;case"deny":t=[{block:"wiki-p",content:BEM.I18N("b-request-access","you_want_reject_access")},{block:"input",mods:{type:"textarea",size:"s"},content:{elem:"control",controlAttrs:{placeholder:BEM.I18N("b-request-access","why_you_dont_give_access")}}}]}return{block:"b-request-access",elem:this.accessAction,content:t}},_getUserGroups:function(t){var e,i=[];if(!t.length)return"";for(e=0;e<t.length;e++)i.push({block:"checkbox",mods:{size:"m"},js:{id:t[e].id},content:{elem:"label",content:t[e].name},mix:[{block:"clearfix"}]});return i},_onShowAccessSuccess:function(){this.accessActionsButton=this.findBlockInside("radio-button"),this.accessActionsButton.on("change",this._onAccessActionChange,this),this._initBlock()},_initBlock:function(){var t=this;switch(this.accessAction){case"allow_groups":this.departmentCheckboxes=this.findBlockInside("allow-groups-departments").findBlocksInside("checkbox"),this.departmentCheckboxes.forEach(function(e){e.on("change",t._onCheckboxChange,t)}),this.otherGroups=[],this.groupsSelect=this.findBlockInside("b-form-input"),this.groupsList=this.elem("groups-list"),this._onGroupsSelectChoose();break;case"allow_applicant":break;case"deny":}},_onAccessActionChange:function(){var t;this.accessAction=this.accessActionsButton.val(),t=this.findElem(this.accessAction),this.elem("access-action-unique").children().hide(),t.length?t.show():(BEM.DOM.append(this.elem("access-action-unique"),BEMHTML.apply(this._getAccessActionBEMJSON())),this._initBlock())},_onCheckboxChange:function(t){var e=this,i=null;t.target.isDisabled()||(t.target.isChecked()?(this.currentDepartmentCheckbox=t.target,this.departmentCheckboxes.forEach(function(t,n){t!=e.currentDepartmentCheckbox?(null!==i&&n>i&&t.setMod("checked","yes"),t.setMod("disabled","yes")):i=n})):this.departmentCheckboxes.forEach(function(t){t.delMod("disabled"),t.delMod("checked")}))},_onGroupsSelectChoose:function(){var t,e=this;this.groupsSelect.on("select",function(i){e._selectedItem=i.target._itemData,e.otherGroups.push(parseInt(e._selectedItem.id)),t=BEMHTML.apply(e._groupBEMJSON(e._selectedItem)),BEM.DOM.append(e.groupsList,t),e.groupsSelect.getPopup().hide(),e.groupsSelect.val("")})},_groupBEMJSON:function(t){return{block:"b-user-group",mods:{type:"request-access"},js:{id:t.id},content:[t.name,{block:"b-user-group",elem:"remove",content:{block:"awesome-icon",mods:{icon:"remove"}}}]}},_getAccessButtonsBEMJSON:function(t){var e=[],i=BEM.I18N("b-request-access","close");return t||"pending"!=this.accessStatus||(i=BEM.I18N("b-request-access","cancel")),e.push({block:"button",mods:{size:"m",type:"cancel"},content:i}),t||"pending"!=this.accessStatus||e.push({block:"button",mix:[{block:"b-readonly-item",js:!0}],mods:{theme:"action",size:"m",type:"save"},content:BEM.I18N("b-request-access","save")}),e},_onShowAccessButtonsSuccess:function(){this.bCancelButton=this.findBlockInside({block:"button",modName:"type",modVal:"cancel"}),this.bCancelButton&&this.bCancelButton.on("click",this._closePopup,this),this.bSaveButton=this.findBlockInside({block:"button",modName:"type",modVal:"save"}),this.bSaveButton&&this.bSaveButton.on("click",this._saveChanges,this)},_closePopup:function(){this.bWidget.hide()},_saveChanges:function(){var t=[],e={action:this.accessAction},i="",n=this.findElem("error");switch(n.length&&n.remove(),this.accessAction){case"allow_groups":if(this.findBlocksInside("checkbox").forEach(function(e){e.isChecked()&&!e.isDisabled()&&t.push(e.params.id)}),t=t.concat(this.otherGroups),!t.length)return i={block:"b-request-access",elem:"error",content:BEM.I18N("b-request-access","no_group_selected")},BEM.DOM.append(this.elem("allow_groups"),BEMHTML.apply(i)),void 0;e.groups=t;break;case"allow_applicant":break;case"deny":if(e.verdict_reason=this.findBlockInside("input").val(),i={block:"b-request-access",elem:"error",content:BEM.I18N("b-request-access","reason_is_required_field")},""===e.verdict_reason)return BEM.DOM.append(this.findBlockInside("input").domElem,BEMHTML.apply(i)),void 0}this._sendApprove(e)},_sendApprove:function(t){BEM.create("api-request",{_:"api-response",apiPath:".requestaccess/"+this.requestID,path:"",method:"POST",data:t,urlParams:!1}).run().then(this._onSendSuccess.bind(this),this._onGetError.bind(this))},_onSendSuccess:function(){BEM.DOM.update(this.elem("content"),BEM.I18N("b-request-access","access_was_processed")),BEM.DOM.update(this.elem("buttons"),BEMHTML.apply(this._getAccessButtonsBEMJSON(!0)),this._onShowAccessButtonsSuccess,this)},_onGetError:function(t){var e=[{block:"b-request-access",elem:"error",content:BEM.I18N("b-request-access","error")+" "+t.code},{block:"wiki-p",content:t.message}];this.delMod("type"),BEM.DOM.update(this.elem("content"),BEMHTML.apply(e)),BEM.DOM.update(this.elem("buttons"),BEMHTML.apply(this._getAccessButtonsBEMJSON(!0)),this._onShowAccessButtonsSuccess,this)}}),BEM.DOM.decl({name:"b-user-group",modName:"type",modVal:"request-access"},{onSetMod:{js:function(){this.bRequestAccess=this.findBlockOutside("b-request-access")}},_onRemoveClick:function(){var t=this.params.id,e=this.bRequestAccess.otherGroups.indexOf(t);this.bRequestAccess.otherGroups.splice(e,1),this.destruct()}},{live:function(){this.liveBindTo("remove","click",function(t){this._onRemoveClick(t)})}}),BEM.DOM.decl("b-notification",{close:function(){this.destruct()}},{live:function(){this.liveBindTo("close","click",function(){this.close()})}}),BEM.decl({block:"wiki-request",baseBlock:"i-handler__request"},null,{getProviderUrl:function(){return"/handlers/"}}),BEM.decl({block:"wiki-request",baseBlock:"i-handler__request"},null,{getProviderUrl:function(){return"/handlers/"}}),function(t,e){function i(){p&&m&&console.log.apply(console,arguments)}function n(t){return"string"==typeof t&&(t={block:t}),t.block+(t.elem?c+t.elem:"")+(t.modName?l+t.modName+l+t.modVal:"")}function s(t){var e={};return t.split(c).forEach(function(t,i){var n=[i?"elem":"block","mod","val"];t.split(l).forEach(function(t,i){e[n[i]]=t})}),e}function o(t){return t?h.push(t):!1}function r(){return h.length&&h.pop()}function a(){this._lang="",this._prj="lego",this._keyset="",this._key=""}if("function"==typeof e.I18N&&e.I18N._proto)return e.I18N;"undefined"==typeof i18n&&(i18n={}),BEM=e;var l="_",c="__",d="ru",u={},h=[],p=!1,m="undefined"!=typeof console&&"function"==typeof console.log;a.prototype={lang:function(t){return this._lang=t,this},project:function(t){return this._prj=t,this},keyset:function(t,e){return e&&o(this._keyset),this._keyset=n(t),this},key:function(t){return this._key=t,this},decl:function(t){var e=s(this._keyset),i="i-tanker"===e.block?"tanker":this._prj,n=e.elem||this._keyset,o=this._key;i=i18n[i]||(i18n[i]={}),n=i[n]||(i[n]={}),n[o]="function"==typeof t?t:function(){return t};var r=u[this._lang]||(u[this._lang]={}),a=r[this._keyset]||(r[this._keyset]={});a[o]=t},val:function(t,e){var n=u[this._lang]&&u[this._lang][this._keyset],s="keyset: "+this._keyset+" key: "+this._key+" (lang: "+this._lang+")";if(!n)return i("[I18N_NO_KEYSET] %s",s),"";n=n[this._key];var o=typeof n;return"undefined"===o?(i("[I18N_NO_VALUE] %s",s),""):"string"===o?n:(e||(e=this),n.call(e,t))},_cache:function(){return u}},e.I18N=function(t){var e=function(t,i,n){return e.keyset(t).key(i,n)};return e._proto=t,e.project=function(t){return this._proto.project(t),this},e.keyset=function(t){return this._proto.keyset(t,!0),this},e.key=function(t,i){var n,s,o=this._proto;return o.lang(this._lang).key(t),n=o.val.call(o,i,e),s=r(),s&&o.keyset(s,!1),n},e.decl=function(t,e,i){var n,s=this._proto;i||(i={}),i.lang&&s.lang(i.lang),s.keyset(t);for(n in e)e.hasOwnProperty(n)&&s.key(n).decl(e[n]);return this},e.lang=function(t){return"undefined"!=typeof t&&(this._lang=t),this._lang},e.debug=function(t){p=!!t},e.lang(d),e}(new a)}(this,"undefined"==typeof BEM?{}:BEM),BEM.I18N.decl("attach",{"button-text":"Выбрать файл","no-file":"файл не выбран"},{lang:"ru"}),BEM.I18N.decl("b-access-button",{access:"Доступ:",access_free:"Свободный для Яндекса",access_lock:"Только для себя",access_to_parent:"Доступ как к родительской странице",cant_get_data:"Ошибка при получении данных",cant_get_list:"Не удалось загрузить список",cant_save_changes:"Не получилось сохранить изменения",common:"Яндекс","delete":"удалить",division:"Подразделение",lock:"Закрытый",owner:"владелец",restricted:"Ограниченный",services:"Сервисы","wiki-groups":"Вики-Группы"},{lang:"ru"}),BEM.I18N.decl("b-action-delete",{all_data_will_disapeared:"Также эти данные пропадут со всех страниц, в которые они добавлены через экшн grid.",cant_delete_page:"Не получилось удалить страницу",do_you_want_delete_page:"Вы действительно хотите удалить страницу",do_you_want_delete_table:"Вы действительно хотите удалить эту таблицу",remove_table_with_content:"Таблица будет удалена со всем добавленным в неё контентом",table_address:"Адрес"},{lang:"ru"}),BEM.I18N.decl("b-action-move",{cant_move_cluster:"Не удалось переместить кластер"},{lang:"ru"}),BEM.I18N.decl("b-cluster-autocomplete",{get_data_error:"Ошибка получения данных автокомплита"},{lang:"ru"}),BEM.I18N.decl("b-cluster-tree",{cant_load_cluster_tree:"Не удалось загрузить дерево кластера",subpages:"Вложенные страницы"},{lang:"ru"}),BEM.I18N.decl("b-cluster-tree-filter",{closed_pages:"Закрытые страницы",non_existent:"Несуществующие страницы",redirects:"Редиректы",tables:"Таблицы"},{lang:"ru"}),BEM.I18N.decl("b-cluster-tree-sort",{sort_by_address:"По адресу",sort_by_createDate:"По дате создания",sort_by_name:"По названию",sort_by_updates:"По дате модификации"},{lang:"ru"}),BEM.I18N.decl("b-comment-answer",{close:"Закрыть",comment_reply:"Ответить",comment_send:"Отправить",comment_text:"Комментарий"},{lang:"ru"}),BEM.I18N.decl("b-comment-delete",{comment_removed:"Комментарий удалён",delete_comment:"удалить"},{lang:"ru"}),BEM.I18N.decl("b-comment-restore",{restore_comment:"Восстановить"},{lang:"ru"}),BEM.I18N.decl("b-comment2-create",{cant_send_comment:"Не удалось отправить комментарий",comment:"Комментировать",please_write:"Пишите от души"},{lang:"ru"}),BEM.I18N.decl("b-comments",{comment_text:"Комментарий"},{lang:"ru"}),BEM.I18N.decl("b-comments-link",{comment_amount:"Комментариев",comment_removed:"Комментарий удалён",no_comments:"Нет комментариев"},{lang:"ru"}),BEM.I18N.decl("b-comments2",{cant_load_comments:"Не удалось загрузить комментарии",comments:"комментариев",comments_text:"Комментарии",more:"Ещё",more_comments:"Еще 5 комментариев"},{lang:"ru"}),BEM.I18N.decl("b-copyright",{link:function(t){return"ООО «"+t.content+"»"
},yandex:"Яндекс"},{lang:"ru"}),BEM.I18N.decl("b-editor-close-button",{cant_save_draft:"Не удалось сохранить черновик! Вы действительно хотите закрыть редактор?",want_to_close:"Вы действительно хотите закрыть редактор?"},{lang:"ru"}),BEM.I18N.decl("b-editor-open-button",{cant_load_wiki_text:"Не удалось загрузить вики-текст страницы",please_reload_page:"Страницу лучше перезагрузить"},{lang:"ru"}),BEM.I18N.decl("b-editor-save-button",{cant_save_page:"Не удалось сохранить страницу",page_title_prefix:"Страница"},{lang:"ru"}),BEM.I18N.decl("b-editor-struct",{page_edit:"Правка",page_save:"Сохранить",page_update_reject:"Отмена",page_update_warning:"Вы редактируете текст старой версии страницы. В случае сохранения изменений актуальная версия страницы будет заменена данной.",page_view:"Просмотр",page_watcher_notify:"известить наблюдателей об изменениях"},{lang:"ru"}),BEM.I18N.decl("b-event",{cant_load_revision:"Не удалось загрузить ревизию"},{lang:"ru"}),BEM.I18N.decl("b-events-log",{access:"Права доступа изменены",add_comment:"Комментарий добавлен",add_file:"Файл добавлен",author:"Автор",cant_load_revision:"Не удалось загрузить ревизии",change_owner:"Владелец изменен",change_to_redirect:"Установка редиректа",closed_page_access:"Доступ закрыт",create:"Страница создана","delete":"Страница удалена",delete_comment:"Комментарий удален",delete_file:"Файл удален",edit:"Страница изменена",edit_version:"Редактировать эту версию",keywords:"Ключевые слова изменены",mark_actual:"Помечена актуальной",mark_obsolete:"Помечена устаревшей",more_events:"Еще события",move_cluster:"Кластер перемещен",no_events:"Cобытий нет",old_page_version:"Это старая версия страницы от ",old_table_version:"Это старая версия таблицы от ",page_edit:"Правка",remove_comment:"Комментарий удален",rename:"Страница переименована",request_access:"Запрос доступа",request_ownership:"Запрос страницы во владение",resolve_access:"Доступ открыт",revert_from_redirect:"Снятие редиректа",unwatch:"Отписка от страницы",watch:"Подписка на страницу"},{lang:"ru"}),BEM.I18N.decl("b-events-select",{all_events:"Все события",only_attaches:"Только аттачи",only_comments:"Только комментарии",only_edits:"Только правки",only_subscribes:"Только подписки"},{lang:"ru"}),BEM.I18N.decl("b-favs",{editerd_by_me:"Отредактированные мной",favorite:"Избранное",i_am_author:"Я автор",i_am_observer:"Я наблюдатель"},{lang:"ru"}),BEM.I18N.decl("b-favs-folder",{cant_delete_folder:"Не удалось удалить папку",cant_rename_folder:"Не удалось переименовать папку"},{lang:"ru"}),BEM.I18N.decl("b-favs-folders",{cant_delete_link:"Не удалось удалить ссылку",cant_rename_link:"Не удалось переименовать ссылку",new_folder:"Новая папка"},{lang:"ru"}),BEM.I18N.decl("b-favs-new-folder",{cant_create_folder:"Не удалось создать папку",new_folder:"Новая папка"},{lang:"ru"}),BEM.I18N.decl("b-favs-options-button",{complete:"Завершить",settings:"Настройки"},{lang:"ru"}),BEM.I18N.decl("b-favs-widget",{settings:"Настройки"},{lang:"ru"}),BEM.I18N.decl("b-file2",{icon_remove:"Удалить файл",icon_upload:"Загрузить файл"},{lang:"ru"}),BEM.I18N.decl("b-files",{files_amount:"Файлов",no_files:"Нет файлов"},{lang:"ru"}),BEM.I18N.decl("b-files2",{cant_load_files:"Не удалось загрузить файлы",files_text:"файла",more:"Еще "},{lang:"ru"}),BEM.I18N.decl("b-foot",{about:"О компании",advert:"Реклама",agreement:"Пользовательское соглашение",beta:"β-версия","copyright-notice":function(){},design:"Дизайн","design-artlebedev":"Студия Артемия Лебедева","design-artlebedev-url":"http://www.artlebedev.ru",mobile:"Мобильная версия","privacy-policy":function(){},"services-button-value":"Перейти",stat:"Статистика","terms-of-service":function(){},termsofuse:"Лицензия на поиск",vacancies:"Вакансии","yandex-is-local":"Яндекс локален","yandex-is-not-local":"Как сделать Яндекс локальным",about_service:"О сервисе",confidential:"Конфиденциально",feedback:"Обратная связь",syntax:"Синтаксис"},{lang:"ru"}),BEM.I18N.decl("b-foot-nda",{text:"Коммерческая тайна ООО «Яндекс», 119021, Россия, г. Москва, ул. Льва Толстого, д. 16","text-ru":function(){}},{lang:"ru"}),BEM.I18N.decl("b-footer",{about_service:"О сервисе",confidential:"Конфиденциально",feedback:"Обратная связь",old_interface:"Эта страница в старом интерфейсе",syntax:"Синтаксис"},{lang:"ru"}),BEM.I18N.decl("b-form-input",{search:"Поиск","search-label":"поиск",vid:"Видео"},{lang:"ru"}),BEM.I18N.decl("b-grid-table",{add_line:"добавить строку",cant_load_table:"Не получилось загрузить таблицу",edit:"Редактировать",finish:"Завершить",incorrect_format:"Неправильный формат данных",page:"Страница",this_required:"обязательно",try_more:"Попробовать еще",undefined_column:"Ошибка: неизвестный тип колонки"},{lang:"ru"}),BEM.I18N.decl("b-grid-table-cell",{choose_date:"выберите дату",select:"выберите",to_choose:"выбрать"},{lang:"ru"}),BEM.I18N.decl("b-grid-table-code-form",{can_sort:"Возможность сортировки",read_only:"Только для чтения",show_line_nums:"Показывать номера строк",width:"Ширина"},{lang:"ru"}),BEM.I18N.decl("b-grid-table-head",{add:"Добавить",author:"Автор",change:"Изменить",checkbox:"Чекбокс",date:"Дата",date_created:"Дата создания",employee:"Сотрудник",executor:"Исполнитель",list:"Список",mandatory:"Обязательный",mark_made:"Помечать сделанным",multiple_list:"Множественный список",number:"Число",priority:"Приоритет",remove_column:"Удалить столбец",several_employees:"Несколько сотрудников",status:"Статус",text:"Текст",ticket_in_tracker:"Тикет в трекере",tickets:"Тикеты",title:"Заголовок",type:"Тип",updated:"Дата обновления",width:"Ширина"},{lang:"ru"}),BEM.I18N.decl("b-grid-table-options",{copy:"Копировать","delete":"Удалить","export":"Экспортировать","import":"Импортировать",mark_as_actual:"Пометить как aктуальную",mark_as_obsolete:"Пометить как устаревшую",move:"Переместить",parent_table:"Родительская таблица"},{lang:"ru"}),BEM.I18N.decl("b-grid-table-settings",{save:"Сохранить",table_name:"Название таблицы"},{lang:"ru"}),BEM.I18N.decl("b-grid-table-sorting-controll",{add_sort:"Добавить сортировку",remove_sort:"удалить сортировку",sort:"Сортировать",then:"Затем"},{lang:"ru"}),BEM.I18N.decl("b-grid-table-sorting-list",{a_z:"А → Я",z_a:"Я → А"},{lang:"ru"}),BEM.I18N.decl("b-grid-table-width-controll",{auto:"Авто"},{lang:"ru"}),BEM.I18N.decl("b-head",{create:"Создать",favorite:"Избранное",guide:"Водство",intranet_search:"поиск по интранету",my_page:"Моя страница",notes:"Заметки",wiki:"Вики"},{lang:"ru"}),BEM.I18N.decl("b-last-changes",{last_changes:"Последние изменения"},{lang:"ru"}),BEM.I18N.decl("b-notification",{actual:"Страница актуальна",not_actual:"Да, устарела",notification:"Страница не обновлялась более года, возможно, информация устарела"},{lang:"ru"}),BEM.I18N.decl("b-old-page",{link_wiki_page:"Ссылка на страницу вики",mark_as_actual:"Пометить как актуальную",mark_as_obsolete:"Пометить как устаревшую",mark_failed:"Не удалось пометить страницу"},{lang:"ru"}),BEM.I18N.decl("b-old-page-mark",{actual_pages:"Актуальная информация",last_update:"Последнее обновление",marked_obsolete:"страница помечена устаревшей",old_page:"Устаревшая страница",unmark:"Снять пометку"},{lang:"ru"}),BEM.I18N.decl("b-page",{access_mistake:"Если вы считаете это ошибкой, можете прямо сейчас запросить доступ с помощью этой формы",access_request_sended:"Запрос отправлен автору страницы",alreade_ask:"Вы уже посылали запрос доступа к этой странице",ask_access:"Заявка на предоставление доступа",ask_again:"Послать запрос еще раз",ask_mail:"Заявка будет отправлена владельцу страницы (или списку ответственных) для принятия решения о предоставлении доступа",cant_delete_page:"Не удалось сохранить страницу",error:"Ошибка",error_occurred:"Произошла ошибка",here:"здесь","icon-favorite":"Избранное",if_you_mail:"Если напишите нам в ",new_page:"новую страницу",no_access:"У вас не хватает прав на просмотр данной страницы",page:"Страница",reason:"Указанная причина",save:"Сохранить",send:"Отправить",something_broken:"У нас что-то сломалось",title:"Заголовок страницы",we_know_about_exception:"Скорее всего, мы уже видим ошибку в логах и занимаемся её устранением",we_will_answer_you:"мы обязательно сообщим вам, когда проблема будет решена",you_can_create:"По этому адресу в Вики нет совсем ничего. А значит вы сами можете создать здесь "},{lang:"ru"}),BEM.I18N.decl("b-page-actions",{"icon-more":"Дополнительные опции",properties:"Свойства"},{lang:"ru"}),BEM.I18N.decl("b-page-date",{updated:"Обновлено:"},{lang:"ru"}),BEM.I18N.decl("b-page-more-panel",{change_owner:"Сменить владельца",create_page:"Создать подстраницу","delete":"Удалить",mark_as_actual:"Пометить как актуальную",mark_as_obsolete:"Пометить как устаревшую",move:"Переместить",subscribe_users:"Подписать пользователей"},{lang:"ru"}),BEM.I18N.decl("b-page-official",{official_page:"Официальная страница",page_owners:"Владелец страницы",responsible:"Ответственный",responsible_group:"Ответственная группа",responsible_groups:"Ответственные группы",responsibles:"Ответственные"},{lang:"ru"}),BEM.I18N.decl("b-page-user",{owner:"Владелец:"},{lang:"ru"}),BEM.I18N.decl("b-panel",{"icon-sidebar":"Сайдбар"},{lang:"ru"}),BEM.I18N.decl("b-panel-actions",{edit:"Правка","icon-more":"Дополнительные опции"},{lang:"ru"}),BEM.I18N.decl("b-readonly",{cant_change:"сохранение изменений временно недоступно",in_readonly:"Вики в режиме «только для чтения»"},{lang:"ru"}),BEM.I18N.decl("b-request-access",{access_denied:"В доступе было отказано.",access_employee:"Доступ сотруднику",access_granted:"Доступ был выдан.",access_group:"Доступ группе",access_was_processed:"Запрос доступа обработан.",access_will_take:"Доступ получит только ",another_group:"Другая группа",ask_access:" запросил(а) доступ к этой странице",cancel:"Отменить",close:"Закрыть",division:"Подразделения",error:"Ошибка",give_access:"Дать доступ группе — предпочтительный вариант, потому что информация на этой странице, вероятно, так же важна для коллег @",groups_include:"Группы, в которые входит ",no_group_selected:"Не выбрано ни одной группы.",no_id_for_request:"Нет id запроса, невозможно выполнить операцию.",reason_is_required_field:"Причина отказа - обязательное поле.",reject:"Отказать",request_irrelevant:"Запрос неактуален. У пользователя уже есть доступ к этой странице.",request_processed:"Запрос уже обработан.",save:"Сохранить",services:"Сервисы",use_this:"используйте, если считаете, что доступ для группы тут никак не подходит.",why_you_dont_give_access:"Пожалуйста, объясните человеку, почему информация на этой странице останется закрытой для него.",wrong_status:"Статус запроса не распознан. Что-то пошло не так.",you_want_reject_access:"Вы собираетесь отказать в доступе к странице."},{lang:"ru"}),BEM.I18N.decl("b-revision-diff",{cant_load_diff:"Не удалось загрузить diff"},{lang:"ru"}),BEM.I18N.decl("b-sidebar",{h2:"Заголовок H2",h3:"Заголовок H3",hotkeys:"Горячие клавиши","icon-code":"Код вставки таблицы","icon-events":"События","icon-files":"Файлы","icon-hotkeys":"Комбинации клавиш","icon-settings":"Настройки","icon-sitemap":"Вложенные страницы","icon-toc":"Оглавление",italic:"Курсив",left_inset:"Отступ слева",not_numberes_list:"Не нумерованный список",numbered_list:"Нумерованный список",remove_indent:"Удалить отступ",strikethrough:"Перечеркнутый",underlined:"Подчеркнутый"},{lang:"ru"}),BEM.I18N.decl("b-subscribe-button",{cant_subscribe:"Не удалось осуществить подписку",not_signed:"Не подписан",signed:"Подписан",signed_on_cluster:"Подписан на кластер",subscribe:"Подписаться",subscribe_to_entire_cluster:"Подписаться на весь кластер",subscription:"Подписка:",unsubscribe:"Отписаться"},{lang:"ru"}),BEM.I18N.decl("b-tree-action",{cant_open_subpages:"Не удалось раскрыть все подстраницы"},{lang:"ru"}),BEM.I18N.decl("b-widget",{add_department_or_person:"Добавить отдел или человека",add_link:"Добавить еще одну ссылку",add_links_text:"Если вы знаете страницы с актуальной информацией по теме, добавьте ссылки на эти страницы",add_users:"Добавить пользователей",cancel:"Отмена",close:"Закрыть",cluster_new_address:"Новый адрес вашего кластера",comment:"Комментарий",create:"Создать",current_address_of_cluster:"Текущий адрес кластера",current_address_table:"Текущий адрес таблицы",grid:"Таблица",grid_already_exist:"Такая таблица уже есть",input_page_name:"Введите название страницы",link_wiki_page:"Ссылка на страницу вики",mark:"Пометить",mark_page_as_actual:"Пометить страницу как актуальную",mark_page_as_obsolete:"Пометить страницу как устаревшую",move_table:"Таблица будет перенесена на указанный вами адрес, по старому адресу будет создан редирект на новый.",move_the_cluster:"Перенести кластер",move_the_table:"Перенести таблицу",name:"Название",not_valid_url:"Не валидный урл новой страницы.",page:"Страница",page_already_exist:"Такая страница уже есть",page_in_current_cluster:"страница будет создана в текущем кластере",page_in_home_cluster:"страница будет создана в домашнем кластере",page_on_current_address:"страница будет создана по текущему адресу",reject:"Отменить",restricted_access:"Ограниченный доступ",save:"Сохранить",set_page_name_to_move_cluster:"Укажите, под какую страницу вы собираетесь перенести кластер",set_page_name_to_move_table:"Укажите, под какую страницу вы собираетесь перенести таблицу",sign_on_page:"Подписать на страницу",subpages:"подстраниц",subscribe:"Подписать",success_subscribe:"Пользователи подписаны на страницу, им выслано письмо-уведомление с вашим комментарием",table_new_address:"Новый адрес таблицы",validation_error:"Ошибка валидации"},{lang:"ru"}),BEM.I18N.decl("b-wiki-form",{cant_save_form:"Не удалось сохранить форму",choose_date:"выберите дату",data_successfully_send:"Данные успешно отправлены.",error_in_target:"Ошибка в поле target:",form_send_error:"При отправке формы произошла непредвиденная ошибка:",missing_field_in_target:"Поле target содержит ненайденное поле",send:"Отправить",unknown_error:"Неизвестная ошибка",unknown_page:"Вы пытаетесь отправить форму на страницу, которая не существует",yaml_error:"Ошибка в синтаксисе YAML:"},{lang:"ru"}),BEM.I18N.decl("b-wiki-grid",{backend_error:"Ошибка от бекенда"},{lang:"ru"}),BEM.I18N.decl("i-services",{404:"404",adresa:"Адреса",advertising:"Реклама",afisha:"Афиша",all:"Все сервисы",api:"API",appsearch:"Приложения",auto:"Авто",avia:"Авиабилеты",aziada:"Азиада",ba:"Баян",backapv:"Партнер Я.Карт",balance:"Баланс",bar:"Бар","bar-ie":"Бар для ИЕ","bar-ie9":"Бар для ИЕ9",bayan:"Баннеры Яндекса",blogs:"Блоги",books:"Книги",browser:"Браузер",calendar:"Календарь",captcha:"ой...",catalogwdgt:"Каталог виджетов",chrome:"Хром с поиском Яндекса",city:"Города",cityday:"День города",collection:"Коллекция",company:"Компания",contest:"Contest",desktop:"Персональный поиск",direct:"Директ","direct.market":"Маркет",disk:"Диск",ege:"ЕГЭ",expert:"Эксперт",feedback:"Обратная связь",feedback2:"Обратная связь",ff:"ФФ с поиском Яндекса",fotki:"Фотки",fresh:"Свежее",games:"Игрушки",geocontext:"Геоконтекст",goroda:"Города",help:"Помощь",i:"Мои сервисы",ie:"ИЕ с поиском Яндекса",images:"Картинки","images-com":"Картинки",interests:"Интересы",internet:"Интернет",keyboard:"Клавиатура",kraski:"Краски",kuda:"Куда все идут",large:"Яндекс для слабовидящих",legal:"Правовые документы",lenta:"Лента",libra:"Библиотека",literacy:"Неделя борьбы за грамотность",local:"Локальная сеть",lost:"Незабудки",love:"День взаимного тяготения — 13 августа",mail:"Почта",maps:"Карты","maps-wiki":"Народная карта",market:"Маркет","market.advertising":"Маркет",metrika:"Метрика",metro:"Метро",mobile:"Мобильный",moikrug:"Мой Круг",money:"Деньги",museums:"Дни исторического и культурного наследия",music:"Музыка","music-partner":"Музыка: статистика",nahodki:"Мои находки",nano:"Нано",newhire:"Наниматор",news:"Новости",notifications:"Нотификационная панель",oauth:"Авторизация",online:"Онлайн",openid:"OpenID",opera:"Opera Software",opinion:"Цитаты",partners:"Рекламная сеть",partnersearch:"Поиск для партнеров",passport:"Паспорт",pdd:"Почта для домена",peoplesearch:"Люди",perevod:"Перевод",probki:"Пробки",pulse:"блоги: пульс",punto:"Punto switcher",pvo:"Ответы",rabota:"Работа",ramazan:function(){},rasp:"Расписания",realty:"Недвижимость",referats:"Рефераты",rk:"Есть вопросы?",root:"Яндекс.Олимпиада для Unix администраторов",school:"Школа",search:"Поиск",server:"Сервер",site:"Поиск для сайта",slovari:"Словари",so:"Самооборона",social:"Социализм",soft:"Программы",sport:"Спорт",sprav:"Справочник",start:"Стартовая страница",stat:"Статистика",subs:"Подписки",taxi:"Такси",terms:"Разговорник",tests:"Тесты и опросы",tickets:"Билеты",time:"Яндекс.Время",toster:"Тосты",translate:"Перевод",tune:"Настройки",tv:"Телепрограмма",uslugi:"Услуги",video:"Видео","video-com":"Видео",vno:"ВНО",wdgt:"Виджеты",weather:"Погода",webmaster:"Вебмастер",widgets:"Виджеты",wordstat:"Статистика",wow:"Я.ру",www:"Поиск",xmlsearch:"XML",yaca:"Каталог",yamb:"Медийные баннеры",zakladki:"Закладки",access:"Доступ",admins:"Админы",blogmon:"Блогмонитор",bond:"Брак",center:"Интранет",diary:"Этушка",doc:"Документация",gap:"Планировщик отсутствий","intranet-passport":"Внутренний паспорт",invite:"Переговорки",jabber:"Джаббер","jams-arm":"АРМ экспертов Яндекс.Пробок",jing:"Джинг",jira:"Jira",job:"Job-jira",lego:"Лего",lunapark:"Лунапарк",maillists:"Рассылки",otrs:"OTRS",planner:"Планировщик",projects:"Проекты",staff:"Стафф",statface:"Статистика",study:"Обучатор",tracker:"Трекер",videoteka:"Обучатор",wiki:"Вики"},{lang:"ru"}),BEM.I18N.decl("i-tanker__days",{acc1:"в понедельник",acc2:"во вторник",acc3:"в среду",acc4:"в четверг",acc5:"в пятницу",acc6:"в субботу",acc7:"в воскресенье",n1:"понедельник",n2:"вторник",n3:"среда",n4:"четверг",n5:"пятница",n6:"суббота",n7:"воскресенье",name:function(t){return function(t){return i18n.tanker.days[(t["short"]?"short":"n")+t.day]()}.call(this,t)},short1:"пн",short2:"вт",short3:"ср",short4:"чт",short5:"пт",short6:"сб",short7:"вс",today:"сегодня",tomorrow:"завтра",yesterday:"вчера"},{lang:"ru"}),BEM.I18N.decl("i-tanker__months",{g1:"Января",g10:"Октября",g11:"Ноября",g12:"Декабря",g2:"Февраля",g3:"Марта",g4:"Апреля",g5:"Мая",g6:"Июня",g7:"Июля",g8:"Августа",g9:"Сентября",n1:"Январь",n10:"Октябрь",n11:"Ноябрь",n12:"Декабрь",n2:"Февраль",n3:"Март",n4:"Апрель",n5:"Май",n6:"Июнь",n7:"Июль",n8:"Август",n9:"Сентябрь",name:function(t){return function(t){var e=i18n.tanker.months[(t["case"]||"n")+t.month]();return Boolean(t.lowercase)?e.toLowerCase():e}.call(this,t)},short1:"янв",short10:"окт",short11:"ноя",short12:"дек",short2:"фев",short3:"мар",short4:"апр",short5:"май",short6:"июн",short7:"июл",short8:"авг",short9:"сен"},{lang:"ru"}),BEM.I18N.decl("link",{cant_load_subpages:"Не удалось загрузить подстраницы"},{lang:"ru"}),BEM.I18N.decl("m-button-action",{email:"Написать письмо",jabber:"Написать в jabber"},{lang:"ru"}),BEM.I18N.decl("m-datepicker",{clear:"очистить"},{lang:"ru"}),BEM.I18N.decl("m-datepicker__short-days",{1:"пн",2:"вт",3:"ср",4:"чт",5:"пт",6:"сб",7:"вс"},{lang:"ru"}),BEM.I18N.decl("m-editor",{clear:"очистить",unsaved_changes:"Есть несохранённые изменения. Хотите применить их?"},{lang:"ru"}),BEM.I18N.decl("m-editor-button",{header2:"Заголовок 2",header3:"Заголовок 3",bold:"Жирный",italic:"Курсив",underline:"Подчеркнутый",strike:"Перечеркнутый",ulist:"Маркированный список",olist:"Нумерованный список",indent:"Отступ слева",outdent:"Отступ справа",quote:"Цитата",separator:"Разделитель",link:"Создать ссылку",picture:"Создать картинку",code:"Вставить код",table:"Таблица",color:"Цветной текст",math:"Формула",spell:"Проверка орфографии",other:"Другие функции"},{lang:"ru"}),BEM.I18N.decl("m-editor-popup",{createLink:"Создание ссылки",pathToLink:"Ссылка",linkText:"Текст",createPicture:"Создание картинки",pictureSize:"Размеры",picturePixels:"в пикселях",pictureWidth:"Ширина",pictureHeight:"Высота",pictureLink:"Ссылка",pictureLinkPlaceholder:"Ссылка на картинку",createCode:"Код с подсветкой синтаксиса",codeStyle:"Синтаксис",codeText:"> Вставьте свой код сюда"},{lang:"ru"}),BEM.I18N.decl("m-head-arrow",{error:"Не удалось получить список сервисов."},{lang:"ru"}),BEM.I18N.decl("m-head-search",{hint:"поиск по интранету",find:"Найти"},{lang:"ru"}),BEM.I18N.decl("m-head-user",{staff:"Я на Стаффе",options:"Настройки",logout:"Выход",wiki:"Я на Wiki"},{lang:"ru"}),BEM.I18N.decl("m-orange",{old_messages:"Старые уведомления",load_error:"Не удалось загрузить уведомления",repeat_request:"Повторить запрос",no_new_messages:"Новых сообщений нет",center:"Уведомления и согласования",we_will:"Здесь будут появляться уведомления о важных событиях."},{lang:"ru"}),BEM.I18N.decl("m-orange-actions",{accepted:"Принято",accept:"Принять",declined:"Отклонено",decline:"Отклонить",comment:"Комментарий",laquo:"«",raquo:"»",comment_placeholder:"Обязательно оставьте комментарий",done:"Готово"},{lang:"ru"}),BEM.I18N.decl("m-orange-item",{error:"Произошла ошибка, повторите, пожалуйста, действие",already_answered:"Запрос был согласован другим ответственным"},{lang:"ru"}),BEM.I18N.decl("m-speller",{notfound:"Нет в словаре","correction-title":"Исправление","checking-language":"Язык проверки",options:"Варианты:","ignore-once":"Пропустить","ignore-all":"Пропустить все",add:"Добавить",replace:"Заменить",replaceAll:"Заменить все",dictLang:"Язык словаря:",cancel:"Отмена",select:"Выбрать:",en:"Английский",ru:"Русский",uk:"Украинский","ignore-uppercase":"Пропускать слова из ПРОПИСНЫХ букв","ignore-digits":"Пропускать слова с цифрами","ignore-urls":"Пропускать URL'ы  и имена файлов","find-repeat":"Подсвечивать повторяющиеся слова",userDict:"Словарь пользователя..",params:"Язык и настройки",hideparams:"Скрыть настройки",close:"Закрыть",complete:"Проверка правописания завершена!","not-checked":"Проверка правописания не осуществлялась",checked:"Проверка завершена",recommended:"рекомендуется",correction:"исправлений",correction1:"исправление",correction2:"исправления","corr-not-found":"рекомендуемых исправлений не найдено","add-to-dict":"добавить в словарь","options-not-found":"варианты не найдены"},{lang:"ru"}),BEM.I18N.decl("m-suggest-item",{staff:"Сотрудник",maillist:"Рассылка",department:"Отдел",table:"Стол",equipment:"Оборудование",floor:"этаж"},{lang:"ru"}),BEM.I18N.decl("m-uploader",{cant_save_page:"Не удалось сохранить страницу",choose_file:"Выбрать файл",drag_file:"Перетащите файл на страницу"},{lang:"ru"}),BEM.I18N.decl("mi-date",{h:"ч","just-now":"только что",min:"мин","today-at":"сегодня в","yesterday-at":"вчера в"},{lang:"ru"}),BEM.I18N.decl("mi-error",{title:"Ой, что-то пошло нет так",body:"Ученые в панике!Неведомая доселе ошибка!"},{lang:"ru"}),BEM.I18N.decl("wiki-change",{text:"Инплейс редактирование больше недоступно. Ваши изменения могли быть потеряны, сожалеем об этом. Попробуйте обновить страницу."},{lang:"ru"}),BEM.I18N.lang("ru");